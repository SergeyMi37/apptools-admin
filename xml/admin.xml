<?xml version="1.0" encoding="UTF-8"?>
<Export generator="IRIS" version="26" zv="IRIS for UNIX (Red Hat Enterprise Linux for x86-64) 2020.3 (Build 304U)" ts="2021-08-12 21:34:32">
<Class name="apptools.Chart.Chart">
<Super>apptools.core.AutoPage</Super>
<TimeChanged>65428,53141.445298</TimeChanged>
<TimeCreated>64985,34590.862384</TimeCreated>

<Parameter name="CSPURL">
<Default>apptools.Chart.Chart.cls</Default>
</Parameter>

<Parameter name="PAGENAME">
<Default>Chart</Default>
</Parameter>

<Parameter name="PARENTPAGE">
<Default>apptools.core.AutoPage.cls</Default>
</Parameter>

<Method name="GetDetailPane">
<Description>
Get the detail pane info object</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pInstance:%CSP.Util.PageInstance</FormalSpec>
<ReturnType>%CSP.Util.Pane</ReturnType>
<Implementation><![CDATA[	quit ##class(apptools.Chart.ChartPanel).%New()
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Chart.ChartPanel">
<IncludeCode>apptools.core</IncludeCode>
<Super>apptools.core.LogInfoPane</Super>
<TimeChanged>65940,38755.591642</TimeChanged>
<TimeCreated>64985,34799.861897</TimeCreated>

<Parameter name="XMLTYPE">
<Default>apptools.Chart.ChartPanel</Default>
</Parameter>

<Method name="DrawBODY">
<Description>
Drawing graphs</Description>
<FormalSpec>pInstance:PageInstance</FormalSpec>
<PublicList>nsp,what,field,value,type,typeclass,caption</PublicList>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 	write ##class(apptools.core.LogInfoPane).AddJsScripts("chart")
	set $ZT="errors"
	set nsp=%request.Get("NSP")
	if nsp'="" try {zn nsp set NSpace=nsp } catch e {}
	set NSpace=$zu(5)

	set arg("header")="Error"
	set arg("labels")="[""Error""]"
	set arg("type")="bar" ;line
	set arg("datasets")="{   label: """_$$$aText("Error display on the graph","")_""", borderColor: 'rgb(255, 199, 132)',  data: [30],  }"

	set days=365 ;1000
	if %request.Get("days") S days=%request.Get("days")
	
	if %request.Get("panel")'="" {
		set class=$p($p(%request.Get("panel"),"(",2),")"),method=$p($p(%request.Get("panel"),")",2),".",2)
		set st=$classmethod(class,method,.arg,days)
	}
	&html< <canvas id="Chart"></canvas>
	>
	$$$jsstart
 	write "var ctx = document.getElementById('Chart').getContext('2d');"
 	write "var chart = new Chart(ctx, {   type: '"_$g(arg("type"),"bar")_"',"
    // The data for our dataset
    write "data: {  labels: "_$g(arg("labels"))_","   // ["January", "February", "March", "April", "May", "June", "July"],
    write "   datasets: ["_$g(arg("datasets"))
    write " ] },  options: {    hover: { mode: 'index' }, tooltips: { mode: 'index' }	, title: { display: true, text: '"_$tr($g(arg("header")),"'""")_"'  }    } });"
	$$$jsstop
	quit $$$OK
errors
 	write !,$ze
 	quit $$$OK
]]></Implementation>
</Method>

<Method name="ColorRGBa">
<Description>
d ##class(apptools.Chart.ChartPanel).ColorRGBa(32,0.2)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>num,alfa=1</FormalSpec>
<Implementation><![CDATA[
 
	set c=$e(+num,*)
	;i +num>9 
	;the same light alfa=1 because the opacity: 100% *
	if c=0 quit "rgba(255, 0, 0, "_alfa_")" ;pure red
	if c=1 quit "rgba(255, 99, 132, "_alfa_")" ;red
    if c=2 quit "rgba(255, 159, 64, "_alfa_")" ;orange
    if c=3 quit "rgba(255, 206, 86, "_alfa_")" ;yellow
    if c=4 quit "rgba(0, 255, 0, "_alfa_")" ;pure green
    if c=5 quit "rgba(75, 192, 192, "_alfa_")" ;green
    if c=6 quit "rgba(12, 164, 240, "_alfa_");" ;blue
    if c=7 quit "rgba(0, 0, 255, "_alfa_")" ;clear blue
    if c=8 quit "rgba(54, 162, 235, "_alfa_")" ;blue
    if c=9 quit "rgba(153, 102, 255, "_alfa_")" ;purple
]]></Implementation>
</Method>

<Method name="FinishArg">
<Description>
Complete the chart objects</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>res,data,labels,arg</FormalSpec>
<Implementation><![CDATA[
	set datasets=""
	set a="" for num=1:1 { set a=$o(res(a)) quit:a=""
		set data(a)=$e(data(a),1,*-1)_"], }"
		set datasets=datasets_data(a)_","
	}
	set datasets=$e(datasets,1,*-1)
	set labels=$e(labels,1,*-1)_"]"
	set arg("datasets")=datasets
	set arg("labels")=labels
	quit 1
]]></Implementation>
</Method>

<Method name="ChartLicUsed">
<Description>
Dynamics of consumption of license on the basis of regular job 
with legacy method: s st=##class(apptools.core.sys).SaveQuery("%SYSTEM.License:Counts")
d ##class(apptools.Chart.ChartPanel).ChartLicUsed(.arg,1200,.res)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>arg,days,res,gn="^%apptools.Task"</FormalSpec>
<Implementation><![CDATA[
 set par=$p(days,",",2,999)
 set days=+days
 set ToDay=$zd($h,3),FromDay=$zd($h-days,3)
 set arg("header")=$$$aText("The dynamics of license spending based on a regular job in a date range ","")_FromDay_" - "_ToDay
 set arg("type")="line"
 set GN=$na(@gn@("%SYSTEM.License:Counts"))
 set dt=""
 for i=1:1:10 { set dt=$o(@GN@(dt),1) quit:dt=""
 	write !,dt," ",$g(@GN@(dt,4,2))
 }
]]></Implementation>
</Method>

<Method name="ChartAlert">
<Description>
Search in the Protocol cconsole.log important events
d ##class(apptools.Chart.ChartPanel).ChartAlert(.arg,1200,.res)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>arg,days,res,list,mm</FormalSpec>
<Implementation><![CDATA[
 	set method="class(apptools.core.files).Alert" 
	do ##class(apptools.core.files).FindContextInLog(days,method,.res) // to parse a Protocol to calculate important events
	set df=$p(res," ",1)
	set dt=$p(res," ",2)
	set arg("header")=$$$aText("Important system events in the date range ","")_df_" - "_dt
	set arg("type")="line"
	set labels="["
	for yyyy=$p(df,".",3):1:$p(dt,".",3) {
		for m=1:1:12 {
			if yyyy=$p(df,".",3),m<$p(df,".",2)  continue
			if yyyy=$p(dt,".",3),m>$p(dt,".",2)  continue
			if m?1n s mm="0"_m
			else  s mm=m
			set labels=labels_""""_##class(apptools.core.type).GetTextMonth(mm)_"."_yyyy_""","
			set a="" f num=1:1 { s a=$o(res(a)) q:a=""
				if '$d(color(a)) s color(a)=num
				if '$d(data(a)) s data(a)="{  label: """_a_""", borderColor: '"_..ColorRGBa(color(a),1)_"',  data: ["
				set data(a)=data(a)_+$g(res(a,yyyy,mm))_","
			}

		}
	}
 do ..FinishArg(.res, .data, .labels, .arg)
 quit $$$OK
]]></Implementation>
</Method>

<Method name="ChartDbSize">
<Description>
Retrospective database sizes
d ##class(apptools.Chart.ChartPanel).ChartDbSize(.arg,1200,.res,.list,.mm)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>arg,days,res,list,mm</FormalSpec>
<Implementation><![CDATA[
	set method="class(apptools.core.files).ExpansionDB" 
	do ##class(apptools.core.files).FindContextInLog(days,method,.res) //to disassemble the Protocol to calculate the monthly growth of the database in megabytes
	do ##class(apptools.core.rest).getDBsize("dbsize",.list) //to calculate the current database size in gigabytes
	//let's go back in time taking masany growth
	s df=$p(res," ",1)
	s dt=$p(res," ",2)
	s arg("header")=$$$aText("Dynamics of database growth in the date range ","")_df_" - "_dt
	s arg("type")="line"
	s labels="["
	s datasets="{  label: """_$$$aText("Error display on the graph","")_""", borderColor: '"_..ColorRGBa(0,1)_"',  data: [30],  }"
	s bd="",(max,free,maxbd)=0
	f num=1:1 { s bd=$o(list(bd)) q:bd=""  
		s list(bd)=list(bd)*1024
		i list(bd)>max s max=list(bd),free=list(bd,"free")*1024,maxbd=list(bd,"name")
		s order(list(bd))=bd //Rangiroa size
		s color(bd)=num
	}
	s list("free","name")="Disk Free Size + "_$g(maxbd)
	s list("free")=max+free
	s order(max+free)="free"
	s color("free")=0
	;zw order	zw list
	//translate into megabytes
	s mm=$p(dt,".",2)
	f yyyy=$p(dt,".",3):-1:$p(df,".",3) {
		for {
			i mm?1n s mm="0"_mm
			;w !,yyyy,"-",mm
			s bd=""	f { s bd=$o(list(bd)) q:bd=""   continue:bd="total"
				s mm(yyyy,mm,bd)=list(bd) ;,1,2) ;the current size of the gig
				i $d(res(bd,yyyy,mm)) {
					s list(bd)=list(bd)-($g(res(bd,yyyy,mm))) //subtract monthly increase in moving Gigi
					i list(bd)<0 s list(bd)=0
				}
			}
			s mm=mm-1
			i mm<1 s mm=12 q
			i yyyy=$p(df,".",3),mm<$p(df,".",2) q

		}
	}
	s yyyy="" f { s yyyy=$o(mm(yyyy)) q:yyyy=""
		f mon=1:1:12 { 
			s mm=mon i mm?1n s mm="0"_mm
			continue:'$d(mm(yyyy,mm))
			s labels=labels_""""_##class(apptools.core.type).GetTextMonth(mm)_"."_yyyy_""","
			s bd2="" f { s bd2=$o(order(bd2),-1,bd) q:bd2=""
				i '$d(data(bd)) s data(bd)="{  label: """_list(bd,"name")_""", borderColor: '"_..ColorRGBa(color(bd),1)_"',  data: ["
				s data(bd)=data(bd)_$g(mm(yyyy,mm,bd))_","
			}
		}
	}
	s datasets=""
	s bd2="" f { s bd2=$o(order(bd2),-1,bd) q:bd2=""
		s data(bd)=$e(data(bd),1,*-1)_"], }"
		s datasets=datasets_data(bd)_","
	}
	s datasets=$e(datasets,1,*-1)
	s labels=$e(labels,1,*-1)_"]"
	s arg("datasets")=datasets
	s arg("labels")=labels
	q 1
]]></Implementation>
</Method>

<Method name="ChartEnsUtilLog">
<Description>
Plot the error of the ensemble Protocol Ens_Util.Log where Type='2' </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>arg,days,res,list</FormalSpec>
<Implementation><![CDATA[
 s ns=$p(days,",",2,999)
 s days=+days
 s ToDay=$zd($h,3),FromDay=$zd($h-days,3)
 s sql="select Convert(VarChar,TimeLogged, 103) as days,count(*) as erro from Ens_Util.Log where Type='2' and TimeLogged>'"_FromDay_"' and TimeLogged<'"_ToDay_"' and (Text not like '%ErrFTP%' and Text not like '%"_$$$aText("Not implemented","")_"%' and text not like '%"_$$$aText("The key is not defined uniquely","")_"%' and text not like '%Could not get%') group by Convert(VarChar,TimeLogged, 103)"
 f i=1:1:$l(ns,",") {
	 s nspace=$p(ns,",",i)
	 continue:nspace=""
	 $$$NspGoto(curNs,nspace)
	 i nspace=$zu(5) {
		s gn="^||tmpCount" ;_$tr(nspace,"-")
		;w "<br>"_gn
		s res(nspace)=""
		d ##class(apptools.core.sys).SaveSQL(sql,gn)
		f ii=1:1 {  q:'$d(@gn@(ii))
			s count=+$lg($g(@gn@(ii)),2)
			s dat=$lg($g(@gn@(ii)),1)
			s dd=$p(dat,"/",1),mm=$p(dat,"/",2)
			s res(nspace,$p(dat,"/",3)_"-"_mm_"-"_dd)=count
		}
	 }
	 $$$NspReturn(curNs)
 }
 s arg("header")=$$$aText("Number of Ens_Util errors.Log in date range","")_FromDay_" - "_ToDay
 s arg("type")="line"
 s labels="["
 for day=$h-days:1:+$h {
	s labels=labels_""""_$zd(day,3)_""","
	s a="" f num=1:1 { s a=$o(res(a)) q:a=""
		i '$d(color(a)) s color(a)=num
		i '$d(data(a)) s data(a)="{  label: """_a_""", borderColor: '"_..ColorRGBa(color(a),1)_"',  data: ["
		s data(a)=data(a)_+$g(res(a,$zd(day,3)))_","
	}
 }
 d ..FinishArg(.res, .data, .labels, .arg)
 q 1
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Form.Exp">
<IncludeCode>apptools.core</IncludeCode>
<Modified>0</Modified>
<Super>apptools.core.AutoPage</Super>
<TimeChanged>65610,77273.857</TimeChanged>
<TimeCreated>64760,78939.721801</TimeCreated>

<Parameter name="CSPURL">
<Default>apptools.Form.Exp.cls</Default>
</Parameter>

<Parameter name="PAGENAME">
<Default>Objects Explorer</Default>
</Parameter>

<Parameter name="PARENTPAGE">
<Default>apptools.core.AutoPage.cls</Default>
</Parameter>

<Method name="GetDetailPane">
<Description>
Get the detail pane info object</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pInstance:%CSP.Util.PageInstance</FormalSpec>
<ReturnType>%CSP.Util.Pane</ReturnType>
<Implementation><![CDATA[	quit ##class(apptools.Form.Explorer).%New()
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Form.Explorer">
<Description>
</Description>
<IncludeCode>apptools.core</IncludeCode>
<Super>apptools.core.LogInfoPane</Super>
<TimeChanged>65610,77273.857</TimeChanged>
<TimeCreated>64760,79525.802682</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Method name="DrawBODY">
<Description>
Draw a shape for input information</Description>
<FormalSpec>pInstance:PageInstance</FormalSpec>
<PublicList>nsp,what,field,value,type,typeclass,caption</PublicList>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 	write ##class(apptools.core.LogInfoPane).AddJsScripts("grid")
	set $ZT="errors"
	set nsp=%request.Get("NSP")
	if nsp'="" try {zn nsp set NSpace=nsp } catch e {}
	set NSpace=$zu(5)
	set SelClass=$tr(%request.Get("SelClass"),"_",".")
	// Navigator system
	if %request.Get("panel")="AccordionExp" {
	&html<
	 <div id="accordion" style='width: 100%; height: 100%'>
		<h3 id=aNSPh>Namespace: <span id=aNSPhead></span></h3>
		<div id=aNSP></div>
		
		<h3 id=aCLSh >Classes: <span id=aCLShead></span></h3>
		<div id=aCLS></div>
		
		<h3 id=aOBJh>Objects: <span id=aOBJhead></span></h3>
		<div id=aOBJ></div>
		
		<h3 id=aPROh>Propertis: <span id=aPROhead></span></h3>
		<div id=aPRO></div>
	 </div>
	>
	d ##class(apptools.core.LogInfoPane).AddJS(NSpace,..%ClassName(1))
	$$$jsstart	// To load a list of fields
		w "$( '#accordion' ).accordion({"
	 	w " collapsible: true, icons: { header: ""ui-icon-zoomin"",  headerSelected: ""ui-icon-zoomout"" }"
		w "});"
	    w " var Namespace = ["
    	s ns=##class(apptools.core.sys).ListNS(.info)
    	f i=1:1:$l(ns,",") {
    		continue:$p(ns,",",i)="%All"
    		continue:$p(ns,",",i)=""
    		w "{ ""Namespace"": """_$p(ns,",",i)_""" }"_$s($p(ns,",",i+1)="":"",1:",")
    	}
   		w "];"
    
    $$$jsstop
 	&js< <script>
    $("#aNSP").jsGrid({
        width: "*",
        height: "auto",
 
        inserting: false,
        editing: false,
        sorting: true,
        paging: true,
  		rowClick: function(args) {
            console.log(args.item);
            $("#aNSPhead").html(args.item.Namespace);
            $("#aCLS").empty();
            $("#aCLShead").html("");
			$.blockUI( { message: '...Loading' , css: { border: 'none', padding: '15px', backgroundColor: '#000', '-webkit-border-radius': '10px','-moz-border-radius': '10px', opacity: .5, color: '#fff' }} );
            $("#aCLS").load("apptools.core.Action.cls","appClass=apptools.Form.Explorer&appMethod=Class2Grid&appNsp="+args.item.Namespace+"&appPar="+args.item.Namespace);
        },
        data: Namespace,
        fields: [
            { name: "Namespace", type: "text", width: 150, validate: "required" }
            
        ]
    });
	</script>>
	}
	/// Navigator of selectors
	else {
	&html<
		<!-- ui-dialog -->
	<div id="dialog" title="Dialog Title">
		<div id=dialogContent></div>
	</div>
		<form name="loginfo" id="loginfo">
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
		  <td>#(##class(apptools.core.LogInfo).GetInfoImg("search"))# 
			 <DIV id='MainNamespaces'></div>
			 <DIV id='MainClasses'></div>
			 <DIV style='overflow: auto;' id='MainObjects'></div>
			</td>
		 </tr>
		 <tr>
		   <td>
	 		<div id="MainContent">
	 		</div>
		   </td>
		 </tr>
		</table>
		>
		 d ##class(apptools.core.LogInfoPane).AddJS(NSpace,..%ClassName(1))
		 $$$jsstart	// To load a list of fields
		   	; to calculate the height of the container as a result of wijetunge victory container-Taba height of the container header
		 	w "$('#MainObjects').height(window.innerHeight-200);"

		 	write "$('#MainNamespaces').load('apptools.core.Action.cls','appClass=apptools.Form.Explorer&appMethod=SelectNsp&appNsp="_$zu(5)_"');"
		 	write "$('#MainClasses').load('apptools.core.Action.cls','appClass=apptools.Form.Explorer&appMethod=SelectClasses&appNsp="_$zu(5)_"&appPar="_$g(SelClass)_"');"
		 $$$jsstop
		write "<br><br><form>"
	}
	quit $$$OK

errors
 	write !,$ze
 	quit $$$OK
]]></Implementation>
</Method>

<Method name="Class2Grid">
<Description>
The list of classes in a table</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<Implementation><![CDATA[
	set ListClasses=""
	do ..SelectClasses("",.ListClasses)
	$$$jsstart	// Download a list of classes
    write " var classes = ["
    	set i=""
    	for { s i=$o(ListClasses(i)) quit:i=""
    		write "{ ""ClassNames"": """_i_""",""SuperClass"": """_$lg(ListClasses(i),3)_""" }"_$s($o(ListClasses(i))="":"",1:",")
    	}
   		 write "];"
    
    $$$jsstop
 	&js< <script>
 	 console.log(classes);
    $("#aCLS").jsGrid({
        width: "*",
        height: "auto",
        inserting: false,
        editing: false,
        sorting: true,
        paging: true,
  		rowClick: function(args) {
            console.log(args.item);
            $("#aCLShead").html(args.item.ClassNames);
            $("#aOBJ").empty();
            $("#aOBJhead").html("");
			$.blockUI( { message: '...Loading' , css: { border: 'none', padding: '15px', backgroundColor: '#000', '-webkit-border-radius': '10px','-moz-border-radius': '10px', opacity: .5, color: '#fff' }} );
            $("#aOBJ").load("apptools.core.Action.cls","appClass=apptools.Form.Explorer&appMethod=Obj2Grid&appNsp="+$("#aNSPhead").html()+"&appPar="+args.item.ClassNames);
        },
        data: classes,
         fields: [
            { "name": "ClassNames", "type": "text", "width": "50%", "validate": "required" ,autosearch: true},
            { "name": "SuperClass", "type": "text", "width": "*", "validate": "required" }
                   
        ]
    });
      $("#aCLSh").click();
      $.unblockUI();
	</script>
	>
]]></Implementation>
</Method>

<Method name="Obj2Grid">
<Description>
A list of instances of classes in a table</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<Implementation><![CDATA[
	#define tra(%s) $zconvert(%s,"O","JS")
	set count=..GetCountTab(Par,.tab)
	set sql="select * from "_tab
	set gn="^||tmpAppExpObj2Grid"
	do ##class(apptools.core.sys).SaveSQL(sql,gn)
	set nl=$c(13,10)
	$$$jsstart
   // To load the list of query fields
      set field = "["
    	for f=1:1:$ll(@gn@(0)) { 
    		set field=field_"{ name: """_$$$tra($lg(@gn@(0),f))_""", type: ""text"", validate: ""required"" }"_$s($ll(@gn@(0))'=f:",",1:"")
    	}
   		 set field=field_"]"
   	write !,nl,"var field = "_field_";",!,nl
   	;w "var field2=JSON.parse(field);",!,nl
    // Download a list of classes
    set max=$$$MAXSHOW
    write " var objects = [",!
    	set i="0"
    	for { s i=$o(@gn@(i)) q:i=""  q:i>max  ;limit
    		write "{ "
    		for f=1:1:$ll(@gn@(0)) {
	    		set val=$lg(@gn@(i),f)
	    		set:$l(val)>80 val=$e(val,1,50)_"..."
    			write """"_$$$tra($lg(@gn@(0),f))_""": """_$$$tra(val)_""" "_$s($ll(@gn@(0))'=f:",",1:"")
    		}
    		write "}"_$s($o(@gn@(i))'="":",",1:""),!
    	}
   		 write "];",!,nl
    	write "$('#aOBJhead').html('Total: "_+count_"');",!,nl
    $$$jsstop
 	&js< <script>
 	   $("#aPROhead").html("");
 	   console.log(objects);
    $("#aOBJ").jsGrid({
        width: "*",
        height: "auto",
        inserting: false,
        sorting: true,
        paging: true,
  		rowClick: function(args) {
            console.log(args.item);
            var pro='';
            for (var item in args.item) { // "foreach"
     		   console.log(args.item[ item ]);
     		   pro=pro+' '+args.item[ item ]
    		}
            $("#aPROhead").html(pro);
            $("#aPRO").load("apptools.core.Action.cls","appClass=apptools.Form.Explorer&appMethod=PRO2Grid&appNsp="+$("#aNSPhead").html()+"&appPar="+args.item.ID+","+$("#aCLShead").html());
            $("#aPRO").click();
        },
        fields: field,
        data: objects
          
    });
 	$("#aOBJh").click();
  	$.unblockUI();
	$("#aPROhead").html("Create new");
	$("#aPRO").load("apptools.core.Action.cls","appClass=apptools.Form.Explorer&appMethod=PRO2Grid&appNsp="+$("#aNSPhead").html()+"&appPar=,"+$("#aCLShead").html());
	</script>
	>
]]></Implementation>
</Method>

<Method name="PRO2Grid">
<Description>
To open an instance of the class</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<Implementation><![CDATA[
	write "<form id='MainForm'><div id='MainContent'>"
	set class=$p(Par,",",2)
	set id=$p(Par,",",1)
	set obj=##class(apptools.core.Form).GetObj(Par)
	if '$isobject(obj) { 
		write $$$appError($$$aText("Failed to open object",""))
	}
	else {
		set mode=($roles["%All")_",WithoutCancel,WithCreate"
		do ##class(apptools.core.Form).Show(obj,mode)
	}
	$$$jsstart
	write "$('#aPRO').height('80%');"
	write:id'="" "$('#aPROh').click();"
 	$$$jsstop
	write "</div></form>"
	quit $$$OK
]]></Implementation>
</Method>

<Method name="SelectNsp">
<Description>
To get a list of fields in the select</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<Implementation><![CDATA[
	set NSpace=$zu(5)
	// To get a list of fields
	set listNs=##class(apptools.core.sys).ListNS(.info)
	set onc="$('#MainClasses').empty();$('#MainObjects').empty();$('#MainClasses').load('apptools.core.Action.cls','appClass=apptools.Form.Explorer&appMethod=SelectClasses&appNsp='+this.options[this.selectedIndex].value+'&appPar='+this.options[this.selectedIndex].value);"
	set selectNS="<SELECT title="""_$$$aText("NameSpace","")_""" name=""NSP"" id=""NSP""  > "
	for ns=1:1:$l(listNs,",") { continue:$p(listNs,",",ns)=""
		continue:$p(listNs,",",ns)["%ALL"
  		set selected=$select(NSpace=$p(listNs,",",ns):"selected",1:"")
  		set selectNS=selectNS_" <OPTION "_selected_" VALUE="""_$p(listNs,",",ns)_""">"_$p(listNs,",",ns)_"</OPTION>"
	}
	set selectNS=selectNS_"</SELECT>"
	write selectNS
	$$$jsstart
		w "$( '#NSP' ).selectmenu({ change: function( event, data ) { "_onc_" }, width:1000 }).selectmenu('menuWidget');" ;;.selectmenu('refresh', true).addClass('overflow');"
		w "$( '#NSP-menu' ).css( 'max-height','500px');"
	$$$jsstop
	quit $$$OK
]]></Implementation>
</Method>

<Method name="SelectClasses">
<Description>
To obtain a list of classes in the form of select</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SelectClass="",ListClasses</FormalSpec>
<Implementation><![CDATA[
	set query=##class(%Library.ResultSet).%New("%Dictionary.ClassDefinition:Summary")
 	set st=query.Execute() ;"%Persistent")
	set onc="$('#MainObjects').load('apptools.core.Action.cls','appClass=apptools.Form.Explorer&appMethod=SelectObjects&appNsp="_$zu(5)_"&appPar='+this.options[this.selectedIndex].value);"
 	set selectNS="<SELECT title="""_$$$aText("Classes","")_""" name=""SelClass"" id=""SelClass"" > "
 	while query.Next() { 
 		if 'query.Get("Persistent") continue
		set class=query.Get("Name"),f1=""
		if $zu(5)'="%SYS" continue:$e(class,1)="%"  
		if $e($zu(5),1,3)'="ENS" continue:$e(class,1,3)="Ens"
		set selected=""
		if class=SelectClass s selected="selected",forceONC=1
		if query.Get("Super")["apptools.core.Form" s f1="style='color:red;' title='Inheritor apptools.core.Form'"
		set selectNS=selectNS_" <OPTION "_$g(selected)_" "_f1_" VALUE="""_class_""">"_class_"</OPTION>"
		if $D(ListClasses) s ListClasses(class)=$lb($g(selected),f1,query.Get("Super"),query.Get("System"),query.Get("TimeChanged"),,query.Get("SqlTableName"))
	}
	quit:$D(ListClasses) $$$OK
	
	set selectNS=selectNS_"</SELECT>"
	write selectNS
	$$$jsstart
		write "$( '#SelClass' ).selectmenu({ change: function( event, data ) { "_onc_" }, width:1000 }).selectmenu('menuWidget');" ;;.selectmenu('refresh', true).addClass('overflow');"
		write "$( '#SelClass-menu' ).css( 'max-height','500px');"
	$$$jsstop
	if $g(forceONC) {
		$$$jsstart
			write "$('#MainObjects').load('apptools.core.Action.cls','appClass=apptools.Form.Explorer&appMethod=SelectObjects&appNsp="_$zu(5)_"&appPar="_SelectClass_"');"
		$$$jsstop
	}
	quit $$$OK
]]></Implementation>
</Method>

<Method name="GetCountTab">
<Description>
To obtain the Number of records in the table</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[SelectClass,&tab]]></FormalSpec>
<Implementation><![CDATA[
	set tab=##class(apptools.core.type).GetTableName(SelectClass)
	set sql="select * from "_tab
	set gn="^||tmpAppExpCount"
	do ##class(apptools.core.sys).SaveSQL("select count(*) from "_tab,gn)
	set count=+$lg($g(@gn@(1)),1)
	quit count
]]></Implementation>
</Method>

<Method name="SelectObjects">
<Description>
To obtain a list of instances of a class in a table</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SelectClass,sql="",exec=""</FormalSpec>
<Implementation><![CDATA[
	set count=..GetCountTab(SelectClass,.tab)
	set:sql="" sql="select * From "_tab
	set add=" <span style='"_$$$styleurl_"' onclick=""WinOpen('"_$zu(5)_"','"_..%ClassName(1)_"','WinOpenEditObj','SelectClass="_SelectClass_"&ID=','','"_##class(apptools.core.Action).WriteWinOpenREST(%request)_"');"" title='"_$$$aText("To create an object","")_"' >"_$$$aText("To create","")_"</span>"_sql
	$$$jsstart
		write "$('#MainObjEdit').empty();"
	$$$jsstop
	set %SelectClass=SelectClass
	if exec="" set exec="##class(apptools.Form.Explorer).WinEditObj(.%AppLogInfoVal, %AppLogInfoCol, %AppLogInfoHead, .%AppLogInfoTemp,"""_$zu(5)_""")"
	set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,$$$MAXSHOW,$zu(5),$$$FormatText($$$aText("Instances of class %1 in namespace %2",""),SelectClass,$zu(5))_" "_add,exec)
	quit st
]]></Implementation>
</Method>

<Method name="EditObj">
<Description>
To form active links for editing</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Val,Col,Head,Temp,nspace,DSN</FormalSpec>
<Implementation><![CDATA[
	set res=Val
	if $g(Head) {
		i $g(Val)="ID" s Temp("ID",Col)=""
	}
	else {
		if $D(Temp("ID",Col)) {
			set res=$replace(Val,Val,"<span style='"_$$$styleurl_"' onclick=""$('#MainObjEdit').load('apptools.core.Action.cls','appClass=apptools.Form.Explorer&appMethod=PRO2Grid&appNsp="_nspace_"&appPar="_Val_","_%SelectClass_"');"" >"_Val_"</span>")
		}
	}
	quit res
]]></Implementation>
</Method>

<Method name="WinEditObj">
<Description>
Forming an active link for editing in the window</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Val,Col,Head,Temp,nspace,DSN</FormalSpec>
<Implementation><![CDATA[
	set res=Val
	if $g(Head) {
		if $g(Val)="ID" s Temp("ID",Col)=""
	}
	else {
		if $D(Temp("ID",Col)) {
			s %id=Val
		}
		set res=$replace(Val,Val,"<span title='"_$$$aText("Edit","")_"' style='"_$$$styleurl_"' onclick=""WinOpen('"_nspace_"','"_..%ClassName(1)_"','WinOpenEditObj','&SelectClass="_%SelectClass_"&ID="_$zconvert(%id,"O","URL")_"','','"_##class(apptools.core.Action).WriteWinOpenREST(%request)_"');"" >"_Val_"</span>")
	}
	quit res
]]></Implementation>
</Method>

<Method name="WinOpenEditObj">
<Description>
To open the window to edit the object instance</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par,json</FormalSpec>
<Implementation><![CDATA[
	set id=$g(Par("ID"))
	set ClassName=$tr($get(Par("SelectClass")),"_",".")
	set obj=##class(apptools.core.Form).GetObj(id_","_ClassName)
	set PrefixIdDIV="WinOpenEditObj"
	write "<form id='"_PrefixIdDIV_"MainForm'>"
		do ##class(apptools.core.Form).Show(obj,"1,WithoutCancel,WithoutRef",PrefixIdDIV) 
	write "</form><div id='"_PrefixIdDIV_"MainContent'></div>"
	q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Security.LockDown">
<Description>
Security utilities</Description>
<Abstract>1</Abstract>
<TimeChanged>65610,77273.857</TimeChanged>
<TimeCreated>65491,30914.44517</TimeCreated>

<Method name="Apply">
<Description>
Increase system security to LockDown
The method disables services and applications as in LockDown. Deletes the namespaces "DOCBOOK", "ENSDEMO", "SAMPLES"
The method enables auditing and configures registration of all events in the portal, except for switching the log
and modification of system properties
For all predefined users, change the password and change the properties as in LockDown
	newPassword - new single password instead of %SYS. For LockDown security level, it has an 8.32ANP pattern
	sBindings = 1 Service %Service_bindings enable
	sCachedirect = 1 Service %Service_cachedirect enable
	InactiveLimit=90  
	DemoDelete=0 Demoens,Samples namespaces are being deleted 
	AuditOn=1 
	sECP = 1 Service %Service_ecp enable
	sBindingsIP - list of ip addresses with a semicolon for which to allow CacheStudio connection.

For ECP configurations, you need to add the addresses of all servers and clients to allow connection on %Net.RemoteConnection to remove "abandoned" tasks
	sCachedirectIP - list of ip addresses with a semicolon for which to allow legacy applications connection.
	sECPIP - list of ip addresses with a semicolon for which to allow connection to the ECP server.
	AuthLDAP = 1 In addition to the password, also enable LDAP authentication
	Application example:
	d ##class(apptools.Security.LockDown).Apply("NewPassword123",.msg,1,1,0,0,0,0,"127.0.0.1","127.0.0.1")
	d ##class(apptools.Security.LockDown).Apply("NewPassword123",.msg,1,1,0,0,1,0,"127.0.0.1","127.0.0.1",,1)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>newPassword="",Warn,sBindings="",sCachedirect="",InactiveLimit=90,DemoDelete=0,AuditOn=1,sECP="",sBindingsIP="",sCachedirectIP="",sECPIP="",AuthLDAP=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	write !,"Start Lockdown"
	set userlist=..GetPreparedUsers()
	new $namespace
	set $namespace="%SYS"
	write !,"Applications and services will be authenticated by "_$s('AuthLDAP:"password",1:"password and LDAP")
	set AutheEnabled=$s(AuthLDAP:2080,1:32) ;password
	s serviceCSP = $Select($Select($ZVersion["IRIS":1,1:0):"%service_webgateway",1:"%service_csp")
	if DemoDelete,$zv["IRIS" set DemoDelete=0	
	zn "%sys"
	if newPassword'="" {
		if newPassword'?8.32ANP s text="Password does not match the pattern 8.32ANP" write !,text QUIT $$$ERROR(text)
		write !,"Password is reset to predefined users"
		set tSC=..ChangePassword(newPassword, userlist)
		if '$$$ISOK(tSC) QUIT $$$ERROR(tSC)
		w !,"OK"
	}
	write !,"Modification of service properties:"
	set result=##CLASS(%ResultSet).%New("%DynamicQuery:SQL")
	set tSC=result.Prepare("select NameLowerCase,ClientSystems FROM Security.Services")
	set:tSC tSC=result.Execute()
	if '$$$ISOK(tSC) {
		set text="Service configuration error :"_$SYSTEM.Status.GetErrorText(tSC) write !,text
		QUIT $$$ERROR(text)
	}
	else {
		while result.Next() {
			set name=result.Data("NameLowerCase")
			#;skipping network services
			continue:(name="%service_mirror")||(name="%service_shadow")||(name="%service_datacheck")
			kill prop
			set prop("Enabled")=0
			if name=serviceCSP||(name="%service_terminal")||(name="%service_console")||(name="%service_login") {
				set prop("Enabled")=1 ; turn on
				if name'=serviceCSP s prop("AutheEnabled")=AutheEnabled
				else  s prop("AutheEnabled")=96
			}
			if $G(sBindings),name="%service_bindings" {
				set prop("Enabled")=1
				set prop("AutheEnabled")=AutheEnabled
				set Warn($i(Warn))="If the current system does not intend to develop or edit the source code in CacheStudio, then it is better to turn off the service "_name
				set prop("ClientSystems")=sBindingsIP
			}
			if $G(sCachedirect),name="%service_cachedirect" {
				set prop("Enabled")=1 ; turn on
				set prop("AutheEnabled")=96
				set Warn($i(Warn))="If the current system does not intend to legacy utility, then it is better to turn off the service "_name
				set prop("ClientSystems")=sCachedirectIP
			}
			if $G(sECP),name="%service_ecp" {
				set prop("Enabled")=1
				set Warn($i(Warn))="If the ECP configuration is not enabled on the current system, it is better to turn off the service "_name
				set:$g(sECPIP)="" Warn($i(Warn))="If ECP configuration is enabled, it is best to limit the connection of ECP clients to the ECP server"
				set prop("ClientSystems")=sECPIP
			}
			set tSC=##class(Security.Services).Modify(name,.prop)
			if '$$$ISOK(tSC) write !,name_": Error="_$SYSTEM.Status.GetErrorText(tSC)
		}
		w !,"OK"
	}
	write !,"Passwords are created for all CSP applications."
	set result=##CLASS(%ResultSet).%New("%DynamicQuery:SQL")
	set tSC=result.Prepare("select Name FROM Security.Applications")
	set:tSC tSC=result.Execute()
	if '$$$ISOK(tSC) {
		set text="Application setup error :"_$SYSTEM.Status.GetErrorText(tSC)  write !,text QUIT $$$ERROR(text)
	}
	else {
		#; List of disconnected applications
		set appDisabled("/csp/ensdemo")=1
		set appDisabled("/csp/samples")=1
		set appDisabled("/csp/user")=1
		set appDisabled("/isc/studio/usertemplates")=1
		set appDisabled("/csp/docbook")=1  
		set appDisabled("/csp/documatic")=1
		set appDisabled("/isc/studio/rules")=1
		set appDisabled("/isc/studio/templates")=1
		while result.Next() {
			set CSP=result.Data("Name")
			set csp=$zconvert(CSP,"L")
			kill prop
			if $g(appDisabled(csp)) {
				set prop("Enabled")=0
			} else {
				  set prop("Enabled")=1
			}
		 set prop("AutheEnabled")=AutheEnabled 
		 set tSC=##class(Security.Applications).Modify(CSP,.prop)
		 if '$$$ISOK(tSC) write !,csp_" : Error="_$SYSTEM.Status.GetErrorText(tSC)
		}
	w !,"OK"
	}
	if DemoDelete {
		write !,"Demo namespaces are being deleted."
		for name="ENSDEMO","SAMPLES" {
			do:##class(%Dictionary.CompiledClass).%ExistsId("%Library.EnsembleMgr")
			set tSC = ##class(Config.Namespaces).Delete(name)
			if $$$ISERR(tSC) set text="Delete Error "_name_" :"_$system.Status.GetErrorText(tSC) w !,text
			if $$$ISOK(tSC) write !,"Deleted "_name
		}
		w !,"OK"
	}
	write !,"There is a modification of the basic system settings"
	#dim ss As Security.System  = ##class(Security.System).%OpenId("SYSTEM")
	set ss.PasswordPattern="8.32ANP"
	set ss.AuditEnabled=+AuditOn
	set ss.InactiveLimit=InactiveLimit
	set tSC=ss.%Save()
	if '$$$ISOK(tSC) s text="Error setting basic security settings :"_$SYSTEM.Status.GetErrorText(tSC)  write !,text QUIT $$$ERROR(text)
	w !,"OK"
	if AuditOn {
		write !,"Event Setup AUDIT :"
		Set rs = ##class(%ResultSet).%New("Security.Events:ListActivate")
		Set tSC = rs.Execute()
		if $$$ISERR(tSC) set text="Event setting error AUDIT:"_$system.Status.GetErrorText(tSC) write !,text QUIT $$$ERROR(text)
		set On("%Ensemble/%Message/ViewContents")=1
		set On("%System/%DirectMode/DirectMode")=1
		set On("%System/%Login/Login")=1
		set On("%System/%Login/LoginFailure")=1
		set On("%System/%Login/Logout")=1
		set On("%System/%Login/Terminate")=1
		set On("%System/%Security/ApplicationChange")=1
		set On("%System/%Security/AuditChange")=1
		set On("%System/%Security/AuditReport")=1
		set On("%System/%Security/DBEncChange")=1
		set On("%System/%Security/DomainChange")=1
		set On("%System/%Security/LoginRuleChange")=1
		set On("%System/%Security/Protect")=1
		set On("%System/%Security/ResourceChange")=1
		set On("%System/%Security/RoleChange")=1
		set On("%System/%Security/ServiceChange")=1
		set On("%System/%Security/SSLConfigChange")=1
		set On("%System/%Security/SystemChange")=1
		set On("%System/%Security/UserChange")=1
		set On("%System/%System/AuditRecordLost")=1
		set On("%System/%System/ConfigurationChange")=1
		set On("%System/%System/JournalChange")=0
		set On("%System/%System/RoutineChange")=1
		set On("%System/%System/Start")=1
		set On("%System/%System/Stop")=1
		set On("%System/%System/SuspendResume")=1
		set On("%System/%System/UserEventOverflow")=1
		While rs.Next() {
			set name = $G(rs.Data("Source"))_"/"_$G(rs.Data("Type"))_"/"_$G(rs.Data("Name"))
			if $DATA(On(name)) {
				kill pro
				do ##class(Security.Events).Get($g(rs.Data("Source")),$G(rs.Data("Type")),$G(rs.Data("Name")),.pro)
				if $d(pro) {
					if pro("Enabled")'=(+$G(On(name))) {
						if ##Class(Security.Events).Exists(name,,,.Event,.Status) {
							set Event.Enabled=+$G(On(name))
							set tSC=Event.%Save()
							if '$$$ISOK(tSC) w !,name_": Error="_$SYSTEM.Status.GetErrorText(tSC)
							else  write !,name_" changed"
						}
					}
				}
			}
		}
		do rs.Close()
	}
	write !,"Stop Lockdown SUCSESS"
	quit $$$OK
]]></Implementation>
</Method>

<Method name="GetPreparedUsers">
<Description>
do ##class(apptools.Security.LockDown).GetPreparedUsers()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[  q "Admin,CSPSystem,IAM,SuperUser,UnknownUser,_Ensemble,_SYSTEM"
]]></Implementation>
</Method>

<Method name="ChangePassword">
<Description>
Change password for userlist
do ##class(apptools.Security.LockDown).ChangePassword("msw", ##class(apptools.Security.LockDown).GetPreparedUsers())</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>newPassword="",UsersList=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $namespace
	set $namespace="%SYS"
	set result=##CLASS(%ResultSet).%New("%DynamicQuery:SQL")
	set sql="select NameLowerCase FROM Security.Users where NameLowerCase in ('"_$replace($zconvert(UsersList,"L"),",","','")_"')"
	;w !,sql
	set tSC=result.Prepare(sql)
	set:tSC tSC=result.Execute()
	if '$$$ISOK(tSC) {
		set text="User configuration error :"_$SYSTEM.Status.GetErrorText(tSC) write !,text
		QUIT $$$ERROR(text)
	}
	else {
		while result.Next() {
			set name=result.Data("NameLowerCase")
			;w !,name continue
			kill prop
			set prop("Password")=newPassword
			if name="_system" s prop("Enabled")=0
			if name="unknownuser" s prop("Roles")="" ; delete all roles
			set tSC=##class(Security.Users).Modify(name,.prop)
			if '$$$ISOK(tSC) w !,name_": Error="_$SYSTEM.Status.GetErrorText(tSC)
		}
	}
	q tSC
]]></Implementation>
</Method>

<Method name="addSQLPrivilege">
<Description>
Helper method to add privileges to users
select * from Security.SQLPrivileges where Grantee='test2' and SQLObject['ZPM'</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pNamespace:%String,pSQLObject:%String,pPrivilege:%String,pGrantee:%String,pGrantable:%Boolean=0,pGrantor:%String="_system"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $namespace
	set $namespace="%SYS"
	Set tStatus = $$$OK
	Set tPrivilege = $e(pPrivilege,1)
	If '##class(Security.SQLPrivileges).IDKeyExists(pNamespace, pSQLObject, tPrivilege, pGrantee, pGrantor) {
		Set tSQLPriv = ##class(Security.SQLPrivileges).%New()
		Set tSQLPriv.Namespace = pNamespace
		Set tSQLPriv.SQLObject = pSQLObject
		Set tSQLPriv.Grantable = pGrantable
		Set tSQLPriv.Grantee = pGrantee
		Set tSQLPriv.Privilege = tPrivilege
		Set tSQLPriv.Grantor = pGrantor
		Set tStatus = tSQLPriv.%Save()
		If $$$ISERR(tStatus) Quit
	}
	Quit tStatus
]]></Implementation>
</Method>

<Method name="CreateUser">
<Description>
Create a security user
w ##class(apptools.Security.LockDown).CreateUser("test3", "%DB_IRISSYS,%DB_"_$namespace, "test", "Test user", $namespace, "", "", 0, 1, "Test user")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pUsername:%String,pRoles:%String,pPassword:%String,pFullName:%String,pNamespace:%String,pRoutine:%String="",pExpirationDate:%String="",pChangePassword:%Boolean=0,pEnabled:%Boolean=1,pComment:%String="",pFlags:%String=1</FormalSpec>
<Implementation><![CDATA[
	new $namespace
	set $namespace="%SYS"
	#dim tSC As %Status
	Set tSC=$$$OK,$ZT="Trap"
	s pNamespace=$zcvt(pNamespace,"U")
	Do {
		#dim tExists As %Boolean
		Set tExists = ##class(Security.Users).Exists(pUsername)
		If 'tExists {
			// Create a new user
			Set tSC = ##class(Security.Users).Create(pUsername,
													 pRoles,
													 pPassword,
													 pFullName,
													 pNamespace,
													 pRoutine,
													 pExpirationDate,
													 pChangePassword,
													 pEnabled,
													 pComment,
													 pFlags)
		} Else {
			// User already exists, let's modify
			#dim tProperties
			Set tProperties("Roles")=pRoles
			Set tProperties("Password")=pPassword
			Set tProperties("FullName")=pFullName
			Set tProperties("NameSpace")=pNamespace
			Set tProperties("Routine")=pRoutine
			Set tProperties("ExpirationDate")=pExpirationDate
			Set tProperties("ChangePassword")=pChangePassword
			Set tProperties("Enabled")=pEnabled
			Set tProperties("Comment")=pComment

			// Now, modify this user
			Set tSC = ##class(Security.Users).Modify(pUsername, .tProperties)
		}

	} While (0)
Exit
	If $$$ISERR(tSC) Set $ZT="" q tSC
	Quit $$$OK
Trap
	Set $ZT="",tSC=$$$ERROR(5002,$ZE)
	Goto Exit
]]></Implementation>
</Method>

<Method name="CreateZMPUserFrom">
<Description>
Create ZPM user from _system
w ##class(apptools.Security.LockDown).CreateZMPUserFrom("test2", "%DB_IRISSYS,%DB_REGISTRY", "test2", "ZMP registry user")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pUsername:%String,pRoles:%String,pPassword:%String,pFullName:%String,from:%String="_system"</FormalSpec>
<Implementation><![CDATA[
	new $namespace
	set $namespace="%SYS"
	Set tSC = ##class(Security.Users).Copy(from, pUsername, pFullName)
	If $$$ISERR(tSC) q tSC
	#dim tProperties
	Set tProperties("Roles")=pRoles
	Set tProperties("Password")=pPassword
	Set tProperties("ChangePassword")=0
	Set tProperties("Enabled")=1
	Set tSC = ##class(Security.Users).Modify(pUsername, .tProperties)
	q tSC
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Tabs.Panel">
<Description>
The template GUI of the application selector and tabs on the basis jQueryUi</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeChanged>65819,34700.165566</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
The application title</Description>
<Default>Tabs Application title</Default>
</Parameter>

<Method name="OnPage">
<Description>
Main method generate the content of page</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s NSpace=$zu(5)
 // Save the session parameters debugging mode (implies extended disclosure)
 s %session.Data("debug")=%request.Get("debug")
 &html<
 <html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>#(..#HeaderText)#</title>
>
	write ##class(apptools.core.LogInfoPane).GetLink()
	write ##class(apptools.core.LogInfoPane).AddJsScripts() 
   	   do ##class(apptools.core.LogInfoPane).AddJS(NSpace,..%ClassName(1))
   	   do ##class(apptools.core.LogInfoPane).AddStyle()
 &html< 
</head>
<body>
 <div id="MainBody">
  <nav style='background: #d7ebf9;' > 
  &nbsp;&nbsp;&nbsp;  
  <span class="uk-margin-small-right uk-icon" uk-icon="album"></span>
  &nbsp;&nbsp;&nbsp; 
 	<div id="MainControlgroup" > </div>
 	<span id='status_nav'> Status session </span>
  </nav> 
 <div id="tabs"> </div>
</div>
>
 // Debug mode 1
 q:..IsDebugMode(0) $$$OK
 $$$jsstart
    // Download available modes menu
 	w "$('#MainControlgroup').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=DrawMenu&appNsp="_NSpace_"&appPar=');"
 	//Download status
 	w "$('#status_nav').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=DrawStatus&appNsp="_NSpace_"&appPar=');"
    //To download Taba
 	w "$('#tabs').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=DrawTabs&appNsp="_NSpace_"&appPar=');"
 $$$jsstop
 
 &html< 	
 <script language="javascript">
$( ".tip" ).tooltip();
</script>
<div id='MainHidden' style='display:none;'></div>
<div id="dialog" title="Dialog Title">
	<div id=dialogContent></div>
</div>
</body>
</html>
	>
 quit $$$OK
]]></Implementation>
</Method>

<Method name="GetSupportInfo">
<Description>
To obtain information on the support</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s msg=$$$aText("Software complex to debug. Try to log in later, or contact tech support:","")
	q msg_"Support info mailto: sergey.mikhaylenko@gmail.com <div id=test></div><button onclick=""$('#test').load('/apprest/getrpc/aaa:::label%5Eapptools.routine(3333,%22green%22)');"" >test</button>"
]]></Implementation>
</Method>

<Method name="IsDebugMode">
<Description>
To add to the form js code if development mode</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>mode=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 i mode,'%request.Get("debug") { 
	$$$jsstart
	  w $$$blockui(..GetSupportInfo())
	$$$jsstop
	w "</body></html>"
  q $$$OK
 }
	q 0
]]></Implementation>
</Method>

<Method name="DrawStatus">
<Description>
rendering status of the user</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;do ##class(apptools.core.Form).BlockUI(0)
	w $s(%request.Get("debug"):"<font color=red><b>"_$$$aText("Administrator mode","")_"</b></font>",1:"")_" <span class='tip' title='"_$username_"-"_$j_"'>"_$$$aText("User","")_": "_##class(apptools.core.sys).GetFullName($username)_"</span>, "_$tr(##class(apptools.core.type).GetDateTime($h),"T"," ")
 	$$$jsstart
	w "$('.tip').tooltip();"
	$$$jsstop
 q $$$OK
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what are the available modes</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;TODO access rights to pages
	;TODO save in database table
	s key="menu-first"
	s opt(key)="Finding" ;The name of the menu
	s opt(key,"id")="Find"
	s opt(key,"TabName")="Tab Finding out" ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed

	s key="menu-second"
	s opt(key)="About the program"
	s opt(key,"id")="About"
	s opt(key,"TabName")="About the program"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"Disable")=1 ;developed
	
	q $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabAbout">
<Description>
the render Tab On the program"
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	d ..GetAllApps(.opt) 
	i $g(opt(Par,"Disable")) w ..GetSupportInfo() q $$$OK
	s divId=$g(opt(Par,"id"))
	w "Hello world! Parameter: "_Par
	w ..ButtonAgain(divId,,Par)
]]></Implementation>
</Method>

<Method name="ShowTabSample">
<Description>
rendering the Tab previously submitted
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ..GetAllApps(.opt) 
 i $g(opt(key,"Disable")) w ..GetSupportInfo() q $$$OK
 s NSpace=$zu(5)
 s pref=$g(opt(key,"id"))
 s mhead=pref_"MainHeader"
 s mcont=pref_"MainContent"
 &html<
<form id="#(pref_"MainForm")#">


<table id="tbpage" cellspacing="0" width='100%' >
  <tbody>
   <tr height='10%' >
   	<td>
   		<DIV id="#(mhead)#"></div>
	</td>
   </tr>
   <tr height='90%' >
   	<td>
 		<div style='overflow: auto;' id="#(mcont)#"></div>
	</td>
 </tr>
</tbody>
</table>
</form>
>
 ;d ##class(apptools.core.LogInfoPane).AddJS(NSpace,..%ClassName(1))
 $$$jsstart
  	; to calculate the height of the container as a result of wijetunge victory container-Taba height of the container header
 	w "$('#"_mcont_"').height($('#tabs-"_pref_"').height()-$('#"_pref_"MainHeader').height()-150);"
  	w $$$blockui($$$aText("Loading...",""))
	w "ActionJs('"_pref_"MainForm','"_mhead_"','','"_pref_"FirstHead','divId="_pref_"~key="_key_"');"
 $$$jsstop
 ;d ..AddToForm()
 quit $$$OK
]]></Implementation>
</Method>

<Method name="FindFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	s key=Par("key")
	s divId=Par("divId")
	set onclick=$$$blockui("Loading...")_";ActionJs('"_divId_"MainForm','"_divId_"MainContent','','"_divId_"Result','key="_key_"~divId="_divId_"~mode=*');"
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
			Context film name
			</td>
			<td>
			#($$$appText(divId_"Name","","New"))#
			</td>
			<td>

			</td>
			<td>

			</td>
			<td>
		
			</td>
			<td>

			</td>
		</tr>
		<tr>
			<td>
			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""","Find in table"))#
			</td>
			<td>

			</td>
			<td>
			</td>
			<td>
			
			</td>
			<td>

			</td>
		</tr>
		</table>
	>
	q $$$OK
]]></Implementation>
</Method>

<Method name="FindResult">
<Description>
Search result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	set Name=$g(Par("%request.Data",divId_"Name"))
	write ..ButtonAgain(divId,,key)
	if mode=1 {
		if Name="" w $$$appError($$$aText("Context is empty","")) q $$$OK
		if $zv["IRIS" {
			zn "USER"
			set sql="select * from Demo.Address where City is not null "
			if Name'="" s sql=sql_" and (City like '%"_Name_"%') "

		} else {
			zn "samples"
			set sql="select * from Cinema.Film where title is not null "
			if Name'="" s sql=sql_" and (title like '%"_Name_"%') "
		}
		set msg="Query: "_sql
		set exec="##class(apptools.core.LogInfo).MarkRed(%AppLogInfoVal,"""_$GET(Name)_","_$GET(Desc)_""")"
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,100000,$zu(5),msg,exec)
		quit $$$OK
	} 
	elseif mode=2 {

	}
	w "<br>"
	q $$$OK
]]></Implementation>
</Method>

<Method name="ShowTab">
<Description>
rendering Tabs
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	d ..GetAllApps(.opt) 
	s tabId="tabs-"_opt(Par,"id")
 	$$$jsstart
 		w "var a = $('#li-"_tabId_"'); a.show();" ; open the tab
 		w "var index = $('#tabs a[href=""#"_tabId_"""]').parent().index();"
		w "$('#tabs').tabs({'active':index});" ;make it active
 		if $g(opt(Par,"Url"))'="" {
	 		w "$('#"_tabId_"').load('"_$g(opt(Par,"Url"))_"');"
 		}
 		else {
	 		w "$('#"_tabId_"').load('apptools.core.Action.cls','appClass="_$g(opt(Par,"ClassName"))_"&appMethod="_$g(opt(Par,"Method"))_"&appNsp="_$zu(5)_"&appPar="_Par_"');"
 		}
	$$$jsstop
]]></Implementation>
</Method>

<Method name="DrawMenu">
<Description>
rendering menu</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
	d ..GetAllApps(.opt) 
	s onc="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar='+this.options[this.selectedIndex].value);"
	w "<select id=""menu-spgz"" >"
	s i="" w "<option VALUE=0> </option>"
	f { s i=$o(opt(i)) q:i=""  
		w "<option VALUE="""_i_""">"_opt(i)_"</option>"
	}
 	w "</select>"
 	w ..ButtonExit("MainBody")
 	$$$jsstart
		w "$( ""#MainControlgroup"" ).controlgroup();"
 		w "$( ""#menu-spgz"" ).selectmenu({ change: function( event, data ) { "_onc_" }, width:600 }).selectmenu('menuWidget');"
	$$$jsstop
  q $$$OK
]]></Implementation>
</Method>

<Method name="DrawTabs">
<Description>
rendering tabs</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	d ..GetAllApps(.opt)
	w "<ul>"
	s i="" f { s i=$o(opt(i)) q:i=""  
		s tabs(i)="tabs-"_$g(opt(i,"id"))
		w "<li id=""li-"_tabs(i)_"""><a href=""#"_tabs(i)_""">"_opt(i,"TabName")_"</a></li>"
	}
 	w "</ul>"
 	s i="" f { s i=$o(tabs(i)) q:i=""  
 		w "<div id='"_tabs(i)_"' style='height: 85%' ></div>"
 	}
 	$$$jsstart
		w "$( ""#tabs"" ).tabs();"
		;All tabs will immediately hide after initialization, they will be open as a choice
		s i="" f { s i=$o(tabs(i)) q:i=""  
			w "var a = $('#li-"_tabs(i)_"'); a.hide();"
		}
	$$$jsstop
	q $$$OK
]]></Implementation>
</Method>

<Method name="ButtonExit">
<Description>
Output exit button</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>formName</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set onclick="$('#"_formName_"').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=Logout&appNsp="_$zu(5)_"&appPar="_$$$aText("Exit complete","")_"');"
	q $$$appButton("appButtonExit","onclick="""_$g(onclick)_"""",$$$aText("Exit",""))
]]></Implementation>
</Method>

<Method name="AddToForm">
<Description>
To add to the form js code</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	q $$$OK
]]></Implementation>
</Method>

<Method name="Logout">
<Description>
Return in a single string</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	d ##class(apptools.core.sys).logout()
	w $$$appMsg($g(Par)) w "<br>"
	d ##class(apptools.core.Form).ButtonRef($$$aText("Entrance",""))
  	q $$$OK
]]></Implementation>
</Method>

<Method name="ButtonAgain">
<Description>
The output of the First button</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Prefix="",Method="",appPar=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	i Method="" s Method="ShowTab"
	s onc="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar='+this.options[this.selectedIndex].value);"
	set onclick="$('#MainHidden').load('apptools.core.Action.cls','"_Prefix_"appClass="_..%ClassName(1)_"&"_Prefix_"appMethod="_Method_"&"_Prefix_"appNsp="_$zu(5)_"&"_Prefix_"appPar="_appPar_"');"
	q $$$appButton("appButtonExit","onclick="""_$g(onclick)_"""",$$$aText("Again",""))
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Tabs.PanelSample">
<Description>
The template GUI of the application selector and tabs</Description>
<IncludeCode>apptools.core</IncludeCode>
<Super>apptools.Tabs.Panel</Super>
<TimeChanged>65610,77273.857</TimeChanged>
<TimeCreated>65098,29527.199416</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
The application title</Description>
<Default>Tabs Application Sample</Default>
</Parameter>

<Method name="GetAllApps">
<Description>
what are the available applications</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s key="menu-first"
	s opt(key)="Find" ;The name of the menu
	s opt(key,"id")="Find"
	s opt(key,"TabName")="Tab Find" ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed

	s key="menu-second"
	s opt(key)="About the program"
	s opt(key,"id")="About"
	s opt(key,"TabName")="About the program"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"Disable")=1 ;developed
	
	s key="menu-param"
	s opt(key)="Parameter"
	s opt(key,"id")="Param"
	s opt(key,"TabName")="Edit parameters"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0
	q $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabAbout">
<Description>
the render Tab On the program"
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	d ..GetAllApps(.opt) 
	$$$AppLogTab("INFO","Loading file","d:\!\wwww.txt")
	w "<pre>" w  w "</pre>"
	i $g(opt(Par,"Disable")) w ..GetSupportInfo() q $$$OK
	s divId=$g(opt(Par,"id"))
	w "Hello world! Parameter: "_Par
	w ..ButtonAgain(divId,,Par)
]]></Implementation>
</Method>

<Method name="ShowTabSample">
<Description>
rendering Tabs
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ..GetAllApps(.opt) 
 i $g(opt(key,"Disable")) w ..GetSupportInfo() q $$$OK
 s NSpace=$zu(5)
 s pref=$g(opt(key,"id"))
 s mhead=pref_"MainHeader"
 s mcont=pref_"MainContent"
 &html<
<form id="#(pref_"MainForm")#">
<div class="uk-grid">
    <div class="uk-width-1-1 " style='overflow: auto;' id="#(mhead)#" ></div>
    <div class="uk-width-1-1 uk-margin-top uk-margin-bottom" style='overflow: auto;' id="#(mcont)#"></div>
</div>
</form>

>
 $$$jsstart
 	;For the tab Param to change the height of the container
 	;if pref="Param" w "$('#"_pref_"MainHeader').height($('#tabs-"_pref_"').height());"
 	; to calculate the height of the container as a result of wijetunge victory container-Taba height of the container header
 	w "$('#"_pref_"MainContent').height($('#tabs-"_pref_"').height()-$('#"_pref_"MainHeader').height()-150);"
  	;w "console.log($('#"_pref_"MainHeader').height());"
  	;Dimming of the screen that says Download
  	w $$$blockui($$$aText("Loading...",""))
	
	;For the organization of execution by clicking on the apply button AppAct js function(From,To,Act), where
	;From - the ID of the container where will we get the items from the form method serialize
	;To - ID container where we deduce resultat run
	;AppAct=NameSpace:Packet.ClassName:Method:&Par1=Val1&Par2=Val2...
	w "AppAct('"_pref_"MainForm','"_mhead_"','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_pref_"FirstHead:&divId="_pref_"&key="_key_"');"
	
 $$$jsstop
 quit $$$OK
]]></Implementation>
</Method>

<Method name="ParamFirstHead">
<Description>
to download a form for editing</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set class="apptools.core.Parameter"
	
	set sql="select * from "_class_" where Name is not null order by id desc"
	;The list of fields displayed in the Value attribute of the Option tag, 
	;The first field of the query must be an identifier
	set listFields="ID,ID,Name,Description"
	write "Choice parameters:"
	s ONCHANGE=";$('#"_divId_"SelectId').attr('value',data.item.value);"
	do ##class(apptools.core.Form).SelectObj(sql,ONCHANGE,listFields,.gn,divId_"Select")
	
	write "<br>"_$$$appInputHidden(divId_"SelectId","","")_"<br>"
	
	set onclick=$$$blockui("Loading...")_";AppAct('"_divId_"MainForm','"_divId_"MainContent','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"Result:&key="_key_"&divId="_divId_"&class="_class_"&mode=*');"
	write $$$appTable1(class)
	set butt1=$$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""",$$$aText("Preview mode in two columns",""))
	set butt2=$$$appButton(divId_"appButtonResult2","onclick="""_$tr(onclick,"*",2)_"""",$$$aText("Edit mode in one column",""))
	set butt3=$$$appButton(divId_"appButtonResult2","onclick="""_$tr(onclick,"*",3)_"""",$$$aText("The view mode from table",""))
	write $$$appTableTrTd1(butt1_butt2_butt3)
	write $$$appTableEnd1
	quit $$$OK
]]></Implementation>
</Method>

<Method name="ParamResult">
<Description>
The result of selecting the edit mode settings</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	set class=Par("class")
	set SelectId=$g(Par("%request.Data",divId_"SelectId"))
	write ..ButtonAgain(divId,,key)
	if mode=1 {
		;the order of the fields in two columns by the delimiter :
		set order="Name,Description:Value,Types:DateStart,DateFinish:isEnabled,isEnabledCheck:File,OfficeFile:ImageFile,ImageGlobal::,"
		do Show(0,order)
		quit $$$OK
	} 
	elseif mode=2 {
		;the order of fields by default
		set order=""
		do Show("1,ShowFieldName",order)
		quit $$$OK
	} 
	elseif mode=3 {
		set sql="select * from "_class
		set exec="##class(apptools.Form.Explorer).WinEditObj(.%AppLogInfoVal, %AppLogInfoCol, %AppLogInfoHead, .%AppLogInfoTemp,"""_$zu(5)_""")"
		set st=##class(apptools.Form.Explorer).SelectObjects(class,sql,exec)
		;write 'st w $$$appError($System.Status.GetErrorText(st)) 
	}
	q $$$OK
Show(modeShow,order)
	set obj=##class(apptools.core.Form).GetObj(SelectId_","_class)
	if '$isobject(obj) { 
		set msg=$$$aText("Failed to open object","")_" "_SelectId_","_class
		write $$$appError(msg) q $$$ERROR($$$GeneralError,msg)
	}
	do ##class(apptools.core.Form).Show(obj,modeShow,divId,order)
 q
]]></Implementation>
</Method>

<Method name="FindFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	s key=Par("key")
	s divId=Par("divId")

	set onclick=$$$blockui("Loading...")_";AppAct('"_divId_"MainForm','"_divId_"MainContent','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"Result:&key="_key_"&divId="_divId_"&mode=*');"
	&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
			Login
			</td>
			<td>
			#($$$appText(divId_"Name","","su"))#
			</td>
			<td>
			fullname
			</td>
			<td>
			#($$$appTextarea(divId_"fullName","rows=5",""))#
			</td>
			<td>
			Date
			</td>
			<td>
			#($$$appDate(divId_"Date","",""))#
			</td>
		</tr>
		<tr>
			<td>
			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""","Find user"))#
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult2","onclick="""_$tr(onclick,"*",2)_"""","Get items from the form"))#
			</td>
			<td>
			#($g(fileDownload))#
			</td>
			<td>
			date time
			</td>
			<td>
			#($$$appDateTime(divId_"DateTime","",""))#
			</td>
		</tr>
		</table>
	>
	q $$$OK
]]></Implementation>
</Method>

<Method name="FindResult">
<Description>
Search result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	set Name=$g(Par("%request.Data",divId_"Name"))
	set fullName=$g(Par("%request.Data",divId_"fullName"))
	set Date=$g(Par("%request.Data",divId_"Date"))
	set DateTime=$g(Par("%request.Data",divId_"DateTime"))
	write ..ButtonAgain(divId,,key)
	if mode=1 {
		if Name="" w $$$appError($$$aText("Context is empty","")) q $$$OK
		zn "%SYS"
		set sql="select ID,name,EmailAddress,fullName from Security.Users where Enabled [ '1' "
		if Name'="" s sql=sql_" and (name like '%"_Name_"%') "
		if fullName'="" s sql=sql_" and (fullName like '%"_fullName_"%') "
		set msg="Query: "_sql
		set exec="##class(apptools.core.LogInfo).MarkRed(%AppLogInfoVal,"""_Name_","_fullName_""")"
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,100000,$zu(5),msg,exec)
		if 'st  w $$$appError($System.Status.GetErrorText(st)) 
		quit $$$OK
	} 
	elseif mode=2 {
		w "<br>" w $$$appMsg(Name_" "_fullName_" "_Date_" "_DateTime)
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="AddToForm">
<Description>
To add to the form js code</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	q $$$OK
]]></Implementation>
</Method>

<Method name="GetSupportInfo">
<Description>
To obtain information on the support</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s msg=$$$aText("Software complex to debug. Try to log in later, or contact tech support:","")
	q msg_"Support info mailto: sample@server.com"
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Tabs.PanelUikit">
<Description>
Template GUI based application Uikit</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeChanged>65610,77273.857</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="JSLIB">
<Description>
Javascript library</Description>
<Default>Uikit-3, jQueryUi-2</Default>
</Parameter>

<Parameter name="HeaderText">
<Description>
The application title</Description>
<Default>Tabs Application title</Default>
</Parameter>

<Method name="GetAppIcon">
<Description>
Icons for the application</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>icon</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[ 	q "<link rel=""icon"" type=""image/x-icon"" href="""_##class(apptools.core.rest).getStatic("apptools.Tabs.PanelUikit:"_icon)_"""/>"
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Main method generate the content of page</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set namespace=$zu(5)
 // Save the session parameters debugging mode (implies extended disclosure)
 set %session.Data("debug")=%request.Get("debug")
 set autoload=%request.Get("autoload")
 &html<
<html>
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
 <title>#(..#HeaderText)#</title>
>
   	write ..GetAppIcon("IconTools")
	write ##class(apptools.core.LogInfoPane).GetLink()
	write ##class(apptools.core.LogInfoPane).AddJsScripts() 
   	   do ##class(apptools.core.LogInfoPane).AddJS(namespace,..%ClassName(1))
   	   do ##class(apptools.core.LogInfoPane).AddStyle()
   	set onclick="$('#MainBody').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=Logout&appNsp="_$zu(5)_"&appPar="_$$$aText("Exit complete","")_"');"
	set menu=..DrawMenu()
 &html<

</head>
<bogy>
<div id="MainBody">
<nav id=MainNavbar class="uk-navbar-container" uk-navbar>
    <div class="uk-navbar-left">
        <ul class="uk-navbar-nav">
			<li><a href="#"><span class="uk-margin-small-right uk-icon" uk-icon="album"></span></a></li>
            <li><a href="#">#(..#HeaderText)#</a></li>
            <li class="uk-active">
                <a href="#"><span class="uk-margin-small-left uk-icon" uk-icon="menu"></span> Modes</a>
                <div class="uk-navbar-dropdown">
                    <ul class="uk-nav uk-navbar-dropdown-nav">
                    #(menu)#
                    </ul>
                </div>
            </li>
			<li><a href="#"><span id='status_nav'></span></a></li>
        </ul>
    </div>
    <div class="uk-navbar-right">
        <ul class="uk-navbar-nav">
            <li class="uk-active"><a href="#" onclick="#(onclick)#"><span class="uk-margin-small-left uk-icon" uk-icon="sign-out"></span>#($$$aText("Exit",""))#</a></li>
        </ul>
    </div>
</nav>

<div class="uk-grid">
    <div class="uk-width-1-1 uk-margin-left uk-margin-right " style='overflow: auto;' id="mainApp" >
		<ul id='tabMenu' class="uk-tab uk-tab-grid uk-tab-top" data-uk-tab="{connect:'#tabList', animation: 'fade'}">
			<li id='t1' class="uk-active"><a href="#">Welcom</a></li>
		</ul>
		<ul id="tabList" class="uk-switcher uk-margin uk-tab-content">
			<li id='ta1' >
			 <div class="uk-alert-success" uk-alert>
				<p> Sample of simple application</p>
			 </div>
			</li>
		</ul>
	</div>
</div>
>
 $$$jsstart
 	//Download status
 	write "$(document).ready(function(){"
 	write "$('#status_nav').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=DrawStatus&appNsp="_namespace_"&appPar=');"
 	if autoload="" {
	 	d ..GetAllApps(.opt) 
	 	set i="" 
	 	for { set i=$o(opt(i)) q:i=""
	 		if $GET(opt(i,"Active")) write "$('#Menu"_opt(i,"id")_"').trigger('click');"
	 	}
 	} else {
	 	write "$('#Menu"_autoload_"').trigger('click');"
 	}
 	write "});"
 $$$jsstop
 
 &html< 	
 <script language="javascript">
///$( ".tip" ).tooltip();
</script>

<div id='MainHidden' style='display:none;'></div>
<div id="dialog" title="Dialog Title">
	<div id=dialogContent></div>
</div>
</div>
</body>
</html>
	>
 quit $$$OK
]]></Implementation>
</Method>

<Method name="GetSupportInfo">
<Description>
To obtain information on the support</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set msg=$$$aText("Software complex to debug. Try to log in later, or contact tech support:","")
	quit msg_"Support info mailto: sergey.mikhaylenko@gmail.com"
]]></Implementation>
</Method>

<Method name="DrawStatus">
<Description>
rendering status of the user</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 write $s(%request.Get("debug"):"<font color=red><b>"_$$$aText("Administrator mode","")_"</b></font>",1:"")_" <span title='"_$username_"-"_$j_"'>"_$$$aText("User","")_": "_##class(apptools.core.sys).GetFullName($username)_"</span>, "_$tr(##class(apptools.core.type).GetDateTime($h),"T"," ")
 quit $$$OK
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what are the available modes</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;TODO access rights to pages
	;TODO save in database table
	set key="menu-first"
	set opt(key)="Example search in Namespace Samples" ;The name of the menu
	set opt(key,"id")="Find"
	set opt(key,"TabName")="Example search in Namespace Samples" ;the name of the tab
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"Method")="ShowTabSample"
	set opt(key,"Disable")=0 ;developed
	set opt(key,"TabMenu","Close")=1

	set key="menuZ-about"
	set opt(key)="About the program"
	set opt(key,"id")="About"
	set opt(key,"TabName")="About the program"
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"Method")="ShowTabAbout"
	set opt(key,"Disable")=1 ;developed

	quit $$$OK
]]></Implementation>
</Method>

<Method name="ShowTab">
<Description>
rendering Tabs
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ..GetAllApps(.opt) 
	set tabId="tab-"_opt(Par,"id")
	set tabIdMenu="tabMenu-"_opt(Par,"id")
	if $g(opt(Par,"TabMenu","Close"))'="" s IconMenu="<span class=""uk-margin-small-left uk-icon uk-close"" uk-icon=""close"" onclick=""$(\'#"_tabIdMenu_",#"_tabId_"\').remove();""></span>"
 	if $DATA(opt(Par,"TabMenu","Close"))>9 { //there are more points
 		;TODO
 	}
 	$$$jsstart
 	 write "if (!$('li').is('#"_tabId_"')) { $('.uk-active').removeClass('uk-active');"
 		write " $('#tabList').append('<li id="_tabId_"></li>');"
 		write " $('#tabMenu').append('<li id="_tabIdMenu_"><a>"_$g(opt(Par,"TabName"))_$g(IconMenu)_"</a></li>');"
 		write " $('#t1,#ta1').hide();" //" $('#t1').prop('disabled',true);"
 		if $g(opt(Par,"Url"))'="" {
	 		write "$('#"_tabId_"').load('"_$g(opt(Par,"Url"))_"');"
 		}
 		else {
	 		write "$('#"_tabId_"').load('apptools.core.Action.cls','appClass="_$g(opt(Par,"ClassName"))_"&appMethod="_$g(opt(Par,"Method"))_"&appNsp="_$zu(5)_"&appPar="_Par_"');"
 		}
 	 write "};"
 	write " UIkit.tab('#tabMenu').show($('#"_tabIdMenu_"'));"
	$$$jsstop
]]></Implementation>
</Method>

<Method name="DrawMenu">
<Description>
rendering menu</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	do ..GetAllApps(.opt) 
	set i="",ret=""
	for { set i=$o(opt(i)) quit:i=""  
	   	set onclick="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar="_i_"');"
		set ret=ret_"<li><a id='Menu"_$g(opt(i,"id"))_"' href='#' onclick="""_onclick_""">"_$g(opt(i))_"</a></li>"
	}
  quit ret
]]></Implementation>
</Method>

<Method name="Logout">
<Description>
Return in a single string</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 do ##class(apptools.core.sys).logout()
 set onclick = "top.document.location.reload();"
 &html<
 <br>
 <div class="uk-align-center uk-width-1-1 uk-margin-left uk-margin-right " style='overflow: auto;'>
	<div class="uk-alert-warning" uk-alert>
		<p>#($g(Par))#</p>
	</div>
	<center><button class="uk-button uk-button-default uk-margin-small-right" type="button" onclick="#(onclick)#" ><span class="uk-margin-small-left uk-icon" uk-icon="sign-in"></span>#($$$aText("Log in",""))#</button>
	</center>
</div>
>
 	quit $$$OK
]]></Implementation>
</Method>

<Method name="ButtonAgain">
<Description>
The output of the First button</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>divId="",key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set mhead=divId_"MainHeader"
	set mcont=divId_"MainContent"
	set onclick="$('#"_mcont_"').empty();AppAct('"_divId_"MainForm','"_mhead_"','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"FirstHead:&divId="_divId_"&key="_key_"');"
	quit $$$appButton("appButtonExit","onclick="""_$g(onclick)_"""",$$$aText("Again",""))
]]></Implementation>
</Method>

<Method name="ShowTabAbout">
<Description>
the render Tab On the program"
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ..GetAllApps(.opt) 
	if $g(opt(Par,"Disable")) write ..GetSupportInfo() quit $$$OK
	set divId=$g(opt(Par,"id"))
	write "Hello world! Parameter: "_Par
	write ..ButtonAgain(divId,Par)
]]></Implementation>
</Method>

<Method name="ShowTabSample">
<Description>
rendering the Tab previously submitted
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 do ..GetAllApps(.opt) 
 if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 set NSpace=$zu(5)
 set pref=$g(opt(key,"id"))
 set mhead=pref_"MainHeader"
 set mcont=pref_"MainContent"
 &html<
<form id="#(pref_"MainForm")#">
<div class="uk-grid">
    <div class="uk-width-1-1 "id="#(mhead)#" ></div>
    <div style='overflow: auto;' class="uk-width-1-1 uk-margin-top uk-margin-left" id="#(mcont)#"></div>
</div>
</form>
>
 ;d ##class(apptools.core.LogInfoPane).AddJS(NSpace,..%ClassName(1))
 $$$jsstart
  	w "ActionJs('"_pref_"MainForm','"_mhead_"','','"_pref_"FirstHead','divId="_pref_"~key="_key_"');"
	w "$('#"_mcont_"').height($(window).height()-($('#"_mhead_"').height()+$('#t1').height()+$('#MainNavbar').height()+200));"
  	w $$$blockui($$$aText("Loading...",""))
 $$$jsstop
 quit $$$OK
]]></Implementation>
</Method>

<Method name="FindFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set onclick=$$$blockui("Loading...")_";ActionJs('"_divId_"MainForm','"_divId_"MainContent','','"_divId_"Result','key="_key_"~divId="_divId_"~mode=*');"
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
		Context film name
			</td>
			<td>
			#($$$appText(divId_"Name","","New"))#
			</td>
			<td>

			</td>
			<td>

			</td>
			<td>
		
			</td>
			<td>

			</td>
		</tr>
		<tr>
			<td>
			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""","Find in table"))#
			</td>
			<td>

			</td>
			<td>
			</td>
			<td>
			
			</td>
			<td>

			</td>
		</tr>
		</table>
	>
	quit $$$OK
]]></Implementation>
</Method>

<Method name="FindResult">
<Description>
Search result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	set Name=$g(Par("%request.Data",divId_"Name"))
	set Desc=$g(Par("%request.Data",divId_"Desc"))
	set Date=$g(Par("%request.Data",divId_"Date"))
	set st=$$$OK
	write ..ButtonAgain(divId,key)
	if mode=1 {
		if Name="" w $$$appError($$$aText("Context is empty","")) quit $$$OK
		if $zv["IRIS" {
			zn "USER"
			set sql="select * from Demo.Address where City is not null "
			if Name'="" s sql=sql_" and (City like '%"_Name_"%') "

		} else {
			zn "samples"
			set sql="select * from Cinema.Film where title is not null "
			if Name'="" s sql=sql_" and (title like '%"_Name_"%') "
		}
		set msg="Query: "_sql
		set exec="##class(apptools.core.LogInfo).MarkRed(%AppLogInfoVal,"""_Name_","_Desc_""")"
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,100000,$zu(5),msg,exec)
		if 'st  w $$$appError($System.Status.GetErrorText(st))
		quit $$$OK

	} 
	elseif mode=2 {

	}
	write "<br>"
	quit $$$OK
]]></Implementation>
</Method>

<XData name="IconTools">
<Description>
s h=##class(apptools.core.rest).getStatic("apptools.Tabs.PanelUikit:IconTools") w !,h</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
data:image/x-icon;base64,AAABAAEAICAAAAEAGACoDAAAFgAAACgAAAAgAAAAQAAAAAEAGAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///+AgICAgICA
gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA
gICAgICAgICAgICAgICAgICAgICAgIAAAAAAAAD///////8AAAAAAAD////AwMDAwMDAwMDAwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCA
gICAgIAAAAAAAAD///////+AgIAAAAAAAAD////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD///////+A
gICAgIAAAAAAAAD////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD////////AwMCAgICAgIAAAAAAAAD////A
wMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA
wMCAgICAgIAAAAAAAAD////////AwMDAwMCAgICAgIAAAAAAAAD////AwMDAwMDAwMDAwMDAwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD/////
///////AwMDAwMCAgICAgIAAAAAAAAD////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD///////8AAAD////AwMDAwMCAgICA
gIAAAAAAAAD////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA
wMDAwMCAgICAgIAAAAAAAAD////////AwMAAAAD////AwMDAwMCAgICAgIAAAAAAAADAwMDAwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD/
///////AwMDAwMAAAAD////AwMDAwMCAgIAAAAAAAAD////AwMDAwMDAwMDAwMDAwMDAwMDAwMDA
wMDAwMDAwMD////////AwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD////////AwMDAwMDAwMAAAAD/
///////AwMCAgIAAAAAAAAD////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMD///8AAAAAAAD////A
wMDAwMDAwMCAgICAgIAAAAAAAAD////////AwMDAwMDAwMDAwMAAAAAAAAD////AwMCAgIAAAAAA
AAD////AwMDAwMDAwMDAwMDAwMDAwMD///8AAAAAAAAAAAAAAAD////AwMDAwMCAgICAgIAAAAAA
AAD////////AwMDAwMDAwMDAwMDAwMCAgIAAAAD////AwMCAgIAAAAAAAAD////AwMDAwMDAwMDA
wMDAwMAAAAAAAACAgICAgIAAAAAAAAD////AwMCAgICAgIAAAAAAAAD////////AwMDAwMDAwMDA
wMDAwMDAwMCAgIAAAAD////AwMCAgIAAAAAAAAD////AwMDAwMDAwMDAwMAAAAAAAACAgIDAwMCA
gIAAAAAAAADAwMCAgICAgIAAAAAAAAD////////AwMDAwMDAwMDAwMDAwMDAwMDAwMCAgIAAAAD/
///AwMCAgIAAAAAAAAD////AwMDAwMD///8AAAAAAACAgIDAwMDAwMD///8AAADAwMCAgICAgIAA
AAAAAAD////////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCAgIAAAAD////AwMCAgIAAAAAAAAD/
//////8AAAAAAACAgID///////////8AAAD////AwMCAgICAgIAAAAAAAAD////////AwMDAwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMCAgIAAAAD////AwMCAgIAAAAAAAAAAAAAAAACAgID///8AAAAA
AAAAAAD////AwMDAwMCAgICAgIAAAAAAAAD////////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA
wMDAwMCAgIAAAAD////AwMCAgICAgICAgICAgID///8AAAD////AwMDAwMDAwMDAwMDAwMCAgICA
gIAAAAAAAAD////////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCAgIAAAACAgICA
gICAgIDAwMD///8AAAD////AwMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD////////AwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCAgIAAAACAgIDAwMDAwMDAwMAAAAD////AwMDA
wMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD////////AwMDAwMDAwMDAwMDAwMDAwMDAwMDA
wMDAwMDAwMD///8AAACAgICAgIDAwMD////AwMCAgIAAAAD////AwMDAwMDAwMDAwMDAwMDAwMCA
gICAgIAAAAAAAAD////////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMD///////8AAACAgICAgIDA
wMD///8AAAD///8AAAD////AwMDAwMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD////////A
wMDAwMDAwMDAwMDAwMD///////////8AAAAAAACAgICAgIDAwMD///8AAAD///8AAAD////AwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD////////AwMDAwMDAwMDAwMD///8AAAAA
AAAAAACAgICAgICAgID///////8AAAD////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA
wMCAgICAgIAAAAAAAAD////////AwMDAwMDAwMD///8AAADAwMDAwMDAwMDAwMDAwMD///8AAAAA
AAD////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD/////
///AwMDAwMDAwMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////AwMDAwMDAwMDAwMDAwMDAwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD////////AwMDAwMDAwMDAwMDAwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA
wMDAwMCAgICAgIAAAAAAAAD////////AwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA
wMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCAgICAgIAAAAAAAAD/
////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////+AgIAAAAAAAAD/////////////////////////
////////////////////////////////////////////////////////////////////////////
//////////////////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAA==
]]></Data>
</XData>
</Class>


<Class name="apptools.Tabs.PanelUikitAdmin">
<Description>
The template GUI of the application selector and tabs on the basis jQueryUi, Uikit</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeChanged>65819,34777.708018</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
The application title</Description>
<Default>AdminTabsApplication</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files and id sessions</Description>
<Default>^%apptools.ui</Default>
</Parameter>

<Parameter name="PreLoad">
<Description>
For Redirect </Description>
</Parameter>

<Method name="IsPermiss">
<Description>
is there a right to work with this form</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>role</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	q $roles[role||($roles["%All")
]]></Implementation>
</Method>

<Method name="GetAppIcon">
<Description>
Icons for the application</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>path</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  	q "<link rel=""icon"" type=""image/x-icon"" href="""_##class(apptools.core.rest).getStatic("apptools.Tabs.PanelUikit:IconTools")_"""/>"
 	;q "<link rel=""icon"" href="""_path_"favicon.ico"" type=""image/x-icon""/><link rel=""shortcut icon"" href="""_path_"favicon.ico"" type=""image/x-icon""/>"
 	;q "<link rel=""icon"" type=""image/x-icon"" href=""data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AJCQk/yQkJP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/0ZGRv8XFxf/////AP///wD///8A////AP///////////////+7u7v9OTk7/sbGx/11dXf9KSkr///////////+lpaX/4eHh/////wD///8A////AAAAAP8AAAD///////////+8vLz///////X19f/t7e3/gICA/5eXl////////////wAAAP8AAAD/////AKysrP8AAAD/AAAA/wAAAP+enp7/////////////////////////////////5OTk/wAAAP8AAAD/AAAA/6ysrP////8A////AP///wCurq6PlJSUzP///wD///8A////AP///wD///8A////AJSUlMyQkJDY////AP///wD///8A////AP///wD///8AAAAA/wAAAP////8A////AP///wD///8A////AP///wAAAAD/AAAA/////wD///8A////AP///wD///8AAAAA/wAAAP8AAAD/////AP///wD///8A////AP///wD///8AAAAA/wAAAP8AAAD/////AP///wD///8ACwsL/wAAAP8AAAD/lJSU2AAAAP8AAAD/cnJy/1hYWP8AAAD/AAAA/2FhYdgHBwf/AAAA/wAAAP////8A////AP///wD///8A////AP///wAAAAD/s7Oz/wAAAP8AAAD/x8fH/wAAAP////8A////AP///wD///8A////AP///wD///8A////AP///wAAAAD/AAAA/////wAAAAD/AAAA/////wAAAAD/AAAA/////wD///8A////AP///wD///8A////AP///wD///8AAAAA/wAAAP+qqqqlAAAA/wAAAP9lZWXjAAAA/wAAAP////8A////AP///wD///8A////AP///wD///8A////ALa2tv////8A9vb2UQAAAP8AAAD/////Uf///wDAwMD/////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wBcXFz/AAAA/////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AADAAwAAwAMAAIABAAAAAAAA5+cAAOfnAADH4wAAgAEAAPgfAADyTwAA8A8AAPZvAAD+fwAA//8AAA==""/>"
]]></Implementation>
</Method>

<Method name="PreLoad">
<ClassMethod>1</ClassMethod>
<FormalSpec>path</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[ q $$$OK
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Main method generate the content of page
TODO #2c3136 - 6699CC , 33383e - #6FA6DE , ffffff - #0048BA
#3e454c - 2185D0 , 1c1f22 - 0FC0FC , 656a70 - </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>parameter=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
 set NSpace=##class(apptools.core.Action).GetParam(.%request,"ns",parameter)
 s:$g(NSpace)="" NSpace=$zu(5)
 zn NSpace
 // Save the session parameters debugging mode (implies extended disclosure)
 ;s %session.Data("debug")=%request.Get("debug")
 
 // http://cip.mvk.ru/csp/spgz/apptools.MVK.gisui.cls?ns=MVK&autoload=Find# - Find the first startup
 // http://localhost:57773/apptoolsrest/get-html/apptools.Tabs.PanelUikitAdmin?ns=APP&autoload=Find
 ;if $d(%request) {  set autoloadmenu=$p(%request.Get("autoload"),"#")
 set autoload=##class(apptools.core.Action).GetParam(.%request,"autoload",parameter)
 
 ;do ##class(apptools.core.Log).AddRecord(..%ClassName(1), "OnPage", "Login", "INFO", "","")
 &html<
 <!doctype html>
 <html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>#(..#HeaderText)#</title>
>
 if ..#PreLoad'="" {
	 d ..PreLoad(.%request)
  &html<
	</html>
	>
	q $$$OK
 }
 	write ##class(apptools.core.LogInfoPane).GetLink()
 	write ##class(apptools.core.LogInfoPane).AddJsScripts() 
   	   do ##class(apptools.core.LogInfoPane).AddJS(NSpace,..%ClassName(1))
   	   do ##class(apptools.core.LogInfoPane).AddStyle()
 	set menu=..DrawMenu() ;sidebar
	set menuTop=..DrawMenuTop() ;top think
	set path=$$$PATHCSP
	write ..GetAppIcon(path)

 &html<
	
<link rel="stylesheet" href="#(path)#apptools-uikit-dark-admin/css/nav.css"> <!-- CSS reset -->
	
</head>
<body>
	<header class="cd-main-header"  style='position: fixed; top: 0px; width: 1903px;'>
		<a href="#" class="cd-logo">
			<font color=#E4F2FB>#(..#HeaderText)#</font>
		</a>
		
		<div class="cd-search is-hidden">
			<input type="search" placeholder="search.." id="searchstr" name="searchstr">
		</div> <!-- cd-search -->

		<a href="#" class="cd-nav-trigger"><span></span></a>

		<nav class="cd-nav">
			<ul class="cd-top-nav">
				#(menuTop)#
			</ul>
		</nav>
	</header> <!-- .cd-main-header -->

	<main class="cd-main-content">
		<nav class="cd-side-nav">
			
			<ul class="uk-nav uk-nav-default">
				<li class="cd-label">...</li>
					#(menu)#
			</ul>

		</nav>

		<div id=MainBody class="content-wrapper">
        <!-- Page Content -->
		<br />
			
<div class="uk-grid">
    <div class="uk-width-1-1 uk-margin-left uk-margin-right " style='overflow: auto;' id="mainApp" >
		<ul id='tabMenu' class="uk-tab uk-tab-grid uk-tab-top" data-uk-tab="{connect:'#tabList', animation: 'fade'}">
			<li id='t1' class="uk-active"><a href="#">About</a></li>
		</ul>
		<ul id="tabList" class="uk-switcher uk-margin uk-tab-content">
			<li id='ta1' >
			 <div class="uk-alert-success" uk-alert>
				<p title='#($username)#'> #($$$aText("If you are not available to any single menu item",""))#</p>
			 </div>
			</li>
		</ul>
	</div>
</div>
        <!-- /#page-content-wrapper -->
		</div> <!-- .content-wrapper -->
	</main> <!-- .cd-main-content -->

<script src="#(path)#apptools-uikit-dark-admin/js/main.js"></script> <!-- Resource jQuery -->

 <script language="javascript">

(function($) {
    var $window = $(window),
        $html = $('#wrapper');

    function resize() {
        if ($window.width() < 768) {
            return $html.removeClass('toggled');
        }
		
        $html.addClass('toggled');
    }

    $window
        .resize(resize)
        .trigger('resize');
})(jQuery);

</script>
<div id='MainHidden' style='display:none;'></div>
<div id="dialog" title="Dialog Title">
	<div id=dialogContent></div>
</div>
>
 $$$jsstart
 	;w "$('#account_status').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=DrawStatus&appNsp="_NSpace_"&appPar=');"_$c(13,10)
 	;w "$('#searchstr').keydown(function (e) { if (e.keyCode == 13) { $('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar=Search&Searchstr='+document.getElementById('searchstr').value); }});"_$c(13,10)
 	write ##class(apptools.core.Action).WriteActJs(%request,"","account_status",..%ClassName(1),"DrawStatus","")_$c(13,10)
 	set enter=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar=Search&Searchstr='+document.getElementById('searchstr').value")_$c(13,10)
 	write "$('#searchstr').keydown(function (e) { if (e.keyCode == 13) { "_enter_" }});"_$c(13,10)
  	if autoload="" {
	 	do ..GetAllApps(.opt) 
	 	set i="" 
	 	for { set i=$o(opt(i)) q:i=""
	 		if $GET(opt(i,"Active")) write "$('#Menu"_opt(i,"id")_"').trigger('click');"_$c(13,10)
	 	}
 	} else {
	 	write "$('#Menu"_autoload_"').trigger('click');"_$c(13,10)
 	}
 $$$jsstop
 
 &html<
</body>
</html>
	>
 quit $$$OK
]]></Implementation>
</Method>

<Method name="DrawMenuTop">
<Description>
the rendering top menu </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	do ..GetAllApps(.opt) 
	do ..GetAllMenu(.opt,.menu,1)
	set m="",ret=""
	for { set m=$o(menu(m)) quit:m=""
		s i=""
		if m=99 { ;account - with submenu
			s ret=ret_"<li class='has-children account'><a href='#'><span id='account_status'>"_$lg(menu(m),2)_"</span></a><ul>"
			for { set i=$o(menu(m,i)) quit:i=""
		   		;set onclick="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar="_i_"');"
				set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar="_i)
				set ret=ret_"<li><a id='Menu"_$g(opt(i,"id"))_"' href='#' onclick="""_onclick_""">"_$g(opt(i))_"</a></li>"
			}
			s ret=ret_"</ul></li>"
		}
		else {
			for { set i=$o(menu(m,i)) quit:i=""
		   		;set onclick="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar="_i_"');"
		   		set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar="_i)
				set ret=ret_"<li><a id='Menu"_$g(opt(i,"id"))_"' href='#' onclick="""_onclick_""">"_$g(opt(i))_"</a></li>"
			}
		}
	}
  quit ret
]]></Implementation>
</Method>

<Method name="DrawMenu">
<Description>
render side menu </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	do ..GetAllApps(.opt) 
	do ..GetAllMenu(.opt,.menu)
	set m="",ret=""
	for { set m=$o(menu(m)) quit:m=""
		s i=""
		s active=$s($lg(menu(m),3):"active",1:"")
		s ret=ret_"<li class='has-children overview "_active_"'><a href='#'>"_$lg(menu(m),2)_"</a><ul>"
		for { set i=$o(menu(m,i)) quit:i=""
	   		;set onclick="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar="_i_"');"
	   		set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar="_i)
			set ret=ret_"<li><a id='Menu"_$g(opt(i,"id"))_"' href='#' onclick="""_onclick_""">"_$g(opt(i))_"</a></li>"
		}
		s ret=ret_"</ul></li>"
	}
  quit ret
]]></Implementation>
</Method>

<Method name="GetSupportInfo">
<Description>
To obtain information on the support</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s msg=$$$aText("Software complex to debug. Try to log in later, or contact tech support:","")
	q msg_"Support info mailto: sergey.mikhaylenko@gmail.com"
]]></Implementation>
</Method>

<Method name="IsDebugMode">
<Description>
To add to the form js code if development mode</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>mode=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 i mode,'%request.Get("debug") { 
	$$$jsstart
	  w $$$blockui(..GetSupportInfo())
	$$$jsstop
  q $$$OK
 }
	q 0
]]></Implementation>
</Method>

<Method name="DrawStatus">
<Description>
rendering status of the user</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;do ##class(apptools.core.Form).BlockUI(0)
	s fio=##class(apptools.core.sys).GetFullName($username)
	s:fio="" fio=$$$aText("The user","")
	;w $s(%request.Get("debug"):"<font color=red><b>"_$$$aText("Administrator mode","")_"</b></font>",1:"")_" <span class='tip' title='"_$username_"-"_$j_"-"_$zu(5)_"'>"_$$$aText("User","")_": "_fio_"</span>, "_$tr(##class(apptools.core.type).GetDateTime($h),"T"," ")
	write "<span class='tip' title='"_fio_"-"_$j_"-"_$zu(5)_"'>"_$username_"</span>"
 	;$$$jsstart
	;	w "$('.tip').tooltip();"
	;$$$jsstop
 q $$$OK
]]></Implementation>
</Method>

<Method name="GetAllMenu">
<Description>
To menu</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt,menu,top=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s i="" for { s i=$o(opt(i)) q:i=""
	if 'top,$d(opt(i,"Menu")) { 
		s m=$lg(opt(i,"Menu"),1)
		s:'$d(menu(m)) menu(m)=opt(i,"Menu")
		s menu(m,i)=""
	}
	if top,$d(opt(i,"MenuTop")) { 
		s m=$lg(opt(i,"MenuTop"),1)
		s:'$d(menu(m)) menu(m)=opt(i,"MenuTop")
		s menu(m,i)=""
	} else {
		;s:'$d(menu(99)) menu(99)=$lb(0,"---",0)
		;s menu(99,i)=""
	}
  }
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what are the available modes</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;make them zavisimye from the area
	;------------ sidebar
	s key="menu-first"
	s opt(key)="Find users" ;The name of the menu
	s opt(key,"id")="Find" ;use methods: FindFirstHead FindResult
	s opt(key,"TabName")="finding users" ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"TabMenu","Close")=1
	s opt(key,"Menu")=$lb(1,"Mode",1) ;$lg(,3)=1 - open menu level 1
	s opt(key,"Active")=1 ;active menu item

	s key="menu-first2"
	s opt(key)="Sample gallery" ;The name of the menu
	s opt(key,"id")="Lighbox" ;use methods: LighboxFirstHead LighboxResult
	s opt(key,"TabName")="Gallery" ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"TabMenu","Close")=1
	s opt(key,"Menu")=$lb(1,"Mode",1) ;$lg(,3)=1 - open menu level 1
	
	s key="menu-second"
	s opt(key)="Help"
	s opt(key,"id")="Help"
	s opt(key,"TabName")="Help"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"MethodUrl")="http://ShowTabAbout.cls"
	s opt(key,"Disable")=1 ;developed
	s opt(key,"Menu")=$lb(2,"About the program",0)

	s key="menu-second2"
	s opt(key)="Menu 3"
	s opt(key,"id")="About"
	s opt(key,"TabName")="Menu 3"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"Disable")=1 ;developed
	s opt(key,"Menu")=$lb(2,"About the program")

	s key="menu-second3"
	s opt(key)="Support"
	s opt(key,"id")="Support"
	s opt(key,"TabName")="Support"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"MethodUrlNewWin")="http://ShowTabAbout.cls"
	s opt(key,"Disable")=1 ;developed
	s opt(key,"Menu")=$lb(2,"About the program")
	
	;------------ one-level upper menu 
	s key="menu-topLern"
	s opt(key)="Menu 2"
	s opt(key,"id")="Menu2"
	s opt(key,"TabName")="Menu 2"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"MenuTop")=$lb(1,"Menu 2") ;has no sub-items

	s key="menu-topOpt"
	s opt(key)="Option"
	s opt(key,"id")="Option"
	s opt(key,"TabName")="Option"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"MenuTop")=$lb(2,"Option") ;has no sub-items

	;------------ top menu the top-accoun
	s key="menu-top-accoun"
	s opt(key)=$$$aText("Profile","")
	s opt(key,"id")="AccountProf"
	s opt(key,"TabName")=$$$aText("Profile","")
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"MenuTop")=$lb(99,"Account") ;only 99-account has sub-items

	s key="menu-top-account3"
	s opt(key)=$$$aText("Exit","")
	s opt(key,"id")="AccountExit"
	s opt(key,"TabName")=$$$aText("Exit","")
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="Logout"
	s opt(key,"MenuTop")=$lb(99,"Account") ;only 99-account has sub-items
	
	;----- Setup the search in the top menu
	s key="Search"
	s opt(key)=$$$aText("Search","")
	s opt(key,"id")="Search-"
	s opt(key,"TabName")=$$$aText("Search","")_"-"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSearch"
	s opt(key,"TabMenu","Close")=1
	s opt(key,"TabMenu","Mode")=0 ;1 - for each new search bar to make new tab, 0-tab is always the same
	
	q $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabSearch">
<Description>
drawing Tabs search
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 ;do ..GetAllApps(.opt) 
 ;if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 ;set NSpace=$zu(5)
 w $$$aText("Context","")_" :"_$g(key)
 ;set pref=$g(opt(key,"id"))
]]></Implementation>
</Method>

<Method name="ShowTab">
<Description>
the render Tab on the menu
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $g(Par("appPar"))'="" set Par=Par("appPar")
	do ..GetAllApps(.opt) 
	d ..ShowTabApps(.Par,.opt)
]]></Implementation>
</Method>

<Method name="ShowTabApps">
<Description>
the render Tab on the menu
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par,opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if Par="Search" {
		s Searchstr=$g(Par("%request.Data","Searchstr"),Par("Searchstr"))
		if Searchstr="" q $$$OK
		;s tr=$tr(##class(apptools.MSW.type).Transliteration(Searchstr)," `()\/*;'"":%","_N---")
		;s tr=$tr($zts,".,") 
		s tr=$e($tr(Searchstr," `()\/*;'"":%?$@&.,",""),1,10)_$i(@..#GNStore@("jobs",$j))
		s key=tr ;Searchstr
		MERGE opt(key)=opt(Par)
		s opt(key)=opt(key)_tr ;Searchstr
		i $g(opt(Par,"TabMenu","Mode"))=1 { ;mode add a new tab 
			s opt(key,"id")=opt(key,"id")_tr
		} else { ;mode add a new replace the old 
			set tabId="tab-"_opt(Par,"id")
			set tabIdMenu="tabMenu-"_opt(Par,"id")
			$$$jsstart
		  	 w "$('#"_tabId_"').remove();"
		  	 w "$('#"_tabIdMenu_"').remove();"
		  	$$$jsstop
		}
		s opt(key,"CGIvar")="&Searchstr="_Searchstr ;$zconvert(Searchstr,"O","URI")
		s opt(key,"TabName")=opt(key,"TabName")_tr 
		s Par=key

	}
	set tabId="tab-"_opt(Par,"id")
	set tabIdMenu="tabMenu-"_opt(Par,"id")
	if $g(opt(Par,"TabMenu","Close"))'="" s IconMenu="<span class=""uk-margin-small-left uk-icon uk-close"" uk-icon=""close"" onclick=""$(\'#"_tabIdMenu_",#"_tabId_"\').remove();""></span>"
 	if $DATA(opt(Par,"TabMenu","Close"))>9 { //there are more points
 		;TODO
 	}
 	$$$jsstart
 	 if $g(opt(Par,"MethodUrlNewWin"))'="" {
	 	 if $g(opt(Par,"Disable")) { w "alert('"_$$$aText("Mode debugging","")_"');"}
	 	 else {write "window.open('"_$g(opt(Par,"MethodUrlNewWin"))_"','_blank');"
	 	 }
 	}
	else {
 	 write "if (!$('li').is('#"_tabId_"')) { $('.uk-active').removeClass('uk-active');"_$c(13,10)
 		write " $('#tabList').append('<li id="_tabId_"></li>');"_$c(13,10)
 		write " $('#tabMenu').append('<li id="_tabIdMenu_"><a>"_$g(opt(Par,"TabName"))_$g(IconMenu)_"</a></li>');"_$c(13,10)
 		write " $('#t1,#ta1').hide();"_$c(13,10) //" $('#t1').prop('disabled',true);"
 		if $g(opt(Par,"Disable")) {
	 		;write "$('#"_tabId_"').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTabAbout&appNsp="_$zu(5)_"&appPar="_Par_"');"
	 		write ##class(apptools.core.Action).WriteActJs(%request,"",tabId,..%ClassName(1),"ShowTabAbout","&appPar="_Par_$g(opt(Par,"CGIvar")))
 		}
 		elseif $g(opt(Par,"MethodUrl"))'="" {
	 		write "$('#"_tabId_"').load('"_$g(opt(Par,"MethodUrl"))_"');"
 		}
 		else {
	 		;write "$('#"_tabId_"').load('apptools.core.Action.cls','appClass="_$g(opt(Par,"ClassName"))_"&appMethod="_$g(opt(Par,"Method"))_"&appNsp="_$zu(5)_"&appPar="_Par_"');"
	 		write ##class(apptools.core.Action).WriteActJs(%request,"",tabId,$g(opt(Par,"ClassName")),$g(opt(Par,"Method")),"&appPar="_Par_$g(opt(Par,"CGIvar")))
 		}
 	 write "};"
 	 write " UIkit.tab('#tabMenu').show($('#"_tabIdMenu_"'));"
	}
	$$$jsstop
]]></Implementation>
</Method>

<Method name="Logout">
<Description>
Return in a single string</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(Par("appPar"))'="" set Par=Par("appPar")
 do ##class(apptools.core.sys).logout()
 set onclick = "top.document.location.reload();"
 do ..GetAllApps(.opt) 
 $$$jsstart
 set i=""
 for { set i=$o(opt(i)) q:i=""
 	continue:i=Par
 	set tabId="tab-"_opt(i,"id")
	set tabIdMenu="tabMenu-"_opt(i,"id")
 	write "$('#"_tabIdMenu_",#"_tabId_"').remove();"
 }
 $$$jsstop
 &html<
 <br>
 <div class="uk-align-center uk-width-1-1 uk-margin-left uk-margin-right " style='overflow: auto;'>
	<div class="uk-alert-warning" uk-alert>
		<p>#($$$aText("The output of Sistema produced",""))#</p>
	</div>
	<center><button class="uk-button uk-button-default uk-margin-small-right" type="button" onclick="#(onclick)#" ><span class="uk-margin-small-left uk-icon" uk-icon="sign-in"></span>#($$$aText("Log in",""))#</button>
	</center>
</div><br><br>
>
 	quit $$$OK
]]></Implementation>
</Method>

<Method name="ButtonAgain">
<Description>
The output of the First button</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>divId="",key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set mhead=divId_"MainHeader"
	set mcont=divId_"MainContent"
	set onclick="$('#"_mcont_"').empty();"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",mhead,..%ClassName(1),divId_"FirstHead","&key="_key_"&divId="_divId)
	;AppAct('"_divId_"MainForm','"_mhead_"','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"FirstHead:&divId="_divId_"&key="_key_"');"
	quit $$$appButton("appButtonExit","onclick="""_$g(onclick)_"""",$$$aText("Again",""))
]]></Implementation>
</Method>

<Method name="ShowTabAbout">
<Description>
the render Tab On the program"
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $g(key("appPar"))'="" set key=key("appPar")
	do ..GetAllApps(.opt) 
	if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
	set divId=$g(opt(key,"id"))
	write "Hello world! Parameter: "_key
	write ..ButtonAgain(divId,key)
]]></Implementation>
</Method>

<Method name="ShowInIFrame">
<Description>
rendering the Tab previously submitted
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(key("appPar"))'="" set key=key("appPar")
 do ..GetAllApps(.opt) 
 if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 set NSpace=$zu(5)
 set pref=$g(opt(key,"id"))
 set mhead=pref_"MainHeader"
 set mcont=pref_"MainContent"
 &html<
<form id="#(pref_"MainForm")#">
<div class="uk-grid">
    <iframe id="#(mcont)#" width="100%" height="100%" style='overflow: auto;' src='#($g(opt(key,"InFrameUrl")))#' ></iframe>
    </div>
</div>
</form>
>
 $$$jsstart
  ;	; to calculate the height of the container as a result of wijetunge victory container-Taba height of the container header
 	w "$('#"_mcont_"').height($(window).height()-($('#t1').height()+$('#MainNavbar').height()+150));"
  ;	w $$$blockui($$$aText("Loading...",""))
 $$$jsstop
 quit $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabSample">
<Description>
rendering the Tab previously submitted
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(key("appPar"))'="" set key=key("appPar")
 do ..GetAllApps(.opt) 
 if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 set NSpace=$zu(5)
 set pref=$g(opt(key,"id"))
 set mhead=pref_"MainHeader"
 set mcont=pref_"MainContent"
 &html<
<form id="#(pref_"MainForm")#">
<div class="uk-grid">
    <div class="uk-width-1-1 "id="#(mhead)#" ></div>
    <div style='overflow: auto;' class="uk-width-1-1 uk-margin-top uk-margin-left" id="#(mcont)#"></div>
</div>
</form>
>
 ;d ##class(apptools.core.LogInfoPane).AddJS(NSpace,..%ClassName(1))
 
 $$$jsstart
  	; to calculate the height of the container as a result of wijetunge victory container-Taba height of the container header
    w ##class(apptools.core.Action).WriteActJs(%request,pref_"MainForm",mhead,..%ClassName(1),pref_"FirstHead","&divId="_pref_"&key="_key)
	w "$('#"_mcont_"').height($(window).height()-($('#"_mhead_"').height()+$('#t1').height()+$('#MainNavbar').height()+300));"_$c(13,10)
  	w $$$blockui($$$aText("Loading...",""))
 $$$jsstop
 quit $$$OK
]]></Implementation>
</Method>

<Method name="FindFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","~key="_key_"~divId="_divId_"~mode=*")
	;ActionJs('"_divId_"MainForm','"_divId_"MainContent','','"_divId_"Result','key="_key_"~divId="_divId_"~mode=*');"
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
		Context name users
			</td>
			<td>
				#($$$appText(divId_"textName","title='context in Name'","s"))#
			</td>		
			<td>
				#($$$appText(divId_"textDesc","title='context in FullName'","m"))#
			</td>
			<td>
			</td>
			<td>
		
			</td>
			<td>

			</td>
		</tr>
		<tr>
			<td>
			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""","Find USERS"))#
			</td>
			<td>
			</td>
			<td>
			</td>
			<td>
			
			</td>
			<td>

			</td>
		</tr>
		</table>
	>
 $$$jsstart
 	//for all identifiers starting with "_divId_"text by pressing Enter, click on the button (ending with $("[id$='txtTitle']"))
 	w "$('[id^="""_divId_"text""]').keydown(function (e) { if (e.keyCode == 13) { $('#"_divId_"appButtonResult1').click(); }});"_$c(13,10)
 $$$jsstop
	
	quit $$$OK
]]></Implementation>
</Method>

<Method name="FindResult">
<Description>
Search result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	set Name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"textName")	
	set Desc=$g(Par("%request.Data",divId_"textDesc"))
	set st=$$$OK
	if mode=1 {
		write ..ButtonAgain(divId,key)
		if Name="" w $$$appError($$$aText("Context is empty","")) quit $$$OK
		zn "%sys"
		set sql="select ID,name,EmailAddress,fullName from Security.Users where Enabled [ '1' "
		if Name'="" s sql=sql_" and (name like '%"_Name_"%') "
		if Desc'="" s sql=sql_" and (fullName like '%"_Desc_"%') "
		set msg="Query: "_sql

		set exec="##class(apptools.core.LogInfo).MarkRed(%AppLogInfoVal,"""_Name_","_Desc_""")"
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,100000,$zu(5),msg,exec)
		if 'st  w $$$appError($System.Status.GetErrorText(st))
		quit $$$OK

	} 
	write "<br>"
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","~key="_key_"~divId="_divId_"~mode=*")
	Set path=$p($p($zu(86),"*",1),$$$slash,1,*-1)
	Set path1=path_$tr("\csp\broker\images\","\",$$$slash)
	Set path2=path_$tr("\docs\","\",$$$slash)
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
				#($$$appText(divId_"path1","size=50 title='path to images'",path1))#
			</td>
			<td>
				#($$$appText(divId_"path2","size=50 title='path to images docs'",path2))#
			</td>
		</tr>
		<tr>
			<td>
			#($$$appButton(divId_"appButtonResult1"," onclick="""_$tr(onclick,"*",1)_"""","Generate gallery via App /csp/broker"))#			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult2"," onclick="""_$tr(onclick,"*",2)_"""","Generate gallery dinamic rest"))#			
			</td>
		</tr>
		</table>
	>
 $$$jsstart
 	;for all identifiers starting with "_divId_"text by pressing Enter, click on the button (ending with $("[id$='txtTitle']"))
 	w "$('[id^="""_divId_"path""]').keydown(function (e) { if (e.keyCode == 13) { $('#"_divId_"appButtonResult2').click(); }});"_$c(13,10)
 $$$jsstop
	
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxResult">
<Description>
Its result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	s path1=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"path1")	
	set path2=$g(Par("%request.Data",divId_"path2"))
	set st=$$$OK
	s wc=##class(apptools.core.filesMimeTypes).GetTypesWildcards("image")_##class(apptools.core.filesMimeTypes).GetTypesWildcards("video")
	if mode=1 {
	 d ##class(apptools.core.files).GetList(path1,wc,.List)
	 s cspappstatic="/csp/broker/images/"
	 ;zw List
	 $$$jsstart
 		w "UIkit.lightboxPanel({"
   		w "items: [ "
		  d ..LighboxDrawJson(.List,cspappstatic)
  		w " ] }).show();"
	 $$$jsstop
	} 
	elseIF mode=2 {
	;	w path2
	 d ##class(apptools.core.files).GetList(path2,wc,.List)
	 ;zw List
	 s appdinamic=%request.Application_"get-files/"
	 $$$jsstart
 		w "UIkit.lightboxPanel({"
   		w "items: [ "
		  d ..LighboxDrawJson(.List,,appdinamic,..#GNStore)
  		w " ] }).show();"
	 $$$jsstop
	}
	write "<br>"
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxDrawJson">
<Description>
Lighbox Draw JSON
List - files array 
subdir - application static</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>List,subdir="",appdynamic,gn=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s i=""
 for { s i=$o(List(i)) q:i=""
 	if $lv($g(List(i))),$lg($g(List(i)),2)="F" {
		 	s fullpath=$lg($g(List(i)),1)
		 	s ItemName=$lg($g(List(i)),4)
 	} else {
 		s ItemName=$g(List(i,"ItemName"))
 		s fullpath=$g(List(i,"Name"))
 	}
 	set ext=$p(ItemName,".",*)
 	s mimetype=##class(apptools.core.filesMimeTypes).GetMimeTypes4ext(ext)
 	s type=$s(mimetype[("video"):"video",(mimetype)[("image"):"image",1:"iframe")
 	if subdir'="" {
 		w "{source: '"_subdir_ItemName_"', caption: '"_ItemName_"', type: '"_type_"'}",$c(13,10)
 	} else {
	 	set fileId=##class(apptools.core.files).GetFileIdView(fullpath,gn) 
		w "{source: '"_appdynamic_fileId_"', caption: '"_ItemName_"', type: '"_type_"'}",$c(13,10)
 	}
	w:$o(List(i))'="" ","
 }
]]></Implementation>
</Method>

<Method name="EnCode">
<Description>
Encode string to URL</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>s</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s s=$zconvert(s,"O","URL")
	q s
]]></Implementation>
</Method>

<Method name="DeCode">
<Description>
Decode string from URL</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>s</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	q $zconvert(s,"I","URL")
]]></Implementation>
</Method>

<Method name="DrawTableUi">
<Description>
Draw Tables UiKit</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[mode="beg",divId="tab2",attr="",&Enum]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if mode="beg" {
	&html<
 <div #(attr)# id="#(divId)#" >
    <table class="uk-table uk-table-hover uk-table-middle uk-table-divider">
        <thead>
           <tr>
          >
          s i=""  for {  s i=$o(Enum(i)) q:i=""
            write " <th "_$GET(Enum(i,"attr"))_" >"_$g(Enum(i))_"</th>"
          }
               /* <th class="uk-table-shrink">Preserve</th>
                <th class="uk-table-expand">Expand + Link</th>
                <th class="uk-width-small">Truncate</th>
                <th class="uk-table-shrink uk-text-nowrap">Shrink + Nowrap</th> */
    &html<
            </tr>
        </thead>
        <tbody>
        >
	}
    elseif mode="tr" {
			w "<tr>"
            s i=""  for {  s i=$o(Enum(i)) q:i=""
				w "<td "_$GET(Enum(i,"attr"))_">"_$GET(Enum(i))_"</td>"
               
               /* <td><input class="uk-checkbox" type="checkbox"></td>
               <td><img class="uk-preserve-width uk-border-circle" src="image/msw.jpg" width="40" alt=""></td>
                <td class="uk-table-link">
                    <a class="uk-link-reset" href="">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</a>
                </td>
                <td class="uk-text-truncate">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</td>
                <td class="uk-text-nowrap">Lorem ipsum dolor</td>*/
            } 			
            w "</tr>"
	}
	elseif mode="end" {
		&html<
		   </tbody>
 	 	 </table>
 		</div>
    	>
	} else {
	}
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Tabs.PanelUikitPermissMatrx">
<Description>
The template GUI of the application selector and tabs</Description>
<IncludeCode>apptools.core</IncludeCode>
<Super>apptools.Tabs.PanelUikit</Super>
<TimeChanged>65610,77273.857</TimeChanged>
<TimeCreated>65098,29527.199416</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
The application title</Description>
<Default>Tabs Application Matrix of Permission</Default>
</Parameter>

<Method name="GetAllApps">
<Description>
what are the available applications</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##super(.opt)
	s key="AmenuMatrix"
	s opt(key)=$$$aText("The matrix","") ;The name of the menu
	s opt(key,"id")="Matrix"
	s opt(key,"TabName")=$$$aText("The matrix","") ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabItem"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"TabMenu","Close")=1

	s key="menuUser"
	s opt(key)=$$$aText("An example of a user search","") ;The name of the menu
	s opt(key,"id")="FindUsers"
	s opt(key,"TabName")=$$$aText("The search tab users","") ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabItem"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"TabMenu","Close")=1

	s key="menuZ-about"
	s opt(key)="About the program"
	s opt(key,"id")="About"
	s opt(key,"TabName")="About the program"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"Disable")=0 ;developed
	
	s key="menu2-param"
	s opt(key)="Parameter"
	s opt(key,"id")="Param"
	s opt(key,"TabName")="Edit Parameter"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabItem"
	s opt(key,"Disable")=0
	s opt(key,"TabMenu","Close")=1
	s opt(key,"Active")=1 ;Download the tab immediately

	q $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabAbout">
<Description>
the render Tab On the program"
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[

	d ..GetAllApps(.opt) 
	i $g(opt(Par,"Disable")) w ..GetSupportInfo() q $$$OK
	s divId=$g(opt(Par,"id"))
	w "Sample Program Based on jQueryUI, Uikit<br>"
	w ..ButtonAgain(divId,Par)
	;w "<pre>" w  w "</pre>"
]]></Implementation>
</Method>

<Method name="ShowTabItem">
<Description>
rendering Tabs
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ..GetAllApps(.opt) 
 i $g(opt(key,"Disable")) w ..GetSupportInfo() q $$$OK
 s NSpace=$zu(5)
 s divId=$g(opt(key,"id"))
 s mhead=divId_"MainHeader"
 s mcont=divId_"MainContent"
 &html<
<form id="#(divId_"MainForm")#">
<div class="uk-grid">
    <div class="uk-width-1-1 " style='overflow: auto;' id="#(mhead)#" ></div>
    <div class="uk-width-1-1 uk-margin-top uk-margin-bottom" style='overflow: auto;' id="#(mcont)#"></div>
</div>
</form>

>
 $$$jsstart
 	; to calculate the height of the container as a result of wijetunge victory container-Taba height of the container header
 	w "$('#"_mcont_"').height($(window).height()-($('#"_mhead_"').height()+$('#t1').height()+$('#MainNavbar').height()+200));"
 	;Dimming of the screen that says Download
  	w $$$blockui($$$aText("Loading...",""))
	
	;For the organization of execution by clicking on the apply button AppAct js function(From,To,Act), where
	;From - the ID of the container where will we get the items from the form method serialize
	;To - ID container where we deduce resultat run
	;AppAct=NameSpace:Packet.ClassName:Method:&Par1=Val1&Par2=Val2...
	w "AppAct('"_divId_"MainForm','"_mhead_"','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"FirstHead:&divId="_divId_"&key="_key_"');"
	
 $$$jsstop
 quit $$$OK
]]></Implementation>
</Method>

<Method name="ParamFirstHead">
<Description>
to download a form for editing</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set class="apptools.core.Parameter"
	
	set sql="select * from "_class_" where Name is not null order by id desc"
	;The list of fields displayed in the Value attribute of the Option tag, 
	;The first field of the query must be an identifier
	set listFields="ID,ID,Name,Description"
	write $$$aText("Select settings","")
	s ONCHANGE=";$('#"_divId_"SelectId').attr('value',data.item.value);"
	do ##class(apptools.core.Form).SelectObj(sql,ONCHANGE,listFields,.gn,divId_"Select")
	
	write "<br>"_$$$appInputHidden(divId_"SelectId","","")_"<br>"
	
	set onclick=$$$blockui($$$aText("Loading...",""))_";AppAct('"_divId_"MainForm','"_divId_"MainContent','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"Result:&key="_key_"&divId="_divId_"&class="_class_"&mode=*');"
	write $$$appTable1(class)
	set butt1=$$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""",$$$aText("Preview mode in two columns",""))
	set butt2=$$$appButton(divId_"appButtonResult2","onclick="""_$tr(onclick,"*",2)_"""",$$$aText("Edit mode in one column",""))
	set butt3=$$$appButton(divId_"appButtonResult2","onclick="""_$tr(onclick,"*",3)_"""",$$$aText("The view mode from table",""))
	write $$$appTableTrTd1(butt1_butt2_butt3)
	write $$$appTableEnd1
	quit $$$OK
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
// The result of selecting the edit mode settings

]]></Content>
</UDLText>

<Method name="ParamResult">
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	set class=Par("class")
	set SelectId=$g(Par("%request.Data",divId_"SelectId"))
	write ..ButtonAgain(divId,key)
	if mode=1 {
		;the order of the fields in two columns by the delimiter :
		set order="Name,Description:Value,Types:DateStart,DateFinish:isEnabled,isEnabledCheck:File,OfficeFile:ImageFile,ImageGlobal::,"
		do Show(0,order)
		quit $$$OK
	} 
	elseif mode=2 {
		;the order of fields by default
		set order=""
		do Show("1,ShowFieldName",order)
		quit $$$OK
	} 
	elseif mode=3 {
		set sql="select * from "_class
		set exec="##class(apptools.Form.Explorer).WinEditObj(.%AppLogInfoVal, %AppLogInfoCol, %AppLogInfoHead, .%AppLogInfoTemp,"""_$zu(5)_""")"
		set st=##class(apptools.Form.Explorer).SelectObjects(class,sql,exec)
		;write 'st w $$$appError($System.Status.GetErrorText(st)) 
	}
	q $$$OK
Show(modeShow,order)
	set obj=##class(apptools.core.Form).GetObj(SelectId_","_class)
	if '$isobject(obj) { 
		set msg=$$$aText("Failed to open object ","")_SelectId_","_class
		write $$$appError(msg) q $$$ERROR($$$GeneralError,msg)
	}
	do ##class(apptools.core.Form).Show(obj,modeShow,divId,order)
 q
]]></Implementation>
</Method>

<Method name="FindUsersFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	s key=Par("key")
	s divId=Par("divId")
	set onclick=$$$blockui($$$aText("Loading...",""))_";AppAct('"_divId_"MainForm','"_divId_"MainContent','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"Result:&key="_key_"&divId="_divId_"&mode=*');"
	&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
			Login
			</td>
			<td>
			#($$$appText(divId_"Name","","su"))#
			</td>
			<td>
			fullname
			</td>
			<td>
			#($$$appTextarea(divId_"fullName","rows=5",""))#
			</td>
			<td>
			Date
			</td>
			<td>
			#($$$appDate(divId_"Date","",""))#
			</td>
		</tr>
		<tr>
			<td>
			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""","Find user"))#
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult2","onclick="""_$tr(onclick,"*",2)_"""","Get items from the form"))#
			</td>
			<td>
			#($g(fileDownload))#
			</td>
			<td>
			date time
			</td>
			<td>
			#($$$appDateTime(divId_"DateTime","",""))#
			</td>
		</tr>
		</table>
	>
	q $$$OK
]]></Implementation>
</Method>

<Method name="FindUsersResult">
<Description>
Search result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	set Name=$g(Par("%request.Data",divId_"Name"))
	set fullName=$g(Par("%request.Data",divId_"fullName"))
	set Date=$g(Par("%request.Data",divId_"Date"))
	set DateTime=$g(Par("%request.Data",divId_"DateTime"))
	write ..ButtonAgain(divId,key)
	if mode=1 {
		if Name="" w $$$appError($$$aText("Context is empty","")) q $$$OK
		zn "%SYS"
		set sql="select ID,name,EmailAddress,fullName from Security.Users where Enabled [ '1' "
		if Name'="" s sql=sql_" and (name like '%"_Name_"%') "
		if fullName'="" s sql=sql_" and (fullName like '%"_fullName_"%') "
		set msg="Query: "_sql
		set exec="##class(apptools.core.LogInfo).MarkRed(%AppLogInfoVal,"""_Name_","_fullName_""")"
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,100000,$zu(5),msg,exec)
		if 'st  w $$$appError($System.Status.GetErrorText(st)) 
		quit $$$OK
	} 
	elseif mode=2 {
		w "<br>" w $$$appMsg(Name_" "_fullName_" "_Date_" "_DateTime)
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="GetSupportInfo">
<Description>
To obtain information on the support</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s msg=$$$aText("Software complex to debug. Try to log in later, or contact tech support:","")
	q msg_"Support info mailto: sample@server.com"
]]></Implementation>
</Method>

<Method name="MatrixFirstHead">
<Description>
download form template search users and roles</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	s key=Par("key")
	s divId=Par("divId")
	s %ui=1
	set onclick=$$$blockui($$$aText("Loading...",""))_";AppAct('"_divId_"MainForm','"_divId_"MainContent','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"Result:&key="_key_"&divId="_divId_"&mode=*');"
	&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
 	Login <br>#($$$appText(divId_"name","title='"_$$$aText("Names separated by a comma or by context","")_"'","s"))#
			</td>
			<td>
	Roles <br>#($$$appText(divId_"roles","title='"_$$$aText("Roles separated by a comma or by context","")_"'","db"))#
			</td>
			<td>
	#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""",""_$$$aText("User roles","")))#
			</td>
		</tr>
		</table>
	>
	q $$$OK
]]></Implementation>
</Method>

<Method name="MatrixResult">
<Description>
Search result </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s %ui=1
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	set name=$g(Par("%request.Data",divId_"name"))
	set roles=$g(Par("%request.Data",divId_"roles"))
	write ..ButtonAgain(divId,key)
	d ##class(apptools.Tabs.security).UiMatrixPermission(name,roles,divId,key,"apptools.Tabs.security","UiSavePermiss")
	q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Tabs.PanelUikitPermissions">
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>apptools.Tabs.PanelUikitAdmin</Super>
<TimeChanged>65610,77273.857</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>

<Parameter name="HeaderText">
<Description>
Application title</Description>
<Default>Permissions</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files</Description>
<Default>^apptools.Permissions</Default>
</Parameter>

<Parameter name="AppRoles">
<Default>ui_Permissions</Default>
</Parameter>

<Method name="GetAllApps">
<Description>
what modes are available</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if ..IsPermiss("%All") {	
	s LeftMenuName="Permission",LeftMenuNumer=1
	s key="MenuMatrix"
	s opt(key)=$$$aText("The matrix","") ;The name of the menu
	s opt(key,"id")="Matrix"
	s opt(key,"TabName")=$$$aText("The matrix","") ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"TabMenu","Close")=1
	s opt(key,"Menu")=$lb(LeftMenuNumer,LeftMenuName,1) ;$lg(,3)=1 - level 1 open menu
	s opt(key,"Active")=1 ;active menu item

	s LeftMenuName="Account",LeftMenuNumer=99
	
	s key="menu-top-account3"
		s opt(key)="Exit"
		s opt(key,"id")="AccountExit"
		s opt(key,"TabName")="Logoit" 
		s opt(key,"ClassName")=..%ClassName(1)
		s opt(key,"Method")="Logout"
		s opt(key,"MenuTop")=$lb(LeftMenuNumer,LeftMenuName) ; 99-account has nested items
		
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="MatrixFirstHead">
<Description>
download form template search users and roles</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	s key=Par("key")
	s divId=Par("divId")
	s %ui=1
	;set onclick=$$$blockui($$$aText("Loading...",""))_";AppAct('"_divId_"MainForm','"_divId_"MainContent','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"Result:&key="_key_"&divId="_divId_"&mode=*');"
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	;ActionJs('"_divId_"MainForm','"_divId_"MainContent','','"_divId_"Result','key="_key_"~divId="_divId_"~mode=*');"

	&html<
		<table>
		<tr>
			<td>
 	Login <br>#($$$appText(divId_"name","title='"_$$$aText("Names separated by a comma or by context","")_"'","s"))#
			</td>
			<td>
	Roles <br>#($$$appText(divId_"roles","title='"_$$$aText("Roles separated by a comma or by context","")_"'","d"))#
			</td>
			<td> <br>
	#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""",""_$$$aText("User roles","")))#
			</td>
		</tr>
		</table>
	>
	q $$$OK
]]></Implementation>
</Method>

<Method name="MatrixResult">
<Description>
Search result </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s %ui=1
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")

	;Geting elements from form and prepare array Par
	s name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"name")	
	set roles=$g(Par("%request.Data",divId_"roles"))


	write ..ButtonAgain(divId,key)
	d ##class(apptools.Tabs.security).UiMatrixPermission(name,roles,divId,key,"apptools.Tabs.security","UiSavePermiss")
	q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Tabs.security">
<Description>
Security utilities</Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65828,39827.891296</TimeChanged>
<TimeCreated>64734,80043.870644</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Method name="UiSavePermiss">
<Description>
Save Access Rights
d ##class(apptools.Tabs.security).UiSavePermiss(.Par)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")

	;Geting elements from form and prepare array Par
	s name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"name")	
	;set roles=$g(Par("%request.Data",divId_"roles"))
	
	set i=""
	for { set i=$o(Par("%request.Data",i)) quit:i=""
		if i[(divId_"Matr0") {
			set val=$g(Par("%request.Data",i))
			if val'["unchecked" {
				set chk(i)=val
				set us=$p(i,"0",2)
				set ro=$p(i,"0",3)
				if $e(ro,1)="p" s ro="%"_$e(ro,2,*)
				if ro["_pD" s ro=$replace(ro,"_pD","_%D")
				set users(us,ro)=val
			}
		}
	}

	new $NAMESPACE
  	set $NAMESPACE = "%SYS"
	set us=""
	for { set us=$o(users(us)) quit:us=""
			set tSC=##class(Security.Users).Get(us,.prop)
			if '$$$ISOK(tSC)  write $$$appError(us_": Error="_$SYSTEM.Status.GetErrorText(tSC)) quit
			set roles=","_prop("Roles")_","
			kill prop
			set ro=""
			for { set ro=$o(users(us,ro)) quit:ro=""
				if $g(users(us,ro)) {
					if roles'[(","_ro_",") set roles=roles_ro_","
				}else {
					if roles[(","_ro_",") set roles=$replace(roles,ro_",","") set:$e(roles,*)'="," roles=roles_","
				}
			}
			set:$e(roles,1)="," roles=$e(roles,2,*)
			set:$e(roles,*)="," roles=$e(roles,1,*-1)
			set prop("Roles")=roles
			;zw prop
			;##class(apptools.form).UikitNote($$$aText("Saved",""),"success")
			set tSC=##class(Security.Users).Modify(us,.prop)
			if '$$$ISOK(tSC) write $$$appError(##class(apptools.core.Form).UikitNote(us_": Error="_$SYSTEM.Status.GetErrorText(tSC))) quit
			;Check
			set tSC=##class(Security.Users).Get(us,.pro)
			if '$$$ISOK(tSC) write $$$appError(##class(apptools.core.Form).UikitNote(us_": Error="_$SYSTEM.Status.GetErrorText(tSC))) quit
			write $$$appMsg(##class(apptools.core.Form).UikitNote(us_": "_pro("Roles"),"success"))
	}
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="UiMatrixPermission">
<Description>
Get HTML content of access matrix form
d ##class(apptools.Tabs.security).UiMatrixPermission("sm","sp","Ui","AnyKey","apptools.Tabs.security","Ui"_"SavePermiss")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>name="",rolesmask="",divId="",key="",class="",Method="",blockui=1</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
		if name="" write $$$appError($$$aText("Select the filter by user option Login blank (Names separated by commas or by the context","")) q 1
		if rolesmask="" write $$$appError($$$aText("Select the filter control","")) q 1
		set msg=$$$aText("Matrix of access rights","")
		set:blockui onclick=$$$blockui($$$aText("Loading...",""))
		
		set onclick=$GET(onclick)_
			$$$onclick(divId_"FormContentSave",divId_"ContentSave",$namespace,class,Method,"&key="_key_"&divId="_divId_"&mode=Save")

		set butt=$$$appButton(divId_"appButtonSavePermiss","onclick="""_onclick_"""",$$$aText("Save access rights",""))
		write butt_"<br><br>"
		write "<form id='"_divId_"FormContentSave' >"
		do ##class(apptools.core.sys).GetRoles(rolesmask,.roles)
		if '$d(roles) write $$$appError($$$aText("This filter was","")) quit 1
		;set roles("%all")=$lb("%All","The Super-User Role")
		do ##class(apptools.core.sys).GetUsers(name,.users)
		if '$d(users) write $$$appError($$$aText("This filter users not found","")) quit 1
		set r="UserName"
  		set gn="matrix"
 	    set @gn@(0,1)=$lb(r)
 		set @gn@(-1,r)=1
  		set col(1)=r
  		set r=""
        for col=2:1 { set r=$o(roles(r)) quit:r=""
        	set NameRole=$lg(roles(r),1)
   		    set @gn@(0,col)=$lb(NameRole)
	  		set @gn@(-1,NameRole)=col
	  		set col(col)=NameRole
        }
        set col=col-1
		set u=""		
		for row=1:1 { set u=$o(users(u)) quit:u=""
			set usroles=$lg(users(u),3)
			;zwrite usroles
			set @gn@(row)=$g(@gn@(row))_$lb(u)
			for c=2:1:col {
				set yes="unchecked"
				if $LISTFIND(usroles,col(c)) set yes="1unchecked"
				set ret=##class(apptools.core.Form).WebCompShowCheckbox(,,,divId_"Matr0"_u_"0"_$tr(col(c),"%","p")_"0",yes)
				set @gn@(row)=$g(@gn@(row))_$lb(ret)
			}
		}
		set st=##class(apptools.core.LogInfoPane).DrawSQL("result "_gn,100000,$zu(5),$g(msg),$g(exec),,1)
		;TODO do ##class(apptools.core.Form).DrawTable(.matrix) 
		write "</form><div id='"_divId_"ContentSave'></div>"
		quit $$$OK
]]></Implementation>
</Method>

<Method name="UsersModify">
<Description>
Create users and Save Access Rights
s Users("Test1","%All")=1,Users("Test1")=$lb("Pass","Description") w ##class(apptools.LockDown).Modify(.Users)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>users=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[

	new $NAMESPACE
  	set $NAMESPACE = "%SYS"
  	set tSC=$$$OK
	set us=""
	for { set us=$o(users(us)) quit:us=""
			;if not exist then create TODO
			if '##class(Security.Users).Exist(us) {
				continue
			}
			set tSC=##class(Security.Users).Get(us,.prop)
			if '$$$ISOK(tSC)  write $$$appError(us_": Error="_$SYSTEM.Status.GetErrorText(tSC)) quit
		
			set roles=","_prop("Roles")_","
			kill prop
			set ro=""
			for { set ro=$o(users(us,ro)) quit:ro=""
				if $g(users(us,ro)) {
					if roles'[(","_ro_",") set roles=roles_ro_","
				}else {
					if roles[(","_ro_",") set roles=$replace(roles,ro_",","") set:$e(roles,*)'="," roles=roles_","
				}
			}
			set:$e(roles,1)="," roles=$e(roles,2,*)
			set:$e(roles,*)="," roles=$e(roles,1,*-1)
			set prop("Roles")=roles
			;zw prop
			set tSC=##class(Security.Users).Modify(us,.prop)
			if '$$$ISOK(tSC) quit
			;Check
			set tSC=##class(Security.Users).Get(us,.pro)
			if '$$$ISOK(tSC) quit
	}
	Quit tSC
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Uikit.Admin">
<Description>
The template GUI of the application selector and tabs on the basis jQueryUi, Uikit</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeChanged>65819,34802.685178</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
The application title</Description>
<Default>AdminTabsApplication</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files and id sessions</Description>
<Default>^%apptools.ui</Default>
</Parameter>

<Parameter name="PreLoad">
<Description>
For Redirect </Description>
</Parameter>

<Method name="IsPermiss">
<Description>
is there a right to work with this form</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>role</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	q $roles[role||($roles["%All")
]]></Implementation>
</Method>

<Method name="GetAppIcon">
<Description>
Icons for the application</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>path</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[ 	q "<link rel=""icon"" type=""image/x-icon"" href=""data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AJCQk/yQkJP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/0ZGRv8XFxf/////AP///wD///8A////AP///////////////+7u7v9OTk7/sbGx/11dXf9KSkr///////////+lpaX/4eHh/////wD///8A////AAAAAP8AAAD///////////+8vLz///////X19f/t7e3/gICA/5eXl////////////wAAAP8AAAD/////AKysrP8AAAD/AAAA/wAAAP+enp7/////////////////////////////////5OTk/wAAAP8AAAD/AAAA/6ysrP////8A////AP///wCurq6PlJSUzP///wD///8A////AP///wD///8A////AJSUlMyQkJDY////AP///wD///8A////AP///wD///8AAAAA/wAAAP////8A////AP///wD///8A////AP///wAAAAD/AAAA/////wD///8A////AP///wD///8AAAAA/wAAAP8AAAD/////AP///wD///8A////AP///wD///8AAAAA/wAAAP8AAAD/////AP///wD///8ACwsL/wAAAP8AAAD/lJSU2AAAAP8AAAD/cnJy/1hYWP8AAAD/AAAA/2FhYdgHBwf/AAAA/wAAAP////8A////AP///wD///8A////AP///wAAAAD/s7Oz/wAAAP8AAAD/x8fH/wAAAP////8A////AP///wD///8A////AP///wD///8A////AP///wAAAAD/AAAA/////wAAAAD/AAAA/////wAAAAD/AAAA/////wD///8A////AP///wD///8A////AP///wD///8AAAAA/wAAAP+qqqqlAAAA/wAAAP9lZWXjAAAA/wAAAP////8A////AP///wD///8A////AP///wD///8A////ALa2tv////8A9vb2UQAAAP8AAAD/////Uf///wDAwMD/////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wBcXFz/AAAA/////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AADAAwAAwAMAAIABAAAAAAAA5+cAAOfnAADH4wAAgAEAAPgfAADyTwAA8A8AAPZvAAD+fwAA//8AAA==""/>"
]]></Implementation>
</Method>

<Method name="PreLoad">
<ClassMethod>1</ClassMethod>
<FormalSpec>path</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[ q $$$OK
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Main method generate the content of page</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>parameter=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
 set NSpace=##class(apptools.core.Action).GetParam(.%request,"ns",parameter)
 s:$g(NSpace)="" NSpace=$zu(5)
 zn NSpace
 // Save the session parameters debugging mode (implies extended disclosure)
 ;s %session.Data("debug")=%request.Get("debug")

 if ..#PreLoad'="" {
  &html< <!doctype html> <html>>
	 d ..PreLoad(.%request)
  &html<</html>>
	q $$$OK
 }
 
 // http://cip.mvk.ru/csp/spgz/apptools.MVK.gisui.cls?ns=MVK&autoload=Find# - Find the first startup
 // http://localhost:57773/apptoolsrest/get-html/apptools.Tabs.PanelUikitAdmin?ns=APP&autoload=Find
 ;if $d(%request) {  set autoloadmenu=$p(%request.Get("autoload"),"#")
 set autoload=##class(apptools.core.Action).GetParam(.%request,"autoload",parameter)
 
 ;do ##class(apptools.core.Log).AddRecord(..%ClassName(1), "OnPage", "Login", "INFO", "","")
 
 set path=$$$PATHCSP_"apptools-uikit-dark-admin/"
 ;get full html
 s html=##class(apptools.core.rest).getStatic(..%ClassName(1)_"Static:html")
 s html=$replace(html,"href=""css","href="""_path_"css")
 s html=$replace(html,"src=""js","src="""_path_"js")
 s html=$replace(html,"TitleUIKitDarkAdmin",..#HeaderText)
 s html=$replace(html,"HeaderUIKitDarkAdmin",..#HeaderText)
 
 ;s link=##class(apptools.core.LogInfoPane).GetLink() ;already load
 ;s jsrc=##class(apptools.core.LogInfoPane).AddJsScripts() 
 
 s js=##class(apptools.core.rest).getStatic("apptools.Uikit.AdminStatic:javascript")
 s css=##class(apptools.core.rest).getStatic("apptools.Uikit.AdminStatic:css")
 
 set menu=..DrawMenu() ;sidebar
 set menuTop=..DrawMenuTop() ;top think
	
 s icon=..GetAppIcon(path)
 
 s html=$replace(html,"<!--head-end-->",icon_js_css)
 s html=$replace(html,"<!--#(menuTop)#-->",menuTop)
 s html=$replace(html,"<!--#(menu)#-->",menu)
 
 s par="<p title='"_$username_"'> "_($$$aText("If you are not available to any single menu item",""))_"</p>"
 s html=$replace(html,"<!--#($username)#-->",par)

 write $p(html,"<!--js-end-->",1)
  $$$jsstart
 	;w "$('#account_status').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=DrawStatus&appNsp="_NSpace_"&appPar=');"_$c(13,10)
 	;w "$('#searchstr').keydown(function (e) { if (e.keyCode == 13) { $('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar=Search&Searchstr='+document.getElementById('searchstr').value); }});"_$c(13,10)
 	write ##class(apptools.core.Action).WriteActJs(%request,"","account_status",..%ClassName(1),"DrawStatus","")_$c(13,10)
 	set enter=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar=Search&Searchstr='+document.getElementById('searchstr').value")_$c(13,10)
 	write "$('#searchstr').keydown(function (e) { if (e.keyCode == 13) { "_enter_" }});"_$c(13,10)
  	if autoload="" {
	 	do ..GetAllApps(.opt) 
	 	set i="" 
	 	for { set i=$o(opt(i)) q:i=""
	 		if $GET(opt(i,"Active")) write "$('#Menu"_opt(i,"id")_"').trigger('click');"_$c(13,10)
	 	}
 	} else {
	 	write "$('#Menu"_autoload_"').trigger('click');"_$c(13,10)
 	}
 $$$jsstop
 &html< </body></html>>
 q $$$OK
]]></Implementation>
</Method>

<Method name="DrawMenuTop">
<Description>
the rendering top menu </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	do ..GetAllApps(.opt) 
	do ..GetAllMenu(.opt,.menu,1)
	set m="",ret=""
	for { set m=$o(menu(m)) quit:m=""
		s i=""
		if m=99 { ;account - with submenu
			s ret=ret_"<li class='has-children account'><a href='#'><span id='account_status'>"_$lg(menu(m),2)_"</span></a><ul>"
			for { set i=$o(menu(m,i)) quit:i=""
		   		;set onclick="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar="_i_"');"
				set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar="_i)
				set ret=ret_"<li><a id='Menu"_$g(opt(i,"id"))_"' href='#' onclick="""_onclick_""">"_$g(opt(i))_"</a></li>"
			}
			s ret=ret_"</ul></li>"
		}
		else {
			for { set i=$o(menu(m,i)) quit:i=""
		   		;set onclick="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar="_i_"');"
		   		set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar="_i)
				set ret=ret_"<li><a id='Menu"_$g(opt(i,"id"))_"' href='#' onclick="""_onclick_""">"_$g(opt(i))_"</a></li>"
			}
		}
	}
  quit ret
]]></Implementation>
</Method>

<Method name="DrawMenu">
<Description>
render side menu </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	do ..GetAllApps(.opt) 
	do ..GetAllMenu(.opt,.menu)
	set m="",ret=""
	for { set m=$o(menu(m)) quit:m=""
		s i=""
		s active=$s($lg(menu(m),3):"active",1:"")
		s ret=ret_"<li class='has-children overview "_active_"'><a href='#'>"_$lg(menu(m),2)_"</a><ul>"
		for { set i=$o(menu(m,i)) quit:i=""
	   		;set onclick="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar="_i_"');"
	   		set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar="_i)
			set ret=ret_"<li><a id='Menu"_$g(opt(i,"id"))_"' href='#' onclick="""_onclick_""">"_$g(opt(i))_"</a></li>"
		}
		s ret=ret_"</ul></li>"
	}
  quit ret
]]></Implementation>
</Method>

<Method name="GetSupportInfo">
<Description>
To obtain information on the support</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s msg=$$$aText("Software complex to debug. Try to log in later, or contact tech support:","")
	q msg_"Support info mailto: sergey.mikhaylenko@gmail.com"
]]></Implementation>
</Method>

<Method name="IsDebugMode">
<Description>
To add to the form js code if development mode</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>mode=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 i mode,'%request.Get("debug") { 
	$$$jsstart
	  w $$$blockui(..GetSupportInfo())
	$$$jsstop
  q $$$OK
 }
	q 0
]]></Implementation>
</Method>

<Method name="DrawStatus">
<Description>
rendering status of the user</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;do ##class(apptools.core.Form).BlockUI(0)
	s fio=##class(apptools.core.sys).GetFullName($username)
	s:fio="" fio=$$$aText("The user","")
	;w $s(%request.Get("debug"):"<font color=red><b>"_$$$aText("Administrator mode","")_"</b></font>",1:"")_" <span class='tip' title='"_$username_"-"_$j_"-"_$zu(5)_"'>"_$$$aText("User","")_": "_fio_"</span>, "_$tr(##class(apptools.core.type).GetDateTime($h),"T"," ")
	write "<span class='tip' title='"_fio_"-"_$j_"-"_$zu(5)_"'>"_$username_"</span>"
 	;$$$jsstart
	;	w "$('.tip').tooltip();"
	;$$$jsstop
 q $$$OK
]]></Implementation>
</Method>

<Method name="GetAllMenu">
<Description>
To menu</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt,menu,top=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s i="" for { s i=$o(opt(i)) q:i=""
	if 'top,$d(opt(i,"Menu")) { 
		s m=$lg(opt(i,"Menu"),1)
		s:'$d(menu(m)) menu(m)=opt(i,"Menu")
		s menu(m,i)=""
	}
	if top,$d(opt(i,"MenuTop")) { 
		s m=$lg(opt(i,"MenuTop"),1)
		s:'$d(menu(m)) menu(m)=opt(i,"MenuTop")
		s menu(m,i)=""
	} else {
		;s:'$d(menu(99)) menu(99)=$lb(0,"---",0)
		;s menu(99,i)=""
	}
  }
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what are the available modes</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;make them zavisimye from the area
	;------------ sidebar
	s key="menu-first"
	s opt(key)="Find users" ;The name of the menu
	s opt(key,"id")="Find" ;use methods: FindFirstHead FindResult
	s opt(key,"TabName")="finding users" ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"TabMenu","Close")=1
	s opt(key,"Menu")=$lb(1,"Mode",1) ;$lg(,3)=1 - open menu level 1
	s opt(key,"Active")=1 ;active menu item

	s key="menu-first2"
	s opt(key)="Sample gallery" ;The name of the menu
	s opt(key,"id")="Lighbox" ;use methods: LighboxFirstHead LighboxResult
	s opt(key,"TabName")="Gallery" ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"TabMenu","Close")=1
	s opt(key,"Menu")=$lb(1,"Mode",1) ;$lg(,3)=1 - open menu level 1
	
	s key="menu-second"
	s opt(key)="Help"
	s opt(key,"id")="Help"
	s opt(key,"TabName")="Help"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"MethodUrl")="http://ShowTabAbout.cls"
	s opt(key,"Disable")=1 ;developed
	s opt(key,"Menu")=$lb(2,"About the program",0)

	s key="menu-second2"
	s opt(key)="Menu 3"
	s opt(key,"id")="About"
	s opt(key,"TabName")="Menu 3"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"Disable")=1 ;developed
	s opt(key,"Menu")=$lb(2,"About the program")

	s key="menu-second3"
	s opt(key)="Support"
	s opt(key,"id")="Support"
	s opt(key,"TabName")="Support"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"MethodUrlNewWin")="http://ShowTabAbout.cls"
	s opt(key,"Disable")=1 ;developed
	s opt(key,"Menu")=$lb(2,"About the program")
	
	;------------ one-level upper menu 
	s key="menu-topLern"
	s opt(key)="Menu 2"
	s opt(key,"id")="Menu2"
	s opt(key,"TabName")="Menu 2"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"MenuTop")=$lb(1,"Menu 2") ;has no sub-items

	s key="menu-topOpt"
	s opt(key)="Option"
	s opt(key,"id")="Option"
	s opt(key,"TabName")="Option"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"MenuTop")=$lb(2,"Option") ;has no sub-items

	;------------ top menu the top-accoun
	s key="menu-top-accoun"
	s opt(key)=$$$aText("Profile","")
	s opt(key,"id")="AccountProf"
	s opt(key,"TabName")=$$$aText("Profile","")
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"MenuTop")=$lb(99,"Account") ;only 99-account has sub-items

	s key="menu-top-account3"
	s opt(key)=$$$aText("Exit","")
	s opt(key,"id")="AccountExit"
	s opt(key,"TabName")=$$$aText("Exit","")
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="Logout"
	s opt(key,"MenuTop")=$lb(99,"Account") ;only 99-account has sub-items
	
	;----- Setup the search in the top menu
	s key="Search"
	s opt(key)=$$$aText("Search","")
	s opt(key,"id")="Search-"
	s opt(key,"TabName")=$$$aText("Search","")_"-"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSearch"
	s opt(key,"TabMenu","Close")=1
	s opt(key,"TabMenu","Mode")=0 ;1 - for each new search bar to make new tab, 0-tab is always the same
	
	q $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabSearch">
<Description>
drawing Tabs search
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 ;do ..GetAllApps(.opt) 
 ;if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 ;set NSpace=$zu(5)
 w $$$aText("Context","")_" :"_$g(key)
 ;set pref=$g(opt(key,"id"))
]]></Implementation>
</Method>

<Method name="ShowTab">
<Description>
the render Tab on the menu
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $g(Par("appPar"))'="" set Par=Par("appPar")
	do ..GetAllApps(.opt) 
	d ..ShowTabApps(.Par,.opt)
]]></Implementation>
</Method>

<Method name="ShowTabApps">
<Description>
the render Tab on the menu
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par,opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if Par="Search" {
		s Searchstr=$g(Par("%request.Data","Searchstr"),Par("Searchstr"))
		if Searchstr="" q $$$OK
		;s tr=$tr(##class(apptools.MSW.type).Transliteration(Searchstr)," `()\/*;'"":%","_N---")
		;s tr=$tr($zts,".,") 
		s tr=$e($tr(Searchstr," `()\/*;'"":%?$@&.,",""),1,10)_$i(@..#GNStore@("jobs",$j))
		s key=tr ;Searchstr
		MERGE opt(key)=opt(Par)
		s opt(key)=opt(key)_tr ;Searchstr
		i $g(opt(Par,"TabMenu","Mode"))=1 { ;mode add a new tab 
			s opt(key,"id")=opt(key,"id")_tr
		} else { ;mode add a new replace the old 
			set tabId="tab-"_opt(Par,"id")
			set tabIdMenu="tabMenu-"_opt(Par,"id")
			$$$jsstart
		  	 w "$('#"_tabId_"').remove();"
		  	 w "$('#"_tabIdMenu_"').remove();"
		  	$$$jsstop
		}
		s opt(key,"CGIvar")="&Searchstr="_Searchstr ;$zconvert(Searchstr,"O","URI")
		s opt(key,"TabName")=opt(key,"TabName")_tr 
		s Par=key

	}
	set tabId="tab-"_opt(Par,"id")
	set tabIdMenu="tabMenu-"_opt(Par,"id")
	if $g(opt(Par,"TabMenu","Close"))'="" s IconMenu="<span class=""uk-margin-small-left uk-icon uk-close"" uk-icon=""close"" onclick=""$(\'#"_tabIdMenu_",#"_tabId_"\').remove();""></span>"
 	if $DATA(opt(Par,"TabMenu","Close"))>9 { //there are more points
 		;TODO
 	}
 	$$$jsstart
 	 if $g(opt(Par,"MethodUrlNewWin"))'="" {
	 	 if $g(opt(Par,"Disable")) { w "alert('"_$$$aText("Mode debugging","")_"');"}
	 	 else {write "window.open('"_$g(opt(Par,"MethodUrlNewWin"))_"','_blank');"
	 	 }
 	}
	else {
 	 write "if (!$('li').is('#"_tabId_"')) { $('.uk-active').removeClass('uk-active');"_$c(13,10)
 		write " $('#tabList').append('<li id="_tabId_"></li>');"_$c(13,10)
 		write " $('#tabMenu').append('<li id="_tabIdMenu_"><a>"_$g(opt(Par,"TabName"))_$g(IconMenu)_"</a></li>');"_$c(13,10)
 		write " $('#t1,#ta1').hide();"_$c(13,10) //" $('#t1').prop('disabled',true);"
 		if $g(opt(Par,"Disable")) {
	 		;write "$('#"_tabId_"').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTabAbout&appNsp="_$zu(5)_"&appPar="_Par_"');"
	 		write ##class(apptools.core.Action).WriteActJs(%request,"",tabId,..%ClassName(1),"ShowTabAbout","&appPar="_Par_$g(opt(Par,"CGIvar")))
 		}
 		elseif $g(opt(Par,"MethodUrl"))'="" {
	 		write "$('#"_tabId_"').load('"_$g(opt(Par,"MethodUrl"))_"');"
 		}
 		else {
	 		;write "$('#"_tabId_"').load('apptools.core.Action.cls','appClass="_$g(opt(Par,"ClassName"))_"&appMethod="_$g(opt(Par,"Method"))_"&appNsp="_$zu(5)_"&appPar="_Par_"');"
	 		write ##class(apptools.core.Action).WriteActJs(%request,"",tabId,$g(opt(Par,"ClassName")),$g(opt(Par,"Method")),"&appPar="_Par_$g(opt(Par,"CGIvar")))
 		}
 	 write "};"
 	 write " UIkit.tab('#tabMenu').show($('#"_tabIdMenu_"'));"
	}
	$$$jsstop
]]></Implementation>
</Method>

<Method name="Logout">
<Description>
Return in a single string</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(Par("appPar"))'="" set Par=Par("appPar")
 do ##class(apptools.core.sys).logout()
 set onclick = "top.document.location.reload();"
 do ..GetAllApps(.opt) 
 $$$jsstart
 set i=""
 for { set i=$o(opt(i)) q:i=""
 	continue:i=Par
 	set tabId="tab-"_opt(i,"id")
	set tabIdMenu="tabMenu-"_opt(i,"id")
 	write "$('#"_tabIdMenu_",#"_tabId_"').remove();"
 }
 $$$jsstop
 &html<
 <br>
 <div class="uk-align-center uk-width-1-1 uk-margin-left uk-margin-right " style='overflow: auto;'>
	<div class="uk-alert-warning" uk-alert>
		<p>#($$$aText("The output of Sistema produced",""))#</p>
	</div>
	<center><button class="uk-button uk-button-default uk-margin-small-right" type="button" onclick="#(onclick)#" ><span class="uk-margin-small-left uk-icon" uk-icon="sign-in"></span>#($$$aText("Log in",""))#</button>
	</center>
</div><br><br>
>
 	quit $$$OK
]]></Implementation>
</Method>

<Method name="ButtonAgain">
<Description>
The output of the First button</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>divId="",key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set mhead=divId_"MainHeader"
	set mcont=divId_"MainContent"
	set onclick="$('#"_mcont_"').empty();"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",mhead,..%ClassName(1),divId_"FirstHead","&key="_key_"&divId="_divId)
	;AppAct('"_divId_"MainForm','"_mhead_"','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"FirstHead:&divId="_divId_"&key="_key_"');"
	quit $$$appButton("appButtonExit","onclick="""_$g(onclick)_"""",$$$aText("Again",""))
]]></Implementation>
</Method>

<Method name="ShowTabAbout">
<Description>
the render Tab On the program"
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $g(key("appPar"))'="" set key=key("appPar")
	do ..GetAllApps(.opt) 
	if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
	set divId=$g(opt(key,"id"))
	write "Hello world! Parameter: "_key
	write ..ButtonAgain(divId,key)
]]></Implementation>
</Method>

<Method name="ShowInIFrame">
<Description>
rendering the Tab previously submitted
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(key("appPar"))'="" set key=key("appPar")
 do ..GetAllApps(.opt) 
 if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 set NSpace=$zu(5)
 set pref=$g(opt(key,"id"))
 set mhead=pref_"MainHeader"
 set mcont=pref_"MainContent"
 &html<
<form id="#(pref_"MainForm")#">
<div class="uk-grid">
    <iframe id="#(mcont)#" width="100%" height="100%" style='overflow: auto;' src='#($g(opt(key,"InFrameUrl")))#' ></iframe>
    </div>
</div>
</form>
>
 $$$jsstart
  ;	; to calculate the height of the container as a result of wijetunge victory container-Taba height of the container header
 	w "$('#"_mcont_"').height($(window).height()-($('#t1').height()+$('#MainNavbar').height()+150));"
  ;	w $$$blockui($$$aText("Loading...",""))
 $$$jsstop
 quit $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabSample">
<Description>
rendering the Tab previously submitted
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(key("appPar"))'="" set key=key("appPar")
 do ..GetAllApps(.opt) 
 if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 set NSpace=$zu(5)
 set pref=$g(opt(key,"id"))
 set mhead=pref_"MainHeader"
 set mcont=pref_"MainContent"
 &html<
<form id="#(pref_"MainForm")#">
<div class="uk-grid">
    <div class="uk-width-1-1 "id="#(mhead)#" ></div>
    <div style='overflow: auto;' class="uk-width-1-1 uk-margin-top uk-margin-left" id="#(mcont)#"></div>
</div>
</form>
>
 ;d ##class(apptools.core.LogInfoPane).AddJS(NSpace,..%ClassName(1))
 
 $$$jsstart
  	; to calculate the height of the container as a result of wijetunge victory container-Taba height of the container header
    w ##class(apptools.core.Action).WriteActJs(%request,pref_"MainForm",mhead,..%ClassName(1),pref_"FirstHead","&divId="_pref_"&key="_key)
	w "$('#"_mcont_"').height($(window).height()-($('#"_mhead_"').height()+$('#t1').height()+$('#MainNavbar').height()+300));"_$c(13,10)
  	w $$$blockui($$$aText("Loading...",""))
 $$$jsstop
 quit $$$OK
]]></Implementation>
</Method>

<Method name="FindFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","~key="_key_"~divId="_divId_"~mode=*")
	;ActionJs('"_divId_"MainForm','"_divId_"MainContent','','"_divId_"Result','key="_key_"~divId="_divId_"~mode=*');"
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
		Context name users
			</td>
			<td>
				#($$$appText(divId_"textName","title='context in Name'","s"))#
			</td>		
			<td>
				#($$$appText(divId_"textDesc","title='context in FullName'","m"))#
			</td>
			<td>
			</td>
			<td>
		
			</td>
			<td>

			</td>
		</tr>
		<tr>
			<td>
			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""","Find USERS"))#
			</td>
			<td>
			</td>
			<td>
			</td>
			<td>
			
			</td>
			<td>

			</td>
		</tr>
		</table>
	>
 $$$jsstart
 	//for all identifiers starting with "_divId_"text by pressing Enter, click on the button (ending with $("[id$='txtTitle']"))
 	w "$('[id^="""_divId_"text""]').keydown(function (e) { if (e.keyCode == 13) { $('#"_divId_"appButtonResult1').click(); }});"_$c(13,10)
 $$$jsstop
	
	quit $$$OK
]]></Implementation>
</Method>

<Method name="FindResult">
<Description>
Search result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	set Name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"textName")	
	set Desc=$g(Par("%request.Data",divId_"textDesc"))
	set st=$$$OK
	if mode=1 {
		write ..ButtonAgain(divId,key)
		if Name="" w $$$appError($$$aText("Context is empty","")) quit $$$OK
		zn "%sys"
		set sql="select ID,name,EmailAddress,fullName from Security.Users where Enabled [ '1' "
		if Name'="" s sql=sql_" and (name like '%"_Name_"%') "
		if Desc'="" s sql=sql_" and (fullName like '%"_Desc_"%') "
		set msg="Query: "_sql

		set exec="##class(apptools.core.LogInfo).MarkRed(%AppLogInfoVal,"""_Name_","_Desc_""")"
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,100000,$zu(5),msg,exec)
		if 'st  w $$$appError($System.Status.GetErrorText(st))
		quit $$$OK

	} 
	write "<br>"
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","~key="_key_"~divId="_divId_"~mode=*")
	Set path=$p($p($zu(86),"*",1),$$$slash,1,*-1)
	Set path1=path_$tr("\csp\broker\images\","\",$$$slash)
	Set path2=path_$tr("\docs\","\",$$$slash)
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
				#($$$appText(divId_"path1","size=50 title='path to images'",path1))#
			</td>
			<td>
				#($$$appText(divId_"path2","size=50 title='path to images docs'",path2))#
			</td>
		</tr>
		<tr>
			<td>
			#($$$appButton(divId_"appButtonResult1"," onclick="""_$tr(onclick,"*",1)_"""","Generate gallery via App /csp/broker"))#			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult2"," onclick="""_$tr(onclick,"*",2)_"""","Generate gallery dinamic rest"))#			
			</td>
		</tr>
		</table>
	>
 $$$jsstart
 	;for all identifiers starting with "_divId_"text by pressing Enter, click on the button (ending with $("[id$='txtTitle']"))
 	w "$('[id^="""_divId_"path""]').keydown(function (e) { if (e.keyCode == 13) { $('#"_divId_"appButtonResult2').click(); }});"_$c(13,10)
 $$$jsstop
	
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxResult">
<Description>
Its result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	s path1=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"path1")	
	set path2=$g(Par("%request.Data",divId_"path2"))
	set st=$$$OK
	s wc=##class(apptools.core.filesMimeTypes).GetTypesWildcards("image")_##class(apptools.core.filesMimeTypes).GetTypesWildcards("video")
	if mode=1 {
	 d ##class(apptools.core.files).GetList(path1,wc,.List)
	 s cspappstatic="/csp/broker/images/"
	 $$$jsstart
 		w "UIkit.lightboxPanel({"
   		w "items: [ "
		  d ..LighboxDrawJson(.List,cspappstatic)
  		w " ] }).show();"
	 $$$jsstop
	} 
	elseif mode=2 {
	 d ##class(apptools.core.files).GetList(path2,wc,.List)
	 s appdinamic=%request.Application_"get-files/"
	 $$$jsstart
 		w "UIkit.lightboxPanel({"
   		w "items: [ "
		  d ..LighboxDrawJson(.List,,appdinamic,..#GNStore)
  		w " ] }).show();"
	 $$$jsstop
	}
	write "<br>"
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxDrawJson">
<Description>
Lighbox Draw JSON
List - files array 
subdir - application static</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>List,subdir="",appdynamic,gn=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s i=""
 for { s i=$o(List(i)) q:i=""
 	if $lv($g(List(i))),$lg($g(List(i)),2)="F" {
		 	s fullpath=$lg($g(List(i)),1)
		 	s ItemName=$lg($g(List(i)),4)
 	} else {
 		s ItemName=$g(List(i,"ItemName"))
 		s fullpath=$g(List(i,"Name"))
 	}
 	set ext=$p(ItemName,".",*)
 	s mimetype=##class(apptools.core.filesMimeTypes).GetMimeTypes4ext(ext)
 	s type=$s(mimetype[("video"):"video",(mimetype)[("image"):"image",1:"iframe")
 	if subdir'="" {
 		w "{source: '"_subdir_ItemName_"', caption: '"_ItemName_"', type: '"_type_"'}",$c(13,10)
 	} else {
	 	set fileId=##class(apptools.core.files).GetFileIdView(fullpath,gn) 
		w "{source: '"_appdynamic_fileId_"', caption: '"_ItemName_"', type: '"_type_"'}",$c(13,10)
 	}
	w:$o(List(i))'="" ","
 }
]]></Implementation>
</Method>

<Method name="EnCode">
<Description>
Encode string to URL</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>s</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s s=$zconvert(s,"O","URL")
	q s
]]></Implementation>
</Method>

<Method name="DeCode">
<Description>
Decode string from URL</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>s</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	q $zconvert(s,"I","URL")
]]></Implementation>
</Method>

<Method name="DrawTableUi">
<Description>
Draw Tables UiKit</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[mode="beg",divId="tab2",attr="",&Enum]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if mode="beg" {
	&html<
 <div #(attr)# id="#(divId)#" >
    <table class="uk-table uk-table-hover uk-table-middle uk-table-divider">
        <thead>
           <tr>
          >
          s i=""  for {  s i=$o(Enum(i)) q:i=""
            write " <th "_$GET(Enum(i,"attr"))_" >"_$g(Enum(i))_"</th>"
          }
               /* <th class="uk-table-shrink">Preserve</th>
                <th class="uk-table-expand">Expand + Link</th>
                <th class="uk-width-small">Truncate</th>
                <th class="uk-table-shrink uk-text-nowrap">Shrink + Nowrap</th> */
    &html<
            </tr>
        </thead>
        <tbody>
        >
	}
    elseif mode="tr" {
			w "<tr>"
            s i=""  for {  s i=$o(Enum(i)) q:i=""
				w "<td "_$GET(Enum(i,"attr"))_">"_$GET(Enum(i))_"</td>"
               
               /* <td><input class="uk-checkbox" type="checkbox"></td>
               <td><img class="uk-preserve-width uk-border-circle" src="image/msw.jpg" width="40" alt=""></td>
                <td class="uk-table-link">
                    <a class="uk-link-reset" href="">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</a>
                </td>
                <td class="uk-text-truncate">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</td>
                <td class="uk-text-nowrap">Lorem ipsum dolor</td>*/
            } 			
            w "</tr>"
	}
	elseif mode="end" {
		&html<
		   </tbody>
 	 	 </table>
 		</div>
    	>
	} else {
	}
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Uikit.AdminLTE">
<Description>
https://adminlte.io</Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65800,75748.951032</TimeChanged>
<TimeCreated>64127,58953.319558</TimeCreated>

<Method name="GetMain">
<Description>
http://localhost:52773/apptoolsrest/ga/admin
http://localhost:52773/apptoolsrest/ga/infochest
http://localhost:52773/apptoolsrest/ga/smarthome</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>app</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set h=##class(apptools.core.rest).getStatic("apptools.Uikit.AdminLTE:html")
	set h=$replace(h,"=path=","/csp/apptools/adminlte/")
	if app="infochest" {
		set h=$replace(h,"=Brand-Text=","Info Chest")
		set h=$replace(h,"=Logo-png=","ApptoolsLogo.png")
		
	}
	if app="smarthome" {
		set h=$replace(h,"=Brand-Text=","IRIS, Sweet Home")
		set h=$replace(h,"=Logo-png=","ApptoolsLogo.png")
	}
	if app="admin" {
		set h=$replace(h,"=Brand-Text=","AppTools-admin")
		set h=$replace(h,"=Logo-png=","ApptoolsLogo.png")
		
	}
	else {
		set h=$replace(h,"=Brand-Text=","AppTools-admin")
		set h=$replace(h,"=Logo-png=","ApptoolsLogo.png")
	}
	d ##class(apptools.core.rest).WriteStatic("html",,,,,h)
	q $$$OK
]]></Implementation>
</Method>

<XData name="html">
<Description>
s h=##class(apptools.core.rest).getStatic("apptools.Uikit.AdminLTE:html") w !,h,!</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>=titleAppToolsadmin=</title>

  <!-- Google Font: Source Sans Pro -->
  <!--<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">-->
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="=path=plugins/fontawesome-free/css/all.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="=path=plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="=path=dist/css/adminlte.min.css">
</head>
<body class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
<div class="wrapper">

  <!-- Preloader -->
  <div class="preloader flex-column justify-content-center align-items-center">
    <img class="animation__wobble" src="=path=dist/img/ApptoolsLogo.png" alt="ApptoolLogo" height="60" width="60">
  </div>

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-dark">
    <!-- Left navbar links -->
	
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="index3.html" class="nav-link">Home</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="#" class="nav-link">Contact</a>
      </li>
    </ul>

    <!-- Right navbar links -->
	<ul class="navbar-nav ml-auto">
      <!-- Navbar Search -->
	  <!--
      <li class="nav-item">
        <a class="nav-link" data-widget="navbar-search" href="#" role="button">
          <i class="fas fa-search"></i>
        </a>
        <div class="navbar-search-block">
          <form class="form-inline">
            <div class="input-group input-group-sm">
              <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
              <div class="input-group-append">
                <button class="btn btn-navbar" type="submit">
                  <i class="fas fa-search"></i>
                </button>
                <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </form>
        </div>
      </li>
	  -->
      <!-- Notifications Dropdown Menu -->
      <li class="nav-item dropdown">
        <a class="nav-link" data-toggle="dropdown" href="#">
          =Account=
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
  
            <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <i class="fas fa-users mr-2"></i> 121212
            <span class="float-right text-muted text-sm">444412</span>
          </a>
  
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-widget="fullscreen" href="#" role="button">
          <i class="fas fa-expand-arrows-alt"></i>
        </a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="index3.html" class="brand-link">
      <img src="=path=dist/img/=Logo-png=" alt="ApptoolsLogo" class="brand-image img-circle elevation-3" style="opacity: .8">
      <span class="brand-text font-weight-light">=Brand-Text=</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      
	  <!-- Sidebar user panel (optional) -->
	  <!--
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <img src="dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
        </div>
        <div class="info">
          <a href="#" class="d-block">Alexander Pierce</a>
        </div>
      </div>
		-->

      <!-- SidebarSearch Form -->
	  <div class="form-inline">
        <div class="input-group" data-widget="sidebar-search">
          <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
          <div class="input-group-append">
            <button class="btn btn-sidebar">
              <i class="fas fa-search fa-fw"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                Dashboard
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="./index2.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Dashboard v1</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="./index2.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Dashboard v2</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="./index2.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Dashboard v3</p>
                </a>
              </li>
            </ul>
          </li>
		  <!--
          <li class="nav-item">
            <a href="pages/widgets.html" class="nav-link">
              <i class="nav-icon fas fa-th"></i>
              <p>
                Widgets
                <span class="right badge badge-danger">New</span>
              </p>
            </a>
          </li>
		  -->
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-copy"></i>
              <p>
                Layout Options
                <i class="fas fa-angle-left right"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="pages/layout/top-nav.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Top Navigation</p>
                </a>
              </li>
            </ul>
          </li>
		  
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-chart-pie"></i>
              <p>
                Charts
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="pages/charts/chartjs.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>ChartJS</p>
                </a>
              </li>
            </ul>
			</li>
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <!-- Info boxes -->
        <div class="row">
		1111
		<p>22222222222
        </div>
        <!-- /.row -->

		</div><!--/. container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <strong>Applications Tools for Admin.</strong>
   
    <div class="float-right d-none d-sm-inline-block">
      <b>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a> All rights reserved. Version</b> 3.1.0-rc
    </div>
  </footer>
</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->
<!-- jQuery -->
<script src="=path=plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="=path=plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- overlayScrollbars -->
<script src="=path=plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
<!-- AdminLTE App -->
<script src="=path=dist/js/adminlte.js"></script>

<!-- PAGE PLUGINS -->
<!-- jQuery Mapael -->
<script src="=path=plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
<script src="=path=plugins/raphael/raphael.min.js"></script>
<script src="=path=plugins/jquery-mapael/jquery.mapael.min.js"></script>
<script src="=path=plugins/jquery-mapael/maps/usa_states.min.js"></script>
<!-- ChartJS -->
<script src="=path=plugins/chart.js/Chart.min.js"></script>

<!-- AdminLTE for demo purposes -->
<!--<script src="dist/js/demo.js"></script>-->
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<!--<script src="dist/js/pages/dashboard2.js"></script>-->
</body>
</html>
]]></Data>
</XData>
</Class>


<Class name="apptools.Uikit.AdminLTEtabs">
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>apptools.Uikit.AdminPanel</Super>
<TimeChanged>65800,39005.629725</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>

<Parameter name="HeaderText">
<Description>
Application title</Description>
<Default>Permissions</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files</Description>
<Default>^apptools.Permissions</Default>
</Parameter>

<Parameter name="AppRoles">
<Default>ui_Permissions</Default>
</Parameter>

<Method name="GetAllApps">
<Description>
what modes are available</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if ..IsPermiss("%All") {	
	s LeftMenuName="Permission",LeftMenuNumer=1
	s key="MenuMatrix"
	s opt(key)=$$$aText("The matrix","") ;The name of the menu
	s opt(key,"id")="Matrix"
	s opt(key,"TabName")=$$$aText("The matrix","") ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"TabMenu","Close")=1
	s opt(key,"Menu")=$lb(LeftMenuNumer,LeftMenuName,1) ;$lg(,3)=1 - level 1 open menu
	s opt(key,"Active")=1 ;active menu item

	s LeftMenuName="Account",LeftMenuNumer=99
	
	s key="menu-top-account3"
		s opt(key)="Exit"
		s opt(key,"id")="AccountExit"
		s opt(key,"TabName")="Logoit" 
		s opt(key,"ClassName")=..%ClassName(1)
		s opt(key,"Method")="Logout"
		s opt(key,"MenuTop")=$lb(LeftMenuNumer,LeftMenuName) ; 99-account has nested items
		
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="MatrixFirstHead">
<Description>
download form template search users and roles</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	s key=Par("key")
	s divId=Par("divId")
	s %ui=1
	;set onclick=$$$blockui($$$aText("Loading...",""))_";AppAct('"_divId_"MainForm','"_divId_"MainContent','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"Result:&key="_key_"&divId="_divId_"&mode=*');"
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	;ActionJs('"_divId_"MainForm','"_divId_"MainContent','','"_divId_"Result','key="_key_"~divId="_divId_"~mode=*');"

	&html<
		<table>
		<tr>
			<td>
 	Login <br>#($$$appText(divId_"name","title='"_$$$aText("Names separated by a comma or by context","")_"'","s"))#
			</td>
			<td>
	Roles <br>#($$$appText(divId_"roles","title='"_$$$aText("Roles separated by a comma or by context","")_"'","d"))#
			</td>
			<td> <br>
	#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""",""_$$$aText("User roles","")))#
			</td>
		</tr>
		</table>
	>
	q $$$OK
]]></Implementation>
</Method>

<Method name="MatrixResult">
<Description>
Search result </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s %ui=1
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")

	;Geting elements from form and prepare array Par
	s name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"name")	
	set roles=$g(Par("%request.Data",divId_"roles"))


	write ..ButtonAgain(divId,key)
	d ##class(apptools.Tabs.security).UiMatrixPermission(name,roles,divId,key,"apptools.Tabs.security","UiSavePermiss")
	q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Uikit.AdminPanel">
<Description>
The template GUI of the application selector and tabs on the basis jQueryUi, Uikit</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeChanged>65819,34824.890416</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
The application title</Description>
<Default>AdminTabsApplication</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files and id sessions</Description>
<Default>^%apptools.ui</Default>
</Parameter>

<Parameter name="PreLoad">
<Description>
For Redirect </Description>
</Parameter>

<Method name="IsPermiss">
<Description>
is there a right to work with this form</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>role</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	q $roles[role||($roles["%All")
]]></Implementation>
</Method>

<Method name="GetAppIcon">
<Description>
Icons for the application</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>path</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  	q "<link rel=""icon"" type=""image/x-icon"" href="""_##class(apptools.core.rest).getStatic("apptools.Tabs.PanelUikit:IconTools")_"""/>"
 	;q "<link rel=""icon"" href="""_path_"favicon.ico"" type=""image/x-icon""/><link rel=""shortcut icon"" href="""_path_"favicon.ico"" type=""image/x-icon""/>"
 	;q "<link rel=""icon"" type=""image/x-icon"" href=""data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AJCQk/yQkJP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/0ZGRv8XFxf/////AP///wD///8A////AP///////////////+7u7v9OTk7/sbGx/11dXf9KSkr///////////+lpaX/4eHh/////wD///8A////AAAAAP8AAAD///////////+8vLz///////X19f/t7e3/gICA/5eXl////////////wAAAP8AAAD/////AKysrP8AAAD/AAAA/wAAAP+enp7/////////////////////////////////5OTk/wAAAP8AAAD/AAAA/6ysrP////8A////AP///wCurq6PlJSUzP///wD///8A////AP///wD///8A////AJSUlMyQkJDY////AP///wD///8A////AP///wD///8AAAAA/wAAAP////8A////AP///wD///8A////AP///wAAAAD/AAAA/////wD///8A////AP///wD///8AAAAA/wAAAP8AAAD/////AP///wD///8A////AP///wD///8AAAAA/wAAAP8AAAD/////AP///wD///8ACwsL/wAAAP8AAAD/lJSU2AAAAP8AAAD/cnJy/1hYWP8AAAD/AAAA/2FhYdgHBwf/AAAA/wAAAP////8A////AP///wD///8A////AP///wAAAAD/s7Oz/wAAAP8AAAD/x8fH/wAAAP////8A////AP///wD///8A////AP///wD///8A////AP///wAAAAD/AAAA/////wAAAAD/AAAA/////wAAAAD/AAAA/////wD///8A////AP///wD///8A////AP///wD///8AAAAA/wAAAP+qqqqlAAAA/wAAAP9lZWXjAAAA/wAAAP////8A////AP///wD///8A////AP///wD///8A////ALa2tv////8A9vb2UQAAAP8AAAD/////Uf///wDAwMD/////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wBcXFz/AAAA/////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AADAAwAAwAMAAIABAAAAAAAA5+cAAOfnAADH4wAAgAEAAPgfAADyTwAA8A8AAPZvAAD+fwAA//8AAA==""/>"
]]></Implementation>
</Method>

<Method name="PreLoad">
<ClassMethod>1</ClassMethod>
<FormalSpec>path</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[ q $$$OK
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Main method generate the content of page
TODO #2c3136 - 6699CC , 33383e - #6FA6DE , ffffff - #0048BA
#3e454c - 2185D0 , 1c1f22 - 0FC0FC , 656a70 - </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>parameter=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
 set NSpace=##class(apptools.core.Action).GetParam(.%request,"ns",parameter)
 s:$g(NSpace)="" NSpace=$zu(5)
 zn NSpace
 // Save the session parameters debugging mode (implies extended disclosure)
 ;s %session.Data("debug")=%request.Get("debug")
 
 // http://cip.mvk.ru/csp/spgz/apptools.MVK.gisui.cls?ns=MVK&autoload=Find# - Find the first startup
 // http://localhost:57773/apptoolsrest/get-html/apptools.Tabs.PanelUikitAdmin?ns=APP&autoload=Find
 ;if $d(%request) {  set autoloadmenu=$p(%request.Get("autoload"),"#")
 set autoload=##class(apptools.core.Action).GetParam(.%request,"autoload",parameter)
 
 ;do ##class(apptools.core.Log).AddRecord(..%ClassName(1), "OnPage", "Login", "INFO", "","")
 &html<
 <!doctype html>
 <html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>#(..#HeaderText)#</title>
>
 if ..#PreLoad'="" {
	 d ..PreLoad(.%request)
  &html<
	</html>
	>
	q $$$OK
 }
 	write ##class(apptools.core.LogInfoPane).GetLink()
 	write ##class(apptools.core.LogInfoPane).AddJsScripts() 
   	   do ##class(apptools.core.LogInfoPane).AddJS(NSpace,..%ClassName(1))
   	   do ##class(apptools.core.LogInfoPane).AddStyle()
 	set menu=..DrawMenu() ;sidebar
	set menuTop=..DrawMenuTop() ;top think
	set path=$$$PATHCSP
	write ..GetAppIcon(path)

 &html<
	
<link rel="stylesheet" href="#(path)#apptools-uikit-dark-admin/css/nav.css"> <!-- CSS reset -->
	
</head>
<body>
	<header class="cd-main-header"  style='position: fixed; top: 0px; width: 1903px;'>
		<a href="#" class="cd-logo">
			<font color=#E4F2FB>#(..#HeaderText)#</font>
		</a>
		
		<div class="cd-search is-hidden">
			<input type="search" placeholder="search.." id="searchstr" name="searchstr">
		</div> <!-- cd-search -->

		<a href="#" class="cd-nav-trigger"><span></span></a>

		<nav class="cd-nav">
			<ul class="cd-top-nav">
				#(menuTop)#
			</ul>
		</nav>
	</header> <!-- .cd-main-header -->

	<main class="cd-main-content">
		<nav class="cd-side-nav">
			
			<ul class="uk-nav uk-nav-default">
				<li class="cd-label">...</li>
					#(menu)#
			</ul>

		</nav>

		<div id=MainBody class="content-wrapper">
        <!-- Page Content -->
		<br />
			
<div class="uk-grid">
    <div class="uk-width-1-1 uk-margin-left uk-margin-right " style='overflow: auto;' id="mainApp" >
		<ul id='tabMenu' class="uk-tab uk-tab-grid uk-tab-top" data-uk-tab="{connect:'#tabList', animation: 'fade'}">
			<li id='t1' class="uk-active"><a href="#">About</a></li>
		</ul>
		<ul id="tabList" class="uk-switcher uk-margin uk-tab-content">
			<li id='ta1' >
			 <div class="uk-alert-success" uk-alert>
				<p title='#($username)#'> #($$$aText("If you are not available to any single menu item",""))#</p>
			 </div>
			</li>
		</ul>
	</div>
</div>
        <!-- /#page-content-wrapper -->
		</div> <!-- .content-wrapper -->
	</main> <!-- .cd-main-content -->

<script src="#(path)#apptools-uikit-dark-admin/js/main.js"></script> <!-- Resource jQuery -->

 <script language="javascript">

(function($) {
    var $window = $(window),
        $html = $('#wrapper');

    function resize() {
        if ($window.width() < 768) {
            return $html.removeClass('toggled');
        }
		
        $html.addClass('toggled');
    }

    $window
        .resize(resize)
        .trigger('resize');
})(jQuery);

</script>
<div id='MainHidden' style='display:none;'></div>
<div id="dialog" title="Dialog Title">
	<div id=dialogContent></div>
</div>
>
 $$$jsstart
 	;w "$('#account_status').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=DrawStatus&appNsp="_NSpace_"&appPar=');"_$c(13,10)
 	;w "$('#searchstr').keydown(function (e) { if (e.keyCode == 13) { $('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar=Search&Searchstr='+document.getElementById('searchstr').value); }});"_$c(13,10)
 	write ##class(apptools.core.Action).WriteActJs(%request,"","account_status",..%ClassName(1),"DrawStatus","")_$c(13,10)
 	set enter=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar=Search&Searchstr='+document.getElementById('searchstr').value")_$c(13,10)
 	write "$('#searchstr').keydown(function (e) { if (e.keyCode == 13) { "_enter_" }});"_$c(13,10)
  	if autoload="" {
	 	do ..GetAllApps(.opt) 
	 	set i="" 
	 	for { set i=$o(opt(i)) q:i=""
	 		if $GET(opt(i,"Active")) write "$('#Menu"_opt(i,"id")_"').trigger('click');"_$c(13,10)
	 	}
 	} else {
	 	write "$('#Menu"_autoload_"').trigger('click');"_$c(13,10)
 	}
 $$$jsstop
 
 &html<
</body>
</html>
	>
 quit $$$OK
]]></Implementation>
</Method>

<Method name="DrawMenuTop">
<Description>
the rendering top menu </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	do ..GetAllApps(.opt) 
	do ..GetAllMenu(.opt,.menu,1)
	set m="",ret=""
	for { set m=$o(menu(m)) quit:m=""
		s i=""
		if m=99 { ;account - with submenu
			s ret=ret_"<li class='has-children account'><a href='#'><span id='account_status'>"_$lg(menu(m),2)_"</span></a><ul>"
			for { set i=$o(menu(m,i)) quit:i=""
		   		;set onclick="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar="_i_"');"
				set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar="_i)
				set ret=ret_"<li><a id='Menu"_$g(opt(i,"id"))_"' href='#' onclick="""_onclick_""">"_$g(opt(i))_"</a></li>"
			}
			s ret=ret_"</ul></li>"
		}
		else {
			for { set i=$o(menu(m,i)) quit:i=""
		   		;set onclick="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar="_i_"');"
		   		set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar="_i)
				set ret=ret_"<li><a id='Menu"_$g(opt(i,"id"))_"' href='#' onclick="""_onclick_""">"_$g(opt(i))_"</a></li>"
			}
		}
	}
  quit ret
]]></Implementation>
</Method>

<Method name="DrawMenu">
<Description>
render side menu </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	do ..GetAllApps(.opt) 
	do ..GetAllMenu(.opt,.menu)
	set m="",ret=""
	for { set m=$o(menu(m)) quit:m=""
		s i=""
		s active=$s($lg(menu(m),3):"active",1:"")
		s ret=ret_"<li class='has-children overview "_active_"'><a href='#'>"_$lg(menu(m),2)_"</a><ul>"
		for { set i=$o(menu(m,i)) quit:i=""
	   		;set onclick="$('#MainHidden').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTab&appNsp="_$zu(5)_"&appPar="_i_"');"
	   		set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar="_i)
			set ret=ret_"<li><a id='Menu"_$g(opt(i,"id"))_"' href='#' onclick="""_onclick_""">"_$g(opt(i))_"</a></li>"
		}
		s ret=ret_"</ul></li>"
	}
  quit ret
]]></Implementation>
</Method>

<Method name="GetSupportInfo">
<Description>
To obtain information on the support</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s msg=$$$aText("Software complex to debug. Try to log in later, or contact tech support:","")
	q msg_"Support info mailto: sergey.mikhaylenko@gmail.com"
]]></Implementation>
</Method>

<Method name="IsDebugMode">
<Description>
To add to the form js code if development mode</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>mode=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 i mode,'%request.Get("debug") { 
	$$$jsstart
	  w $$$blockui(..GetSupportInfo())
	$$$jsstop
  q $$$OK
 }
	q 0
]]></Implementation>
</Method>

<Method name="DrawStatus">
<Description>
rendering status of the user</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;do ##class(apptools.core.Form).BlockUI(0)
	s fio=##class(apptools.core.sys).GetFullName($username)
	s:fio="" fio=$$$aText("The user","")
	;w $s(%request.Get("debug"):"<font color=red><b>"_$$$aText("Administrator mode","")_"</b></font>",1:"")_" <span class='tip' title='"_$username_"-"_$j_"-"_$zu(5)_"'>"_$$$aText("User","")_": "_fio_"</span>, "_$tr(##class(apptools.core.type).GetDateTime($h),"T"," ")
	write "<span class='tip' title='"_fio_"-"_$j_"-"_$zu(5)_"'>"_$username_"</span>"
 	;$$$jsstart
	;	w "$('.tip').tooltip();"
	;$$$jsstop
 q $$$OK
]]></Implementation>
</Method>

<Method name="GetAllMenu">
<Description>
To menu</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt,menu,top=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s i="" for { s i=$o(opt(i)) q:i=""
	if 'top,$d(opt(i,"Menu")) { 
		s m=$lg(opt(i,"Menu"),1)
		s:'$d(menu(m)) menu(m)=opt(i,"Menu")
		s menu(m,i)=""
	}
	if top,$d(opt(i,"MenuTop")) { 
		s m=$lg(opt(i,"MenuTop"),1)
		s:'$d(menu(m)) menu(m)=opt(i,"MenuTop")
		s menu(m,i)=""
	} else {
		;s:'$d(menu(99)) menu(99)=$lb(0,"---",0)
		;s menu(99,i)=""
	}
  }
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what are the available modes</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;make them zavisimye from the area
	;------------ sidebar
	s key="menu-first"
	s opt(key)="Find users" ;The name of the menu
	s opt(key,"id")="Find" ;use methods: FindFirstHead FindResult
	s opt(key,"TabName")="finding users" ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"TabMenu","Close")=1
	s opt(key,"Menu")=$lb(1,"Mode",1) ;$lg(,3)=1 - open menu level 1
	s opt(key,"Active")=1 ;active menu item

	s key="menu-first2"
	s opt(key)="Sample gallery" ;The name of the menu
	s opt(key,"id")="Lighbox" ;use methods: LighboxFirstHead LighboxResult
	s opt(key,"TabName")="Gallery" ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"TabMenu","Close")=1
	s opt(key,"Menu")=$lb(1,"Mode",1) ;$lg(,3)=1 - open menu level 1
	
	s key="menu-second"
	s opt(key)="Help"
	s opt(key,"id")="Help"
	s opt(key,"TabName")="Help"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"MethodUrl")="http://ShowTabAbout.cls"
	s opt(key,"Disable")=1 ;developed
	s opt(key,"Menu")=$lb(2,"About the program",0)

	s key="menu-second2"
	s opt(key)="Menu 3"
	s opt(key,"id")="About"
	s opt(key,"TabName")="Menu 3"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"Disable")=1 ;developed
	s opt(key,"Menu")=$lb(2,"About the program")

	s key="menu-second3"
	s opt(key)="Support"
	s opt(key,"id")="Support"
	s opt(key,"TabName")="Support"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"MethodUrlNewWin")="http://ShowTabAbout.cls"
	s opt(key,"Disable")=1 ;developed
	s opt(key,"Menu")=$lb(2,"About the program")
	
	;------------ one-level upper menu 
	s key="menu-topLern"
	s opt(key)="Menu 2"
	s opt(key,"id")="Menu2"
	s opt(key,"TabName")="Menu 2"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"MenuTop")=$lb(1,"Menu 2") ;has no sub-items

	s key="menu-topOpt"
	s opt(key)="Option"
	s opt(key,"id")="Option"
	s opt(key,"TabName")="Option"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"MenuTop")=$lb(2,"Option") ;has no sub-items

	;------------ top menu the top-accoun
	s key="menu-top-accoun"
	s opt(key)=$$$aText("Profile","")
	s opt(key,"id")="AccountProf"
	s opt(key,"TabName")=$$$aText("Profile","")
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"MenuTop")=$lb(99,"Account") ;only 99-account has sub-items

	s key="menu-top-account3"
	s opt(key)=$$$aText("Exit","")
	s opt(key,"id")="AccountExit"
	s opt(key,"TabName")=$$$aText("Exit","")
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="Logout"
	s opt(key,"MenuTop")=$lb(99,"Account") ;only 99-account has sub-items
	
	;----- Setup the search in the top menu
	s key="Search"
	s opt(key)=$$$aText("Search","")
	s opt(key,"id")="Search-"
	s opt(key,"TabName")=$$$aText("Search","")_"-"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSearch"
	s opt(key,"TabMenu","Close")=1
	s opt(key,"TabMenu","Mode")=0 ;1 - for each new search bar to make new tab, 0-tab is always the same
	
	q $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabSearch">
<Description>
drawing Tabs search
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 ;do ..GetAllApps(.opt) 
 ;if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 ;set NSpace=$zu(5)
 w $$$aText("Context","")_" :"_$g(key)
 ;set pref=$g(opt(key,"id"))
]]></Implementation>
</Method>

<Method name="ShowTab">
<Description>
the render Tab on the menu
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $g(Par("appPar"))'="" set Par=Par("appPar")
	do ..GetAllApps(.opt) 
	d ..ShowTabApps(.Par,.opt)
]]></Implementation>
</Method>

<Method name="ShowTabApps">
<Description>
the render Tab on the menu
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par,opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if Par="Search" {
		s Searchstr=$g(Par("%request.Data","Searchstr"),Par("Searchstr"))
		if Searchstr="" q $$$OK
		;s tr=$tr(##class(apptools.MSW.type).Transliteration(Searchstr)," `()\/*;'"":%","_N---")
		;s tr=$tr($zts,".,") 
		s tr=$e($tr(Searchstr," `()\/*;'"":%?$@&.,",""),1,10)_$i(@..#GNStore@("jobs",$j))
		s key=tr ;Searchstr
		MERGE opt(key)=opt(Par)
		s opt(key)=opt(key)_tr ;Searchstr
		i $g(opt(Par,"TabMenu","Mode"))=1 { ;mode add a new tab 
			s opt(key,"id")=opt(key,"id")_tr
		} else { ;mode add a new replace the old 
			set tabId="tab-"_opt(Par,"id")
			set tabIdMenu="tabMenu-"_opt(Par,"id")
			$$$jsstart
		  	 w "$('#"_tabId_"').remove();"
		  	 w "$('#"_tabIdMenu_"').remove();"
		  	$$$jsstop
		}
		s opt(key,"CGIvar")="&Searchstr="_Searchstr ;$zconvert(Searchstr,"O","URI")
		s opt(key,"TabName")=opt(key,"TabName")_tr 
		s Par=key

	}
	set tabId="tab-"_opt(Par,"id")
	set tabIdMenu="tabMenu-"_opt(Par,"id")
	if $g(opt(Par,"TabMenu","Close"))'="" s IconMenu="<span class=""uk-margin-small-left uk-icon uk-close"" uk-icon=""close"" onclick=""$(\'#"_tabIdMenu_",#"_tabId_"\').remove();""></span>"
 	if $DATA(opt(Par,"TabMenu","Close"))>9 { //there are more points
 		;TODO
 	}
 	$$$jsstart
 	 if $g(opt(Par,"MethodUrlNewWin"))'="" {
	 	 if $g(opt(Par,"Disable")) { w "alert('"_$$$aText("Mode debugging","")_"');"}
	 	 else {write "window.open('"_$g(opt(Par,"MethodUrlNewWin"))_"','_blank');"
	 	 }
 	}
	else {
 	 write "if (!$('li').is('#"_tabId_"')) { $('.uk-active').removeClass('uk-active');"_$c(13,10)
 		write " $('#tabList').append('<li id="_tabId_"></li>');"_$c(13,10)
 		write " $('#tabMenu').append('<li id="_tabIdMenu_"><a>"_$g(opt(Par,"TabName"))_$g(IconMenu)_"</a></li>');"_$c(13,10)
 		write " $('#t1,#ta1').hide();"_$c(13,10) //" $('#t1').prop('disabled',true);"
 		if $g(opt(Par,"Disable")) {
	 		;write "$('#"_tabId_"').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTabAbout&appNsp="_$zu(5)_"&appPar="_Par_"');"
	 		write ##class(apptools.core.Action).WriteActJs(%request,"",tabId,..%ClassName(1),"ShowTabAbout","&appPar="_Par_$g(opt(Par,"CGIvar")))
 		}
 		elseif $g(opt(Par,"MethodUrl"))'="" {
	 		write "$('#"_tabId_"').load('"_$g(opt(Par,"MethodUrl"))_"');"
 		}
 		else {
	 		;write "$('#"_tabId_"').load('apptools.core.Action.cls','appClass="_$g(opt(Par,"ClassName"))_"&appMethod="_$g(opt(Par,"Method"))_"&appNsp="_$zu(5)_"&appPar="_Par_"');"
	 		write ##class(apptools.core.Action).WriteActJs(%request,"",tabId,$g(opt(Par,"ClassName")),$g(opt(Par,"Method")),"&appPar="_Par_$g(opt(Par,"CGIvar")))
 		}
 	 write "};"
 	 write " UIkit.tab('#tabMenu').show($('#"_tabIdMenu_"'));"
	}
	$$$jsstop
]]></Implementation>
</Method>

<Method name="Logout">
<Description>
Return in a single string</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(Par("appPar"))'="" set Par=Par("appPar")
 do ##class(apptools.core.sys).logout()
 set onclick = "top.document.location.reload();"
 do ..GetAllApps(.opt) 
 $$$jsstart
 set i=""
 for { set i=$o(opt(i)) q:i=""
 	continue:i=Par
 	set tabId="tab-"_opt(i,"id")
	set tabIdMenu="tabMenu-"_opt(i,"id")
 	write "$('#"_tabIdMenu_",#"_tabId_"').remove();"
 }
 $$$jsstop
 &html<
 <br>
 <div class="uk-align-center uk-width-1-1 uk-margin-left uk-margin-right " style='overflow: auto;'>
	<div class="uk-alert-warning" uk-alert>
		<p>#($$$aText("The output of Sistema produced",""))#</p>
	</div>
	<center><button class="uk-button uk-button-default uk-margin-small-right" type="button" onclick="#(onclick)#" ><span class="uk-margin-small-left uk-icon" uk-icon="sign-in"></span>#($$$aText("Log in",""))#</button>
	</center>
</div><br><br>
>
 	quit $$$OK
]]></Implementation>
</Method>

<Method name="ButtonAgain">
<Description>
The output of the First button</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>divId="",key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set mhead=divId_"MainHeader"
	set mcont=divId_"MainContent"
	set onclick="$('#"_mcont_"').empty();"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",mhead,..%ClassName(1),divId_"FirstHead","&key="_key_"&divId="_divId)
	;AppAct('"_divId_"MainForm','"_mhead_"','AppAct="_$zu(5)_":"_..%ClassName(1)_":"_divId_"FirstHead:&divId="_divId_"&key="_key_"');"
	quit $$$appButton("appButtonExit","onclick="""_$g(onclick)_"""",$$$aText("Again",""))
]]></Implementation>
</Method>

<Method name="ShowTabAbout">
<Description>
the render Tab On the program"
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $g(key("appPar"))'="" set key=key("appPar")
	do ..GetAllApps(.opt) 
	if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
	set divId=$g(opt(key,"id"))
	write "Hello world! Parameter: "_key
	write ..ButtonAgain(divId,key)
]]></Implementation>
</Method>

<Method name="ShowInIFrame">
<Description>
rendering the Tab previously submitted
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(key("appPar"))'="" set key=key("appPar")
 do ..GetAllApps(.opt) 
 if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 set NSpace=$zu(5)
 set pref=$g(opt(key,"id"))
 set mhead=pref_"MainHeader"
 set mcont=pref_"MainContent"
 &html<
<form id="#(pref_"MainForm")#">
<div class="uk-grid">
    <iframe id="#(mcont)#" width="100%" height="100%" style='overflow: auto;' src='#($g(opt(key,"InFrameUrl")))#' ></iframe>
    </div>
</div>
</form>
>
 $$$jsstart
  ;	; to calculate the height of the container as a result of wijetunge victory container-Taba height of the container header
 	w "$('#"_mcont_"').height($(window).height()-($('#t1').height()+$('#MainNavbar').height()+150));"
  ;	w $$$blockui($$$aText("Loading...",""))
 $$$jsstop
 quit $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabSample">
<Description>
rendering the Tab previously submitted
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(key("appPar"))'="" set key=key("appPar")
 do ..GetAllApps(.opt) 
 if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 set NSpace=$zu(5)
 set pref=$g(opt(key,"id"))
 set mhead=pref_"MainHeader"
 set mcont=pref_"MainContent"
 &html<
<form id="#(pref_"MainForm")#">
<div class="uk-grid">
    <div class="uk-width-1-1 "id="#(mhead)#" ></div>
    <div style='overflow: auto;' class="uk-width-1-1 uk-margin-top uk-margin-left" id="#(mcont)#"></div>
</div>
</form>
>
 ;d ##class(apptools.core.LogInfoPane).AddJS(NSpace,..%ClassName(1))
 
 $$$jsstart
  	; to calculate the height of the container as a result of wijetunge victory container-Taba height of the container header
    w ##class(apptools.core.Action).WriteActJs(%request,pref_"MainForm",mhead,..%ClassName(1),pref_"FirstHead","&divId="_pref_"&key="_key)
	w "$('#"_mcont_"').height($(window).height()-($('#"_mhead_"').height()+$('#t1').height()+$('#MainNavbar').height()+300));"_$c(13,10)
  	w $$$blockui($$$aText("Loading...",""))
 $$$jsstop
 quit $$$OK
]]></Implementation>
</Method>

<Method name="FindFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","~key="_key_"~divId="_divId_"~mode=*")
	;ActionJs('"_divId_"MainForm','"_divId_"MainContent','','"_divId_"Result','key="_key_"~divId="_divId_"~mode=*');"
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
		Context name users
			</td>
			<td>
				#($$$appText(divId_"textName","title='context in Name'","s"))#
			</td>		
			<td>
				#($$$appText(divId_"textDesc","title='context in FullName'","m"))#
			</td>
			<td>
			</td>
			<td>
		
			</td>
			<td>

			</td>
		</tr>
		<tr>
			<td>
			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""","Find USERS"))#
			</td>
			<td>
			</td>
			<td>
			</td>
			<td>
			
			</td>
			<td>

			</td>
		</tr>
		</table>
	>
 $$$jsstart
 	//for all identifiers starting with "_divId_"text by pressing Enter, click on the button (ending with $("[id$='txtTitle']"))
 	w "$('[id^="""_divId_"text""]').keydown(function (e) { if (e.keyCode == 13) { $('#"_divId_"appButtonResult1').click(); }});"_$c(13,10)
 $$$jsstop
	
	quit $$$OK
]]></Implementation>
</Method>

<Method name="FindResult">
<Description>
Search result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	set Name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"textName")	
	set Desc=$g(Par("%request.Data",divId_"textDesc"))
	set st=$$$OK
	if mode=1 {
		write ..ButtonAgain(divId,key)
		if Name="" w $$$appError($$$aText("Context is empty","")) quit $$$OK
		zn "%sys"
		set sql="select ID,name,EmailAddress,fullName from Security.Users where Enabled [ '1' "
		if Name'="" s sql=sql_" and (name like '%"_Name_"%') "
		if Desc'="" s sql=sql_" and (fullName like '%"_Desc_"%') "
		set msg="Query: "_sql

		set exec="##class(apptools.core.LogInfo).MarkRed(%AppLogInfoVal,"""_Name_","_Desc_""")"
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,100000,$zu(5),msg,exec)
		if 'st  w $$$appError($System.Status.GetErrorText(st))
		quit $$$OK

	} 
	write "<br>"
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","~key="_key_"~divId="_divId_"~mode=*")
	Set path=$p($p($zu(86),"*",1),$$$slash,1,*-1)
	Set path1=path_$tr("\csp\broker\images\","\",$$$slash)
	Set path2=path_$tr("\docs\","\",$$$slash)
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
				#($$$appText(divId_"path1","size=50 title='path to images'",path1))#
			</td>
			<td>
				#($$$appText(divId_"path2","size=50 title='path to images docs'",path2))#
			</td>
		</tr>
		<tr>
			<td>
			#($$$appButton(divId_"appButtonResult1"," onclick="""_$tr(onclick,"*",1)_"""","Generate gallery via App /csp/broker"))#			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult2"," onclick="""_$tr(onclick,"*",2)_"""","Generate gallery dinamic rest"))#			
			</td>
		</tr>
		</table>
	>
 $$$jsstart
 	;for all identifiers starting with "_divId_"text by pressing Enter, click on the button (ending with $("[id$='txtTitle']"))
 	w "$('[id^="""_divId_"path""]').keydown(function (e) { if (e.keyCode == 13) { $('#"_divId_"appButtonResult2').click(); }});"_$c(13,10)
 $$$jsstop
	
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxResult">
<Description>
Its result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	s path1=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"path1")	
	set path2=$g(Par("%request.Data",divId_"path2"))
	set st=$$$OK
	s wc=##class(apptools.core.filesMimeTypes).GetTypesWildcards("image")_##class(apptools.core.filesMimeTypes).GetTypesWildcards("video")
	if mode=1 {
	 d ##class(apptools.core.files).GetList(path1,wc,.List)
	 s cspappstatic="/csp/broker/images/"
	 ;zw List
	 $$$jsstart
 		w "UIkit.lightboxPanel({"
   		w "items: [ "
		  d ..LighboxDrawJson(.List,cspappstatic)
  		w " ] }).show();"
	 $$$jsstop
	} 
	elseIF mode=2 {
	;	w path2
	 d ##class(apptools.core.files).GetList(path2,wc,.List)
	 ;zw List
	 s appdinamic=%request.Application_"get-files/"
	 $$$jsstart
 		w "UIkit.lightboxPanel({"
   		w "items: [ "
		  d ..LighboxDrawJson(.List,,appdinamic,..#GNStore)
  		w " ] }).show();"
	 $$$jsstop
	}
	write "<br>"
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxDrawJson">
<Description>
Lighbox Draw JSON
List - files array 
subdir - application static</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>List,subdir="",appdynamic,gn=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s i=""
 for { s i=$o(List(i)) q:i=""
 	if $lv($g(List(i))),$lg($g(List(i)),2)="F" {
		 	s fullpath=$lg($g(List(i)),1)
		 	s ItemName=$lg($g(List(i)),4)
 	} else {
 		s ItemName=$g(List(i,"ItemName"))
 		s fullpath=$g(List(i,"Name"))
 	}
 	set ext=$p(ItemName,".",*)
 	s mimetype=##class(apptools.core.filesMimeTypes).GetMimeTypes4ext(ext)
 	s type=$s(mimetype[("video"):"video",(mimetype)[("image"):"image",1:"iframe")
 	if subdir'="" {
 		w "{source: '"_subdir_ItemName_"', caption: '"_ItemName_"', type: '"_type_"'}",$c(13,10)
 	} else {
	 	set fileId=##class(apptools.core.files).GetFileIdView(fullpath,gn) 
		w "{source: '"_appdynamic_fileId_"', caption: '"_ItemName_"', type: '"_type_"'}",$c(13,10)
 	}
	w:$o(List(i))'="" ","
 }
]]></Implementation>
</Method>

<Method name="EnCode">
<Description>
Encode string to URL</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>s</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s s=$zconvert(s,"O","URL")
	q s
]]></Implementation>
</Method>

<Method name="DeCode">
<Description>
Decode string from URL</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>s</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	q $zconvert(s,"I","URL")
]]></Implementation>
</Method>

<Method name="DrawTableUi">
<Description>
Draw Tables UiKit</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[mode="beg",divId="tab2",attr="",&Enum]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if mode="beg" {
	&html<
 <div #(attr)# id="#(divId)#" >
    <table class="uk-table uk-table-hover uk-table-middle uk-table-divider">
        <thead>
           <tr>
          >
          s i=""  for {  s i=$o(Enum(i)) q:i=""
            write " <th "_$GET(Enum(i,"attr"))_" >"_$g(Enum(i))_"</th>"
          }
               /* <th class="uk-table-shrink">Preserve</th>
                <th class="uk-table-expand">Expand + Link</th>
                <th class="uk-width-small">Truncate</th>
                <th class="uk-table-shrink uk-text-nowrap">Shrink + Nowrap</th> */
    &html<
            </tr>
        </thead>
        <tbody>
        >
	}
    elseif mode="tr" {
			w "<tr>"
            s i=""  for {  s i=$o(Enum(i)) q:i=""
				w "<td "_$GET(Enum(i,"attr"))_">"_$GET(Enum(i))_"</td>"
               
               /* <td><input class="uk-checkbox" type="checkbox"></td>
               <td><img class="uk-preserve-width uk-border-circle" src="image/msw.jpg" width="40" alt=""></td>
                <td class="uk-table-link">
                    <a class="uk-link-reset" href="">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</a>
                </td>
                <td class="uk-text-truncate">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</td>
                <td class="uk-text-nowrap">Lorem ipsum dolor</td>*/
            } 			
            w "</tr>"
	}
	elseif mode="end" {
		&html<
		   </tbody>
 	 	 </table>
 		</div>
    	>
	} else {
	}
]]></Implementation>
</Method>
</Class>


<Class name="apptools.Uikit.AdminStatic">
<Description>
Query and SQL statements</Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65610,77273.857</TimeChanged>
<TimeCreated>64127,58953.319558</TimeCreated>

<XData name="html">
<Description>
s h=##class(apptools.core.rest).getStatic("apptools.Uikit.AdminStatic:html",.desc) w !,h,!!,desc</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
<!doctype html>
<html lang="ru" class="no-js">
<head>
	<!--head-start-->
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- ## UIKit dark admin ### by expresspixel.com -->
	
	<link rel="stylesheet" href="css/theme.css"> <!-- Resource style -->
	<link rel="stylesheet" href="css/nav.css"> <!-- CSS reset -->
	<!--<link rel="stylesheet" href="css/style.css"> <!-- Resource style -->
	<link rel="stylesheet" href="css/uikit.min.css"> <!-- CSS reset -->
	
	<script src="js/jquery-2.1.4.js"></script>
	<script src="js/uikit.min.js"></script>
	<script src="js/uikit-icons.min.js"></script>
	<script src="js/jquery-ui.js"></script>
	<script src="js/jquery.blockui.js"></script>
	<link rel="stylesheet" href="css/jquery-ui.css">
	<title>TitleUIKitDarkAdmin</title>
	<!--head-end-->
</head>
<body>
	<header class="cd-main-header" style="position: fixed; top: 0px;" >
		<a href="#" class="cd-logo">
			HeaderUIKitDarkAdmin
		</a>
		
		<div class="cd-search is-hidden">
			<form action="#0">
				<input type="search" placeholder="Search..." id="searchstr" name="searchstr">
			</form>
		</div> <!-- cd-search -->

		<a href="#" class="cd-nav-trigger"><span></span></a>

		<nav class="cd-nav">
			<ul class="cd-top-nav">
				<!--#(menuTop)#-->
			</ul>
		</nav>
	</header> <!-- .cd-main-header -->

	<main class="cd-main-content">
		<nav class="cd-side-nav">
			<ul class="uk-nav uk-nav-default">
			  <li class="cd-label">...</li>
			  <!--#(menu)#-->
			</ul>
		</nav>

		<div id=MainBody class="content-wrapper">
        <!-- Page Content -->
		<br />
			<div class="uk-grid">
			    <div class="uk-width-1-1 uk-margin-left uk-margin-right " style='overflow: auto;' id="mainApp" >
					<ul id='tabMenu' class="uk-tab uk-tab-grid uk-tab-top" data-uk-tab="{connect:'#tabList', animation: 'fade'}">
						<li id='t1' class="uk-active"><a href="#">About</a></li>
					</ul>
					<ul id="tabList" class="uk-switcher uk-margin uk-tab-content">
						<li id='ta1' >
						 <div class="uk-alert-success" uk-alert>
							<!--#($username)#-->
						 </div>
						</li>
					</ul>
				</div>
			</div>
		   <!-- /#page-content-wrapper -->
		</div> <!-- .content-wrapper -->
	</main> <!-- .cd-main-content -->
<script src="js/jquery.menu-aim.js"></script>
<script src="js/main.js"></script> <!-- Resource jQuery -->

<script>
/*
function get_content(tpl, div) {
$.get(tpl, function(result){
    $result = $(result);

    $( div ).html( result );
    $result.find('script').appendTo(div);
}, 'html');

}

crossroads.addRoute('/{section}/{subsection}', function(section, subsection){  
  get_content('templates/'+section+'/'+subsection+'.html', '#content');
});
crossroads.addRoute('/', function(id){  
  get_content('templates/home.html', '#content');
}); 

//setup hasher
function parseHash(newHash, oldHash){
  crossroads.parse(newHash);
}
hasher.initialized.add(parseHash); //parse initial hash
hasher.changed.add(parseHash); //parse hash changes
hasher.init(); //start listening for history change
*/

(function($) {
    var $window = $(window),
        $html = $('#wrapper');

    function resize() {
        if ($window.width() < 768) {
            return $html.removeClass('toggled');
        }
		
        $html.addClass('toggled');
    }

    $window
        .resize(resize)
        .trigger('resize');
})(jQuery);
</script>
<div id='MainHidden' style='display:none;'></div>
<div id="dialog" title="Dialog Title">
	<div id=dialogContent></div>
</div>
<!--js-end-->
</body>
</html>
]]></Data>
</XData>

<XData name="css">
<Description>
s h=##class(apptools.core.rest).getStatic("apptools.Uikit.AdminStatic:css") w !,h</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
<style type="text/css">
 
 	/* https://habr.com/ru/post/453744/
table {
  overflow: hidden;
}

tr:hover {
  background-color: #ffa;
}

td, th {
  position: relative;
}
td:hover::after,
th:hover::after {
  content: "";
  position: absolute;
  background-color: #ffa;
  left: 0;
  top: -5000px;
  height: 10000px;
  width: 100%;
  z-index: -1;
}
*/

 
 /*
	div {
  max-width: 400px;
  max-height: 150px;
  overflow: scroll;
}
*/

/* Use position: sticky to have it stick to the edge
 * and top, right, or left to choose which edge to stick to: */

thead th {
  position: -webkit-sticky; /* for Safari */
  position: sticky;
  top: 0;
}

tbody th {
  position: -webkit-sticky; /* for Safari */
  position: sticky;
  left: 0;
}

/* To have the header in the first column stick to the left: */

thead th:first-child {
  left: 0;
  z-index: 1;
}


/* Just to display it nicely: */

thead th {
  background: #E7EBF9;

}

tbody th {
  background: #E7EBF9;

}

table {
  border-radius: 10px; 
  border: 1px solid #72a7cf
}

td,
th {
  padding: 0.5em;
}

.bigbox { 
height: 20px; width: 20px 
}
 
</style>
]]></Data>
</XData>

<XData name="javascript">
<Description>
s h=##class(apptools.core.rest).getStatic("apptools.Uikit.AdminStatic:javascript") w !,h</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
<script language="javascript">
$('#tWHAT').keydown(function (e) {
  	if (e.ctrlKey && e.keyCode == 13) {
    // Ctrl-Enter pressed
    document.getElementById('WHAT').value=document.getElementById('tWHAT').value;
    document.forms['loginfo'].submit();
   }
});
// 
function ActionJs(FormId,ResultId,appClass,appMethod,appPar,appNsp){
	var $data =[];
	;var appNspace ='#(ns)#';
	;if (!appNsp) {appNsp =appNspace;}
	var classname ='#(class)#';
	if (!appClass) var appClass =classname;
	if (FormId) {
		$data = $('#'+FormId).serializeArray(); 
		//alert(FormId);
	}
	//Add to array
	$data.push({name:"appClass",value:appClass});
	$data.push({name:"appMethod",value:appMethod});
	$data.push({name:"appNsp",value:appNsp});
	$data.push({name:"appPar",value:appPar});
	$.ajax({
	  url: 'apptools.core.Action.cls',
	  type: 'post',
	  data: $data,
	  crossDomain: true,
	  success: function(result) {
	  if (ResultId) {$('#'+ResultId).html(result);}
	  }
	});
}
// Collect data from the form, serialize, send to the server, execute and paste the result into the container
// FormId - source form identifier <form id='FormInpur'>...</form>
// ResultId -  identifier of the target container <div id='ResultDiv'>...</div>
// appAct -  parameters for executing code on the server
//     namespace:classname:methodname:par1=val1&par2=val2...&parX-valX
function AppAct(FormId,ResultId,appAct){
	var $data =[]; //json array initialization
	$data.push({name:"params",value:{}});
	if (FormId) { //if the form id is specified, then we collect all input elements from it
		// elements must have an id attribute matching the name.
		// For example <input type='text' id='elem2' name='elem2'>
		$data = $('#'+FormId).serializeArray();
	}
	$data.push({name:"appAct",value:appAct}); //add execution parameters that will be parsed in apptools.core.Action.cls
	//if (jsonExt) {
	//  if there is additional json, then add it
	//	$data.push({"jsonExt":jsonExt});
	//	}
	//var url1='apptools.core.Action.cls';	if (url2) { url1=url2;}
	//execute an asynchronous request to the apptools.core.Action.cls
	$.ajax({  
	  url: 'apptools.core.Action.cls',
	  type: 'post',
	  data: $data,
	  success: function(result) {  // if successful
	  	// if the resulting container is specified, put everything sent from the server into it
	  	if (ResultId) {$('#'+ResultId).html(result);}
	  }
	});
}
// Collect data from the form, serialize, send to the server, execute and paste the result into the container
// FormId - source form identifier <form id='FormInpur'>...</form>
// ResultId -  identifier of the target container <div id='ResultDiv'>...</div>
// appAct -  parameters for executing code on the server
//     namespace:classname:methodname:par1=val1&par2=val2...&parX-valX
//     namespace:routine:label:par1=val1&par2=val2...&parX-valX
function AppRpc(FormId,ResultId,appAct,url,json){
	var data ={"jsonrpc":"2.0",params:{}};
	
	if (FormId) {
		data.params.formId=FormId;
		data.params.form=JSON.stringify($('#'+FormId).serializeArray());
	}
	if (json) {
		data.params.json = json;
	}

	data.method=appAct;
	$.ajax({
	  url: url,
	  type: 'post',
	  contentType:'application/json; charset=UTF-8',
	  dataType:'html', 
	  crossDomain: true,
	  data: JSON.stringify(data),
	  success: function(result) {
	  if (ResultId) {
		  $('#'+ResultId).html(result);
	  }
	  else {
		  return result;
	  	}
	  }
	});
}

// The function of opening the dialog box
function WinOpen(ns,classname,met,el,title,rest) {
	
	var titlename="Method "+met+" parameter "+decodeURIComponent(el);
	if (title) {titlename=title;}

	//$("#dialogContent").load("apptools.core.Action.cls","appClass="+classname+"&appMethod="+met+"&appNsp="+ns+"&appPar="+el);
	
	if (rest) {AppRpc('anyForm','dialogContent',ns+':'+classname+':'+met+':'+decodeURIComponent(el),rest);}
	else { ActionJs('anyForm',"dialogContent",classname,met,el,ns);}
	$( "#dialog" ).dialog({
		modal: true, 
        title: titlename, 
        autoOpen: true, 
        width:window.innerWidth-200, 
        height:window.innerHeight-300,
		position: { my: 'top', at: 'top+150' },
		buttons: [
		{
			text: "Cancel",
			click: function() {
				$( this ).dialog( "close" );
			}
		}
		]
		});
	try { event.preventDefault();
	} catch (e){};
}
</script>
]]></Data>
</XData>
</Class>


<Class name="apptools.core.Action">
<Description>
Withdraw the necessary actions</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeChanged>65839,45316.018632</TimeChanged>
<TimeCreated>65607,76497.951768</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Method name="GetParam">
<Description>
s par=##class(apptools.core.Action).GetParam(.%request,"ns",param)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[req,paramName,param,del="&"]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $d(req) { 
 	q $tr(req.Get(paramName),"#")
 }
 else { set val=$p($p(param,(del_paramName_"="),2),del,1)
 	quit val
 }
]]></Implementation>
</Method>

<Method name="OnPage">
<Description>
Main method generate the content of page</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>param</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set $zt="Err"
 	#dim %request as %CSP.Request

	if '$d(%request) {
		d ##class(apptools.core.type).ParseURL(param,.appPar,"&")
		if $g(appPar("appAct"))'="" {
			d ..RunMethod($p(appPar,":",1),$p(appPar,":",2),$p(appPar,":",3),.appPar)
			q $$$OK
		}
		if $g(appPar("appClass"))'="" {
			d ..RunMethod($g(appPar("appNsp")),$g(appPar("appClass")),$g(appPar("appMethod")),.appPar)
			q $$$OK
		}
		
		q $$$OK
	}

 	;set $$$AppL("MSW","req")=$$$AppObJs(%request)
 	;merge $$$AppL("MSW","%request.Data")=%request.Data
	;set $$$AppL("MSW","%request.AppData")=%request.AppData

 	if %request.Get("appAct")'="" { ;AppAct=NameSpace:Packet.ClassName:Method:@Par1=Val1@Par2=Val2...
 		set appPar=$p(%request.Get("appAct"),"AppAct=",2,*)
		set i=""
		for { set i=$o(%request.Data(i)) quit:i=""
			set:$o(%request.Data(i,""),-1)'="" appPar("%request.Data",i)=$g(%request.Data(i,$o(%request.Data(i,""),-1)))
		}
		d ..RunMethod($p(appPar,":",1),$p(appPar,":",2),$p(appPar,":",3),.appPar)
		q $$$OK
 	} else {
	 	set appNsp=%request.Get("appNsp")
		set appMethod=%request.Get("appMethod")
		set appClass=%request.Get("appClass")
		set appPar=%request.Get("appPar")
		set appJson=%request.Get("appJson")
		set i=""
		for { set i=$o(%request.Data(i)) quit:i=""
			if i["appNsp",appNsp="" s appNsp=$g(%request.Data(i,$o(%request.Data(i,""),-1)))
			if i["appMethod",appMethod="" s appMethod=$g(%request.Data(i,$o(%request.Data(i,""),-1)))
			if i["appClass",appClass="" s appClass=$g(%request.Data(i,$o(%request.Data(i,""),-1)))
			if i["appPar",appPar="" s appPar=$g(%request.Data(i,$o(%request.Data(i,""),-1)))
			if i["appJson" s appJson=$g(%request.Data(i,$o(%request.Data(i,""),-1)))
			set:$o(%request.Data(i,""),-1)'="" appPar("%request.Data",i)=$g(%request.Data(i,$o(%request.Data(i,""),-1)))
		}
		;if appNsp'="" try {zn appNsp set NSpace=appNsp } catch e {}
		;set NSpace=$zu(5)

	 	if $isobject(%request.Content) { 
		 	set stream=%request.Content
			set sc=##class(apptools.core.files).Stream2String(%request.Content,.str)
			if 'sc quit sc
		 	if $g(str)["{" d ..ParseJson(.str,.appClass,.appMethod,.appPar) ;m appPar("%request.Content")=str  m appPar("%request")=$$$AppObJs(%request)
		 	;merge $$$AppL("MSW","Content")=str
	 	}
	  	i $g(appJson)["{" d ..ParseJson(.appJson,.appClass,.appMethod,.appPar) ;m appPar("%request")=$$$AppObJs(%request)
  	}
 	
	if appMethod="" {
		$$$jsstart
 		write "alert('"_$$$aText("The appMethod parameter is empty","")_"');"
 		$$$jsstop
 		zw jsobj
 		m a=%request.Data
 		zw a
 		w
		quit $$$OK
	}
	elseif appMethod="ShowJson" {
		if appNsp'="" try {zn appNsp set NSpace=appNsp } catch e {}
		d ..ShowJson(appPar)
	}
	elseif appMethod="ShowXML" {
		if appNsp'="" try {zn appNsp set NSpace=appNsp } catch e {}
		d ..ShowXML(appPar)
	}
	else {
		d ..RunMethod(appNsp,appClass,appMethod,.appPar)
	}
	
	quit $$$OK
Err 
	write $zconvert($ze,"O","HTML")
	quit $$$OK
]]></Implementation>
</Method>

<Method name="RunMethod">
<Description>
To execute the method</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>appNsp,appClass,appMethod,appPar</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if appNsp'="" try {zn appNsp set NSpace=appNsp } catch e {}
	set NSpace=$zu(5)
		set:appClass="" appClass="apptools.core.Action"
		if $e(appPar,1)="{" {
			;Parse json TODO
		}
		elseif appPar["~" {
			do ##class(apptools.core.type).ParseURL(appPar,.appPar,"~")  ;parse in array
		}
		elseif appPar["&" {
			d ##class(apptools.core.type).ParseURL(appPar,.appPar,"&")
		}
		Do $CLASSMETHOD(appClass,appMethod,.appPar)
]]></Implementation>
</Method>

<Method name="ShowJson">
<Description>
Show a formatted json </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>appPar,json</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set gn=$zconvert(appPar,"I","URL")
	try {
		write "<h3>"_gn_" in NameSpace :"_$zu(5)_"</h3>"
		if '$d(@gn) w $$$appError("Global node does not exist") q
		write "<pre>" write $g(@gn) write "</pre>" 
	} catch e { w $ze }
	quit $$$OK
]]></Implementation>
</Method>

<Method name="ShowXML">
<Description>
Show formatted XNL</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>appPar,json</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set gn=$zconvert(appPar,"I","URL")
	try {
		write "<h3>"_gn_" in NameSpace "_$zu(5)_"</h3>"
		if '$d(@gn) w $$$appError("Global node does not exist") q
		write $zconvert($g(@gn),"O","HTML")
	} catch e { write $ze }
	quit $$$OK
]]></Implementation>
</Method>

<Method name="Test">
<Description>
To disassemble the drain to Json</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>appPar,json</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	write "ClassMethod Test."
	zwrite appPar
	quit $$$OK
]]></Implementation>
</Method>

<Method name="ParseJson">
<Description>
To disassemble the drain to Json</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>jsonStr,appClass,appMethod,appPar</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 try {
	set appClass={}.$$$jsonFromJSON(jsonStr).appClass
	set appMethod={}.$$$jsonFromJSON(jsonStr).appMethod
	set appPar={}.$$$jsonFromJSON(jsonStr).appPar
	set appPar("jsonStr")=jsonStr
	}
 catch e { 
 	write $zconvert($ze,"O","HTML")
 }
 quit $$$OK
]]></Implementation>
</Method>

<Method name="WriteWinOpenREST">
<Description>
Write Action Js 
w ##class(apptools.core.Action).WriteWinOpenREST(%request)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>req</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  	if req.URL[(req.Application_"get-html")||(req.URL[(req.Application_"post-json")) { ;||(req.URL[(req.Application_"a")) { //is static content
  		q req.Application_"post-json"
  	} else {
  		q ""
  	}
]]></Implementation>
</Method>

<Method name="WriteAppAct">
<Description>
Write Action Js 
w ##class(apptools.core.Action).WriteActJs(%request,pref_"MainForm",mhead,..%ClassName(1),pref_"FirstHead",key)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>req,fornId,resultDivId,ns,classname,method,CGIVar=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  	;s $$$AppL("MML","%request-WriteActJs-")=$$$AppObJs(req)
  	set:CGIVar'["'" CGIVar=CGIVar_"'"
  	if req.URL[(req.Application_"get-html")||(req.URL[(req.Application_"post-json"))||(req.URL[(req.Application_"a")) { //is static content
  		q "AppRpc('"_fornId_"','"_resultDivId_"','"_ns_":"_classname_":"_method_":"_CGIVar_",'"_req.Application_"post-json');"
  	} else {
	  	q "AppAct('"_fornId_"','"_resultDivId_"','AppAct="_ns_":"_classname_":"_method_":"_CGIVar_");"
  		
  	}
	quit ""
]]></Implementation>
</Method>

<Method name="WriteActJs">
<Description>
Write Action Js 
w ##class(apptools.core.Action).WriteActJs(%request,pref_"MainForm",mhead,..%ClassName(1),pref_"FirstHead",key)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>req,fornId,resultDivId,classname,method,CGIVar="",ns=$namespace</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  	;s $$$AppL("MML","%request-WriteActJs-")=$$$AppObJs(req)
  	set:CGIVar'["'" CGIVar=CGIVar_"'"
  	
  	quit:req.URL[".cls" "ActionJs('"_fornId_"','"_resultDivId_"','"_classname_"','"_method_"','"_CGIVar_");"
  	
  	if req.URL[(req.Application_"get-html")||
  		(req.URL[(req.Application_"post-json"))||
  		(req.URL[(req.Application_"a")) { //is static content
  		set:ns="" ns=$namespace
  		q "AppRpc('"_fornId_"','"_resultDivId_"','"_ns_":"_classname_":"_method_":"_CGIVar_",'"_req.Application_"post-json');"
  	} else {
  		q "ActionJs('"_fornId_"','"_resultDivId_"','"_classname_"','"_method_"','"_CGIVar_");"
  	}
	quit ""
]]></Implementation>
</Method>

<Method name="GetElemParseForm">
<Description>
Write Action Js 
w ##class(apptools.core.Action).GetElemParseForm(form,.Par,pref_"text")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>form,Par,divIdname,convert=1</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 i form'="" {
	s aray=[].$$$jsonFromJSON(form)
	for i=0:1:aray.$$$jsonSize()-1 {
		set item = aray.$$$jsonGet(i)
		i $isobject(item) {
			;s $$$AppL("MML","%request-GetElemForm-item")=$zconvert(item.value,"I","UTF8")
			s value=item.value
			if convert s value=$zconvert(item.value,"I","UTF8")
			;if item.name=divIdname set val=value
			s:item.name'="" Par("%request.Data",item.name)=value
		}
	}
 }
 q $$$OK
]]></Implementation>
</Method>

<Method name="GetElemForm">
<Description>
Write Action Js 
w ##class(apptools.core.Action).GetElemForm(%request,.Par,pref_"text")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>req,Par,divIdname</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  	;s $$$AppL("MML","%request-GetElemForm-")=$$$AppObJs(req)
	;s $$$AppL("MML","%request.Cont")=$$$AppObJs(req.Content)

  	if req.URL[(req.Application_"get-html")||(req.URL[(req.Application_"post-json")) {
  		if $isobject(req.Content) {
	  		set stream=req.Content
			set sc=##class(apptools.core.files).Stream2String(req.Content,.str)
			if 'sc quit sc
			;s $$$AppL("MML","%request.str")=str
			if $g(str)["{" {
				s form={}.$$$jsonFromJSON(str).params.form
   				;s $$$AppL("MML","%request-GetElemForm-aray")=form
				d ..GetElemParseForm(form,.Par,divIdname)
			}
		 	;merge $$$AppL("MSW","Content")=str
  			;s val=req.Content.$$$jsonGet(name)
  		}
  	} else {	
  	}
	quit $g(Par("%request.Data",divIdname))
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.AutoPage">
<Description>
Updated at 12/08/2017 16:19:10</Description>
<Super>%CSP.Util.AutoPage</Super>
<TimeChanged>65610,77273.857</TimeChanged>
<TimeCreated>65607,76498.651592</TimeCreated>

<Parameter name="DOMAIN">
<Description>
Default Localization Domain</Description>
<Default>portalutils</Default>
</Parameter>

<Parameter name="ERRORPAGE">
<Description>
Specify a custom error page to call if there are any problems with generating this page.
If this is not specified it will use the default error page specified for this CSP
application, and if this is not specified it will use the system default error page.
For example this could be set to '/csp/samples/error.csp' to display the sample error
page.</Description>
<Default>apptools.errorpage.cls</Default>
</Parameter>

<Parameter name="STYLESHEET">
<Description>
Name of the external style sheet file</Description>
<Default>intersystems.css</Default>
</Parameter>

<Method name="OnCompile">
<Internal>1</Internal>
<ClassMethod>1</ClassMethod>
<CodeMode>generator</CodeMode>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[
	s tSC=$$$OK
	// Skip the test if the compiled template class
	s isTemplate=%class="apptools.core.AutoPage"
	q:isTemplate $$$OK
	
	s cspurl=%class_".cls"
	s pvalue=$$$comMemberKeyGet(%class,$$$cCLASSparameter,"CSPURL",$$$cPARAMdefault)
	i (pvalue'=cspurl) {
		$$$defMemberKeySet(%class,$$$cCLASSparameter,"CSPURL",$$$cPARAMdefault,cspurl)
		s updateClass=##class("%Dictionary.ClassDefinition").%OpenId(%class)
		s updateClass.Modified=0
		d updateClass.%Save()
		d updateClass.%Close()
 	}

	f param="PAGENAME","PARENTPAGE" {
		s pvalue=$$$comMemberKeyGet(%class,$$$cCLASSparameter,param,$$$cPARAMdefault)
		i (pvalue="") {
			$$$defMemberKeySet(%class,$$$cCLASSparameter,param,$$$cPARAMdefault," ")
			s updateClass=##class("%Dictionary.ClassDefinition").%OpenId(%class)
			s updateClass.Modified=0
			d updateClass.%Save()
			d updateClass.%Close()
	 	}
	}
	q tSC
]]></Implementation>
</Method>

<Method name="GetTitlePane">
<ClassMethod>1</ClassMethod>
<CodeMode>objectgenerator</CodeMode>
<FormalSpec>pInstance:%CSP.Util.PageInstance</FormalSpec>
<ReturnType>%CSP.Util.Pane</ReturnType>
<Implementation><![CDATA[
	Do %code.WriteLine(" Set tPane = ##class(%CSP.Util.SMTitlePane).%New()")
	Do %code.WriteLine(" Set tPane.Text =  $$$Text("""_$G(%parameter("PAGENAME"),"N/A")_""")")
	Do %code.WriteLine(" Quit tPane")
	q $$$OK
]]></Implementation>
</Method>

<Method name="GetDetailPane">
<Description>
Get the detail pane info object</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pInstance:%CSP.Util.PageInstance</FormalSpec>
<ReturnType>%CSP.Util.Pane</ReturnType>
<Implementation><![CDATA[
	Set tDetailPane = ""
	Quit tDetailPane
]]></Implementation>
</Method>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<FormalSpec>parameter=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	Quit ..DrawHTML()
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.DownloadCSP">
<IncludeCode>apptools.core</IncludeCode>
<Super>%CSP.Page</Super>
<TimeChanged>65829,48540.191746</TimeChanged>
<TimeCreated>65607,76504.561797</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Method name="OnPreHTTP">
<Description><![CDATA[
Event handler for <b>PreHTTP</b> event: this is invoked before
the HTTP headers for a CSP page have been sent.  All changes to the
<class>%CSP.Response</class> class, such as adding cookies, HTTP headers,
setting the content type etc. must be made from within the OnPreHTTP() method.
Also changes to the state of the CSP application such as changing
%session.EndSession or %session.AppTimeout must be made within the OnPreHTTP() method.
It is prefered that changes to %session.Preserve are also made in the OnPreHTTP() method
as this is more efficient, although it is supported in any section of the page.
Return <b>0</b> to prevent <method>OnPage</method> from being called.]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>par=""</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[
	if %request.Get("fileName")'="" {
		s file=%request.Get("fileName")
	}
	elseif %request.Get("fileId")'="" {
		s file=..GetfileName(%request.Get("fileId"),,.origname)
	}
	elseif %request.Get("Id")'="" {
		s file=..GetfileName(%request.Get("Id"),,.origname)
	}
	if file="" {set fileName=$$$aText("Link already invalid","")}
	else {set fileName = $p(file,$$$slash,*)}
	s %response.ContentType="application/force-download"
	;s %response.CharSet="windows-1251"
	s %response.CharSet=""
	d %response.SetHeader("Expires", "0")
	;d %response.SetHeader("Accept-Ranges","bytes")
	set f=##class(%File).%New()
 	s size=f.GetFileSize(file)
	d %response.SetHeader("Content-Length",size)
	set name=fileName
	if origname'="" set name=origname
	set name=$ZCVT($ZCVT(name,"O","UTF8"),"O","URL")
	d %response.SetHeader("Content-Disposition","attachment;filename="_name)
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPage">
<Description><![CDATA[
Event handler for <b>PAGE</b> event: this is invoked in order to  
generate the content of a csp page.
w "<a title=""Save this file to disk"" href=""apptools.core.DownloadCSP.cls?fileId=221212"">"]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[
	if %request.Get("fileName")'="" {
		s file=%request.Get("fileName")
	}
	elseif %request.Get("fileId")'="" {
		set fileId=%request.Get("fileId")
		s file=..GetfileName(fileId)
		d ..DeleteFileId(fileId)
	}
	elseif %request.Get("Id")'="" {
		set fileId=%request.Get("Id")
		s file=..GetfileName(fileId)
	}
	
	set stream=##class(%FileBinaryStream).%New()
	set stream.Filename=file
	while 'stream.AtEnd {
		set line=stream.Read()
		write line
	}
	
	/*
	#dim f As %File
	set f=##class(%File).%New(file)
 	set ok=f.Open("RS")     
 	if 'ok do f.%Close() Q ok
 	;set len=$zu(140,1,file)
 	d f.Rewind()
 	while 'f.AtEnd {
    	Write f.Read($$$MaxLocalLength)
	}
 	do f.%Close()
 	*/
 	if %request.Get("log")'="" {
 		try {
 			Do $classmethod(%request.Get("log"),"AddRecord","apptools.core.DownloadCSP","OnPage",$st($st(-1),"PLACE"),"INFO",file,"DownLoad")
 		} catch e {}
 	}
     Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetGN">
<Description>
To global link</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	quit $na(^CacheTemp.App.tmpDownloadCSP(+$h)) ;global should be available from any region
]]></Implementation>
</Method>

<Method name="DeleteFileId">
<Description>
Remove the ID for download</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>FileId,gn=..GetGN()</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	KILL @gn@(FileId)
	quit $$$OK
]]></Implementation>
</Method>

<Method name="GetfileName">
<Description>
To obtain the full name of the file ID for download</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>FileId,gn=..GetGN(),origname="",ContentType=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	if '$d(@gn@(FileId)) quit ""
	set origname=$g(@gn@(FileId,"origname"))
	if $g(@gn@(FileId))'=""	{
		if $g(@gn@(FileId,"ContentType"))'="" s ContentType=$g(@gn@(FileId,"ContentType")) 
		quit $g(@gn@(FileId))
	}
	quit ""
]]></Implementation>
</Method>

<Method name="GetFileId">
<Description><![CDATA[
To ID to download the file
if ##class(apptools.core.DownloadCSP).GetFileId(fileName,.url) { set fn="<a href='"_url_"'>DownLoad</a>"	}
cgivar="Id" to send a file during the day
cgivar="fileId" give the file only once
cgivar="fileName" to send a file via the full path (insecure)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[FileName,&URL,&id,cgivar="Id",gn=..GetGN()]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set URL=""
	set st=$$$OK
	set origname=$p(FileName,"*",2)
	set FileName=$p(FileName,"*",1)
	TRY {
		set f=##class(%File).%New(FileName)
 		set st=f.Open("RS")     
 		if 'st do f.%Close() Q
 		if cgivar="fileName" {
	 		s id=FileName
	 	} else {
 			set id=$r(+$h)_$zcrc(7,FileName)_$r(+$h)
 			set @gn@(id)=FileName
 			set @gn@(id,"origname")=origname
	 	}
 		set URL=..%ClassName(1)_".cls?"_cgivar_"="_id
	} catch (e) {  
		s st=$System.Status.GetErrorText(e) 
	}
 	quit st
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.Form">
<Description>
The representation of the stored classes for viewing and editing</Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65828,34876.784824</TimeChanged>
<TimeCreated>65607,76506.867349</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="PREFIXFIELD">
<Description>
prefix the field name of the object</Description>
<Default>appfield</Default>
</Parameter>

<Method name="GetSubclassOf">
<Description>
To get all descendants for a class</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>super="apptools.core.Form"</FormalSpec>
<Implementation><![CDATA[
 set query=##class(%Library.ResultSet).%New("%Dictionary.ClassDefinition:SubclassOf")
 set st=query.Execute(super)
 Q query
]]></Implementation>
</Method>

<Method name="GetJsonProp">
<Description>
To obtain the extended properties of the field object</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>obj,propName,gn,out</FormalSpec>
<Implementation><![CDATA[
	set out("description")=..GetPropVal(obj,propName,.gn,"Description")
	set out("inputtype")=""
	if out("description")["{" {
		set json="{"_$p(out("description"),"{",2,*)
		try {
			;2017 set title={}.%FromJSON(json).title 
			;2016.1 set title={}.$fromJSON(json).title
			set out("title")={}.$$$jsonFromJSON(json).title
			set out("inputtype")={}.$$$jsonFromJSON(json).inputtype
			set out("displayname")={}.$$$jsonFromJSON(json).displayname
			set out("inputpattern")={}.$$$jsonFromJSON(json).inputpattern
			if $g(out("inputpattern"))="autocomplete" {
				s out("autocompleteMethod")={}.$$$jsonFromJSON(json).autocompleteMethod
			}
			elseif $g(out("inputpattern"))="files" {
				s out("filesMethod")={}.$$$jsonFromJSON(json).filesMethod
				s out("filesStore")={}.$$$jsonFromJSON(json).filesStore
				if out("filesMethod")="" set out("filesMethod")="##class(apptools.core.type).UploadFilesJS(%id)"
				if "TempDir"[out("filesStore") set out("filesStore")=##class(%File).GetDirectory(##class(%File).TempFilename())
				if "stream"=out("filesStore") set out("filesStore")=$$defdir^%SYS.GLO($ZU(5))_"stream"_$$$slash
			}
			elseif $g(out("inputpattern"))["select" {
				s out("selectMethod")={}.$$$jsonFromJSON(json).selectMethod
			}
			set out("attr")={}.$$$jsonFromJSON(json).attr
			set out("onchange")={}.$$$jsonFromJSON(json).onchange
			set out("readOnly")={}.$$$jsonFromJSON(json).ReadOnly
			if out("displayname")'="" set out("description")=out("displayname")
			else  s out("description")=$p(out("description"),"{",1)
			// enable the event handler
			if $g(out("onchange"))'="" {
				s out("attr")=out("attr")_" onchange='"_out("onchange")_"'" ;alert(this.value)'"
			}
			
		} catch e { w "Error: "_$ze }
	}
	elseif out("description")="" {
		set out("description")=propName
	}
]]></Implementation>
</Method>

<Method name="GetPropVal">
<Description>
Get all property values</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>obj,propName,gn,nameAttr</FormalSpec>
<Implementation><![CDATA[
	;q:nameAttr=""||(propName="")||('$g(gn)) "" 
	;i '$d(gn("Properties",propName)) q ""
	q $g(gn("Properties",propName,nameAttr))
	;set col=$g(@gn@(-1,nameAttr))
	;quit:'col ""
	;quit $lg($g(@gn@(row)),col)
]]></Implementation>
</Method>

<Method name="ShowProp">
<Description>
Write the string object properties</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>obj,propName,gn,PrefixIdDIV,Mode</FormalSpec>
<Implementation><![CDATA[
	set sysType=..GetPropVal(obj,propName,.gn,"Type")
	if sysType["%Stream." q $$$OK ;TODO exception
	set Name=..GetPropVal(obj,propName,.gn,"Name")
	if Name="" q $$$ERROR($$$GeneralError,"No Exsist Property "_propName) 
	set Required=..GetPropVal(obj,propName,.gn,"Required")
	set ReadOnly=..GetPropVal(obj,propName,.gn,"ReadOnly")
	set Parameters=..GetPropVal(obj,propName,.gn,"Parameters")
	set Value=$property(obj,Name)
	set redstar="" if Required s redstar="<font color=red title='"_$$$aText("Required field","")_"'>*</font>"
	
	do ..GetJsonProp(obj, propName, .gn, .pr)
	if 'ReadOnly set ReadOnly=$g(pr("readOnly"))
	if 'Mode set ReadOnly=1
	
	set label=pr("description")_redstar
	if Mode["ShowFieldName" set label=label_"<br>("_propName_")"
	if $g(pr("inputpattern"))="hidden" set label=""
	write "<td style='text-align: right;' title='"_$g(pr("title"))_"' ><label>"_label_"</label></td>"
	write "<td style='text-align: left;' title='"_$g(pr("title"))_"' >"
	s pr("attr")=$g(pr("attr"))_" "_$s(Required:"Required",1:"")_" "_$s(ReadOnly:"disabled",1:"")
	
	s %id=$g(PrefixIdDIV)_..#PREFIXFIELD_Name
	s %val=$g(Value)
	s pr("WebComp-size")=" size=50 " if pr("attr")["size" set pr("WebComp-size")=""
	
	if sysType="%Boolean",pr("inputtype")'="checkbox" {
		d ##class(apptools.core.Form).SelectFieldYesNo(%id,%val)
	}
	elseif sysType="%Date" {
	 	write $$$appText(%id," size=10 "_pr("attr"),%val)
	}
	else {  //%String
		if $g(pr("inputpattern"))="textarea" {
			if pr("attr")'["cols" s pr("attr")=pr("attr")_" cols=77 "
			if pr("attr")'["rows" s pr("attr")=pr("attr")_" rows=3 "
			write $$$appTextarea(%id,pr("attr"),%val)
		}
		elseif $g(pr("inputpattern"))="hidden" {
			write "<input type='hidden' id='"_%id_"' name='"_%id_"' "_$g(pr("attr"))_" value='"_%val_"'>"
		}
		elseif $g(pr("inputpattern"))="autocomplete" {
			set met=$g(pr("autocompleteMethod"))
			if met'=""  xecute "do "_met
			write $$$appAutocomplete(%id," "_pr("attr"),%val)
		}
		elseif $g(pr("inputpattern"))="files" {
			write ..WebCompShowFiles(obj,.pr,Mode,%id,%val)
		}
		elseif $g(pr("inputpattern"))="select" {
			set met=$g(pr("selectMethod"))
			if met'="" {
				;;w met
				if (met["{") { //a list of json
					;TODO
				}
				else { //a list of functions
					xecute "do "_met
				}
			}
			;w $$$appInputHidden(.%id," "_attr,%val)
		}
		elseif $g(pr("inputpattern"))="selectize" {
			s met=$g(pr("selectMethod"))
			write "<input type='text' id='"_%id_"' name='"_%id_"' class='input-tags demo-default ui-corner-all ui-widget ui-widget-content' value='"_%val_"'>"
			if met'="" {
				xecute "do "_met
			}
		}
		elseif pr("inputtype")="checkbox" {
			;set onclick="$('#"_%id_"').attr('value',$('#"_%id_"checkbox').prop('checked') ? 1 : 0 );"
			;write $$$appInput(%id_"checkbox"," onclick="""_onclick_""" type='"_pr("inputtype")_"' "_pr("WebComp-size")_pr("attr")_" "_$s(%val:"checked ",1:""),%val)
			;write $$$appInputHidden(%id,"",%val)
			write ..WebCompShowCheckbox(,.pr,Mode,%id,%val)
		}
		elseif pr("inputtype")'="" {
			write $$$appInput(%id," type='"_pr("inputtype")_"' "_pr("WebComp-size")_pr("attr"),%val)
		}
		elseif Parameters["{" {
			if {}.$$$jsonFromJSON(Parameters).VALUELIST'="" {
			  set vl={}.$$$jsonFromJSON(Parameters).VALUELIST
			  set dl={}.$$$jsonFromJSON(Parameters).DISPLAYLIST
			  ;	s ^tmpMSW(1,$i(^tmpMSW),"Parameters")=$lb(propName,vl,dl)
			  set:dl="" dl=vl
			  do ..SelectField($lfs(vl),,$lfs(dl),.gn2,,%id,%val,600)
			} else {
				write $$$appText(%id,pr("WebComp-size")_pr("attr"),%val)
			}
		}
		else {write $$$appText(%id,pr("WebComp-size")_pr("attr"),%val)
		}
	}
	write "</td>"
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="WebCompShowCheckbox">
<Description>
Display checkbox</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[obj,&pr,Mode,%id,%val,&ext]]></FormalSpec>
<Implementation><![CDATA[
	set onclick="$('#"_%id_"').attr('value',$('#"_%id_"checkbox').prop('checked') ? 1 : 0 );"
	;set ret=$$$appInput(%id_"checkbox"," onclick="""_onclick_""" type='checkbox' "_$g(pr("WebComp-size"))_$g(pr("attr"))_" "_$s(%val:"checked ",1:""),%val)
	set ret=$$$appCheck(%id_"checkbox"," onclick="""_onclick_""" "_$g(pr("WebComp-size"))_$g(pr("attr"))_" "_$s(%val:"checked ",1:""),%val)
	set ret=ret_$$$appInputHidden(%id,"",%val)
	quit ret
]]></Implementation>
</Method>

<Method name="WebCompShowFiles">
<Description>
Display component Files</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[obj,&pr,Mode,%id,%val,&ext]]></FormalSpec>
<Implementation><![CDATA[
	set ret=""
	set met=$g(pr("filesMethod"))
	set attr=$g(pr("WebComp-size"))_$g(pr("attr"))
	;if attr'["disabled" set attr=attr_" disabled "
	for ff="filesStore" set %id(ff)=$g(pr(ff))
	if Mode {
		if met'="" 	s %obj=obj  x "set %ret="_$e(met,1,*-1)_",.%id)"
		set ret=$g(%ret)_$$$appText(%id,attr,%val)
	} else {
		set ret=ret_$$$appText(%id,attr,%val)
	}
	;pr("sysType")
	if %val'="" {
		set fileName=$g(pr("filesStore"))_%val
		;W fileName
		if ##class(apptools.core.DownloadCSP).GetFileId(fileName,.url) { 
			set ext("aurl")="<a href='"_url_"'>"_$$$aText("DownLoad","")_"</a>"
			set ext("url")=url
			set ext("fileName")=fileName
			s ret=ret_" "_ext("aurl")
		}
	}
	quit ret
]]></Implementation>
</Method>

<Method name="ObjectDelete">
<Description>
Keep object default</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Param="",Ref=0</FormalSpec>
<Implementation><![CDATA[
	set id=$g(Param("objId")) ;$p(Param,",")
	set Class=$g(Param("ClassName")) ;$p(Param,",",2)
	set PrefixIdDIV=$g(Param("pref")) ;$p(Param,",",3)
	#dim obj As %Persistent
	if id="" w $$$appError($$$aText("Undefined object identifier",""))_"<br>" d:'Ref ..ButtonRef() q
	set obj=$classmethod(Class,"%OpenId",id)
	if '$isobject(obj) w $$$appError($$$aText("Undefined object",""))_"<br>" d:'Ref ..ButtonRef() q
	set st=obj.%DeleteId(obj.%Id())
	if 'st w $$$appError($System.Status.GetErrorText(st)) w "<br>" d:'Ref ..ButtonRef() q
	write $$$appMsg($$$aText("The object is removed",""))
	write "<br>" d:'Ref ..ButtonRef() 
	q
]]></Implementation>
</Method>

<Method name="ObjectSaveAsNew">
<Description>
To create the object as new</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Param=""</FormalSpec>
<Implementation><![CDATA[
	s Param("objId")=""
 d ..ObjectSave(.Param)
]]></Implementation>
</Method>

<Method name="ObjectNew">
<Description>
To create a new object by default</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Param=""</FormalSpec>
<Implementation><![CDATA[
 s obj=..GetObj(Param)
 d ..Show(obj,$p(Param,",",3,99))
 q $$$OK
]]></Implementation>
</Method>

<Method name="GetObj">
<Description>
To get the object from the argument</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $p(Par,",",1) = "" s obj=$classmethod($p(Par,",",2),"%New")
	else  s obj=$classmethod($p(Par,",",2),"%OpenId",$p(Par,",",1))
	q obj
]]></Implementation>
</Method>

<Method name="ObjectSave">
<Description>
Save the default object</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Param="",Ref=0</FormalSpec>
<Implementation><![CDATA[
	set id=$g(Param("objId")) ;$p(Param,",")
	set Class=$g(Param("ClassName")) ;$p(Param,",",2)
	set PrefixIdDIV=$g(Param("pref")) ;$p(Param,",",3)
	set Mode=$g(Param("mode"))
	if Mode["WithoutRef" s Ref=1
	if id="" s obj=$classmethod(Class,"%New")
	else  s obj=$classmethod(Class,"%OpenId",id)
	if '$isobject(obj) w $$$appError(..UikitNote($$$aText("Undefined object","")))_"<br>" d:'Ref ..ButtonRef() q ""
	;set gn="%prop"
	set st=..GetPropertyDefinition(obj,.gn)
	if 'st w $$$appError(..UikitNote($System.Status.GetErrorText(st)))_"<br>" d:'Ref ..ButtonRef() q ""
	set prefix=$g(PrefixIdDIV)_..#PREFIXFIELD
	set i=prefix
	;m $$$AppL("SPZ",".gn")=gn
	;m m=%request.Data	zw m
	;zw gn
	;zw Param
	if '$d(Param("%request.Data")) {
		for { set i=$o(%request.Data(i)) quit:i=""  quit:i'[prefix
			set nameProp=i
			s Value=$g(%request.Data(i,1))
			set:nameProp'="" Param("%request.Data",nameProp)=Value
		}
	} 
	s i=""
	for { set i=$o(Param("%request.Data",i)) quit:i=""
			set nameProp=$p(i,prefix,2)  
			continue:nameProp=""
			set Value=$g(Param("%request.Data",i))
			continue:'$d(gn("Properties",nameProp))
			
			if ..GetPropVal(obj,nameProp,.gn,"Required"),Value="" {
				;to get property - description of pr("description")
				d ..GetJsonProp(obj, nameProp, .gn, .pr)
				s err=$g(err)_"<li>"_nameProp_" "_$$$aText("Mandatory field is empty","")_" ("_$g(pr("description"))_")</li>" continue
			}
			if $d(gn("Properties",nameProp)) {
				;set sysType=..GetPropVal(obj,nameProp,.gn,"Type")
				; if the property is - the stream from the stored file
				if 0,sysType["%Stream." {
					set filename=##class(%File).GetDirectory(##class(%File).TempFilename())_Value
					Set file = ##class(%File).%New(filename)
  					set sc=file.Open("RU") // same flags as the OPEN command
					;Do $method(obj,nameProp,"CopyFrom",file)
					;write "<br>"_filename ;continue
					;s stream=##class(%Stream.FileBinary).%New()
					;Set sc=stream.LinkToFile(filename)
					if 'sc {
						;write $$$appError($System.Status.GetErrorText(sc))
					} else {
						set $property(obj,nameProp)=file ;stream
						set file=""
					}
				}
				else {
					set $property(obj,nameProp)=Value
				}
			}
	}
	if $d(err) w "<br><br>"_$$$appError(..UikitNote($$$aText("Error checking properties",""))_"<hr>"_$g(err)) d:'Ref ..ButtonRef() q ""
	set st=obj.%Save()
	if 'st w "<br><br>"_$$$appError(..UikitNote($System.Status.GetErrorText(st)))_" <br>" d:'Ref ..ButtonRef() q ""
	write "<br><br>"_$$$appMsg(..UikitNote($$$aText("Saved",""),"success"))_"<br>" d:'Ref ..ButtonRef()
	quit obj
]]></Implementation>
</Method>

<Method name="UikitNote">
<Description>
To list the properties of a class</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>msg,status="warning"</FormalSpec>
<Implementation><![CDATA[
	$$$jsstart
	w "UIkit.notification({message: '"_msg_"', status: '"_status_"',pos: 'top-center'});"
	$$$jsstop
	q msg
]]></Implementation>
</Method>

<Method name="GetPropertyDefinition">
<Description>
To list the properties of a class</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>obj,gn</FormalSpec>
<Implementation><![CDATA[
	; Get all object properties
	;s sql="SELECT cls.Name, prop.Name, prop.Type, prop.Description FROM ""%Dictionary"".ClassDefinition cls  JOIN ""%Dictionary"".PropertyDefinition prop ON cls.Name = prop.parent WHERE cls.Name = '"_obj.%ClassName(1)_"'"
	;set sql="SELECT * from ""%Dictionary"".PropertyDefinition where parent like '"_obj.%ClassName(1)_"'"
	;set st=##class(apptools.core.sys).SaveSQL(sql,gn,1)
	set st=##class(apptools.core.LogInfoPane).GetClassDef(obj.%ClassName(1),"",.gn,0)
	if 'st q st
	;zw gn("Properties")
	quit $$$OK
]]></Implementation>
</Method>

<Method name="SelectFieldYesNo">
<Description>
The output type field select Yes or no
do ##class(apptools.core.Form).SelectFieldYesNo("test","0")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>idSelect="selectmenu",dfltKey=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ..SelectField($lb(0,1),,$lb($$$aText("No",""),$$$aText("Yes","")),.gn,,idSelect,dfltKey,100)
	q $$$OK
]]></Implementation>
</Method>

<Method name="SelectField">
<Description>
The output fields of type select
do ##class(apptools.core.Form).SelectField($lb("",0,1),"alert(1);",$lb("","No","Yes"),.gn,,"test","0",50) </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>KeyList="",ONCHANGE="",ValueList="",gnRet,order=1,idSelect="selectmenu",dfltKey="",width=500,NoWrite=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	kill gnRet
	set selectNS="<SELECT id='"_idSelect_"' name='"_idSelect_"' "_$s(NoWrite:"ONCHANGE='"_ONCHANGE_"'",1:"")_">"
	;set selectNS=selectNS_" <OPTION  VALUE=''></OPTION>"
	set gnRet($i(gnRet))=selectNS
	for i=1:1:$ll(KeyList) { 
		;continue:$lg(KeyList,i)=""
		set selected=""
		if dfltKey'="",dfltKey=$lg(KeyList,i) s selected="selected"
		set select=" <OPTION "_$g(selected)_" VALUE="""_$lg(KeyList,i)_""">"_$lg(ValueList,i)_"</OPTION>"
  		set gnRet($i(gnRet))=select
	}
	set gnRet($i(gnRet))="</SELECT>"
	if NoWrite q $$$OK
	for i=1:1 {q:'$DATA(gnRet(i))  write gnRet(i)}
	$$$jsstart
		w "$( '#"_idSelect_"' ).selectmenu({ change: function( event, data ) { "_ONCHANGE_" }, width:"_width_" }).selectmenu('menuWidget');" ;;.selectmenu('refresh') .addClass('overflow');"
		w "$( '#"_idSelect_"-menu' ).css( 'max-height','500px');"
	$$$jsstop
	q $$$OK
]]></Implementation>
</Method>

<Method name="SelectObj">
<Description>
To objects in the selector for small samples 
Return in the same row or in the global
sql query
ONCHANGE = js function on the event in the ONCHANGE salestore
ValueList = list of fields for the output Value
gnRet - return the array by reference</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>sql,ONCHANGE="",ValueList="",gnRet,idSelect="selectmenu"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	kill gnRet
	set gn="^||TempPack"
	set selectNS="<SELECT id='"_idSelect_"' > "
	set selectNS=selectNS_" <OPTION  VALUE=''></OPTION>"
	set gnRet($i(gnRet))=selectNS
	set st=##class(apptools.core.sys).SaveSQL(sql,gn)
	if 'st quit st
	if ValueList="" set ValueList=$lg(@gn@(0),1)_","_$lg(@gn@(0),1) ///The first field of the query should be identificator
	set NameFieldVALUE=$p(ValueList,",",1)
	s ns=""
	for { s ns=$o(@gn@(ns)) Q:ns=""
		continue:ns<1
		set VALUE=$lg(##class(apptools.core.sys).GetValueGN(gn,ns,NameFieldVALUE),1)
		set OPTION=$e($lts(##class(apptools.core.sys).GetValueGN(gn,ns,$p(ValueList,",",2,*))," "),1,100)
		s select=" <OPTION "_$g(selected)_" VALUE="""_VALUE_""">"_OPTION_"</OPTION>"
  		set gnRet($i(gnRet))=select
	}
	set gnRet($i(gnRet))="</SELECT>"
	for i=1:1 {q:'$DATA(gnRet(i))  write gnRet(i)}
	$$$jsstart
		w "$( '#"_idSelect_"' ).selectmenu({ change: function( event, data ) { "_ONCHANGE_" }, width:1000 }).selectmenu('menuWidget');" ;;.selectmenu('refresh', true).addClass('overflow');"
		w "$( '#"_idSelect_"-menu' ).css( 'max-height','500px');"
	$$$jsstop
	quit $$$OK
]]></Implementation>
</Method>

<Method name="BlockUI">
<Description>
To block or unblock the screen
do ##class(apptools.core.Form).BlockUI(1,"Loading form")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>mode=1,msg="...Loading"</FormalSpec>
<Implementation><![CDATA[
 $$$jsstart 
  w:mode $$$blockui(msg)
  w:'mode "$.unblockUI();"
 $$$jsstop
 q $$$OK
]]></Implementation>
</Method>

<Method name="Show">
<Description>
Show object 
Obj - the class instance
Mode = 0 safe mode
Mode = 1 edit mode with all buttons
Mode = "1,WithoutSave,WithoutDel,WithCreate,WithoutRef" edit mode without buttons
Mode = "1,ShowFieldName" - show the field names</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>obj,Mode=0,PrefixIdDIV="",orderProp=""</FormalSpec>
<Implementation><![CDATA[
	if '$isobject(obj) w $$$aText("No object","") quit
	set st=..GetPropertyDefinition(obj,.gn)
	if 'st w $System.Status.GetErrorText(st) quit  ;##class(%Library.Global).Quote(
	if orderProp=""	set orderProp=obj.#AppORDERPROPERTY
	write "<table>"
	// An ordered display of fields
	if orderProp'="" {
		if orderProp[":" { ;In multiple columns
			for ii=1:1:$l(orderProp,":") { s col=$ZStrip($p(orderProp,":",ii),"<>WCP")
				continue:col=""
				write "<tr>"
				for i=1:1:$l(col,",") { s nameProp=$ZStrip($p(col,",",i),"<>WCP")
			 		if nameProp="" w "<td></td><td></td>" continue
					do ..ShowProp(obj,nameProp,.gn,PrefixIdDIV,Mode)
				}
				write "</tr>"
			}
		}
		else { ;in one column
			for i=1:1:$l(orderProp,",") { s nameProp=$ZStrip($p(orderProp,",",i),"<>WCP")
			 	continue:nameProp=""
			 	write "<tr>"
				do ..ShowProp(obj,nameProp,.gn,PrefixIdDIV,Mode) ;gn("Properties")
				write "</tr>"
			}
		}
	} //the output fields by default
	else {
		set p=""
		for  { s p=$o(gn("Properties",p)) q:p=""  ;q:'$d(@gn@(p))  
			write "<tr>"
			do ..ShowProp(obj,p,.gn,PrefixIdDIV,Mode)
			write "</tr>"
		}
	}
	write "<tr><td style='text-align: right;'>"
		;set onclick="AppAct('"_PrefixIdDIV_"MainForm','"_PrefixIdDIV_"MainContent','AppAct="_$zu(5)_":"_..%ClassName(1)_":*:&objId="_obj.%Id()_"&ClassName="_obj.%ClassName(1)_"&pref="_PrefixIdDIV_"&mode="_Mode_"');"
		set onclick=##class(apptools.core.Action).WriteAppAct(%request,PrefixIdDIV_"MainForm",PrefixIdDIV_"MainContent",$zu(5),..%ClassName(1),"*","&objId="_obj.%Id()_"&ClassName="_obj.%ClassName(1)_"&pref="_PrefixIdDIV_"&mode="_Mode)
		
		if Mode {
			
			if Mode'["WithoutSave" {
				set buttval=$s(obj.%Id()'="":$$$aText("Save",""),1:$$$aText("Create",""))
				do ..ButtonMake(buttval,$replace(onclick,"*","ObjectSave"),"appButtonSave") ;ObjectSaveAsNew
			}
			if Mode'["WithoutDel" {
				if obj.%Id() w "&nbsp; " d ..ButtonMake($$$aText("Delete",""),"if (confirm('"_$$$aText("Delete, are you sure?","")_"')) { "_$replace(onclick,"*","ObjectDelete")_"}","appButtonDelete")
			}
			if obj.%Id(),Mode["WithCreate" {
			  w "&nbsp; " do ..ButtonMake($$$aText("Save As New",""),$replace(onclick,"*","ObjectSaveAsNew"),"appButtonSaveAsNew")
			}
		}
		if Mode'["WithoutCancel" {
			write "</td><td style='text-align: left;'>"
				do ..ButtonMake($$$aText("Cancel",""),"","appButtonCancel")
			write "</td><tr>"
		}
	write "</table>"
	;do ##class(apptools.core.Form).BlockUI(0)
	quit $$$OK
]]></Implementation>
</Method>

<Method name="ButtonRef">
<Description>
Bring the first button</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>value={$$$aText("Begin","")},onclick="top.document.location.reload();",id="appButtonRef"</FormalSpec>
<Implementation><![CDATA[
	do ..ButtonMake(value,onclick,id)
	quit $$$OK
]]></Implementation>
</Method>

<Method name="ButtonBack">
<Description>
Display back button</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>value={$$$aText("Back","")},onclick="window.history.back();",id="appButtonBack"</FormalSpec>
<Implementation><![CDATA[
	do ..ButtonMake(value,onclick,id)
	quit $$$OK
]]></Implementation>
</Method>

<Method name="ButtonMake">
<Description>
Withdraw button</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>value="",onclick="",id,title=""</FormalSpec>
<Implementation><![CDATA[
  	write $$$appButton(id,"onclick="""_$g(onclick)_""" "_$s(title="":"",1:"title="""_title_""""),value)
  	;w " <input id='appButtonSave' class='ui-button ui-corner-all ui-widget' type=button onclick='"_$g(onclick)_"' value='"_value_"'>"
	quit $$$OK
]]></Implementation>
</Method>

<Method name="GetValueByName">
<Description>
get parameter value by name
ExtProp=1 to extended properties, for example for the type of file
if ##class(apptools.core.Form).GetValueByName("apptools.core.Parameter","TestFiles","Value",.Val,1) zwrite Val</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[class,name,NameField="Value",&Val,ExtProp=0,field="Name"]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	KILL Val
	set Val=""
	set st=$$$OK
	s gn="^||tmpGetValueName"
	set tab=##class(apptools.core.type).GetTableName(class)
	s st=##class(apptools.core.sys).SaveSQL("select top 1 * from "_tab_" where "_field_"='"_name_"'",gn)
	if 'st quit st
	i $g(@gn@(-1,NameField))="" q $$$ERROR($$$GeneralError,"undefined field: "_NameField)
 	i '$d(@gn@(1)) q $$$ERROR($$$GeneralError,"undefined "_name)
 	s Val=$lg(@gn@(1),@gn@(-1,NameField))
 	if ExtProp {
	 	set id=##class(apptools.core.sys).GetValue(gn,1,"ID")
	 	set obj=##class(apptools.core.Form).GetObj(id_","_class)
	 	if $isobject(obj) {
			set st=..GetPropertyDefinition(obj,.prop)
			if 'st quit st
			m Val("Properties")=prop("Properties",NameField)
			d ..GetJsonProp(obj, NameField, .prop, .pr)
			m Val("PropJson")=pr
			m Val("obj")=obj
			if $g(pr("inputpattern"))="files" {
				set comp=..WebCompShowFiles(obj,.pr,0,NameField,Val,.Ext)
				m Val=Ext
			}
	 	}
 	}
	q st
]]></Implementation>
</Method>

<Method name="GetValueProperty">
<Description>
s Val="value" d ##class(apptools.core.Form).GetValueProperty(obj, "FileKP1",.Val)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[obj,NameField,&Val]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set st=..GetPropertyDefinition(obj,.prop)
	if 'st quit st
	m Val("Properties")=prop("Properties",NameField)
	d ..GetJsonProp(obj, NameField, .prop, .pr)
	m Val("PropJson")=pr
	m Val("obj")=obj
	if $g(pr("inputpattern"))="files" {
		set comp=..WebCompShowFiles(obj,.pr,0,NameField,$g(Val),.Ext)
		m Val=Ext
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="GetValueByIdField">
<Description>
get parameter value by identifier
ExtProp=1 to extended properties, for example for the type of file
if ##class(apptools.core.Form).GetValueByIdField("apptools.core.Parameter","15","ImageFile",.Val,1) zwrite Val</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[class,id,NameField,&Val,ExtProp=0]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[ return ..GetValueByName(class,id,NameField,.Val,1,"ID")
]]></Implementation>
</Method>

<Method name="DrawTable">
<Description>
Display a table from a matrix
do ##class(apptools.core.Form).DrawTable(.matrix) </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>matrix,cols="",rows=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set r=$o(matrix(""))
	quit:r="" $$$OK
	&html<
 <table>
    <thead>
      <tr>
        <th></th>>
        s c=""
        for { set c=$o(matrix(r,c)) quit:c=""
        	write "<th>"_$g(matrix(r,c))_"</th>"
        }
      &html<
      </tr>
    </thead>
    <tbody>
>
     for { set r=$o(matrix(r)) quit:r=""
     	set c=""
     	set first=1
     	write "<tr>"
 		for { set c=$o(matrix(r,c)) quit:c=""
        	if first {
	        	write "<th>"_$g(matrix(r,c))_"</th>" set first=0
        	}
        	else {
         		write "<td>"_$g(matrix(r,c))_"</td>"
        	}
 		}
 		write "</tr>"
       }
    &html<
    </tbody>
   </table>
	>
]]></Implementation>
</Method>
</Class>


<Routine name="apptools.core" type="INC" timestamp="65895,29775.061119"><![CDATA[
#Include %occMessages
#include %occReference

#;App. -> apptools.
#;apptools.core.LogMacro -> apptools.core

#; Escape sequence for coloring the font in terminal do ##class(apptools.core.msg).EscColor()
#define escClear $c(27)_"[0m"
#define escBg $Case(##class(apptools.core.msg).ZPMColorScheme(),"white":47,"dark":40,:0)
#define escGreen(%t) $Select($$$escBg=0:%t,1:$c(27)_"[1;32;"_$$$escBg_"m"_%t_$$$escClear)
#define escBlue(%t) $Select($$$escBg=0:%t,1:$c(27)_"[1;36;"_$$$escBg_"m"_%t_$$$escClear)
#define escDefault(%t) $Select($$$escBg=0:%t,1:$c(27)_"[1;3"_$Select($$$escBg:0,1:7)_";"_$$$escBg_"m"_%t_$$$escClear)
#define escYellow(%t) $Select($$$escBg=0:%t,1:$c(27)_"[1;33;"_$$$escBg_"m"_%t_$$$escClear)
#define escViolet(%t) $Select($$$escBg=0:%t,1:$c(27)_"[1;35;"_$$$escBg_"m"_%t_$$$escClear)
#define escSeq(%e,%t) $Select($$$escBg=0:%t,1:$c(27)_"["_%e_"m"_%t_$$$escClear)

#;%from - id form for serialize elements
#;%to - id div output result
#;%ns - namespase class
#;%class - classname
#;%method - method executed
#;%arg - string cgi variables 
#define onclick(%from,%to,%ns,%class,%method,%arg) ##class(apptools.core.Action).WriteActJs(%request,%from,%to,%class,%method,%arg,%ns) 
#define SetHeightContent(%id,%d) $$$jsstart w $$$NL write "$('#"_%id_"MainContent').height($(window).height()-($('#"_%id_"MainHeader').height()+$('#t1').height()+"_%d_"));"_$$$NL $$$jsstop w $$$NL

#;Include %msql $$$MaxStringLength
#;		;2016.2<= set title={}.%FromJSON(json).title 
#;		;2016.1 set title={}.$fromJSON(json).title
#;		set title={}.$$$jsonFromJSON(json).title
#define R(%property) %request.Content.##Expression(%property)
#define RG(%property) %request.Get(%property)
#define StackPlace 		$st($st(-1),"PLACE")
#define CurrentClass 	##Expression($$$quote(%classname))
#define CurrentMethod 	##Expression($$$quote(%methodname))
#define slash $s($zversion(1)=3:"/",1:"\")
#define FileTempDir	$zu(140,17)

#define formatJSON 		"aelotwc"
#define formatJSONSQL	"tw"
#define formatDate		3
#define formatTime		7

#define toJSONClassMethod "toJSON"
#define updateClassMethod "updateIdFromObject"
#define IsNewJSON ##Expression($$$comClassDefined("%Library.DynamicAbstractObject"))

#if $$$IsNewJSON
    #define NewDynObj {}
    #define NewDynDTList []
    #define NewDynObjList $$$NewDynDTList
    #define Insert(%obj,%element) do %obj.%Push(%element)
    #define DynObjToJSON(%obj) w %obj.%ToJSON()
    #define ListToJSON(%obj) $$$DynObjToJSON(%obj)
    #define ListSize(%obj) %obj.%Size()
    #define ListGet(%obj,%i) %obj.%Get(%i-1)
    #define jsonClassIsLatestVersion %ClassIsLatestVersion 	
    						//usage: obj.$$$jsonClassIsLatestVersion()
    #define jsonExtends %Extends							
    						//usage: {}.$$$jsonExtends(classname) 
    #define jsonFromJSON %FromJSON							
    						//usage: {}.$$$jsonFromJSON(string) 
    #define jsonGetIterator %GetIterator 					
    						//usage: obj.$$$jsonGetIterator()
	#define jsonGetNext %GetNext 					
    						//usage: iterator.$$$jsonGetNext(.key, .value)
	#define jsonIsA %IsA									
    						//usage: obj.$$$jsonIsA(className)
    #define jsonToJSON %ToJSON								
    						//usage: obj.$$$jsonToJSON()
    #define jsonGet %Get									
    #define jsonNew %New									
    						//usage: obj.$$$jsonGet(key)
    #define jsonIsDefined %IsDefined						
    						//usage: obj.$$$jsonIsDefined(key) 
    #define jsonRemove %Delete								
    						//usage: obj.$$$jsonRemove(key)
    #define jsonSet %Set									
    						//usage: obj.$$$jsonSet(key, val)
    #define jsonSize %Size									
    						//usage: obj.$$$jsonSize()
    #define jsonPop %Pop									
    						//usage: obj.$$$jsonPop()
    #define jsonPush %Push									
    						//usage: obj.$$$jsonPush(val) 
	#define jsonAbstractClass %Library.AbstractDynamicObject
	#define jsonObjectClass %Library.DynamicObject
	#define jsonArrayClass %Library.DynamicArray
	
	#define jsonInitialArrayIndex 1
	
	#define jsonGetTypeOf %GetTypeOf
    						//usage: obj.$$$jsonGgetTypeOf()
#else
    #define NewDynObj ##class(%ZEN.proxyObject).%New()
    #define NewDynDTList ##class(%ListOfDataTypes).%New()
    #define NewDynObjList ##class(%ListOfObjects).%New()
    #define Insert(%obj,%element) do %obj.Insert(%element)
    #define DynObjToJSON(%obj) do %obj.%ToJSON()
    #define ListToJSON(%obj) do ##class(%ZEN.Auxiliary.jsonProvider).%ObjectToJSON(%obj)
    #define ListSize(%obj) %obj.Count()
    #define ListGet(%obj,%i) %obj.GetAt(%i)

   #define jsonClassIsLatestVersion $classIsLatestVersion 	
    						//usage: obj.$$$jsonClassIsLatestVersion()
    #define jsonExtends $extends							
    						//usage: {}.$$$jsonExtends(classname) 
    #define jsonFromJSON $fromJSON							
    						//usage: {}.$$$jsonFromJSON(string) 
    #define jsonGetIterator $getIterator 					
    						//usage: obj.$$$jsonGetIterator()
    #define jsonGetNext $getNext 					
    						//usage: iterator.$$$jsonGetNext(.key, .value)
    #define jsonIsA $isA									
    						//usage: obj.$$$jsonIsA(classname)
    #define jsonToJSON $toJSON								
    						//usage: obj.$$$jsonToJSON()
    #define jsonGet $get									
    #define jsonNew $new									
    						//usage: obj.$$$jsonGet(key)
    #define jsonIsDefined $isDefined						
    						//usage: obj.$$$jsonIsDefined(key) 
    #define jsonRemove $remove								
    						//usage: obj.$$$jsonRemove(key)
    #define jsonSet $set									
    						//usage: obj.$$$jsonSet(key, val)
    #define jsonSize $size									
    						// usage: obj.$$$jsonSize()
    #define jsonPop $pop									
    						//usage: obj.$$$jsonPop()
    #define jsonPush $push									
    						//usage: obj.$$$jsonPush(val) 
 	#define jsonAbstractClass %Library.AbstractObject
	#define jsonObjectClass %Library.Object
	#define jsonArrayClass %Library.Array
	#define jsonInitialArrayIndex 0
	#define jsonGetTypeOf $getTypeOf
    						//usage: obj.$$$jsonGgetTypeOf()
#endif


#def1arg jsonIsAbstract %IsA(##Quote($$$jsonAbstractClass))
							//usage: obj.$$$jsonIsAbstract
#def1arg jsonIsObject %IsA(##Quote($$$jsonObjectClass))
							//usage: obj.$$$jsonIsObject
#def1arg jsonIsArray %IsA(##Quote($$$jsonArrayClass))
							//usage: obj.$$$jsonIsArray

#define MethodArguments ##Expression(##class(apptools.core.Log).GetMethodArguments(%classname,%methodname))

#define LogEvent(%type, %message) Do ##class(apptools.core.Log).AddRecord($$$CurrentClass,$$$CurrentMethod,$$$StackPlace,%type,$$$MethodArguments,%message)
#define LogNone(%message) 		$$$LogEvent("NONE", %message)
#define LogError(%message) 		$$$LogEvent("ERROR", %message)
#define LogFatal(%message) 		$$$LogEvent("FATAL", %message)
#define LogWarn(%message) 		$$$LogEvent("WARN", %message)
#define LogInfo(%message) 		$$$LogEvent("INFO", %message)
#define LogStat(%message) 		$$$LogEvent("STAT", %message)
#define LogDebug(%message) 		$$$LogEvent("DEBUG", %message)
#define LogRaw(%message) 		$$$LogEvent("RAW", %message)

#; To obtain the date and time in $h
#define LoggedDT(%h) $s(%h[",":$tr($zd(%h,4),"/",".")_" "_$zt(+$p(%h,",",2),1),1:"")

#; the macro saves the node in the global call stack and all local variables 
#; Example of usage: /apptools/apptools.core.LogInfo.cls?WHAT=?
#; If you need a trap for a particular process, to assign s ^logFIO(0)=Number of process
#define LogEventAddGN(%debubGN, %message) s %AppLogId=##class(apptools.core.Log).AddRecord($$$CurrentClass,$$$CurrentMethod,$$$StackPlace,"DEBUG",%debubGN,%message)
#define logdevGN 	"^log"
#define MgtPortalSettings 	"^CacheTemp.MgtPortalSettings"
#define AppLogTab(%type,%message,%desc) Do ##class(apptools.core.Log).AddRecord($$$CurrentClass,$$$CurrentMethod,$$$StackPlace,%type,%desc,%message)
#define AppLog(%dev,%node,%list,%mode) s zsr=$zr,zsG=$$$logdevGN_%dev  if $g(@zsG@(0))=$j||($g(@zsG@(0))="") { s @zsG@(1,$i(@zsG),%node)=%list,zsGzr=$zr if %mode["t" { $$$LogEventAddGN(zsGzr,%list) } if %mode["s" {s zsG=$na(@($qs(zsGzr,0)_"stack")@($qs(zsGzr,2))),@zsG=$lb($ze,$h,$tl,$io,$j,$zu(110),##class(apptools.core.LogInfoPane).GetPathStack(),##class(apptools.core.Log).GetClientAddress()) S zs1="",zsG=$na(@zsG@("varList")),zsii=0 k @zsG s:%mode["e" @zsG@("%%%$$LOG^%ETN")=$$LOG^%ETN  if %mode["v" { f { s zs1=$O(@zs1) q:zs1=""  continue:$e(zs1,1,2)="zs"&&(zs1'="zs")  if $d(@zs1)'["0",$isobject(@zs1) { s @zsG@(zs1)=##class(apptools.core.Log).SerializeObject(@zs1,$na(@zsG@(zs1))),zsii=zsii+1 } elseif $d(@zs1)>9 {s:$d(@zs1)=11 @zsG@(zs1)=@zs1,zsii=zsii+1 MERGE @zsG@(zs1)=@zs1 if zs1="%zlog" {s zs2="" for {s zs2=$o(@zs1@(zs2)) q:zs2=""   s @zsG@(zs1,zs2)=##class(apptools.core.Log).SerializeObject($G(@zs1@(zs2)),$na(@zsG@(zs1,zs2)),%mode)   }}}	 elseif $d(@zs1)=1 {s @zsG@(zs1)=@zs1,zsii=zsii+1}} s @zsG=zsii KILL zsii,zsG,zs1,zs2}else{KILL zsii,zsG,zs1,zs2,zsGzr}} try{ if $d(@zsr) KILL zsr} catch e { KILL zsr}}
#; To add an active link to the panel
#define addAppLog(%text,%title,%input,%target) "<a title='"_%title_"' "_$g(%target)_" href=""apptools.core.LogInfo.cls?NSP="_$zu(5)_"&WHAT="_$zconvert(%input,"O","URL")_""">"_%text_"</a>"
#define addAppL(%text) "<a target="""_$ZCRC(%text,7)_""" href=""apptools.core.LogInfo.cls?NSP="_$zu(5)_"&WHAT="_$zconvert(%text,"O","URL")_""">"_%text_"</a>"
#define addLoadLogInfo(%text,%title,%input,%http) "<a title='"_%title_"' target=LogInfo"_$tr($zts,",.")_" href="""_%http_"apptools.core.LogInfo.cls?NSP="_$zu(5)_"&WHAT="_$zconvert(%input,"O","URL")_""">"_%text_"</a>"

#; To obtain the date and time YYYY-MM-DD HH:MM:SS
#define AppDT(%h) $zd(+%h,3)_" "_##class(apptools.core.type).GetValidZT(%h)
#define AppObJs(%ob)  $s($isobject(%ob):##class(apptools.core.Log).WriteJSONFromObject(%ob),1:%ob)
#define ApplogGN(%fio) ("^log"_$zconvert($e(%fio,1,3),"U"))
#;define AppL(%fio,%node) @$$$ApplogGN(%fio)@($i(@$$$ApplogGN(%fio)),$$$AppDT($h)_" "_%node)
#define AppL(%fio,%node) @$$$ApplogGN(%fio)@($i(@$$$ApplogGN(%fio)),$$$AppDT($h)_" ("_$classname()_")."_%node)

#define forAll(%in,%gn) s gn%in=$na(%gn) s %in="" f { s %in=$o(@gn%in@(%in)) q:%in=""
#define forAllk(%in,%kn,%gn) s gn%in=$na(%gn) s %in="" f %kn=1:1 { s %in=$o(@gn%in@(%in)) q:%in=""
#define forEnd  }

#; keep the name of the current region
#define NspGoto(%cur,%ns)  s %cur=$zu(5) try {zn %ns} catch e {} 
#; to return to the current region
#define NspReturn(%cur)  zn %cur
#;---------- layout
#;
#define appStyleInput " style='border: none;	background: none;	color: inherit;	padding: .222em 0;	margin: .2em 0;	vertical-align: middle;	margin-left: .4em;	margin-right: .4em;' "
#define appInputHidden(%id,%attr,%val) "<input type=hidden "_%attr_" id='"_%id_"' name='"_%id_"' value='"_%val_"'>"
#define appText(%id,%attr,%val) "<span class='ui-spinner ui-corner-all ui-widget ui-widget-content'><input autocomplete='off' "_$$$appStyleInput_" type=text "_%attr_" id='"_%id_"' name='"_%id_"' value='"_%val_"'></span>"
#define appAutocomplete(%id,%attr,%val) "<span class='ui-spinner ui-corner-all ui-widget ui-widget-content'><input id='"_%id_"' name='"_%id_"' "_%attr_" "_$$$appStyleInput_" autocomplete='off' value='"_%val_"'>"
#define appAutocomplete2(%id,%attr,%val) "<input id='"_%id_"' name='"_%id_"' "_%attr_" class='ui-autocomplete-input' autocomplete='off' value='"_%val_"'>"
#define appInput(%id,%attr,%val) "<span class='ui-spinner ui-corner-all ui-widget ui-widget-content'><input autocomplete='off' "_$$$appStyleInput_" "_%attr_" id='"_%id_"' name='"_%id_"' value='"_%val_"'></span>"
#define appButton(%id,%attr,%val) $s($g(%ui):"<button class='uk-button uk-button-primary uk-margin-small-right' type='button' "_%attr_" id='"_%id_"' name='"_%id_"' >"_%val_"</button>",1:"<input class='ui-button ui-corner-all ui-widget' type=button id='"_%id_"' name='"_%id_"' "_%attr_" value='"_%val_"'>")
#define appTextarea(%id,%attr,%val) "<span class='ui-spinner ui-corner-all ui-widget ui-widget-content'><textarea autocomplete='off' "_$$$appStyleInput_" "_%attr_" id='"_%id_"' name='"_%id_"' >"_%val_"</textarea></span>"
#define appDate(%id,%attr,%val) "<span class='ui-spinner ui-corner-all ui-widget ui-widget-content'><input autocomplete='off' "_$$$appStyleInput_" type=date "_%attr_" id='"_%id_"' name='"_%id_"' value='"_%val_"'></span>"
#define appDateTime(%id,%attr,%val) "<span class='ui-spinner ui-corner-all ui-widget ui-widget-content'><input autocomplete='off' "_$$$appStyleInput_" type=datetime-local "_%attr_" id='"_%id_"' name='"_%id_"' value='"_%val_"'></span>"
#;define appCheck(%id,%attr,%val) "<input class='ui-button ui-corner-all ui-widget' type=checkbox id='"_%id_"' name='"_%id_"' "_%attr_" value='"_%val_"'>"
#define appCheck(%id,%attr,%val) "<input class='bigbox' type=checkbox id='"_%id_"' name='"_%id_"' "_%attr_" value='"_%val_"'>"
#define appSelect(%id,%attr,%val) ""
#define appError(%val) "<div class='ui-widget'><div class='ui-state-error ui-corner-all' style='margin-top: 20px; padding: 1em;'><p><span class='ui-icon ui-icon-alert' style='float: left; margin-right: 3em;'></span>"_%val_"</p></div></div>"
#define appMsg(%val) "<div class='ui-widget'><div class='ui-state-highlight ui-corner-all' style='margin-top: 20px; padding: 1em;'><p><span class='ui-icon ui-icon-info' style='float: left; margin-right: 3em;'></span>"_%val_"</p></div></div>"

#define appTableAttr "style=""border-radius: 10px; border: 1px solid #72a7cf"" cellpadding=2 cellspacing=0 class=""DetailTable"" bgcolor=""#c4d6d6"" width=""90%"""
#define appTable1(%n1) "<table "_$$$appTableAttr_"><tbody><tr><th>"_%n1_"</th></tr>"
#define appTableTrTd1(%n1) "<tr class=""trs"" ><td align=""center"" >"_%n1_"</td></tr>"
#define appTableEnd1 "</tbody></table>"_$s('$d(%DrawArray):"<script language='javascript'>$('.trs').hover(function(){ $(this).toggleClass( 'ui-widget-content' ) });</script>",1:"")

#define appTable2(%n1,%n2) "<table "_$$$appTableAttr_"><tbody><tr><th align=""left"" width=""5px"">"_%n1_"</th><th align=""left"" width=""50px"">"_%n2_"</th></tr>"
#define appTableTrTd2(%n1,%n2) "<tr class=""trs"" ><td align=""left"" >"_%n1_"</td><td>"_%n2_"</td></tr>"
#define appTableEnd2 "</tbody></table>"_$s('$d(%DrawArray):"<script language='javascript'>$('.trs').hover(function(){ $(this).toggleClass( 'ui-widget-content' ) });</script>",1:"")

#define appTable3(%n1,%n2,%n3) "<table "_$$$appTableAttr_"><tbody><tr><th align=""left"" width=""5px"">"_%n1_"</th><th align=""left"" width=""50px"">"_%n2_"</th><th align=""left"" width=""50px"">"_%n3_"</th></tr>"
#define appTableTrTd3(%n1,%n2,%n3) "<tr class=""trs"" ><td style=""text-align:left"" >"_%n1_"</td><td style=""text-align:left"" >"_%n2_"</td><td style=""text-align:left"" >"_%n3_"</td></tr>"
#define appTableEnd3 "</tbody></table>"_$s('$d(%DrawArray):"<script language='javascript'>$('.trs').hover(function(){ $(this).toggleClass( 'ui-widget-content' ) });</script>",1:"")

#define appTab3(%n1,%n2,%n3) "<table cellpadding=2 cellspacing=0 border=1 class=""DetailTable"" width=""90%""><tbody><tr><th align=""left"" width=""5px"">"_%n1_"</th><th align=""left"" width=""50px"">"_%n2_"</th><th align=""left"" width=""50px"">"_%n3_"</th></tr>"

#define jsbegin "<script language='javascript'>"_$$$NL
#define jsend "</script>"_$$$NL
#define jsstart write $$$jsbegin
#define jsstop write $$$jsend
#define styleurl "text-decoration:underline; color:blue; cursor:hand;"
#define blockui(%msg)  "$.blockUI( { message: '"_%msg_"' , css: { border: 'none', padding: '15px', backgroundColor: '#000', '-webkit-border-radius': '10px','-moz-border-radius': '10px', opacity: .5, color: '#fff' }} );"

#define Msg(%c,%t) "<span class='brand-text font-weight-light' style='color:"_%c_"'>"_%t_"</span><br>"
#define Message(%t) "<span class='brand-text font-weight-light'>"_%t_"</span><br>"
#define MessErr(%t) "<span class='brand-text font-weight-light' style='color:hotpink'>"_%t_"</span><br>"

#;	Localization
#define GNLangDOMAIN "AppTools"

#define GNEnsConf "^%apptools.Setting"
#define EnsProductStatusRun $g(@$$$GNEnsConf@("EnsProductStatusRun"),"Running")

/// Global history of command
#define HISTORYGN "^%apptools.History"
/// Global tempory data
#define TEMPORYGN "^mtempAppData"
/// Global projects in the system
#define PROJGN "^%apptools.Proj"
#define GNExtentions "^%apptools.Exten"
/// Global tempory data for Journals
#define TEMPJRNL "^%apptools.JRNL"
/// Limiting the number of nodes in a global or query result for output
#define MAXSHOW 10000

#;;; Parameters dependent on the installation server
#define GNLang "^%AppCacheMsg"
#; Path to CSP apps "/apptools/"
#define  PATHCSP $GET(@$$$GNEnsConf@("PATHCSP")) 
#; Mail Server Settings
#define  EMAILSERVERIP $GET(@$$$GNEnsConf@("EMAILSERVERIP"))
#define  EMAILSERVERPORT $GET(@$$$GNEnsConf@("EMAILSERVERPORT"))
#; Authorization in the mail server
#define  EMAILAUTH $GET(@$$$GNEnsConf@("EMAILAUTH")) 
#define  EMAILAUTHPASS $GET(@$$$GNEnsConf@("EMAILAUTHPASS"))
#; Technical support admin address
#define  EMAILSUPPORT $G(@$$$GNEnsConf@("EMAILSUPPORT")) 
#; Path for temporary xls file before sending to mail
#define  EMAILXLSPATH $G(@$$$GNEnsConf@("EMAILXLSPATH"))
#; Path to storing project sources
#define  EXPORTPROJPATH $G(@$$$GNEnsConf@("EXPORTPROJPATH")) 

#; --------------- Application section
#define GNmessages "^%apptools.cconsolelog"
#define DubledQuote(%s)	$replace(%s,"'","''")


#If $DATA(^%apptools.Proj("infoservice-focus"))
#define  TESTSERVER "-test"
#define DEVELOPER "mihaylenko_sv"
#; The module display links to the administrative application panel
#define  DRAWAllApp ##class(apptools.MVK.docbook).GetAllApp(0)
#define SDNum if $g(SDNum)'="" write:##class(apptools.core.sys).ClassExist("apptools.MVK.docbook") "<br>"_##class(apptools.MVK.docbook).FindSDRef(SDNum)
#define aText(%en,%ru) ##Expression(##class(apptools.core.msg).AddLangMsg(%en,%ru))
#define  MultiLang 1
#define  JSLibLocal 1

#Else 
#define  TESTSERVER " "
#define DEVELOPER "admin"
#; The module display links to the administrative application panel
#define  DRAWAllApp " "
#define SDNum  
#define aText(%en,%ru) %en
#define  MultiLang 0
#define  JSLibLocal 0

#EndIf



]]></Routine>


<Class name="apptools.core.Installer">
<Description>
Importing this class will install App Tools properly.
fork from WebTerminal </Description>
<IncludeCode>apptools.core</IncludeCode>
<Super>%Projection.AbstractProjection</Super>
<TimeChanged>65810,81375.532712</TimeChanged>
<TimeCreated>65607,76509.816379</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="DispatchClass">
<Default>apptools.core.rest</Default>
</Parameter>

<Parameter name="ResourceName">
<Default>%apptools</Default>
</Parameter>

<Parameter name="RoleName">
<Default>apptools</Default>
</Parameter>

<Parameter name="AppRest">
<Default>apptoolsrest</Default>
</Parameter>

<Parameter name="AppCSP">
<Default>apptools</Default>
</Parameter>

<Parameter name="AppName">
<Default>apptools</Default>
</Parameter>

<Projection name="Reference">
<Type>Installer</Type>
</Projection>

<Parameter name="VERSION">
<Default>1.0</Default>
</Parameter>

<Method name="CreateProjection">
<Description>
This method is invoked when a class is compiled.
 d ##class(apptools.core.Installer).CreateProjection()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[cls:%String,&params]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $Namespace
	set ns = $Namespace // ought to be package home namespace!
	if $g(@$$$GNEnsConf@("HomeNamespace"))'="",$g(@$$$GNEnsConf@("HomeNamespace"))'=ns {
		QUIT $$$OK
	}
	if $g(@$$$GNEnsConf@("HomeNamespace"))="" {
	;Filling the global default values
	 set @$$$GNEnsConf@("EMAILAUTH")="user_from_send_mail@server.com"
	 set @$$$GNEnsConf@("EMAILAUTHPASS")=12345
	 set @$$$GNEnsConf@("EMAILSERVERIP")="127.0.0.1"
	 set @$$$GNEnsConf@("EMAILSERVERPORT")=25
	 set @$$$GNEnsConf@("EMAILSUPPORT")="user_to_send_mail@server.com"
	 set @$$$GNEnsConf@("EMAILXLSPATH")="c:\temp\"
	 set @$$$GNEnsConf@("EXPORTPROJPATH")="c:\temp\source\"
	 set @$$$GNEnsConf@("Language")="en"
	 set @$$$GNEnsConf@("PATHCSP")="/"_..#AppCSP_"/"
	 ;set @$$$GNEnsConf@("EnsProductStatusRun")="Run" 
			
	}
    set @$$$GNEnsConf@("HomeNamespace") = ns
    write !, "Installing "_..#AppName_" application to " _ ns
    set dbdir = $$$defdir
    $$$NspGoto(curNs,"%SYS")
    try {
        set $Namespace = "%SYS"
    } catch (e) {
        set mes = "<PROTECT> The user " _ $Username _ " has no privileges"
            _ " to enter the %SYS namespace. Please, log in as a privileged user"
            _ " to set up the "_..#AppName_" application."
        set err = $$$ERROR($$$GeneralError, mes)
        write !, mes
        return err
    }

   	set result=##CLASS(%ResultSet).%New("%DynamicQuery:SQL")
	set tSC=result.Prepare("select * FROM Security.Applications where Name=?")
	set:tSC tSC=result.Execute("/csp/"_ns)
	if '$$$ISOK(tSC) {
		set text="Error application :"_$SYSTEM.Status.GetErrorText(tSC)  w !,text QUIT $$$ERROR(text)
	}
	else {
		while result.Next() {
			set cspProperties("Path")=result.Data("Path")
		}
	}
	if ns="IRISAPP" set cspProperties("Path")="/opt/irisapp/web/",IsNameSpaceDefault=1 ;Docker
    if '$data(cspProperties("Path")) {
	    set tempdir=$p($zu(12),$$$slash,1,*-2)_$$$slash_$s($zversion(1)=3:"csp",1:"CSP")_$$$slash_ns
		write !,"Create directory ",tempdir
		set st=##class(%File).CreateDirectory(tempdir)
		if 'st w !,"Error creating directory " ; quit $$$OK
	    set cspProperties("Path")=tempdir
    }
    set cspProperties("AutheEnabled") = $$$AutheCache ;$$$AutheUnauthenticated ;
    set cspProperties("NameSpace") = ns
    set cspProperties("Description") = "A WEB application for "_..#AppName_"."
    set cspProperties("IsNameSpaceDefault") = +$GET(IsNameSpaceDefault)
    set st = ..RegisterWebApplication("/"_..#AppCSP, .cspProperties)
    return:$$$ISERR(st) st
    
 
	set @$$$GNEnsConf@("CSP-Path")=cspProperties("Path")
	KILL cspProperties("Path")
	
    set cspProperties("AutheEnabled") = $$$AutheCache ;$$$AutheUnauthenticated
    set cspProperties("NameSpace") = ns
    set cspProperties("Description") = "A WEB application for "_..#AppName_"."
    set cspProperties("IsNameSpaceDefault") = $$$NO
    set cspProperties("DispatchClass") = ..#DispatchClass
    set st = ..RegisterWebApplication("/"_..#AppRest, .cspProperties)
    return:$$$ISERR(st) st
  	set @$$$GNEnsConf@("PATHCSP")="/"_..#AppCSP_"/"
    
    do ..CreateAllNamespace()
    
    write !, "Mapping "_..#AppName_" package into all namespaces:"
    set st = ..Map(ns,..#AppName)
    if ($$$ISERR(st)) {
        do $System.Status.DisplayError(st)
    } else {
	    write !, ""_..#AppName_" package successfully mapped into all namespaces."
    }

    if (##class(Security.Resources).Exists(..#ResourceName) = 0) {
        set st = ##class(Security.Resources).Create(..#ResourceName,
            "Grants access to "_..#AppName_" if set up.", "")
    }

    if (##class(Security.Roles).Exists(..#RoleName) = 0) {
        set st = ##class(Security.Roles).Create(..#RoleName,
            "AppTools user role which may grant access to /"_..#AppCSP_" application if set up.",
            ..#ResourceName_":RWU")
    }
	do ..AddExtentions()
	do ..AddFavorites()
	$$$NspReturn(curNs)
    return st
]]></Implementation>
</Method>

<Method name="AddExtentions">
<Description>
Add Extentions
do ##class(apptools.core.Installer).AddExtentions()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	// @$$$GNExtentions@( Namespace , FavoriteNode , Description )
	 for prep="tmp","log" {
	 	set @$$$GNExtentions@("%All","ShowGlobals^"_prep_"**","Desc")="ShowGlobals ^"_prep_"**"
	 	set ^("Xecute")="xec do ##class(apptools.core.Production).ShowGlobals(""^"_prep_"**"",##class(apptools.core.sys).ListNS(.info,""NotPre,Ens""))"
	 }
 	set @$$$GNExtentions@("%All","FindAndDrawAllQueue","Desc")="Watch all queues"
 	set ^("Xecute")="xec do ##class(apptools.core.Production).FindAndDrawAllQueue(##class(apptools.core.sys).ListNS(.info,""NotPre,Ens""))"

	 set @$$$GNExtentions@("%All","FindAndDrawAllErr","Desc")="Sample extension for all namespaces. Monitoring products in all namespaces with rapid transition to visual tracing"
	 set ^("Xecute")="xec d ##class(apptools.core.Production).FindAndDrawAllErr(""Select * from Ens_Util.Log where Type='2' and TimeLogged>'""_$zd($h-1,3)_"" 21:00' order by id desc"",##class(apptools.core.sys).ListNS(.info,""NotPre,Ens""))"
	 set @$$$GNExtentions@("DOCBOOK","Query DocBook.articl","Desc")=$lb("Sample extension for DOCBOOK namespaces. Query DocBook.articl")
	 set ^("Xecute")="select * From DocBook.article"
]]></Implementation>
</Method>

<Method name="AddFavorites">
<Description>
Add Favorites
do ##class(apptools.core.Installer).AddFavorites()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $namespace
	set $namespace="%SYS"
	set Status=##Class(Config.Startup).Get(.Properties)
	if Status s ServerPort="http://"_$zu(110)_":"_$g(Properties("WebServerPort"),52773) write !
    do ..AddAndWriteFavorite(..#AppName,"/"_..#AppCSP_"/apptools.core.LogInfo.cls",$g(ServerPort))
    do ..AddAndWriteFavorite(..#AppName_" Permission Matrx","/"_..#AppCSP_"/apptools.Tabs.PanelUikitPermissMatrx.cls?autoload=Matrix",$g(ServerPort))
    do:$$$JSLibLocal ..AddAndWriteFavorite(..#AppName_" Samples Admin Panel","/"_..#AppCSP_"/apptools.Tabs.PanelUikitAdmin.cls?autoload=Matrix",$g(ServerPort))
    do:$$$JSLibLocal ..AddAndWriteFavorite(..#AppName_" REST service Admin Panel","/"_..#AppCSP_"rest/get-html/apptools.Tabs.PanelUikitAdmin.cls?autoload=Find",$g(ServerPort))
]]></Implementation>
</Method>

<Method name="AddAndWriteFavorite">
<Description>
AddFavorite </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>name:%String,url,ServerPort</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    Set tSC = ##class(%SYS.Portal.Users).%AddFavorite(name,url) 
    if ServerPort'="" write !,ServerPort_url
]]></Implementation>
</Method>

<Method name="RegisterWebApplication">
<ClassMethod>1</ClassMethod>
<FormalSpec>name:%String,spec</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    new $Namespace
    set $Namespace = "%SYS"
    set st = $$$OK
    if ('##class(Security.Applications).Exists(name)) {
        write !,"Creating WEB application """_name_"""..."
        set st = ##class(Security.Applications).Create(name, .spec)
        write !, "WEB application """_name_""" is created."
    } else { // ensure configuration matches in case of updating from old terminal versions
        write !, "Updating web application """_name_"""..."
        set st = ##class(Security.Applications).Modify(name, .spec)
        write !, "WEB application """_name_""" is updated."
    }
    return st
]]></Implementation>
</Method>

<Method name="RemoveWebApplication">
<ClassMethod>1</ClassMethod>
<FormalSpec>name:%String</FormalSpec>
<Implementation><![CDATA[
    new $Namespace
    set $Namespace = "%SYS"
    set st = $$$OK
    if (##class(Security.Applications).Exists(name)) {
        do ##class(Security.Applications).Get(name, .props)
        if (props("DispatchClass") '= ..#DispatchClass) && (name = "/"_..#AppCSP) {
            write !, "Won't delete WEB-application """_name_""" because it does not refer to dispatch class anymore."
        } else {
            write !, "Deleting WEB application """_name_"""..."
            set st = ##class(Security.Applications).Delete(name)
            write !, "WEB application """_name_""" was successfully deleted."
        }
    }
    return st
]]></Implementation>
</Method>

<Method name="RemoveProjection">
<Description>
This method is invoked when a class is 'uncompiled'.</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[cls:%String,&params,recompile:%Boolean]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $Namespace

	write:(recompile) !, "Recompiling "_..#AppName_", skipping the deletion..."
    return:(recompile) $$$OK

	set ns = $get(@$$$GNEnsConf@("HomeNamespace"), $Namespace)
    write !, "Uninstalling "_..#AppName_" application from ", ns
    zn "%SYS"
    set st = ..RemoveWebApplication("/"_..#AppCSP)
    return:($$$ISERR(st)) st
    
    set st = ..RemoveWebApplication("/"_..#AppRest)
    return:($$$ISERR(st)) st
    
    if (##class(Security.Resources).Exists(..#ResourceName) = 1) {
        set st = ##class(Security.Resources).Delete(..#ResourceName)
        return:($$$ISERR(st)) st
    }
    if (##class(Security.Roles).Exists(..#RoleName) = 1) {
        set st = ##class(Security.Roles).Delete(..#RoleName)
        return:($$$ISERR(st)) st
    }

    kill:st @$$$GNEnsConf
    write !, "Global "_$$$GNEnsConf_" removed."

    kill:st @$$$GNLang
    write !, "Global "_$$$GNLang_" removed."

    write !, "Unmapping App package from all namespaces:"
	set st = ..UnMap(ns,..#AppName)
    if ($$$ISERR(st)) {
        do $System.Status.DisplayError(st)
       
    } else {
	    write !, "Unmapping complete."
    }

    return st
]]></Implementation>
</Method>

<Method name="CreateAllNamespace">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $Namespace
    set $Namespace = "%SYS"
	set ns = "%All"
	set st = $$$OK
	if ('##Class(Config.Namespaces).Exists(ns)) {

        if ($system.Version.GetISCProduct() >= 4) {
            set Properties("Globals") = "IRISTEMP"
            set Properties("Library") = "IRISLIB"
            set Properties("Routines") = "IRISTEMP"
            set Properties("SysGlobals") = "IRISSYS"
            set Properties("SysRoutines") = "IRISSYS"
            set Properties("TempGlobals") = "IRISTEMP"
        } else {
            set Properties("Globals") = "CACHETEMP"
            set Properties("Library") = "CACHELIB"
            set Properties("Routines") = "CACHETEMP"
            set Properties("SysGlobals") = "CACHESYS"
            set Properties("SysRoutines") = "CACHESYS"
            set Properties("TempGlobals") = "CACHETEMP"
        }
		
		set st = ##Class(Config.Namespaces).Create(ns, .Properties)
		if ($$$ISERR(st)) {
        	do $System.Status.DisplayError(st)
    	} else {
        	write !, "%All namespace is created."
    	}
	}
	return st
]]></Implementation>
</Method>

<Method name="Map">
<ClassMethod>1</ClassMethod>
<FormalSpec>fromNS="",Packet</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $Namespace
    set $Namespace = "%SYS"
    set st = $$$OK

    set mapTo = $LISTBUILD("%All", "SAMPLES", "DOCBOOK")
    do ##Class(Config.Namespaces).Get(fromNS, .InstallNSProps)
    set Properties("Database") = $get(InstallNSProps("Routines"))
    set ptr = 0
    while $LISTNEXT(mapTo, ptr, namespace) {
        continue:(fromNS = namespace)
        continue:('##Class(Config.Namespaces).Exists(namespace))
        write " ", namespace
        if ('##Class(Config.MapPackages).Exists(namespace, Packet)) {
        	set st1 = ##Class(Config.MapPackages).Create(namespace, Packet, .Properties)
        }
        if ('##Class(Config.MapGlobals).Exists(namespace, Packet)) {
	        set st2 = ##Class(Config.MapGlobals).Create(namespace, Packet, .Properties)
        }
        set st = $$$ADDSC(st,$$$ADDSC($get(st1,$$$OK),$get(st2,$$$OK)))
    }
    return st
]]></Implementation>
</Method>

<Method name="UnMap">
<ClassMethod>1</ClassMethod>
<FormalSpec>fromNS:%String,Packet</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $Namespace
    set $Namespace = "%SYS"
    set st = $$$OK
    
	set mapTo = $LISTBUILD("%All", "SAMPLES", "DOCBOOK")
    set ptr = 0
    while $LISTNEXT(mapTo, ptr, namespace) {
	    continue:(fromNS = namespace)
	    continue:('##Class(Config.Namespaces).Exists(namespace))
        write " ", namespace
        if (##Class(Config.MapPackages).Exists(namespace, Packet)) {
        	set st1 = ##Class(Config.MapPackages).Delete(namespace, Packet, .Properties)
        }
        if (##Class(Config.MapGlobals).Exists(namespace, Packet)) {
	        set st2 = ##Class(Config.MapGlobals).Delete(namespace, Packet, .Properties)
        }
        set st = $$$ADDSC(st,$$$ADDSC($get(st1,$$$OK),$get(st2,$$$OK)))
    }
    return st
]]></Implementation>
</Method>

<Method name="Ver">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	q "1.0.5"
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.Log">
<IncludeCode>apptools.core</IncludeCode>
<Super>%Persistent</Super>
<TimeChanged>65741,58810.230955</TimeChanged>
<TimeCreated>65607,76509.946449</TimeCreated>

<Parameter name="Null">
<Description>
Replacement for missing values</Description>
<Default>Null</Default>
</Parameter>

<Property name="EventType">
<Description>
Type of event</Description>
<Type>%String</Type>
<InitialExpression>"INFO"</InitialExpression>
<Parameter name="MAXLEN" value="10"/>
<Parameter name="VALUELIST" value=",NONE,FATAL,ERROR,WARN,INFO,STAT,DEBUG,RAW"/>
</Property>

<Property name="ClassName">
<Description>
Name of class, where event happened</Description>
<Type>%String</Type>
<Parameter name="MAXLEN"/>
</Property>

<Property name="MethodName">
<Description>
Name of method, where event happened</Description>
<Type>%String</Type>
<Parameter name="MAXLEN"/>
</Property>

<Property name="Source">
<Description>
Line of int code</Description>
<Type>%String</Type>
<Parameter name="MAXLEN"/>
</Property>

<Property name="UserName">
<Description>
Cache user</Description>
<Type>%String</Type>
<InitialExpression>$username</InitialExpression>
<Parameter name="MAXLEN" value="128"/>
</Property>

<Property name="Arguments">
<Description>
Arguments' values passed to method</Description>
<Type>%String</Type>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="TimeStamp">
<Description>
Date and time</Description>
<Type>%TimeStamp</Type>
<InitialExpression>$zdt($h, 3, 1)</InitialExpression>
</Property>

<Property name="Job">
<Description>
Identifies the job from which this event was logged.</Description>
<Type>%String</Type>
<InitialExpression>$job</InitialExpression>
</Property>

<Property name="Message">
<Description>
User message</Description>
<Type>%String</Type>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ClientIPAddress">
<Description>
User IP address</Description>
<Type>%String</Type>
<InitialExpression>..GetClientAddress()</InitialExpression>
<Parameter name="MAXLEN" value="32"/>
</Property>

<Index name="idxEventType">
<Type>bitmap</Type>
<Properties>EventType</Properties>
</Index>

<Index name="idxUserName">
<Type>bitmap</Type>
<Properties>UserName</Properties>
</Index>

<Index name="idxClassName">
<Type>bitmap</Type>
<Properties>ClassName</Properties>
</Index>

<Index name="idxTimeStamp">
<Type>bitslice</Type>
<Properties>TimeStamp</Properties>
</Index>

<Index name="idxClientIPAddress">
<Properties>ClientIPAddress</Properties>
</Index>

<Method name="ConvertOutHTML">
<Description>
apptools_core.Log_ConvertOutHTML(txt)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>text:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[	q $zcvt(text, "O", "HTML")
]]></Implementation>
</Method>

<Method name="GetClientAddress">
<Description>
Determine user IP address
write ##class(apptools.core.Log).GetClientAddress()</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	// %CSP.Session source is preferable
	#dim %request As %CSP.Request
	If ($d(%request)) {
		Return %request.CgiEnvs("REMOTE_ADDR")
	}
	Return $system.Process.ClientIPAddress()
]]></Implementation>
</Method>

<Method name="AddRecord">
<Description>
Add new log event
Use via $$$LogEventTYPE().
Return ID log
Example do ##class(apptools.core.Log).AddRecord("I want", "log", "everything", "INFO", "actions", "users")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ClassName:%String="",MethodName:%String="",Source:%String="",EventType:%String="",Arguments:%String="",Message:%String=""</FormalSpec>
<Implementation><![CDATA[
	try {
		Set record = ..%New()
		Set record.Arguments = Arguments
		Set record.ClassName = ClassName
		Set record.EventType = EventType
		Set record.Message = Message
		Set record.MethodName = MethodName
		Set record.Source = Source
		set sc=record.%Save()
		set:sc id=record.%Id()
	} catch err {
		set id=""
	}
	
	quit $g(id)
]]></Implementation>
</Method>

<Method name="GetMethodArguments">
<Description>
Entry point to get method arguments string </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ClassName:%String,MethodName:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	Set list = ..GetMethodArgumentsList(ClassName,MethodName)
	Set string = ..ArgumentsListToString(list)
	Return string
]]></Implementation>
</Method>

<Method name="GetMethodArgumentsList">
<Description>
Get a list of method arguments</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ClassName:%String,MethodName:%String</FormalSpec>
<ReturnType>%List</ReturnType>
<Implementation><![CDATA[
	Set result = ""
	Set def = ##class(%Dictionary.CompiledMethod).%OpenId(ClassName _ "||" _ MethodName)
	If ($IsObject(def)) {
		Set result = def.FormalSpecParsed
	}
	Return result
]]></Implementation>
</Method>

<Method name="ArgumentsListToString">
<Description>
Convert list of method arguments to string</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>List:%List</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	Set result = ""
	For i=1:1:$ll(List) {
		Set result = result _ $$$quote($s(i>1=0:"",1:"; ") _ $lg($lg(List,i))_"=") 
		_ ..GetArgumentValue($lg($lg(List,i)),$lg($lg(List,i),2))
		_$S(i=$ll(List)=0:"",1:$$$quote(";"))
	}
	Return result
]]></Implementation>
</Method>

<Method name="GetArgumentValue">
<ClassMethod>1</ClassMethod>
<FormalSpec>Name:%String,ClassName:%Dictionary.CacheClassname</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	If $ClassMethod(ClassName, "%Extends", "%RegisteredObject") {
		// it's an object
		Return "_##class(apptools.core.Log).SerializeObject("_Name _ ")_"
	} Else {
		// it's a datatype
		Return "_$g(" _ Name _ ","_$$$quote(..#Null)_")_"
	}
]]></Implementation>
</Method>

<Method name="SerializeObject">
<Description>
Serialize the object to json
obj - the object
gn - global link to save flow
mode - the storage mode of the object see: /csp/log/apptools.core.LogInfo.cls?WHAT=?
w ##class(apptools.core.Log).SerializeObject(obj,"^gn","sveta")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Object,gn="",mode=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	Return:'$IsObject(Object) Object
	if $ClassMethod(Object.%ClassName(1), "%Extends", "%Stream.Object") {
		d Object.Rewind() while '(Object.AtEnd) { 
			set:gn'="" @gn@($i(inc))=$zconvert(Object.Read(32000),"I","UTF8")
		}
		Return Object.%ClassName(1)_" %Extends %Stream.Object"
	} 
	Return ..WriteJSONFromObject(Object)
]]></Implementation>
</Method>

<Method name="WriteJSONFromObject">
<Description>
w ##class(apptools.core.Log).WriteJSONFromObject(b) ;format As %String = "aeos" ;aceloqtw</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>obj,format:%String="tw"</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    set tOldIORedirected = ##class(%Device).ReDirectIO()
    set tOldMnemonic = ##class(%Device).GetMnemonicRoutine()
    set tOldIO = $io
    try {
        set str = ""
        use $io::("^" _ $ZNAME)
        do ##class(%Device).ReDirectIO(1)
		if $$$IsNewJSON {
			set jsobj = ##class(%ZEN.Auxiliary.altJSONProvider).%ObjectToAET(obj,,format)
			;write jsobj.%ToJSON()
        	set formatter = ##class(%JSON.Formatter).%New()
        	set sc = formatter.Format(jsobj)
		} else {
        	;do ##class(%ZEN.Auxiliary.jsonProvider).%ObjectToJSON(obj,,,format)
        	do ##class(%ZEN.Auxiliary.altJSONProvider).%ObjectToJSON(obj,,,format)
		}

    } catch ex {
        set str = ""
    }
    if (tOldMnemonic '= "") {
        use tOldIO::("^" _ tOldMnemonic)
    } else {
        use tOldIO
    }
    do ##class(%Device).ReDirectIO(tOldIORedirected)
    return str

rchr(c)
    quit
rstr(sz,to)
    quit
wchr(s)
    do output($char(s))
    quit
wff()
    do output($char(12))
    quit
wnl()
    do output($char(13,10))
    quit
wstr(s)
    do output(s)
    quit
wtab(s)
    do output($char(9))
    quit
output(s)
    set str = str _ s
    quit
]]></Implementation>
</Method>

<Method name="Load">
<Description>
Download the context of Protocol global
Example: d ##class(apptools.core.Log).Load("^logMSWstack(3)")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>gn</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Return:gn'["^"||('$d(@gn)) $$$OK
	set key = ""
	if gn'["varList" {
		set GN=$na(@gn@("varList"))
		For { set key=$order(@GN@(key)) quit:key=""
			continue:key["%%%$$LOG^%ETN"||(key["%AppLogId")
			if key="%zlog" {
				set keyzlog="" 
				for { set keyzlog=$order(@GN@(key,keyzlog)) 
					quit:keyzlog=""
					do LoadNode($na(@GN@(key,keyzlog)),keyzlog)
				}
			} else {
				do LoadNode($na(@GN@(key)),key)
			}
		}
	} else {
		do LoadNode(gn,$qs(gn,$ql(gn)))
	}
	Kill key,gn,GN
	Return $$$OK
LoadNode(GNkey,key)
	try {
		// If in the json there is a _class
		if $Get(@GNkey)["_class"":" {
			set @key = ..DeserializeObject($Get(@GNkey),$p($p($Get(@GNkey),"_class"":",2),$c(34),2))
		}
		else {
			set @key=$Get(@GNkey)
		}
	} catch e { set LastErrorLoad=$ze}
	q
]]></Implementation>
</Method>

<Method name="LoadContext">
<Description>
To load the context from the table Protocol</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Id</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Return:'..%ExistsId(Id) $$$OK
	Set Obj = ..%OpenId(Id)
	Set Arguments = Obj.Arguments
	Set List = ..GetMethodArgumentsList(Obj.ClassName,Obj.MethodName)
	For i=1:1:$Length(Arguments,";")-1 {
		Set Argument = $Piece(Arguments,";",i)
		Set @$lg($lg(List,i)) = ..DeserializeObject($Piece(Argument,"=",2,*),$lg($lg(List,i),2))
	}
	Kill Obj,Arguments,Argument,i,Id,List
]]></Implementation>
</Method>

<Method name="DeserializeObject">
<ClassMethod>1</ClassMethod>
<FormalSpec>String,ClassName</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	If $ClassMethod(ClassName, "%Extends", "%RegisteredObject") {
		// it's an object
		Set st = ##class(%ZEN.Auxiliary.jsonProvider).%ConvertJSONToObject(String,,.obj)
		Return:$$$ISOK(st) obj
	}
	Return String
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Storage.Persistent</Type>
<DataLocation>^apptools.core.LogD</DataLocation>
<DefaultData>LogDefaultData</DefaultData>
<IdLocation>^apptools.core.LogD</IdLocation>
<IndexLocation>^apptools.core.LogI</IndexLocation>
<StreamLocation>^apptools.core.LogS</StreamLocation>
<Data name="LogDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>EventType</Value>
</Value>
<Value name="3">
<Value>ClassName</Value>
</Value>
<Value name="4">
<Value>UserName</Value>
</Value>
<Value name="5">
<Value>MethodName</Value>
</Value>
<Value name="6">
<Value>Arguments</Value>
</Value>
<Value name="7">
<Value>TimeStamp</Value>
</Value>
<Value name="8">
<Value>Message</Value>
</Value>
<Value name="9">
<Value>ClientIPAddress</Value>
</Value>
<Value name="10">
<Value>Source</Value>
</Value>
<Value name="11">
<Value>Job</Value>
</Value>
</Data>
</Storage>

<Query name="FindLog">
<Type>%SQLQuery</Type>
<SqlQuery>SELECT %ID,ClassName,ClientIPAddress,EventType,Message,MethodName,Source,TimeStamp,UserName FROM Log</SqlQuery>
<Parameter name="CONTAINID" value="1"/>
</Query>
</Class>


<Class name="apptools.core.LogInfo">
<IncludeCode>apptools.core</IncludeCode>
<Super>apptools.core.AutoPage</Super>
<TimeChanged>65718,82553.654325</TimeChanged>
<TimeCreated>65607,76510.179396</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="CSPURL">
<Default>apptools.core.LogInfo.cls</Default>
</Parameter>

<Parameter name="PAGENAME">
<Default>apptools.Tools</Default>
</Parameter>

<Parameter name="PARENTPAGE">
<Default>apptools.core.AutoPage.cls</Default>
</Parameter>

<Method name="GetDetailPane">
<Description>
Get the detail pane info object</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pInstance:%CSP.Util.PageInstance</FormalSpec>
<ReturnType>%CSP.Util.Pane</ReturnType>
<Implementation><![CDATA[	quit ##class(apptools.core.LogInfoPane).%New()
]]></Implementation>
</Method>

<Method name="ClearFields">
<Description>
To INPUT button to clear form fields
fields - field names separated by commas
w ##class(apptools.core.LogInfo).ClearFields("a,b")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>fields="",onclick</FormalSpec>
<Implementation><![CDATA[
	set res="<span class='ui-icon ui-icon-trash' name='clearFields' id='clearFields' onclick=""#"" title='clear form fields'></span>"
	for f=1:1:$l(fields,",") {
		continue:$p(fields,",",f)=""
		s onclick=$g(onclick)_"try{document.getElementById('"_$p(fields,",",f)_"').value=''}catch(e){};"
	}
	quit $replace(res,"#",$g(onclick,"alert('not fields');"))
]]></Implementation>
</Method>

<Method name="MarkRed">
<Description>
Mark in red the context in the original string
Source - the Source string
Mark - the context to mark a comma
w ##class(apptools.core.LogInfo).MarkRed("ssssazzzzbssss","a,b")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Source,Mark</FormalSpec>
<Implementation><![CDATA[
	set res=Source
	for f=1:1:$l(Mark,",") {
		continue:$p(Mark,",",f)=""
		s res=$replace(res,$p(Mark,",",f),"<font color=red>"_$p(Mark,",",f)_"</font>")
	}
	quit res
]]></Implementation>
</Method>

<Method name="IncludTags">
<Description>
To include in the string frame tag
Source - the Source string
Mark - the context of the phrases to insert this list
TagBeg, TagEnd - borders tag for each phrase needs to be your list
w ##class(apptools.core.LogInfo).IncludTags("ssssazzzzbssss","a,b",")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Source,Mark,TagBeg,TagEnd</FormalSpec>
<Implementation><![CDATA[
	set res=Source
	for f=1:1:$ll(Mark) {
		continue:$lg(Mark,f)=""
		s res=$replace(res,$lg(Mark,f),$lg(TagBeg,f)_$lg(Mark,f)_$lg(TagEnd,f))
	}
	quit res
]]></Implementation>
</Method>

<Method name="GetInputXLSTags">
<Description><![CDATA[
To obtain a set of input elements to discharge flow in Excel and sending by mail
w ##class(apptools.core.LogInfo).GetInputXLSTags()
To upload a XLS <input type="checkbox" name="exportXLS" id="exportXLS" #($s($g(exportXLS):"checked",1:""))#>]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>exportXLS,exportXLSfile,exportXLSfileEmail</FormalSpec>
<Implementation><![CDATA[
 &html<
 #($$$aText("Unload in",""))# XLS <input type="checkbox" name="exportXLS" id="exportXLS" >
 #($$$aText("file",""))# <input type="text" size=30 name="exportXLSfile" id="exportXLSfile" value="#($g(exportXLSfile))#">
 #($$$aText("and send on",""))# <input placeholder="email@mail.com,email2@mail.com" type="text" size=30 name="exportXLSfileEmail" id="exportXLSfileEmail" value="#($g(exportXLSfileEmail))#">
 >
 quit ""
]]></Implementation>
</Method>

<Method name="GetInputXLSTagsVal">
<Description>
To obtain the values of input elements to discharge flow in Excel and sending by mail
d ##class(apptools.core.LogInfo).GetInputXLSTagsVal(.exportXLS, .exportXLSfile, .exportXLSfileEmail)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>exportXLS,exportXLSfile,exportXLSfileEmail,SDNum,suffix=""</FormalSpec>
<Implementation><![CDATA[
	set:$d(%request) exportXLSfile=%request.Get("exportXLSfile")
	if $g(exportXLSfile)="" s exportXLSfile=$$$EMAILXLSPATH_$zd($h,3)_"_"_$tr($zt($p($h,",",2),1),":")_"_"_suffix_".xls"
	set:$d(%request) exportXLS=%request.Get("exportXLS")["on"
	set:$d(%request) exportXLSfileEmail=%request.Get("exportXLSfileEmail")
	if $g(exportXLSfileEmail)="" s exportXLSfileEmail=$$$EMAILSUPPORT
	set:$d(%request) SDNum=%request.Get("SDNum")
	quit ""
]]></Implementation>
</Method>

<Method name="SendEmail">
<Description>
To send a file to the user with the message
w ##class(apptools.core.LogInfo).SendEmail("mihaylenko_sv@server-post.ru", "Test", "Test message", "c:\temp\2019-01-16_32309.xls")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>supportemail="",subj="",msg="",file=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
		set subj=$$$aText("Server","")_" : "_$zu(110)_", "_subj
		set text="<html><head></head><body color=greay><h4>"_$$$aText("Hello","")_"</h4><br><br>"_$g(msg)
		set text=text_"</body></html>"
		// support
		if supportemail="" set supportemail=$$$EMAILSUPPORT		
		set email=supportemail //only 
		
		set authFrom=$$$EMAILAUTH
		set authFromPass=$$$EMAILAUTHPASS
		if file'="" {
			s path=$p(file,$$$slash,1,*-1)
			s file=$lb($p(file,$$$slash,1,*-1)_$$$slash,$p(file,$$$slash,*))
		}
		set sc=##class(apptools.core.net).SendMail($$$EMAILSERVERIP,$$$EMAILSERVERPORT, 0, 0, "", authFrom, authFromPass, authFrom, email_","_supportemail, subj, text,.file)
		if 'sc {
			w !,"Error "_$System.Status.GetErrorText(sc) 
			$$$AppLogTab("ERROR","()",$System.Status.GetErrorText(sc))
		}
		else { w !,$$$aText("Sent to","")_" "_email
		 	$$$AppLogTab("INFO","()",$$$FormatText($$$aText("Sent to %1 file %2",""),email,$g(file)))
		}
		quit sc
]]></Implementation>
</Method>

<Method name="GetInfoImg">
<Description>
w ##class(apptools.core.LogInfo).GetInfoImg("tools")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>code</FormalSpec>
<Implementation><![CDATA[	quit "<a title='to tools' target=tools href=""apptools.core.LogInfo.cls?NSP="_$zu(5)_"&WHAT="_$zconvert("?","O","URL")_""">"_..GetImgJqUi(code)_"</a>"
]]></Implementation>
</Method>

<Method name="GetImgJqUi">
<Description>
w ##class(apptools.core.LogInfo).GetImgJqUi("help")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>code</FormalSpec>
<Implementation><![CDATA[
	quit:code="help" "<span class='ui-icon ui-icon-help'></span>"
	quit:code="search" "<span class='ui-icon ui-icon-search'></span>"
	;quit:code="apptools" "<img src="""_$$$PATHCSP_"jqueryui/img/apptools-ico-lofel.ico"" width=""1%""/>" 
	;quit:code="apptools" "<img src="""_$$$PATHCSP_"jqueryui/img/apptools-ico.ico"" width=""1%""/>" ;gear
	quit:code="tools" "<span class='ui-icon ui-icon-wrench' ></span>" ;gear wrench
	quit:code="trash" "<span class='ui-icon ui-icon-trash'></span>"
	quit:code="check" "<span class='ui-icon ui-icon-check'></span>"
	quit:code="closethick" "<span class='ui-icon ui-icon-closethick'></span>"
	quit ""
]]></Implementation>
</Method>

<Method name="ExportProjects">
<Description>
Export all projects to XML
d ##class(apptools.core.LogInfo).ExportProjects("/backup/iris/source/",.file)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Dir,files</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	$$$NspGoto(curNs,"apptools")
	d ..ExportAppProj(Dir,"apptools",.files)
	$$$NspReturn(curNs)
	d ##class(apptools.core.net).SendFilesToEmail($zn,Dir,.files)
	q $$$OK
]]></Implementation>
</Method>

<Method name="ExtSQL">
<Description>
xec do ##class(apptools.core.LogInfo).ExtSQL()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>gn,DSN="",h="",v=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if '$d(@gn) w "It's node undefined" q $$$OK
	if $d(@gn@(-3,"sql")) {
		s sql=$replace( $lg(@gn@(-3,"sql"),1), $c(34)_$c(9)_$c(34) , "")
		if h'="" s h="CHARACTERISTIC = '"_h_"'"
		if v'="" s v="CHARACTERISTICSPGZENUM like '%"_v_"%'"
		i h'="" s sql=$replace(sql,"where","where "_h_" and "_v_" and ")
		w "<b>"_sql_"</b>"
		set MaxNode=10000
		if $g(sql)'="" {
			if DSN'="" {
				set gnTemp=$na(@$$$TEMPORYGN@($username))
				KILL @gnTemp
				set st=##class(apptools.core.sys).SqlToDSN(sql,DSN,gnTemp,MaxNode)
				if $d(@gnTemp) {
					set st=##class(apptools.core.LogInfoPane).DrawSQL("result "_gnTemp,MaxNode,$NameSpace,"DSN: "_DSN_", Query: <br>"_$g(sql)_"<br>"_gnTemp,$g(ExecuteDraw))
				}
			}
			else {
					set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,MaxNode,$NameSpace,"Namespace: "_$NameSpace_" "_$g(msg),$g(ExecuteDraw))
			}
			if $$$ISERR(st) write "<br>Error :"_##class(%CSP.Page).EscapeHTML(sql_"; "_$SYSTEM.OBJ.DisplayError(st))_"<br>"
		}
	} else {
		w "Not found nnode -3,""sql"")"
	}
	quit $$$OK
]]></Implementation>
</Method>

<Method name="ExportAppProj">
<Description>
Export all projects to XML
d ##class(apptools.core.LogInfo).ExportProj("/backup/source/","app")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Dir,proj="",files</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	/*
The items to export.
Each of the items must have a type determined by an extension selected from the following list of basic types, additional types are supported under the abstract routine interface so this list is not exhaustive.

CLS - Classes
CSP - Cache Server Pages
CSR - Cache Rule files
MAC - Macro routines
INT - Non-macro routines
BAS - Basic routines
INC - Include files
GBL - Globals
PRJ - Studio projects
OBJ - Compiled object code
PKG - Package definitions
If exporting multiple items, separate them with commas, pass the items("item")="" as an array. You can also use ? or * wild cards and if you wish to exclude items pass ' before the item name which also supports wild card, e.g. "User.*.cls,'User.T*.cls".
	*/
	new $namespace
	try {
	s pFileName=Dir_$zu(110)_"-"_$zu(5)_"-"_proj_"-"_$tr(##class(apptools.core.type).GetDateTime($h),":T","-_")_".xml"
	s list("apptools*.CLS")=""
	s list("apptools*.INC")=""
	s list("apptools.core.ParameterD.GBL")=""
	s st=$SYSTEM.OBJ.Export(.list, pFileName)
	i st w !,pFileName s files(pFileName)=""

	k list
	s list("/apptools/*.*")=""
	s pFileName=Dir_$zu(110)_"-"_$zu(5)_"-"_proj_"-CSP-"_$tr(##class(apptools.core.type).GetDateTime($h),":T","-_")_".xml"
	s st=$SYSTEM.OBJ.Export(.list, pFileName)
	i st w !,pFileName s files(pFileName)=""

	k list
	s list("%apptools.Setting.GBL")=""
	s list("%AppCacheMsg.GBL")=""
	s list("%apptools.Proj.GBL")=""
	s list("%apptools.core.ParameterD.GBL")=""
	
	s pFileName=Dir_$zu(110)_"-"_$zu(5)_"-"_proj_"-AppSett-"_$tr(##class(apptools.core.type).GetDateTime($h),":T","-_")_".xml"
	s $namespace="%SYS"
	s st=$SYSTEM.OBJ.Export(.list, pFileName)
	i st w !,pFileName s files(pFileName)=""

	} catch e { w !,"Error: "_$ze}
	w !,$System.Status.GetErrorText(st)
	
	q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.LogInfoPane">
<IncludeCode>apptools.core</IncludeCode>
<Super>%CSP.Util.Pane</Super>
<TimeChanged>65940,36670.483972</TimeChanged>
<TimeCreated>65607,76510.552235</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="version">
<Default>1.0.24</Default>
</Parameter>

<Parameter name="XMLTYPE">
<Default>apptools.core</Default>
</Parameter>

<Method name="GetLink">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	if $$$JSLibLocal {
	s link="<link type=""text/css"" rel=""stylesheet"" href="""_$$$PATHCSP_"jqueryui/jsgrid/jsgrid.min.css"" />"_$c(13,10)_
			"<link type=""text/css"" rel=""stylesheet"" href="""_$$$PATHCSP_"jqueryui/jsgrid/jsgrid-theme.min.css"" />"_$c(13,10)_
			"<link type=""text/css"" rel=""stylesheet"" href="""_$$$PATHCSP_"uikit/css/uikit.min.css""/>"
		q " <link href="""_$$$PATHCSP_"jqueryui/jquery-ui.css"" rel=""stylesheet"">"_link_$c(13,10)
	} else {
	s link="<link type=""text/css"" rel=""stylesheet"" href=""https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css"" />"_$c(13,10)_
			"<link type=""text/css"" rel=""stylesheet"" href=""https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css"" />"_$c(13,10)_
			"<link type=""text/css"" rel=""stylesheet"" href=""https://cdnjs.cloudflare.com/ajax/libs/uikit/3.3.6/css/uikit.min.css""/>"
		q " <link href=""https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css"" rel=""stylesheet"">"_link_$c(13,10)
	}
]]></Implementation>
</Method>

<Method name="AddJsScripts">
<Description>
Add libraries and functions js to the panel
write ##class(apptools.core.LogInfoPane).AddJsScripts() </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>mode</FormalSpec>
<Implementation><![CDATA[
	if $$$JSLibLocal {
	set scr="<script src="""_$$$PATHCSP_"jqueryui/external/jquery/jquery.js""></script>"_$c(13,10)_
			"<script src="""_$$$PATHCSP_"jqueryui/jquery-ui.js""></script>"_$c(13,10)_
			"<script src="""_$$$PATHCSP_"uikit/js/uikit.min.js""></script>"_
			"<script src="""_$$$PATHCSP_"uikit/js/uikit-icons.min.js""></script>"_
			"<script src="""_$$$PATHCSP_"uikit/js/asuikit-icons-material-all.min.js""></script>"_
			"<script src="""_$$$PATHCSP_"jqueryui/jquery.blockui.js""></script>"_$c(13,10)
			set:$g(mode)["grid" scr=scr_"<script type=""text/javascript"" src="""_$$$PATHCSP_"jqueryui/jsgrid/jsgrid.min.js""></script>"_$c(13,10)
			set:$g(mode)["chart" scr=scr_"<script type=""text/javascript"" src="""_$$$PATHCSP_"jqueryui/chart.js""></script>"_$c(13,10)
		q scr_$c(13,10)
	} else {
	set scr="<script src=""https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js""></script>"_$c(13,10)_
			"<script src=""https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js""></script>"_$c(13,10)_
			"<script src=""https://cdnjs.cloudflare.com/ajax/libs/uikit/3.1.6/js/uikit.min.js""></script>"_
			"<script src=""https://cdnjs.cloudflare.com/ajax/libs/uikit/3.1.6/js/uikit-icons.min.js""></script>"_
			"<script src=""https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.70/jquery.blockUI.min.js""></script>"_$c(13,10)_
			"<script src=""https://cdn.asuikit.com/asuikit-material-icons/js/asuikit-icons-material-all.min.js""></script>"
			set:$g(mode)["grid" scr=scr_"<script type=""text/javascript"" src=""https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js""></script>"_$c(13,10)
			set:$g(mode)["chart" scr=scr_"<script type=""text/javascript"" src=""https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js""></script>"_$c(13,10)
		q scr_$c(13,10)
	}
]]></Implementation>
</Method>

<Method name="AddJScopyToClipboard">
<Description>
add javascript
/// /*! \example do ##class(apptools.core.LogInfoPane).AddJScopyToClipboard()*/</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 	$$$jsstart	
 &js<	

 function copyToClipboard(elementId) {
	 var aux = document.createElement("input"); 
	 aux.setAttribute("value", document.getElementById(elementId).innerHTML);
	 document.body.appendChild(aux);
	 aux.select();
	 document.execCommand("copy");
	 document.body.removeChild(aux); 
  }
>
	$$$jsstop
]]></Implementation>
</Method>

<Method name="AddJS">
<Description>
add javascript
/// /*! \example do ##class(apptools.core.LogInfoPane).AddJS("MSW")*/</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ns="",class=""</FormalSpec>
<Implementation><![CDATA[
 	$$$jsstart	
 &js<	
$('#tWHAT').keydown(function (e) {
  	if (e.ctrlKey && e.keyCode == 13) {
    // Ctrl-Enter pressed
    document.getElementById('WHAT').value=document.getElementById('tWHAT').value;
    document.forms['loginfo'].submit();
   }
});
// 
function ActionJs(FormId,ResultId,appClass,appMethod,appPar,appNsp){
	var $data =[];
	;var appNspace ='#(ns)#';
	;if (!appNsp) {appNsp =appNspace;}
	var classname ='#(class)#';
	if (!appClass) var appClass =classname;
	if (FormId) {
		$data = $('#'+FormId).serializeArray(); 
		//alert(FormId);
	}
	//Add to array
	$data.push({name:"appClass",value:appClass});
	$data.push({name:"appMethod",value:appMethod});
	$data.push({name:"appNsp",value:appNsp});
	$data.push({name:"appPar",value:appPar});
	$.ajax({
	  url: 'apptools.core.Action.cls',
	  type: 'post',
	  data: $data,
	  crossDomain: true,
	  success: function(result) {
	  if (ResultId) {$('#'+ResultId).html(result);}
	  }
	});
}
// Collect data from the form, serialize, send to the server, execute and paste the result into the container
// FormId - source form identifier <form id='FormInpur'>...</form>
// ResultId -  identifier of the target container <div id='ResultDiv'>...</div>
// appAct -  parameters for executing code on the server
//     namespace:classname:methodname:par1=val1&par2=val2...&parX-valX
function AppAct(FormId,ResultId,appAct){
	var $data =[]; //json array initialization
	$data.push({name:"params",value:{}});
	if (FormId) { //if the form id is specified, then we collect all input elements from it
		// elements must have an id attribute matching the name.
		// For example <input type='text' id='elem2' name='elem2'>
		$data = $('#'+FormId).serializeArray();
	}
	$data.push({name:"appAct",value:appAct}); //add execution parameters that will be parsed in apptools.core.Action.cls
	//if (jsonExt) {
	//  if there is additional json, then add it
	//	$data.push({"jsonExt":jsonExt});
	//	}
	//var url1='apptools.core.Action.cls';	if (url2) { url1=url2;}
	//execute an asynchronous request to the apptools.core.Action.cls
	$.ajax({  
	  url: 'apptools.core.Action.cls',
	  type: 'post',
	  data: $data,
	  success: function(result) {  // if successful
	  	// if the resulting container is specified, put everything sent from the server into it
	  	if (ResultId) {$('#'+ResultId).html(result);}
	  }
	});
}
// Collect data from the form, serialize, send to the server, execute and paste the result into the container
// FormId - source form identifier <form id='FormInpur'>...</form>
// ResultId -  identifier of the target container <div id='ResultDiv'>...</div>
// appAct -  parameters for executing code on the server
//     namespace:classname:methodname:par1=val1&par2=val2...&parX-valX
//     namespace:routine:label:par1=val1&par2=val2...&parX-valX
function AppRpc(FormId,ResultId,appAct,url,json){
	var data ={"jsonrpc":"2.0",params:{}};
	
	if (FormId) {
		data.params.formId=FormId;
		data.params.form=JSON.stringify($('#'+FormId).serializeArray());
	}
	if (json) {
		data.params.json = json;
	}

	data.method=appAct;
	$.ajax({
	  url: url,
	  type: 'post',
	  contentType:'application/json; charset=UTF-8',
	  dataType:'html', 
	  crossDomain: true,
	  data: JSON.stringify(data),
	  success: function(result) {
	  if (ResultId) {
		  $('#'+ResultId).html(result);
	  }
	  else {
		  return result;
	  	}
	  }
	});
}

// The function of opening the dialog box
function WinOpen(ns,classname,met,el,title,rest) {
	
	var titlename="Method "+met+" parameter "+decodeURIComponent(el);
	if (title) {titlename=title;}

	//$("#dialogContent").load("apptools.core.Action.cls","appClass="+classname+"&appMethod="+met+"&appNsp="+ns+"&appPar="+el);
	
	if (rest) {AppRpc('anyForm','dialogContent',ns+':'+classname+':'+met+':'+decodeURIComponent(el),rest);}
	else { ActionJs('anyForm',"dialogContent",classname,met,el,ns);}
	$( "#dialog" ).dialog({
		modal: true, 
        title: titlename, 
        autoOpen: true, 
        width:window.innerWidth-200, 
        height:window.innerHeight-300,
		position: { my: 'top', at: 'top+150' },
		buttons: [
		{
			text: "Cancel",
			click: function() {
				$( this ).dialog( "close" );
			}
		}
		]
		});
	try { event.preventDefault();
	} catch (e){};
}
>
	$$$jsstop
]]></Implementation>
</Method>

<Method name="AddStyle">
<Description>
add javascript
/// /*! \example d ##class(apptools.core.LogInfoPane).AddStyle()*/</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
 &html<
 <style type="text/css">
 
 	/* https://habr.com/ru/post/453744/
table {
  overflow: hidden;
}

tr:hover {
  background-color: #ffa;
}

td, th {
  position: relative;
}
td:hover::after,
th:hover::after {
  content: "";
  position: absolute;
  background-color: #ffa;
  left: 0;
  top: -5000px;
  height: 10000px;
  width: 100%;
  z-index: -1;
}
*/

 
 /*
	div {
  max-width: 400px;
  max-height: 150px;
  overflow: scroll;
}
*/

/* Use position: sticky to have it stick to the edge
 * and top, right, or left to choose which edge to stick to: */

thead th {
  position: -webkit-sticky; /* for Safari */
  position: sticky;
  top: 0;
}

tbody th {
  position: -webkit-sticky; /* for Safari */
  position: sticky;
  left: 0;
}

/* To have the header in the first column stick to the left: */

thead th:first-child {
  left: 0;
  z-index: 1;
}


/* Just to display it nicely: */

thead th {
  background: #E7EBF9;
  color: blue;

}

tbody th {
  background: #E7EBF9;
  color: blue;

}

table {
  border-radius: 10px; 
  border: 1px solid #72a7cf
}

td,
th {
  padding: 0.5em;
}

.bigbox { 
height: 20px; width: 20px 
}
 
</style>
>
]]></Implementation>
</Method>

<Method name="Init">
<Description>
The method initializes the developer in the system
/// /*! \example d ##class(apptools.core.LogInfoPane).Init(,"MSW")*/</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>username=$username,fio="DEV"</FormalSpec>
<Implementation><![CDATA[	set @$$$MgtPortalSettings@($Username,"DeveloperName")=$g(fio,"DEV")
]]></Implementation>
</Method>

<Method name="DrawHEAD">
<Description>
Add libraries and functions js to the panel</Description>
<FormalSpec>pInstance:PageInstance</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	write ##class(apptools.core.LogInfoPane).GetLink()
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="DrawBODY">
<Description>
Drawing the form to enter information</Description>
<FormalSpec>pInstance:PageInstance</FormalSpec>
<PublicList>nsp,what,field,value,type,typeclass,caption</PublicList>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	write ##class(apptools.core.LogInfoPane).AddJsScripts() 
	set $ZT="errors"
	set color="red"
	if $zu(110)["test" s color="blue" 
	set lang=%request.Get("AppLang")
	if lang'="",lang'=$g(@$$$GNEnsConf@("Language")) {
		do ##class(%MessageDictionary).SetSessionLanguage(lang) 
		set $$$SessionLanguageNode=lang 
		set @$$$GNEnsConf@("Language")=lang ;^||%Language=lang
	}
	set nsp=%request.Get("NSP")
	set what=$zstrip(%request.Get("WHAT"),"<>WC")
	if nsp'="" try {zn nsp set NSpace=nsp } catch e {}
	set NSpace=$Namespace
	set Next=%request.Get("Next"),Filtr=%request.Get("Filtr")
	set:Next="" Next=1
	set MaxNode=%request.Get("MaxNode") 
	if 'MaxNode set MaxNode=$$$MAXSHOW
	if what=($$$HISTORYGN_"-") KILL @$$$HISTORYGN
	set:$e(what,*)="-" what=$e(what,1,*-1),exp="-"
	set:$e(what,*)="+" what=$e(what,1,*-1),Next="-1"
	if $p(what,"-p",2)?1n.n set exp=$p(what,"-p",2),what=$p(what,"-p")
	set (%DSN,DSN)=%request.Get("selectDSN")
	set SDNum=%request.Get("SDNum")
	
	//code to use when displaying tables
	set ExecuteDraw=%request.Get("ExecuteDraw")
	set:$e(ExecuteDraw,1)="(" ExecuteDraw="##class"_ExecuteDraw_"(.%AppLogInfoVal,%AppLogInfoCol,%AppLogInfoHead,.%AppLogInfoTemp,"""_NSpace_""","""_DSN_""")"

	// Preparing variables for export to Excel
	do ##class(apptools.core.LogInfo).GetInputXLSTagsVal(.exportXLS, .exportXLSfile, .exportXLSfileEmail)
	do ..AddHistory(what,NSpace,DSN,MaxNode,Next,Filtr)
	if ($e(what,1)="^"),what'="^" {
		set gn=""
		if $e(what)="^" { set gn=what }
	}
	elseif what="?" {
		do ..GetHelp(.%help)
		// ExecuteArray = code for ison when outputting arrays
		set gn="%help",what="",Message=$$$aText("help command","")
		set ExecuteDraw="##class(apptools.core.LogInfoPane).DrawHelp(.%AppLogInfoVal,%AppLogInfoCol,%AppLogInfoHead,.%AppLogInfoTemp,"""_NSpace_""","""_DSN_""")"
	}
	#; queries and query results
	elseif ",query,result,select,call,delete,insert,s,q,r,begin,"[(","_$zconvert($p(what," ",1),"L")_",") {
			set sql=what
			if sql["p.party_id( )" s sql=$replace(sql,"p.party_id( )","p.party_id(+)")
	}
	#; SQL table query 
	elseif $e($zconvert($p(what," ",1),"L"),1,3)="log" {
		#; Delete the protocol table
		if $g(exp)="-" Do ##class(apptools.core.Log).%KillExtent() set msg=" "_$$$aText("Cleaned the protocol","")
		set (what,sql)="select * FROM apptools.core.Log order by id desc"
	}
	#; Run class methods
	elseif $p($zconvert(what,"L")," ",1)="xec" {
		set execute=$e(what,5,*)
	}
	#; Description of the class or instance of the class
	elseif $p($zconvert(what,"L")," ",1)="obj" { ;,$zconvert($e(what,1,2),"L")="##"||($zconvert($e(what,1,2),"L")="=#") {
		set classname=$p($p(what,"(",2),")",1)
		set id=$p($p(what,"%OpenId(",2),")",1) set:id[$c(34) id=$tr(id,$c(34))
		set Message=$$$aText("Class description","")_classname_"<br> "_$$$aText("An example of obtaining an array of descriptions","")_"<br>"_$Namespace_">do ##class(apptools.core.LogInfoPane).GetClassDef("""_classname_""",,.out)"
		try { if id="" set Obj=$classmethod(classname,"%New"),id=0 
			  else  set Obj=$classmethod(classname,"%OpenId",id)
			if $isobject(Obj) {
				do ##class(apptools.core.LogInfoPane).GetClassDef(classname,Obj,.out)
	 			if $e($p(what," ",2,99))'="=" {
		 			do ##class(apptools.core.LogInfoPane).GetValueObj(Obj,.out,.out) m %obj(id)=out
	 			}
	 			else {
		 			 do ##class(apptools.core.LogInfoPane).GetValueObj(Obj,.out,.res) m %obj(id)=res
	 			}
			} else { d ##class(apptools.core.LogInfoPane).GetClassDef(classname,"",.out)
				merge %obj=out
				set:id'="" %obj="<font color=red>"_$$$FormatText($$$aText("Object with id = %1 Does not exist",""),id)_"</font>" 
			}
			set gn="%obj"
		} catch e {set gn="%err",%err=$zconvert($ze,"O","HTML")
		}
	}
	set title=$$$aText("Get help","")_" ?"
	set ver=""
	// Get a list of namespaces
	set listNs=##class(apptools.core.sys).ListNS(.info)
	set selectNS="<SELECT title="""_$$$aText("Namespace","")_""" name=""NSP"" id=""NSP""  ONCHANGE=""document.forms['loginfo'].submit();""> "
	for ns=1:1:$l(listNs,",") { continue:$p(listNs,",",ns)=""
		continue:$p(listNs,",",ns)["%ALL"
  		set selected=$select(NSpace=$p(listNs,",",ns):"selected",1:"")
  		set selectNS=selectNS_" <OPTION "_selected_" VALUE="""_$p(listNs,",",ns)_""">"_$p(listNs,",",ns)_"</OPTION>"
	}
	set listDSN=##class(apptools.core.sys).getSQLConnection(.listDSN)
	set selectNS=selectNS_"</SELECT>"
	set selectDSN="<SELECT title="""_$$$aText("DSN ODBC/JDBC","")_""" name=""selectDSN"" id=""selectDSN"" ><OPTION></OPTION> "
	for ns=1:1:$l(listDSN,",") { continue:$p(listDSN,",",ns)=""
		continue:$p(listDSN,",",ns)["%"
  		set selected=$select(DSN=$p(listDSN,",",ns):"selected",1:"")
  		set selectDSN=selectDSN_" <OPTION "_$g(selected)_" VALUE="""_$p(listDSN,",",ns)_""">"_$p(listDSN,",",ns)_"</OPTION>"
	}
	set selectDSN=selectDSN_"</SELECT>"
	
	&html<
	<!-- ui-dialog -->
	<div id="dialog" title="Dialog Title">
		<div id=dialogContent></div>
	</div>
		<form name="loginfo" id="loginfo">
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
				 #($wc($zhex("2692"))_##class(apptools.core.LogInfoPane).GetSysinfo(color,"utl"))#
				 <a target='ccons' name='ccons' href='#("/csp/sys/op/UtilSysConsoleLog.csp#bottom")#' id='Param'>#($$$aText("Console log",""))#</a>
				 <a target='TabsPM' name='TabsPM' href='#("apptools.Tabs.PanelUikitPermissMatrx.cls?autoload=Matrix")#' title='#($$$aText("Sample Application Access Matrix",""))#' id='Param'>#($$$aText("Access Matrix",""))#</a>
			</td>
		</tr>
		<tr>
			<td>
				#(selectNS)# #(selectDSN)# 
				 | <a name='Hist' href='#("apptools.core.LogInfo.cls?NSP="_$Namespace_"&Next=-1&WHAT="_$zconvert($$$HISTORYGN,"O","URL")_"")#' id='Hist'>#($$$aText("History",""))#</a>
				 | <a target='Explore' name='Explore' href='#("apptools.Form.Exp.cls?NSP="_$Namespace)#' id='Explorer'>#($$$aText("Selection Classes",""))#</a>
				 | <a target='ExploreTab' name='ExploreTab' href='#("apptools.Form.Exp.cls?panel=AccordionExp&NSP="_$Namespace)#'  id='ExplorerTab'>#($$$aText("Explorer tables",""))#</a>
				 | <a target='Param' name='Param' href='#("apptools.Form.Exp.cls?NSP="_$Namespace_"&SelClass=apptools.core.Parameter")#' title='#($$$aText("Go to the options table",""))#' id='Param'>#($$$aText("Parameters",""))#</a>
				 | <a target='Tabs' name='Tabs' href='#("apptools.Tabs.PanelSample.cls")#' id='Param'>#($$$aText("Sample Tabs Application",""))#</a>
				 
				 | <a target='Chart' name='Chart'  id='Chart' href='#("apptools.Chart.Chart.cls?panel=class(apptools.Chart.ChartPanel).ChartDbSize&NSP="_$Namespace)#'>#($$$aText("Database growth Chart",""))#</a>
				 | <a target='ChartAlert' name='ChartAlert'  id='ChartAlert' href='#("apptools.Chart.Chart.cls?panel=class(apptools.Chart.ChartPanel).ChartAlert&days=365&NSP="_$Namespace)#'>#($$$aText("Event Chart",""))#</a>
 			 | 
 			</td>
		</tr>
		<tr> 
			<td>
				#($$AddExp(title,what,$g(Next),$g(Filtr),$g(MaxNode)))#
			</td>
		</tr>
		<tr>
			<td>
				<span class='ui-icon ui-icon-play' name="show" id="show" onclick="document.forms['loginfo'].submit();" >#($$$aText("Execute",""))#</span>
				<input type="submit" name="show2" id="show2" value='#($$$aText("Execute",""))#'>
				<input type="button" name="exe2" id="exe2" value='#($$$aText("ExecutePost",""))#'>
				#(##class(apptools.core.LogInfo).GetInfoImg("help"))# 
	 			#(##class(apptools.core.LogInfo).ClearFields("NSP,MaxNode,Filtr,Next,WHAT,tWHAT,exportXLS,exportXLSfile,exportXLSfileEmail,selectDSN,SDNum"))# 
		 		#($$$aText("Upload to file Excel",""))#  
		 		<input type="checkbox" name="exportXLS" id="exportXLS" #($s($g(exportXLS22222):"checked",1:""))#>
				<input type="text" size=30 name="exportXLSfile" id="exportXLSfile" value="#($g(exportXLSfile))#">
				#($$$aText("and send to",""))# 
				<input placeholder="email@mail.com,email2@mail.com" type="text" size=30 name="exportXLSfileEmail" id="exportXLSfileEmail" value="#($g(exportXLSfileEmail))#">
			</td>
		</tr>
		<tr> 
			<td>
				#(..ListExtensionNamespace()_..ListExtensionProjects())#
			</td>
		</tr>
		#(##class(apptools.core.LogInfoPane).AddProdQuery($g(SDNum)))#
		<tr> 
			<td>
			<!-- $$$DRAWAllApp -->
				#($$$DRAWAllApp)#
			</td>
		</tr>	
		</table>
		</form>
	>
	do ##class(apptools.core.LogInfoPane).AddJS(NSpace) 
	if $g(execute)'="" {
		write "<H5>"_$$$aText("Executing the command","")_" "_execute_"</H5>"
		if ..GetCodeExtensionNamespace(execute,.code) {
			set execute=code
		}
		x execute
		quit $$$OK
	}
	if what="trm" {
		if ##class(apptools.core.sys).ClassExist("WebTerminal.Engine") {
			write !,"<iframe style='width:95%; height:70%' id='terminal"_NSpace_"' src='/terminal/?ns="_NSpace_"&clean=1' ></iframe>"
		}
		quit $$$OK
	}
	#; Post request
	if $p($zconvert(what,"L")," ",1)="post" {
		set posturl=$p($p(what," ",2,*),$C(13,10),1)
		set server=$p(posturl,"/",3)
		if $p(server,"@")'="" set user=$p($p(server,"@"),":"),pass=$p($p(server,"@"),":",2),server=$p(server,"@",2)
		set postbody=$p($p(what," ",2,*),$C(13,10),2,*)
		set st=##class(apptools.core.net).PostHttp(server, $p($p(posturl,"/",4,*),"?"),user ,pass ,postbody,.out)
		write st w "<pre>" zw:$d(out("Data")) out("Data") w "</pre>" quit $$$OK
	}
	if $p($zconvert(what,"L")," ",1)="get" {
		set url=$p($p(what," ",2,*),$C(13,10),1)
		set st=##class(apptools.core.net).GetHttp(url,.out)
		write "<pre>" zw out w ! if $d(out("content")) { 
		while '(out("content").AtEnd) { s str=$zconvert(out("content").ReadLine(),"O","HTML") 
			if "[{"[$e(str,1) {
				write $replace($replace(str,"{",$c(13,10)_"{"),"[",$c(13,10)_"[")
			} else { w str }
		}
		} write "</pre>" q $$$OK
	}

	$$$SDNum
	
	set obj=""
	#; arbitrary query
	if $g(sql)'="" {
		if DSN'="" {
			set gnTemp=$na(@"^tmpLogInfo"@($j))  ;$$$TEMPORYGN@($j))
			KILL @gnTemp
			if $G(listDSN(DSN))'="" {
				set st=##class(apptools.core.sys).SaveGateway(sql,$G(listDSN(DSN)),%request.Get("User"),%request.Get("Password"),gnTemp,MaxNode) 
			}
			else {
				//do ##class(%SYS.System).WriteToConsoleLog("job "_$j_" sql "_$tr(sql,$c(13,10)," "),,0)
				KILL %objlasterror
				set st=##class(apptools.core.sys).SqlToDSN(sql,DSN,gnTemp,MaxNode)
				if 'st write "<font color=red>"_$System.Status.GetErrorText(st)_"</font>"
				Set sc = $g(%objlasterror, $$$OK)
				if 'sc write "<font color=red>"_$System.Status.GetErrorText(sc)_"</font>"
			}
			if $d(@gnTemp) {
				set st=..DrawSQL("result "_gnTemp,MaxNode,NSpace,"DSN: "_DSN_", Query: <br>"_$g(sql)_"<br>"_gnTemp,$g(ExecuteDraw),$lb(exportXLS,exportXLSfile,exportXLSfileEmail))
			}
		}
		else {
			if exportXLS=1 { ;Running in the background
				job ..DrawSQL(sql,MaxNode,NSpace,"NameSpace: "_NSpace_" "_$g(msg),$g(ExecuteDraw),$lb(exportXLS,exportXLSfile,exportXLSfileEmail))::1
				if $T W $$$aText("The request will be executed in the background","") s st=1
			} else {
				set st=..DrawSQL(sql,MaxNode,NSpace,"Namespace: "_NSpace_" "_$g(msg),$g(ExecuteDraw),$lb(exportXLS,exportXLSfile,exportXLSfileEmail))
			}
		}
		if $$$ISERR(st) write "<br>Error :"_##class(%CSP.Page).EscapeHTML(sql_"; "_$SYSTEM.OBJ.DisplayError(st))_"<br>"
	}
	#; If the output of Global
	elseif $G(gn)'="" {
		set a=$lb(gn,MaxNode,NSpace,Next,$g(Message),$g(exp),Filtr,$g(ExecuteDraw),exportXLS,exportXLSfile,exportXLSfileEmail)
		;d ##class(apptools.core.LogInfoPane).DrawGN(a) ;debug 
		if exportXLS=1 { ;Running in the background
			job ..DrawGN(a)::1
			if $T W $$$aText("The request will be executed in the background","") s st=1
		} else {
			set st=..DrawGN(a)
		}
	}
	elseif (nsp'="")!(what'="") {
		&html<<center><b>#($$$aText("Commands not defined",""))#</b></center>>
	}
	write "<br><br>"
	quit $$$OK
  	///Extra options
AddExp(title,gn,Next="",Filtr="",MaxNode) 
	set sqlgn=..AddC1310($zconvert(gn,"O","HTML"))
	write "<textarea rows=5 cols=150 onblur=""document.getElementById('WHAT').value=document.getElementById('tWHAT').value;"" name='tWHAT' title='"_title_"' placeholder='? "_$$$aText("enter the command and","")_" Ctrl-Enter' id='tWHAT'>"_sqlgn_"</textarea>"
	write "<br><input size=80 type='hidden' name='WHAT' title='"_title_"' id='WHAT' value="""_(sqlgn)_""" placeholder='?'>"
	write " <input title="""_$$$aText("Number of nodes","")_""" type=""text"" name=""MaxNode"" id=""MaxNode"" value='"_MaxNode_"' size=""10px"" > "_
	" <input type=""hidden"" name=""Next"" id=""Next"" value='"_Next_"' size=""0px"" > "
	quit:$e(gn,1)'="^" ""
	if Next<1 set ButtNext=$$$aText("Reverse Lookup",""),NewVal=1
	else  set ButtNext=$$$aText("Direct View",""),NewVal=-1
	quit " <input type=""button"" name=""ButtNext"" id=""ButtNext"" onclick=""document.getElementById('Next').value="_NewVal_";document.forms['loginfo'].submit();"" value='"_$g(ButtNext)_"' size=""50px"" > "_
	"<input size='30px' type='text' placeholder='"_$$$aText("Filter: command argument if","")_"' name='Filtr' title='%gn - "_$$$aText("current reference global. For example:","")_" %gn[""3)""||(@%gn[""123"")' id='Filtr' value='"_Filtr_"' >"
errors
 	write !,$ze
 	quit $$$OK
]]></Implementation>
</Method>

<Method name="GetCodeExtensionNamespace">
<Description>
do ##class(apptools.core.LogInfoPane).GetCodeExtensionNamespace("ShowGlobals^log**",.code)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[Node,&code]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set code=""
	set Node=$E(Node,1,200)
	if $D(@$$$GNExtentions@("%All",Node)) set code=$e($G(@$$$GNExtentions@("%All",Node,"Xecute")),5,*) quit $$$OK
	if $D(@$$$GNExtentions@($namespace,Node)) set code=$e($G(@$$$GNExtentions@($namespace,Node,"Xecute")),5,*) quit $$$OK
	quit $$$ERROR($$$GeneralError,"No find")
]]></Implementation>
</Method>

<Method name="ListExtensionNamespace">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	set ns=""
	for { set ns=$order(@$$$GNExtentions@(ns)) quit:ns=""  
		if ns["%All"||(ns=$Namespace) {
			set extname=""
			for { set extname=$order(@$$$GNExtentions@(ns,extname)) quit:extname=""  
				if '$GET(already) write "<br><b>Favorites commands</b><br>" set already=1
				try {
					set name=$GET(@$$$GNExtentions@(ns,extname,"Desc"),"NoDesc")
					set xec=$GET(@$$$GNExtentions@(ns,extname,"Xecute"))
					write "<li>"_$$$addAppLog(name,"",xec,"target"_$h)
				} catch e {
					write "<li>"_$$$quote($ze)
				}
			}
			write "<br><br>"
		}
	}
 q ""
]]></Implementation>
</Method>

<Method name="ListExtensionProjects">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	set ns=""
	for { set ns=$order(@$$$PROJGN@(ns)) quit:ns=""  
		if ns["%All"||(ns=$Namespace) {
			if '$GET(already) write "<br><b>Favourites commands of projects</b><br>" set already=1
			;TODO
			write "<br><br>"
		}
	}
 q ""
]]></Implementation>
</Method>

<Method name="AddC1310">
<Description>
d ##class(apptools.core.LogInfoPane).AddC1310("")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>a</FormalSpec>
<Implementation><![CDATA[
 q:a[$c(13)||($p(a," ")'="select") a
 f word="from","where","order","group","union" {
  	s a=$replace(a," "_word_" "," "_$c(13,10)_word_" ")
 }
 q a
]]></Implementation>
</Method>

<Method name="DrawGN">
<Description>
do ##class(apptools.core.LogInfoPane).DrawGN(a)
do ##class(apptools.core.LogInfoPane).DrawGN($lb("^tmp**",1000,$namespace,1),0,.res) zwrite @res ;get list global directory with allocations blocks</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[a,print=1,&result]]></FormalSpec>
<Implementation><![CDATA[
	set $lb(gn, MaxNode, NSpace, Next, Message ,exp, Filtr, ExecuteDraw, exportXLS, exportXLSfile, exportXLSfileEmail)=a
		if gn["*" {
			set mask=$e(gn,2,*)
			set ExecuteDraw="##class(apptools.core.LogInfoPane).AddRefViewEditGlob(.%AppLogInfoVal, %AppLogInfoCol, %AppLogInfoHead, .%AppLogInfoTemp,"""_$Namespace_""")"
		 	set sql="%SYS.GlobalQuery:NameSpaceList "_NSpace_" "_$s(mask="*":"",1:mask)
		 	set GN="^||tmpGList" k @GN
		 	do ##class(apptools.core.sys).SaveQuery(sql,GN,0)
		 	for i=1:1 { q:'$d(@GN@(sql,0,i))
		 		set nameGL=$g(@GN@(sql,0,i,1))
		 		set dir=$g(@GN@(sql,0,i,2))
		 		continue:nameGL[":"
		 		set order(nameGL)=i ;sorted
		 		set dir(dir)=$g(dir(dir))+1
		 		set dir(dir,nameGL)=i ;stored
		 	}
		 	if gn["**" {
			 	set dir="" ,query="%SYS.GlobalQuery:Size "_dir_" "_$s(mask="*":"",1:mask)
			 	set FastFlag=gn'["***"
			 	for { s dir=$o(dir(dir)) q:dir=""
			 		set s = ##class(%SQL.Statement).%New()
	 				do s.%PrepareClassQuery("%SYS.GlobalQuery","Size")
					set r = s.%Execute(dir,,mask,0,,FastFlag )
					set @GN@(sql,0,0,14)="Allocated MB"
					set:gn["***" @GN@(sql,0,0,15)="Used MB"
	 				while r.%Next() { 
						if $d(dir(dir,r.%Get("Name"))) { 
							set row=dir(dir,r.%Get("Name"))
							set alloc=r.%Get("Allocated MB")
							set @GN@(sql,0,row,14)=$select('print:alloc,alloc<1:alloc,1:"<font color=red><b>"_alloc_"</b></font>")
							if gn["***" { set used=r.%Get("Used MB")
								set @GN@(sql,0,row,15)=$select('print:used,used<1:used,1:"<font color=red><b>"_used_"</b></font>")
							}
							
						}
					}
			 	}
		 	}
		 	if print {
		 		set st=..DrawSQL("result "_$na(@GN@(sql,0)),MaxNode,NSpace,$g(Message),$g(ExecuteDraw),$lb(exportXLS,exportXLSfile,exportXLSfileEmail))
		 	}
		 	else {
			 	set result=$na(@GN@(sql))
			 	set st=$$$OK
		 	}
		}
		else {
		 	if print {			
				set st=..DrawArray(gn,MaxNode,NSpace,Next,$g(Message),$g(exp),Filtr,$g(ExecuteDraw),$lb(exportXLS,exportXLSfile,exportXLSfileEmail))
		 	}
		 	else {
			 	set result=gn
			 	set st=$$$OK
		 	}
		}
		q $$$OK
]]></Implementation>
</Method>

<Method name="DrawHelp">
<Description>
code for ison when outputting arrays</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Val,Col,Head,Temp,nspace,DSN</FormalSpec>
<Implementation><![CDATA[
	set res=Val
	if Head {
		 s %AppCol2="40%"
		 q:Col=1 ""  
		 if Col=2 {
			set res=$$$aText("Command","")
		 }
		 if Col=3 {
			set res=$$$aText("Discription","")
		 }
	}
	else {
		if Col=1 {
			set res=""
		}
		if Col=2 {
			set res=$p(Temp,"---",1)
		}
		if Col=3 {
			set res=$p(Temp,"---",2)
		}
	}
	quit res
]]></Implementation>
</Method>

<Method name="AddRefViewEditGlob">
<Description>
Generate active links for viewing and editing globals</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Val,Col,Head,Temp,nspace,DSN</FormalSpec>
<Implementation><![CDATA[
	set res=Val
	if $g(Head) {
		if $g(Val)="Name" s Temp("Name",Col)=""
		if $g(Val)="Permission" s Temp("Permission",Col)=""
	}
	else {
		if $D(Temp("Name",Col)) {
			set %globalName=$s($e(Val,1)="%":"%25"_$e(Val,2,*),1:Val)
			if $g(%globalName)[":" q res
			set href="apptools.core.LogInfo.cls?NSP="_nspace_"&selectDSN=&WHAT=^"_Val
			set res=$replace(Val,Val,"<a title='viewGlob' target='viewGlob' href='"_href_"'>"_Val_"</a>")
		}
		if $D(Temp("Permission",Col)) {
			if $g(%globalName)[":" q res
			set:Val["R" href2="<a title='View' target='View' href=""/csp/sys/exp/UtilExpGlobalView.csp?$ID2="_%globalName_"&$NAMESPACE="_nspace_""">R</a>"
			set:Val["W" href3="<a title='Edit' target='Edit' href=""/csp/sys/exp/UtilExpGlobalDrill.csp?$ID2="_%globalName_"&$NAMESPACE="_nspace_""">W</a>"
			set res=$g(href2)_$g(href3)
		}
	}
	quit res
]]></Implementation>
</Method>

<Method name="DrawArray">
<Description>
Output a list of array elements
set st=##class(apptools.core.LogInfoPane).DrawArray(res,100,$Namespace,"Output a list 1111")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>gn:%String="",MaxNode=$$$MAXSHOW,NSpace="",Next="1",msg="",exp="",Filtr="",Execute="",fileXLS=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
		; Check if there is a record of the stack
		if $e(gn,1,4)=($$$logdevGN)||($e(gn,1,6)=("^mtemp"))||($e(gn,1,4)="^tmp") {
			if $e($g(exp))="-" {
				set:gn[$$$logdevGN stackGN=($$$logdevGN)_$e(gn,5,7)_"stack"
				set:gn["mtemp" stackGN=("^mtemp")_$e(gn,7,9)_"stack"	
				set:gn["tmp" stackGN="astack"	
				set jo=$g(@gn@(0)) KILL @gn,exp,@stackGN set:jo @gn@(0)=jo  
			}
			#; Clean and initialize the debug isolation node
			if $g(exp)?1n.n set job=exp KILL @gn@(1) if job,$d(^$j(+job)) set @gn@(0)=+job
			if gn["stack(",$qs(gn,1)?1n.n,$g(@gn)'="",$lv(@gn) {
				;$ze,$h,$tl,$io,$j,$zu(110),stack,ipRemote
				set stack=$lfs($lg(@gn,7),"|")
				set href="href='apptools.core.LogInfo.cls?NSP="_NSpace_"&WHAT="_$na(@$replace($qs(gn,0),"stack","")@(1,$qs(gn,1)))_"'"
				set anc="<a  title='"_$$$aText("Go to the protocol node","")_"' "_href_" >"_gn_"</a>"
				&html<
				<h5>View stack : #(anc)# <font color=red>$ze:</font> #($lg(@gn,1))#<font color=red> $h: </font>#($$$LoggedDT($lg(@gn,2)))#<font color=red> $tl: </font>#($lg(@gn,3))#<font color=red> $io: </font>#($lg(@gn,4))#<font color=red> $j: </font>#($lg(@gn,5))#<font color=red>  $zu(110):</font> #($lg(@gn,6))# <font color=red> IP-Adress: </font> #($lg(@gn,8))#</h5>
				<table style="border-radius: 10px; border: 1px solid #72a7cf"  cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" ><tbody>
				<tr>
					<th align="left" width="5px">#</th>
					<th align="left" width="50px">Code Link</th>
					<th align="left" width="50px">Code string</th>
				</tr>
				>
				for line2=2:1:$ll(stack) {
					set line=$lg(stack,line2)
					try {	set code=$t(@$p(line," ")) }
					catch {	set code=""	}
					quit:code["s zsr=$zr,zsG=" ;not derive itself a trap
					&html<
					<tr >
						<td align="left"  >#(line2)#</td>
						<td align="left" >#(line)#</td>
						<td align="left" >#(code)#</td>
					</tr>
					>
				}
				&html<</tbody></table>>
				set gn=$q(@gn)
			}
		} 
		if fileXLS'="",$lg(fileXLS,1) {
			d ..OpenXLSfile(fileXLS, .exportXLSfileEmail, .exportXLSfile, .io)
		}
		s num="#"
		s ref=$$$aText("reference","")
		s data=$$$aText("Data","")
		s %AppCol2="9%"
		if Execute'="" {
			s %AppLogInfoHead=1
			s %AppLogInfoTemp=data
			s num=..AddExecute(Execute,num, 1, NSpace = "",.countEx) 
			s ref=..AddExecute(Execute,ref, 2, NSpace = "",.countEx) 
			s data=..AddExecute(Execute,data, 3, NSpace = "",.countEx) 
		}
			&html<
			<h5>#($s(msg="":$$$aText("View array","")_" : "_gn_" "_$$$aText("in namespace","")_" "_$Namespace,1:msg))#</h5>
			<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" ><tbody>
			<tr>
				<th title='Edit nodes and values global' align="left" width="1%">#(num)#</th>
				<th align="left" width="#(%AppCol2)#">#(ref)#</th>
				<th align="left" width="*">#(data)#</th>
			</tr>
			>
			set (igg,ig)=gn
			set count=0,test=0
			#; The first line
			if ig'="",$g(@ig)'="",Execute="" d ..DrawNodeGN(ig,@ig,.count,,ig,$g(NSpace))
  			// For local interest arrays viewing - direct
  			set next=$s($e(gn,1)="%":1,Next["-1":-1,1:1)
  			if MaxNode<$$$MAXSHOW set MaxNode=$$$MAXSHOW
  			if $g(next)=-1 {	
  				for count2=1:1 { set ig=$q(@ig) quit:ig=""||(ig'[$e(igg,1,*-1))  set iglast=ig 
  					Quit:count2>(MaxNode*2) ##; Twice the limit
  				}
  				if $g(iglast)'="" set ig=iglast
  			}
  			if ig'="" {
	  			if next=-1 { 
	  				set NoDraw=0
		  			if $g(Filtr)'="" set NoDraw=$$ExpTestFiltr(ig,Filtr) 
		  			if $p(ig,"(",1)=$$$HISTORYGN,$g(NSpace)'="%SYS" set:$lg(@ig,2)'=$g(NSpace) NoDraw=1
		  			do:'NoDraw ..DrawNodeGN(ig,$g(@ig),.count,,ig,$g(NSpace),Execute)
	  			}
	  			for { set ig=$q(@ig,$g(next)) 
	  				quit:ig=""||(ig'[$e(igg,1,*-1))
	  				if $g(Filtr)'="" continue:$$ExpTestFiltr(ig,Filtr)
	  				set node=$e($p(ig,$e(igg,1,*-1),2),2,*)
					if $p(ig,"(",1)=$$$HISTORYGN,$g(NSpace)'="%SYS" continue:$lg(@ig,2)'=$g(NSpace)
					do ..DrawNodeGN(node,@ig,.count,$g(job),ig,$g(NSpace),Execute)
					Quit:count>MaxNode
	  			}
  			}
  			&html<</tbody></table>>
	if $g(exportXLSfile)'="" { 
		d ..CloseXLSfile(fileXLS, .exportXLSfileEmail, .exportXLSfile,.io, .count, .msg, .gn)
	}  	
	i '$d(%DrawArray) {
		$$$jsstart
		w "$('.trs').hover(function(){ " // set the function when you hover the cursor over the element and during its lead	ui-state-hover
		w "  $(this).toggleClass( 'ui-widget-content' )" 
		w " });"
		$$$jsstop
	 s %DrawArray=1
	}
  	quit $$$OK
	##; Filter conditions on a node and values
ExpTestFiltr(%gn,Filtr) set %test=0
	xecute "i '("_Filtr_") set %test=$t"   
 	quit %test
]]></Implementation>
</Method>

<Method name="AddHistory">
<Description>
Add command history</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>what,NSpace,DSN,MaxNode,Next,Filtr</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $$$HISTORYGN_",?,trm,log"'[what {
		s val=$o(@$$$HISTORYGN@(""),-1),lastcmd=""
		i val'="",$lv($g(@$$$HISTORYGN@(val))) s lastcmd=$lg($g(@$$$HISTORYGN@(val)),1)
			i $g(lastcmd)'=what { // If the commands are not repeated
			s dt=$$$AppDT($h)
			set @$$$HISTORYGN@(dt)=$lb(what,NSpace,DSN,MaxNode,Next,Filtr)
		}
	}
]]></Implementation>
</Method>

<Method name="getNode">
<Description>
Get global node</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&node,gn,NSpace=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $e(gn,1,4)=($$$logdevGN),$e(node,1)="(",$e(gn,*-4,*)'="stack" {	
		set gnSt=$$$logdevGN_$e(gn,5,7)_"stack"
		set lev2=$qs("a"_node,2)
		try {
			if lev2'="",$d(@gnSt@(lev2)) {
					set href="href='apptools.core.LogInfo.cls?NSP="_NSpace_"&WHAT="_$na(@gnSt@(lev2))_"'"
					set title=$$$aText("Show call stack","")
					try {
						set lv=@gnSt@(lev2)
						set title=title_$c(13,10)_$$$LoggedDT($lg(lv,2))
					} catch e {}
					set node=$replace(node,","_lev2_",","<a title='"_title_"' "_href_" >,"_lev2_",</a>")
			}
		} catch e {}
	}
]]></Implementation>
</Method>

<Method name="DrawNodeGN">
<Description>
Drawing the global node</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[node:%String="",val:%String="",&count,job="",gn,NSpace="",Execute=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set count=count+1
	do ..getNode(.node, gn, NSpace)
	set node=..ShowCell(node,NSpace)
	if $e(gn,1,4)=($$$logdevGN) {
		if $qs(gn,3)["%%%$$LOG^%ETN" {	
			try { set d=$zd($lg(@gn,1),1),inc=$lg(@gn,2)
			} catch e { set d="",inc=""}
			set href="href='/csp/sys/op/UtilSysAppError.csp?$ID1="_$namespace_"&$ID2="_d_"&$ID3="_inc_"'"
			set title=$$$aText("Show stack and variables","")_$c(13,10)_d_" # "_inc
			set node=$replace(node,"%%%$$LOG^%ETN","<a  title='"_title_"' "_href_" >"_"%%%$$LOG^%ETN"_"</a>")
		} 
		// If there is a serialized object, then open the browse window.
		elseif $e(val,1)="{"&&($e(val,*)="}")||($e(val,1,4)="""\""{")||($e(val,1)="[") {
			set href="style='"_$$$styleurl_"' onclick=""WinOpen('"_NSpace_"','','ShowJson','"_$zconvert(gn,"O","URL")_"','','"_##class(apptools.core.Action).WriteWinOpenREST(%request)_"');"""
			set title=$$$aText("Show formatted json","")
			set node="<a title='"_title_"' "_href_" >"_node_"</a> "
		}
		elseif $e(val,1)="<"&&($e(val,*)=">") {
			set href="style='"_$$$styleurl_"' onclick=""WinOpen('"_NSpace_"','','ShowXML','"_$zconvert(gn,"O","URL")_"','','"_##class(apptools.core.Action).WriteWinOpenREST(%request)_"');"""
			set title=$$$aText("Show","")_" XML"
			set node="<a title='"_title_"' "_href_" >"_node_"</a> "
			set val=$zconvert(val,"O","HTML")
		}
		elseif $e(val,1)="<" {
			set val=$zconvert(val,"O","HTML")
		}
	}
	#; for process detail and dashboard systems
	i job'="",val=job,node="(0)" {
		set url=$p($g(%request.CgiEnvs("HTTP_REFERER")),"/",1,3)_"/"
		set title=$$$aText("Process control","")
		set val=$replace(val,val,"<a title='"_title_"' target='process' href='"_url_"csp/sys/op/%25CSP.UI.Portal.ProcessDetails.cls?PID="_val_"&DISPLAYID=&$ID1="_val_"'>"_val_"</a>")
		set title=$$$aText("DBMS panel","")
		set val=val_" <a title='"_title_"' target='system' href='"_url_"csp/sys/op/UtilDashboard.csp?$NAMESPACE='>"_$zu(110)_"</a>"
	}
	elseif node["%AppLogId",$D(%request) {
		set url=$p($g(%request.CgiEnvs("HTTP_REFERER")),"/",1,3)_"/"
		set href="href='apptools.core.LogInfo.cls?NSP="_NSpace_"&WHAT="_$zconvert("select * from apptools.core.Log where id="_val,"O","URL")_"'"
		set node=$replace(node,"%AppLogId","<a title='Load record' "_href_">%AppLogId</a>")
	}
	else {	
		set val=..ShowCell(val,NSpace)	
	}
	set bgcolor="#c4d6d6"
	if node[",""="")" set bgcolor="white" 
	
	/// Parsing and coloring history
	if $p(gn,"(",1)=$$$HISTORYGN {
		set node=$replace(node,node,"<a href=""apptools.core.LogInfo.cls?NSP="_$lg(@gn,2)_"&Filtr="_$zconvert($lg(@gn,6),"O","URL")_"&Next="_$lg(@gn,5)_"&MaxNode="_$lg(@gn,4)_"&selectDSN="_$lg(@gn,3)_"&WHAT="_$zconvert($lg(@gn,1),"O","URL")_""" title='"_$$$aText("Load and run command","")_"'>"_node_"</a>")
		set val=$replace(val,"$lb(","$lb(<font color=red>")
		set val=$replace(val,$c(34)_","_$c(34),"</font>"_$c(34)_","_$c(34))
	}
	if Execute'="" {
		set %AppLogInfoHead=0
		set %AppLogInfoTemp=val
		set count=..AddExecute(Execute,count, 1, NSpace = "",.countEx) 
		set node=..AddExecute(Execute,node, 2, NSpace = "",.countEx) 
		set val=..AddExecute(Execute,val, 3, NSpace = "",.countEx) 
	}
	set count2="<span title='Edit' style='"_$$$styleurl_"' onclick=""WinOpen('"_NSpace_"','"_..%ClassName(1)_"','WinOpenEditNode','&node="_$zconvert(gn,"O","URL")_"','EditNode','"_##class(apptools.core.Action).WriteWinOpenREST(%request)_"');"" >"_count_"</span>"
	&html<
	<tr >
		<td align="left" >#(count2)#</td>
		<td align="left" >#(node)#</td>
		<td align="left" >#(val)#</td>
	</tr>
	>
]]></Implementation>
</Method>

<Method name="WinOpenEditNode">
<Description>
Win Open Edit Node</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set gn=$zconvert($g(Par("node")),"I","URL")
	if gn="" w $$$appError("Global link is empty") q
	if '$d(@gn) w $$$appError("Global node does not exist") q
	set PrefixIdDIV="WinOpenEdit"
	set Node=$$$appText(PrefixIdDIV_"Node","size=80",gn)
	set Value=@gn
	set:$lv(Value) Value=##class(%Global).Quote(Value)
	set Value=$$$appTextarea(PrefixIdDIV_"Value","rows=6 cols=78",Value)
	
	set onclick="ActionJs('"_PrefixIdDIV_"MainForm','"_PrefixIdDIV_"MainContent','"_..%ClassName(1)_"','WinOpenNodeSaveOrKill','~mode=*');"

	set bsave=$$$appButton(PrefixIdDIV_"idButtSave","onclick="""_$replace(onclick,"*","Save")_"""","Save")
	set bkill=$$$appButton(PrefixIdDIV_"idButtKill","onclick=""if (prompt('Delete you sure ?','Yes')) {"_$replace(onclick,"*","Kill")_"}""","Delete")
	&html<
	<center>
	<form id='#(PrefixIdDIV_"MainForm")#'>
		<table>
			<tr>
				<td style='text-align: right;'>Globals Node</td>
				<td style='text-align: left;'>#(Node)#</td>
			</tr>
			<tr>
				<td style='text-align: right;'>Value</td>
				<td style='text-align: left;'>#(Value)#</td>
			</tr>
			<tr>
				<td style='text-align: right;'>#(bsave)#</td>
				<td style='text-align: left;'>#(bkill)#</td>
			</tr>
			>
		if gn[$$$HISTORYGN||(gn[$$$GNExtentions) {
			if (gn[$$$GNExtentions) {
				set node=$qs(gn,2)
				set old=$qs(gn,1)
				set ref=$na(@$qs(gn,0)@($qs(gn,1),$qs(gn,2)))
				set desc=$G(@ref@("Desc"))
				set code=$G(@ref@("Xecute"))
				
			} else { //History
				set node=$e($tr($lg(@gn,1)," "),1,10) ;_$i(@$$$GNExtentions)
				set desc="Description "_$e($lg(@gn,1),1,100)
				set code=$lg(@gn,1)
				set old=$lg(@gn,2)
			}
			set nodeFavor=$$$appText(PrefixIdDIV_"NodeF","size=80",$g(node))
			set descFavor=$$$appTextarea(PrefixIdDIV_"DescF","rows=6 cols=78",$g(desc))
			set code=$$$appTextarea(PrefixIdDIV_"CodeF","rows=6 cols=78",$g(code))
			set bkillF=$$$appButton(PrefixIdDIV_"idButtKillF","onclick=""if (prompt('Delete you sure ?','Yes')) {"_$replace(onclick,"*","KillF")_"}""","Delete favorite")
			set bsaveS=$$$appButton(PrefixIdDIV_"idButtSaveS","onclick="""_$replace(onclick,"*","ns:%All")_"""","Save Favorite to %ALL")
			set bsaveN=$$$appButton(PrefixIdDIV_"idButtSaveN","onclick="""_$replace(onclick,"*","ns:"_$namespace)_"""","Save Favorite to "_$namespace)
			set:old'=""&&(old'=$namespace) bsaveO=$$$appButton(PrefixIdDIV_"idButtSaveO","onclick="""_$replace(onclick,"*","ns:"_old)_"""","Save Favorite to "_old)
			&html<
			<tr>
				<td style='text-align: right;'>Favorite description </td>
				<td style='text-align: left;'>#(descFavor)#</td>
			</tr>
			<tr>
				<td style='text-align: right;'>Favorite node </td>
				<td style='text-align: left;'>#(nodeFavor)#</td>
			</tr>
			<tr>
				<td style='text-align: right;'>Favorite code </td>
				<td style='text-align: left;'>#(code)#</td>
			</tr>
			<tr>
				<td style='text-align: right;'></td>
				<td style='text-align: left;'>#(bkillF)# #(bsaveN)# #(bsaveS)# #($g(bsaveO))#</td>
			</tr>
		>
		}
	&html<	</table>
	</form><div id='#(PrefixIdDIV_"MainContent")#'></div>
	</center>
	>
	q $$$OK
]]></Implementation>
</Method>

<Method name="WinOpenNodeSaveOrKill">
<Description>
WinOpenNodeSaveOrKill</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set gn=$g(Par("%request.Data","WinOpenEditNode"))
	set val=$g(Par("%request.Data","WinOpenEditValue"))
	if $g(Par("mode"))="Save" {
		set @gn=val
		write $$$appMsg("Saved") quit
	}
	elseif $g(Par("mode"))="Kill" {
		kill @gn	
		write $$$appMsg("Killed") quit
	}
	elseif $g(Par("mode"))="KillF" {
		set ref=$na(@$qs(gn,0)@($qs(gn,1),$qs(gn,2)))
		kill @ref
		write $$$appMsg("Killed favorite") quit
	}
	elseif $e($g(Par("mode")),1,3)="ns:" {
		set node=$g(Par("%request.Data","WinOpenEditNodeF"))
		set desc=$g(Par("%request.Data","WinOpenEditDescF"))
		set code=$g(Par("%request.Data","WinOpenEditCodeF"))
		set ns=$e($g(Par("mode")),4,*)
		if node="" write $$$appError("Node is empty!") quit
		if desc="" write $$$appError("Description is empty!") quit
		set @$$$GNExtentions@(ns,node,"Desc")=desc
		set ^("Xecute")=code
		write $$$appMsg("Saved favorite to "_ns) quit
	}
]]></Implementation>
</Method>

<Method name="AddExecute">
<Description>
Add an active link for the terminal</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[Execute,data,col,NSpace="",&countEx]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set %AppLogInfoVal=data
	set %AppLogInfoCol=col
	try {
		xecute "set %AppLogInfoVal2="_Execute
		if %AppLogInfoVal'=%AppLogInfoVal2 set countEx=$g(countEx)+1
		set %AppLogInfoVal=%AppLogInfoVal2
	}
	catch e { w $ze}
	quit %AppLogInfoVal
]]></Implementation>
</Method>

<Method name="AddClassRef">
<Description>
Add an active link to view the class description.</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[class,&str,NSpace=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	q:'$d(%request)
	if ##class(%Dictionary.ClassDefinition).%ExistsId(class) { 
		set url=$p($g(%request.CgiEnvs("HTTP_REFERER")),"/",1,3)_"/"
		set str=$replace(str,class,"<a title='"_$$$aText("Download class description","")_"' href='"_url_"csp/documatic/%25CSP.Documatic.cls?LIBRARY="_NSpace_"&CLASSNAME="_class_"'>"_class_"</a>")
	}
]]></Implementation>
</Method>

<Method name="AddClassId">
<Description>
Add an active link to view a class instance.</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[classname,id,&str,NSpace=""]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	if ##class(%Dictionary.ClassDefinition).%ExistsId(classname) { 
		try {set Obj=$classmethod(classname,"%OpenId",id)
			if $isobject(Obj) {
				set what="obj =##class("_classname_").%OpenId("_id_")"
			}
		} catch e {	}
		quit:$g(what)=""
		set href="href='apptools.core.LogInfo.cls?NSP="_NSpace_"&WHAT="_$zconvert(what,"O","URL")_"'"
		set str=$replace(str,"_id"":"_id,"<a title='"_$$$aText("Download a class instance","")_"' "_href_">"_"_id"":"_id_"</a>")
	}
]]></Implementation>
</Method>

<Method name="ShowCell">
<Description>
Cell drawing</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>str,NSpace=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set:$lv(str) str=##class(%Global).Quote(str)
	/*
	if $l(str,".")>2 {
		; TODO cycle through the line if there are a lot of classes
		if $p($p(str,"(",2),")",1)["." {
			set class=$p($p(str,"(",2),")",1)
			if class'="" d ..AddClassRef(class, .str, NSpace)
		}
	}*/
	if str["_class"":" {
			set class=$p($p(str,"_class"":",2),$c(34),2)
			set id=$p($p(str,"_id"":",2),",",1)
			if class'="" {
				if id'="" do ..AddClassId(class, id, .str, NSpace)
				else  d ..AddClassRef(class, .str, NSpace)
			}
	}
	;Add a link to go to the view stack
	elseif str["(",$e(str,1,4)=$$$logdevGN,str'["<a title" {
		set node="("_$p(str,"(",2,*)
		do ..getNode(.node, str, NSpace)
		quit $p(str,"(",1)_node
	}
	else {
		quit str
	}
	quit str
]]></Implementation>
</Method>

<Method name="OpenXLSfile">
<Description>
Open file XLS</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[fileXLS,&exportXLSfileEmail,&exportXLSfile,io]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s exportXLSfileEmail=$lg(fileXLS,3)
	s exportXLSfile=$lg(fileXLS,2)
	set io=$i
	if '##class(apptools.core.files).OpenFile(exportXLSfile,1) use io write !,$$$aText("Do not open file","")_" "_exportXLSfile quit
	use exportXLSfile	
	&html<
	<html xmlns:v="urn:schemas-microsoft-com:vml"
	xmlns:o="urn:schemas-microsoft-com:office:office"
	xmlns:x="urn:schemas-microsoft-com:office:excel"
	xmlns="http://www.w3.org/TR/REC-html40">
	<head>
	<meta http-equiv=Content-Type content="text/html; charset=utf-8">
	<meta name=ProgId content=Excel.Sheet>
	<meta name=Generator content="Microsoft Excel 15">
	</head>
	<body>
	>
	quit
]]></Implementation>
</Method>

<Method name="CloseXLSfile">
<Description>
Close file XLS</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[fileXLS,&exportXLSfileEmail,&exportXLSfile,io,count,msg,SQL]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	&html<	
	</body>
	</html>>
	use io close exportXLSfile
	s slash=##class(apptools.core.files).getSlash()
	s path=$p(exportXLSfile,slash,1,*-1)
	s sc=##class(apptools.core.files).zipFile(path,$p(exportXLSfile,slash,*),$p(exportXLSfile,slash,*)_".zip",path)
	if sc s exportXLSfile=exportXLSfile_".zip"
	;i 'sc ;s $$$AppL("APP","CloseXLSfile-zipFile")=$System.Status.GetErrorText(sc) 
	// Send file to e-mail
	i exportXLSfileEmail'="" {
		s sc=##class(apptools.core.LogInfo).SendEmail(exportXLSfileEmail, $$$aText("Send file","")_" "_exportXLSfile, $g(msg)_"<br> "_$$$aText("Namespace","")_" :"_$Namespace_"<br> "_$$$aText("Query","")_": "_SQL, exportXLSfile)
		i 'sc write $System.Status.GetErrorText(sc) ;s $$$AppL("APP","CloseXLSfile-SendEmail")=$System.Status.GetErrorText(sc) 
		}
	write !,"<br><h5>"_$$$aText("Query result","")_" ("_(+count)_" "_$$$aText("lines) uploaded to file","")_" "_exportXLSfile_"</h5>"
	quit
]]></Implementation>
</Method>

<Method name="DrawSQL">
<Description>
Query table output
fileXLS - list of parameters for uploading to Excel and sending by mail
 $lg(fileXLS,1) =1 flag 
	s exportXLSfileEmail=$lg(fileXLS,3) - parcel addresses separated by commas, to which to send the file
	s exportXLSfile=$lg(fileXLS,2) - full path to the file where to write the table
 mode=1 - not included number colomn

d ##class(App.LogInfoPane).DrawSQL("query %SYS.GlobalQuery:NameSpaceList %SYS %S*",10000,$namespace," ")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SQL:%String="",MaxNode=$$$MAXSHOW,NSpace="",msg="",Execute="",fileXLS="",Mode="",FiltrRow=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set hoverClass="hc"_$tr($zts,",.")
	if ($zconvert($e(SQL,1),"L")="q") {
		try { set st=1
			if $e($p(SQL," ",2,99),1,2)="##" {
				x "set %q2="_$p(SQL," ",2)
				set query=%q2
			}
			else {
				set query=##class(%Library.ResultSet).%New($p(SQL," ",2))
			}
			if $p(SQL," ",4)'="" {set st=query.Execute($p(SQL," ",3),$p(SQL," ",4))}
			elseif $p(SQL," ",3)'="" {set st=query.Execute($p(SQL," ",3))}
			else {set st=query.Execute()}
			set msg=SQL
		} catch e { 
			set errmsg=SQL_" "_$$$aText("Error","")_" "_$ze q ;$$$ERROR($$$GeneralError,msg) 
		}
		quit:'st st
		quit:$g(errmsg)'="" errmsg
	}
	elseif ($zconvert($e(SQL,1),"L")="r") {
		set resGN=$p(SQL," ",2,99)
		if '$d(@resGN) {
			set msg=SQL_" "_$$$aText("Link does not exist",""),ColCount=0
		}
		else {
			i $g(@resGN@(0))'="" {
				s ColCount=$ll(@resGN@(0)) //for local sql
			}
			else {
				 s ColCount=$o(@resGN@(0,""),-1)  //for sql via DSN
			}
		}
	}
	else {
		set query=##class(%ResultSet).%New()
		set st=query.Prepare(SQL)
		if 'st quit st
		set st=query.Execute()
		if 'st quit st
	}
	set (count)=0
	if $g(resGN)="" set ColCount=query.GetColumnCount()
	
	if fileXLS'="",$lg(fileXLS,1) {
		d ..OpenXLSfile(fileXLS, .exportXLSfileEmail, .exportXLSfile, .io)
	}

	&html<
	<h7>#($s(msg'="":msg,1:"Query: "_SQL))#</h7>
	<table style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" width="90%">
	<thead>
		<tr class='trs #(hoverClass)#' >
		>
	if 'Mode write "<th width=""1%"">#</th>"
	
	s %AppLogInfoHead=1 //Processing title
	For i=1:1:ColCount {
		&html<	<th width="5%">>
		set %AppLogInfoCol=i
		if $g(resGN)'="" {
			if $d(@resGN@(0,i)) {set %AppLogInfoVal=$g(@resGN@(0,i))	if $lv(%AppLogInfoVal) set %AppLogInfoVal=$lg(%AppLogInfoVal,1)
			}
			else { set %AppLogInfoVal=$lg($g(@resGN@(0)),i)
			}
		}
		else {
			set %AppLogInfoVal=query.GetColumnName(i)
		}
			if Execute'="" {
				try {
					xecute "set %AppLogInfoVal2="_Execute
					if %AppLogInfoVal'=%AppLogInfoVal2 set countEx=$g(countEx)+1
					set %AppLogInfoVal=%AppLogInfoVal2
				}
				catch e {
					set %AppLogInfoVal=$zconvert($ze,"O","HTML")
					}
			}
			else {set %AppLogInfoVal=..ShowCell(%AppLogInfoVal,NSpace)	
			}
			write %AppLogInfoVal
		&html<&nbsp;</th>>	
	}
	&html<	</tr></thead><tbody>	>
	s %AppLogInfoHead=0 //We process lines
	if $g(resGN)'="" { set i=0
		for { set i=$order(@resGN@(i))   quit:i=""
			if FiltrRow'="",'$D(@FiltrRow@(i)) continue 
			for ii=1:1:ColCount set GetData(ii)=$s($lv($GET(@resGN@(i),"?")):$lg(@resGN@(i),ii),1:$GET(@resGN@(i,ii)))
			d qNext(.GetData,i) q:$g(stopWrite)
		}
	}
	else {
		while query.Next() { 
			for ii=1:1:ColCount set GetData(ii)=query.GetData(ii)
			d qNext(.GetData) q:$g(stopWrite)
		}
	}
	&html<</tbody></table>>
	if msg=" " {}
	else {
		Write !,$$$aText("Number of records found","")_" :"_+$g(count)
		if Execute'="" {
			Write !,$$$aText("Contextual changes or allotments","")_" :"_+$g(countEx)
		}
	}
	if $g(exportXLSfile)'="" { 
		d ..CloseXLSfile(fileXLS, .exportXLSfileEmail, .exportXLSfile,.io, .count, .msg, .SQL)
	}
	;Set the hover for table rows
	i '$d(%DrawSQL) {
	$$$jsstart
		w "$('."_hoverClass_"').hover(function(){ " // set the function when you hover the cursor over the element and during its lead	ui-state-hover
		w "  $(this).toggleClass( 'ui-widget-content' )" 
		w " });"
	$$$jsstop
	 s %DrawSQL=1
	}
	quit $$$OK
 // Handling one query string
qNext(GetData,cou="")
		set count=count+1
		write "<tr class='trs "_hoverClass_"' >"
		if 'Mode write "<th>"_$s(cou="":count,1:cou)_"</th>"
		if count>MaxNode w "<th style='color:red'>... "_$$$aText("More entries","")_" "_MaxNode_"</th></tr>" s stopWrite=1 QUIT
		for ii=1:1:ColCount {	
			set %AppLogInfoVal=$g(GetData(ii))
			set %AppLogInfoCol=ii
			if Execute'="" {
				try {
					xecute "set %AppLogInfoVal2="_Execute
					if %AppLogInfoVal'=%AppLogInfoVal2 set countEx=$g(countEx)+1
					set %AppLogInfoVal=%AppLogInfoVal2
				}
				catch e {}
			}
			else {
				set %AppLogInfoVal=..ShowCell(%AppLogInfoVal,NSpace)	
			}
			if $g(exportXLSfile)'="",%AppLogInfoVal?1.N s %AppLogInfoVal="&nbsp;"_%AppLogInfoVal
			write "<t"_$s(ii=1:"h",1:"d")_">"_(%AppLogInfoVal)_"</t"_$s(ii=1:"h",1:"d")_">"	
		}
			&html<</tr> >
	quit
]]></Implementation>
</Method>

<Method name="GetPathStack">
<Description>
Get call stack</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set $ECODE=""
	set Path=""
	for loop=0:1:$STACK	{
		if Path'="" set Path=Path_"~"
		set Path=Path_$case(Path,"":"",:"|")_$STACK(loop,"PLACE")
		if $l(Path)>32000 quit
	}
	set Path=$tr(Path,$c(9),"")
	quit Path
]]></Implementation>
</Method>

<Method name="GetValueObj">
<Description><![CDATA[
/*! \brief The method implements getting values
<br>\defgroup class_definition Class definition
<br>\ingroup class_definition
<br>\param in - class property description
<br>\param out - result of values 
<br>\example 	d ##class(apptools.core.LogInfoPane).GetClassDef(classname,Obj,.out)
<br>	 				d ##class(apptools.core.LogInfoPane).GetValueObj(Obj,.out,.res) */]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>obj,in,out</FormalSpec>
<Implementation><![CDATA[
	set p="" for  { set p=$o(in(p)) quit:p=""
		set n="" for { set n=$o(in(p,n)) quit:n=""
			try {
				set val=$c(1,2,3)
				if p="Methods" { i n'="getname" continue:$e(n,*-2,*)'="Get"
					set val=$METHOD(obj,n)
				}
				elseif p="Parameters" { 
					set val=$PARAMETER(obj,n)
				}
				elseif p="Properties" { 
					set val=$PROPERTY(obj, n)
				}
				set:val'=$c(1,2,3) out(p,n,"=")=val
			}
			catch (e) {
			}
		}
	}
	quit $$$OK
]]></Implementation>
</Method>

<Method name="GetClassDef">
<Description><![CDATA[
/*! \brief Parse class description into methods and properties
<br>\ingroup class_definition
\example d ##class(apptools.core.LogInfoPane).GetClassDef("utils.Log","",.out) */]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[aClassName:%String="",doc,&out,inSuper=1]]></FormalSpec>
<Implementation><![CDATA[
	if $g(doc)'="", $isobject(doc) set aClassName=doc.%ClassName(1)
	set classDefinition=##class(%Dictionary.ClassDefinition).%OpenId(aClassName)
	if ('$isobject(classDefinition)) {
		quit $g(%objlasterror)
	}

	// class description
	set classDescription=$zstrip(classDefinition.Description,"<>W")
	set out("ClassName",aClassName)=classDescription
	if classDefinition.Super'="" {
		set out("ClassName",aClassName,"super")=classDefinition.Super
		if inSuper {
			for sup=1:1:$l(classDefinition.Super,",") {  continue:$p(classDefinition.Super,",",sup)=""
				do ..GetClassDef($p(classDefinition.Super,",",sup),,.out)
			}
		}
	}
	// description of methods
	if (classDefinition.Methods.Count()>0) {
		set key=""
		while(1) {
			set methodDefinition=classDefinition.Methods.GetNext(.key)
			quit:(key="")
			set out("Methods",methodDefinition.Name,"Description")=methodDefinition.Description
		} 
	}
	// Property descriptions
	if (classDefinition.Properties.Count()>0) {
		set key=""
		while(1) {
			set propertyDefinition=classDefinition.Properties.GetNext(.key)
			quit:(key="")
			set out("Properties",propertyDefinition.Name,"Description")=propertyDefinition.Description
			set out("Properties",propertyDefinition.Name,"Name")=propertyDefinition.Name
			set out("Properties",propertyDefinition.Name,"Type")=propertyDefinition.Type
			set out("Properties",propertyDefinition.Name,"ReadOnly")=propertyDefinition.ReadOnly
			set out("Properties",propertyDefinition.Name,"Required")=propertyDefinition.Required
			set out("Properties",propertyDefinition.Name,"Parameters")=$$$AppObJs(propertyDefinition.Parameters)
		}
	}
	// Parameter Descriptions
	if (classDefinition.Parameters.Count()>0) {
		set key=""
		while(1) {
			set parameterDefinition=classDefinition.Parameters.GetNext(.key)
			quit:(key="")
			set out("Parameters",parameterDefinition.Name,"Description")=parameterDefinition.Description
			set out("Parameters",parameterDefinition.Name,"Default")=parameterDefinition.Default
		}
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="GetSysinfo">
<Description>
 d ##class(apptools.core.LogInfoPane).GetSysinfo()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>color,code=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set sys=" <a target='license' href=""/csp/sys/op/UtilDashboard.csp?$NAMESPACE=%25SYS""> "_$$$aText("System Dashboard","")_"</a>"
	set sysinfo="<font color="_color_">"_##class(apptools.core.LogInfo).GetImgJqUi("tools")_"</font> "_$$$aText("Server","")_": <font color="_color_">"_$zu(110)_"</font> "_$$$aText("NameSpace","")_": <font color="_color_">"_$Namespace_"</font> $JOB: <font color="_color_">"_$j_"</font> "_$g(sys)
	if $$$MultiLang {
		set lang=$g(@$$$GNEnsConf@("Language"))
		if lang="" s lang=##class(%MessageDictionary).GetSessionLanguage()
		set list=##class(%MessageDictionary).GetLanguages()
		set key=$lb(""),gGN=""
		for i=1:1:list.Count() {
			s key=key_$lb(list.GetAt(i))
		}
		if 'list.Count() s key=$lb($mvv(58))
		do ##class(apptools.core.Form).SelectField(key,"document.getElementById(""AppLang"").value=this.options[this.selectedIndex].value;document.forms[""loginfo""].submit();",key,.gGN,,"ChangeLang",lang,50,1)
		set key="" for i=1:1 {q:'$DATA(gGN(i))  s key=key_gGN(i)}
		set langselect=" <input type='hidden' id='AppLang' name='AppLang'>"_key
	}
	q sysinfo_$g(langselect)
]]></Implementation>
</Method>

<Method name="AddAction">
<Description>
/*! \example d ##class(apptools.core.LogInfoPane)AddAction()*/</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>nameElem="NSP,MaxNode,Filtr,Next,WHAT,tWHAT,exportXLS,exportXLSfile,exportXLSfileEmail,selectDSN,SDNum"</FormalSpec>
<Implementation><![CDATA[
	&html<
	<table>
	 <tr style='vertical-align: middle;' >
	   <td>
		<span class='ui-icon ui-icon-play' name="show" id="show" onclick="document.forms['loginfo'].submit();" title='#($$$aText("Execute and Show",""))#'></span>
		<input type="submit" name="show" id="show" value='#($$$aText("Execute",""))#'>
		<span class='ui-icon ui-icon-arrowreturnthick-1-w' onclick='window.history.back(); return false' title='#($$$aText("Go back",""))#'></span>
		#(##class(apptools.core.LogInfo).ClearFields(nameElem))# 
	  </td>
	  <td>
	  	#(##class(apptools.core.LogInfo).GetInfoImg("tools"))# 
	 </td>
    </tr>
   </table>
	>
	q ""
]]></Implementation>
</Method>

<Method name="AddProdQuery">
<Description>

/*! \example ##class(apptools.core.LogInfoPane).AddProdQuery() */</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SDNum,csp="csp"</FormalSpec>
<Implementation><![CDATA[
	&html< <tr style='vertical-align: middle;' >
	<td> 
	 | <a uk-icon="m-dashboard" target="ensprod"#($Namespace)# href='#("/"_csp_"/"_$zconvert($Namespace,"L")_"/EnsPortal.ProductionConfig.zen?$NAMESPACE="_$Namespace)#' > #($$$aText("Production",""))#</a> 
	 | <a uk-icon='m-assignment-late' target="ensproderr"#($Namespace)# href='#("/"_csp_"/"_$zconvert($Namespace,"L")_"/EnsPortal.EventLog.zen?$NAMESPACE="_$Namespace)#' > #($$$aText("Production Errors",""))#</a> 
	 | <a uk-icon='m-assignment' target="ensqueues"#($Namespace)# href='#("/"_csp_"/"_$zconvert($Namespace,"L")_"/EnsPortal.Queues.zen?$NAMESPACE="_$Namespace)#' > #($$$aText("Production Queues",""))#</a> 
	 | <a uk-icon='m-chevron-right' target="query"#($Namespace)# href='#("/csp/sys/exp/%25CSP.UI.Portal.SQL.Home.zen?$NAMESPACE="_$Namespace)#' > #($$$aText("Query",""))# </a> 
	 | <a uk-icon='m-expand-less' target="globals"#($Namespace)# href='#("/csp/sys/exp/%25CSP.UI.Portal.GlobalList.zen?$NAMESPACE="_$Namespace)#' > #($$$aText("Globals",""))# </a> 
	#($s(##class(apptools.core.sys).ClassExist("WebTerminal.Engine"):" | "_$$$addAppLog($$$aText("WebTerminal",""),$$$aText("Load WebTerminal",""),"trm",""),1:""))#
	 | 
	</td></tr>>
	q ""
]]></Implementation>
</Method>

<Method name="ExportProjects">
<ClassMethod>1</ClassMethod>
<FormalSpec>Dir,files</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	q $$$OK
]]></Implementation>
</Method>

<Method name="GetHelp">
<ClassMethod>1</ClassMethod>
<FormalSpec>help</FormalSpec>
<Implementation><![CDATA[
	#define sH(%msg) set help($i(help))=%msg
	$$$sH($$$aText("Call examples",""))
	$$$sH(" ")
	$$$sH(" "_$$$addAppLog("^%apptools.Setting","","^%apptools.Setting","")_" --- "_$$$aText("View and edit global with the basic settings panel",""))
	for gn=##class(apptools.core.Production).#SettingsGN,$$$PROJGN,$$$GNExtentions {
		$$$sH(" "_$$$addAppLog(gn,"",gn,"")_" --- "_$$$aText("View and edit global",""))
	}
	$$$sH(" ")
	$$$sH(" "_$$$addAppL("obj ##class(apptools.core.Log).%New()")_" --- "_$$$aText("To obtain information on the class",""))
	$$$sH(" "_$$$addAppL("obj ##class(apptools.core.Log).%OpenId(2)")_" --- "_$$$aText("To obtain information on class and object",""))
	$$$sH(" "_$$$addAppL("obj =##class(apptools.core.Log).%OpenId(2)")_" --- "_$$$aText("To obtain information only on the object values",""))
	$$$sH(" ")
	; $$$sH(" "_$$$addAppL("xec set obj=##class(apptools.core.Log).%OpenId(2) write ""<pre>"" zw obj w ""</pre>"" ")_"--- "_$$$aText("Execute command : to Show dump of the object ",""))
	$$$sH(" "_$$$addAppL("xec do ##class(apptools.core.sys).SaveQuery(""%SYSTEM.License:Counts"",""^mtempGN"",0) zwrite ^mtempGN")_"--- "_$$$aText("Run the command : Save the query result in the global ^GN",""))
	$$$sH(" "_$$$addAppL("result ^mtempGN(""%SYSTEM.License:Counts"",0)")_" --- "_$$$aText("Bring recorded in the global result of the query","")_" ##class(apptools.core.sys).SaveQuery")
	$$$sH(" ")
	$$$sH(" "_$$$addAppL("query ##class(%Library.ResultSet).%New(""%SYS.Portal.Users:List"")")_"--- "_$$$aText("Run the query and show the favorites page for the user",""))
	$$$sH(" "_$$$addAppL("query ##class(%Library.ResultSet).%New(""%SYSTEM.License:Counts"")")_"--- "_$$$aText("Run the query and show license usage",""))
	$$$sH(" "_$$$addAppL("query %SYSTEM.License:Counts")_"--- "_$$$aText("Run the query and show license usage",""))
	$$$sH(" "_$$$addAppL("query %SYS.GlobalQuery:NameSpaceList USER")_" --- "_$$$aText("show the list globalaw in the USER area",""))
	;$$$sH(" "_$$$addAppL("query %SYS.GlobalQuery:Size /opt/isc/ensemble/mgr/USER/")_" --- "_$$$aText("to calculate the size globalaw our database USER",""))
	$$$sH(" ")
	$$$sH(" "_$$$addAppL("select * FROM apptools_core.Log order by id desc")_" --- "_$$$aText("To execute arbitrary sql query",""))
	$$$sH(" ")
	set fio=$g(@$$$MgtPortalSettings@($Username,"DeveloperName"),"DEV")
	set gn=$$$logdevGN_fio
	$$$sH(" "_$$$addAppLog("^*","","^*","")_" --- "_$$$aText("show a list of all globalaw in the current scope",""))
	$$$sH(" "_$$$addAppLog("^log*","","^log*","")_" --- "_$$$aText("show the list globalaw mask",""))
	$$$sH(" "_$$$addAppLog("^log**","","^log**","")_" --- "_$$$aText("show the list globalaw with the occupied size Allocated MB",""))
	$$$sH(" "_$$$addAppLog("^log***","","^log***","")_" --- "_$$$aText("show the list globalaw with the occupied size Allocated MB Used MB and",""))
	$$$sH(" "_$$$addAppLog("^tmp**","","^tmp**","")_" --- "_$$$aText("show the list globalaw with the occupied size Allocated MB",""))
	$$$sH(" "_$$$addAppLog("^ISCSOAP","","^ISCSOAP","")_" --- "_$$$aText("Global SOAP (on the prod should be removed)",""))
	
	$$$sH(" ")
	if ##class(apptools.core.sys).ClassExist("WebTerminal.Engine") {
		$$$sH(" "_$$$addAppLog("trm","","trm","")_" --- "_$$$aText("Open the built-in Web Terminal ",""))
	}
	$$$sH("--- "_$$$aText("If this macro is to insert in the test program","")_" $$$LogDebug(""Debug info"") "_$$$aText("table apptools.core.Log pojawia new record",""))
	$$$sH("---  $$$AppL("""_fio_""",""node"")=$$$AppObJs(object) "_$$$aText("will record in global","")_" "_gn_" "_$$$aText("an object in the format","")_" json")
	
	$$$sH(" "_$$$addAppL("xec job ##class(apptools.core.files).OneDayJournalCount()::0 if $test write ""Processing""")_" --- "_$$$aText("Attention! The process can be long. Information about globalo default written in ","")_$$$TEMPJRNL)
	$$$sH(" "_$$$addAppL("xec do ##class(apptools.core.files).Export2CSV()")_" --- "_$$$aText("Display information about globalo of","")_" "_$$$TEMPJRNL_" in "_$$$EMAILXLSPATH_"JrnCount*.csv")
	$$$sH(" "_$$$addAppL("xec Set tSC = ##class(%SYS.Portal.Users).%AddFavorite(""apptools"",""/apptools/apptools.core.LogInfo.cls?WHAT=%3F"") zwrite tSC")_" --- "_$$$aText("Add a link to AppTools in the management portal",""))
	;$$$sH(" "_$$$addAppL("post http://User:pass@localhost:57772/apptoolsrest/jsonrpc"_$c(13,10)_"{""jsonrpc"":""2.0"",""method"":""server.shutdown"",""params"":{""server"":""42""},""id"":1}")_" --- Perform http request with POST method with a JSON body")
	;$$$sH(" "_$$$addAppL("get https://openexchange.intersystems.com/index.html")_" --- to Perform http request with POST method with a JSON body")
	$$$sH(" ")
	
	/*
	##;3. Prevent page refresh at session end - #;YSD2224 
	%SYS> -  %CSP.Util.AutoPage).DrawAutoLogout()  
	;	If %request.URL '[ "UtilSqlQuery.csp" && ( %request.URL '[ "/apptools.") && ( %request.URL '[ "/App.") { ##; MSW
	*/
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.Parameter">
<Description>
Example Parameters</Description>
<Super>%Persistent</Super>
<TimeChanged>65611,76707.144126</TimeChanged>
<TimeCreated>65607,76510.846247</TimeCreated>

<Parameter name="AppORDERPROPERTY">
<Description>
The order of the properties in the output in the form</Description>
<Default>Name,Description,Value,Types,Namespace,DateStart,DateFinish,File,isEnabled,isEnabledCheck,OfficeFile</Default>
</Parameter>

<Property name="Namespace">
<Description>
Namespace $zu(5) use parameter</Description>
<Type>%String</Type>
<InitialExpression>$zu(5)</InitialExpression>
<Parameter name="MAXLEN"/>
</Property>

<Property name="Name">
<Description>
The name of the parameter</Description>
<Type>%String</Type>
<Required>1</Required>
<Parameter name="MAXLEN"/>
</Property>

<Property name="Value">
<Description>
Parameter value default</Description>
<Type>%String</Type>
<Parameter name="MAXLEN"/>
</Property>

<Property name="Description">
<Description>
The description of the parameter
{"displayname":"Description of option","title":"parameter Description","inputpattern":"textarea"}</Description>
<Type>%String</Type>
<Parameter name="MAXLEN"/>
</Property>

<Property name="DateStart">
<Description>
Date of sampling Protocol
{"displayname":"date of sampling Protocol","title":"enter date","inputtype":"date"}</Description>
<Type>%String</Type>
<InitialExpression>##class(apptools.core.type).GetYear($h)_"-01-01"</InitialExpression>
<Parameter name="MAXLEN"/>
</Property>

<Property name="DateFinish">
<Description>
Date of sampling Protocol on
{"displayname":"date of sampling Protocol","title":"enter the date and time","inputtype":"datetime-local"}</Description>
<Type>%String</Type>
<InitialExpression>##class(apptools.core.type).GetYear($h)_"-12-31"</InitialExpression>
<Parameter name="MAXLEN"/>
</Property>

<Property name="isEnabledCheck">
<Description>
Type Boolean in a checkbox
{"displayname":"Enabled","inputtype":"checkbox"}</Description>
<Type>%Boolean</Type>
<InitialExpression>1</InitialExpression>
</Property>

<Property name="isEnabled">
<Description>
Type Boolean in a list
{"displayname":"Included","title":"enter (1 or 0)"}</Description>
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="File">
<Description>
Select the file to upload to drive TempDir = ##class(%File).GetDirectory(##class(%File).TempFilename())
{"displayname":"Select template file","title":"the Choice sablona","inputpattern":"files","filesMethod":"##class(apptools.core.type).UploadFilesJS(%id)","attr":"accept='.xls,.xlsx'","filesStore":"TempDir"}</Description>
<Type>%String</Type>
<Parameter name="MAXLEN"/>
</Property>

<Property name="Types">
<Description>
The list of parameter types
{"displayname":"parameter Types","title":"Select a Type"}</Description>
<Type>%String</Type>
<InitialExpression>"AppOption"</InitialExpression>
<Required>1</Required>
<Parameter name="DISPLAYLIST" value=",Project,Application Parameter,System Parameter"/>
<Parameter name="MAXLEN" value="1"/>
<Parameter name="VALUELIST" value=",Projecr,AppOption,SysOption"/>
</Property>

<Property name="OfficeFile">
<Description>
Select the file to download to disk TempDir
{"displayname":"Select file","title":"Select file","inputpattern":"files"}</Description>
<Type>%String</Type>
<Parameter name="MAXLEN"/>
</Property>

<Storage name="Default">
<Type>%Storage.Persistent</Type>
<DataLocation>^%apptools.core.ParameterD</DataLocation>
<DefaultData>ParameterDefaultData</DefaultData>
<IdLocation>^%apptools.core.ParameterD</IdLocation>
<IndexLocation>^%apptools.core.ParameterI</IndexLocation>
<StreamLocation>^%apptools.core.ParameterS</StreamLocation>
<Data name="ParameterDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>name</Value>
</Value>
<Value name="3">
<Value>dob</Value>
</Value>
<Value name="4">
<Value>ts</Value>
</Value>
<Value name="5">
<Value>num</Value>
</Value>
<Value name="6">
<Value>Namespace</Value>
</Value>
<Value name="7">
<Value>TESTSERVER</Value>
</Value>
<Value name="8">
<Value>EMAILSERVERIP</Value>
</Value>
<Value name="9">
<Value>EMAILSERVERPORT</Value>
</Value>
<Value name="10">
<Value>EMAILAUTH</Value>
</Value>
<Value name="11">
<Value>EMAILAUTHPASS</Value>
</Value>
<Value name="12">
<Value>EMAILSUPPORT</Value>
</Value>
<Value name="13">
<Value>EMAILXLSPATH</Value>
</Value>
<Value name="14">
<Value>PATHCSPUI</Value>
</Value>
<Value name="15">
<Value>ServerName</Value>
</Value>
<Value name="16">
<Value>DateStart</Value>
</Value>
<Value name="17">
<Value>DateFinish</Value>
</Value>
<Value name="18">
<Value>Description</Value>
</Value>
<Value name="19">
<Value>Name</Value>
</Value>
<Value name="20">
<Value>isBiddingByOne</Value>
</Value>
<Value name="21">
<Value>FileOther</Value>
</Value>
<Value name="22">
<Value>FileOtherOriginalFileName</Value>
</Value>
<Value name="23">
<Value>contractType</Value>
</Value>
<Value name="24">
<Value>Types</Value>
</Value>
<Value name="25">
<Value>isEnabled</Value>
</Value>
<Value name="26">
<Value>File</Value>
</Value>
<Value name="27">
<Value>FileName</Value>
</Value>
<Value name="28">
<Value>ImageFile</Value>
</Value>
<Value name="29">
<Value>ImageGlobal</Value>
</Value>
<Value name="30">
<Value>isEnabledCheck</Value>
</Value>
<Value name="31">
<Value>OfficeFile</Value>
</Value>
<Value name="32">
<Value>Value</Value>
</Value>
<Value name="33">
<Value>ImageFileName</Value>
</Value>
<Value name="34">
<Value>ImageGlobalName</Value>
</Value>
<Value name="35">
<Value>CustomFile</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="apptools.core.Production">
<Description>
Utilities for group work with Ensemble or Interoperability products of different Namespaces
d ##class(apptools.core.Production).SaveAndStop()
d ##class(apptools.core.Production).StartAll()</Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65952,29748.884405</TimeChanged>
<TimeCreated>65607,76510.942315</TimeCreated>

<Parameter name="TIMEOUTSTOP">
<Description>
How long to wait for the product to stop before being stopped again by force (seconds)</Description>
<Default>60</Default>
</Parameter>

<Parameter name="SettingsGN">
<Default>^%apptools.core.Productions</Default>
</Parameter>

<Method name="SaveStat">
<Description>
 Check and save settings and status of products in all Namespaces
 d ##class(apptools.core.Production).SaveStat(1)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>resave=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s listns=##class(apptools.core.sys).ListNS(.inf,"NotPref,Ens")
	s GN=..#SettingsGN
	i 'resave,$d(@GN) w !,"Settings have already been saved. Rewrite ? [Y/N] <N>" r r q:$zconvert(r,"L")'["y"
	KILL @GN
	MERGE @GN=inf
	w !,"Updated "_GN,!!
	s ns=""
	f { s ns=$o(inf(ns)) q:ns=""
	 zw inf(ns,"Ens")
	}
 quit $$$OK
]]></Implementation>
</Method>

<Method name="SaveAndStop">
<Description>
 Save settings and status of products in all Namespaces; Stop all productions
 d ##class(apptools.core.Production).SaveAndStop()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	d ..SaveStat(1)
	d ..StopAll()
]]></Implementation>
</Method>

<Method name="StopAll">
<Description>
Remove autostart from all products; stop all products in Namespaces before restarting the OS
d ##class(apptools.core.Production).StopAll()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 d ..EnsAction("auto0")
 d ..EnsAction("stop")
 w !!,"ok"
 q
]]></Implementation>
</Method>

<Method name="StartAll">
<Description>
Check and restore autorun products in Namespaces, run all products that were launched
d ##class(apptools.core.Production).StartAll()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>nsOnly=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 	d ..EnsAction("auto1")
 	d ..EnsAction("start",nsOnly)
 	w !!,"ok"
 	q
]]></Implementation>
</Method>

<Method name="CreateProduction">
<Description>
Create new Interoperability Production (from diashenrique.messageviewer.util.InstallerProduction)
https://openexchange.intersystems.com/package/IRIS-Interoperability-Message-Viewer
write $System.Status.GetErrorText(##class(apptools.core.Production).CreateProduction("USER","Test.TestProd","Ens.MonitorService,Ens.Alerting.AlertManager,Ens.Activity.Operation.REST"))
zn "USER" do ##class(Ens.Director).StartProduction("Test.TestProd")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ns=$Namespace,pn="TestProduction",ConfItem=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	New $Namespace
	Set $Namespace = ns
	d ..Init(ns)
	Set sc = $$$OK
	Try {
		#; create new production
		Set class = ##class(%Dictionary.ClassDefinition).%New(pn)
		Set class.ProcedureBlock = 1
		Set class.Super = "Ens.Production"
		Set class.GeneratedBy = $ClassName()
		Set xdata = ##class(%Dictionary.XDataDefinition).%New()
		Set xdata.Name = "ProductionDefinition"
		Do xdata.Data.Write("<Production Name="""_pn_""" LogGeneralTraceEvents=""true""></Production>")	
		Do class.XDatas.Insert(xdata)
		Set sc = $$$ADDSC(sc,class.%Save())
		Set sc = $$$ADDSC(sc,$System.OBJ.Compile(pn,"fck-dv"))
		if ConfItem'="" {
			Set production = ##class(Ens.Config.Production).%OpenId(pn)
			for i=1:1:$l(ConfItem,",") { continue:$p(ConfItem,",",i)=""
				Set item = ##class(Ens.Config.Item).%New()
				Set item.ClassName = $p(ConfItem,",",i)
				Do production.Items.Insert(item)
				Set sc = $$$ADDSC(sc,production.%Save())
			}
		}
	}
    Catch (err) {
		Set sc = $$$ADDSC(sc,err.AsStatus())
	}
	Return sc
]]></Implementation>
</Method>

<Method name="CreateTasksPurgeMess">
<Description>
Creating tasks message cleaning
d ##class(apptools.core.Production).CreateTasksPurgeMess(30)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>days=90</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s listns=##class(apptools.core.sys).ListNS(.inf,"NotPref,Ens")	
	set ns=""
	for { set ns=$o(inf(ns)) q:ns=""
		continue:'$d(inf(ns,"Ens"))
	 	write !,ns," ",..CreateTaskPurge("Cleaning productions messages "_ns,ns,days)
	}
 quit $$$OK
]]></Implementation>
</Method>

<Method name="CreateTaskPurge">
<Description>
Create a task to clean productions messages
 w ##class(apptools.core.Production).CreateTaskPurge("Cleaning production messages "_$Namespace,$Namespace,7) }</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Name:%String="",ns=$Namespace,days=90</FormalSpec>
<Implementation><![CDATA[
		Set Task=##Class(%SYSTEM.Task).%New()
		Set Task.Name=Name 
		Set Task.Type=0
		Set Task.Description=Name
		Set Task.TaskClass="Ens.Util.Tasks.Purge"
		#;Every day at 1:00 am
		Set Task.DailyStartTime=3600
		;Do Task.idSet(Number)
		Set Task.RunAsUser="SuperUser"
		Set Task.MirrorStatus=3
		s t=##class(Ens.Util.Tasks.Purge).%New()
		s t.KeepIntegrity=1
		s t.NumberOfDaysToKeep=days
		s t.BodiesToo=1
		s t.TypesToPurge="all"
		Set Task.Settings=t.GetSettings()
		s Task.NameSpace=ns
		q Task.%Save()
]]></Implementation>
</Method>

<Method name="Init">
<Description>
Initiate all Namespaces for the Ensemble\Interoperability
d ##class(apptools.core.Production).Init("USER")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>nsList=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if nsList="" set nsList=##class(apptools.core.sys).ListNS(.inf,"NotPref")
	for i=1:1:$l(nsList) {
		continue:$p(nsList,",",i)=""
		do ##class(%EnsembleMgr).EnableNamespace($p(nsList,",",i),1) 
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="EnsAction">
<Description>
Change products status in Namespaces
d ##class(apptools.core.Production).EnsAction("restart")
ex= "auto0" - clean all Namespaces of auto start products
ex= "auto1" - enable auto start products, restore from #SettingsGN(ns)
ex= "stop"  - stop all products
ex= "restart"  - reload all products
ex= "start"  - run the ones that were started, restore from #SettingsGN(ns)
ex= "status" - output statuses
ex= "info" - output of additional information about products and services with parameters d ##class(apptools.core.Production).EnsAction("info",,.out)
out - result ;d ##class(apptools.core.Production).EnsAction("status",$Namespace,.out)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ex="",nsOnly="",out</FormalSpec>
<PublicList>tProductionName,inf</PublicList>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;get all namespace with ensemble
	s listns=##class(apptools.core.sys).ListNS(.inf,"NotPref,Ens")
	#define NotSaveStat " settings not saved, to do ##class(apptools.core.Production).SaveStat(1) "
	$$$forAll(ns,inf)
	i nsOnly'="",nsOnly'=ns continue
	$$$NspGoto(curN,ns)
	i '$d(inf(ns,"Ens")) continue
	s GN=..#SettingsGN
	i ex'="info" w !!,"--- ",ns
	if ex="stop" {
		s sc=##class(Ens.Director).StopProduction(..#TIMEOUTSTOP)
		i 'sc {
			s sc2=##class(Ens.Director).StopProduction(..#TIMEOUTSTOP,1) 
			i 'sc2 w $System.Status.DisplayError(sc2)
		}
	}
	elseif ex="restart" {
		s sc=##class(Ens.Director).RestartProduction()
		i 'sc w $System.Status.DisplayError(sc)
	}
	elseif ex="start" {
		i '$d(@GN@(ns,"Ens")) w !,$$$NotSaveStat
		$$$forAll(tProductionName,@GN@(ns,"Ens"))
			continue:$lg(@GN@(ns,"Ens",tProductionName),1)'[$$$EnsProductStatusRun
			w !,ns," ",tProductionName
			Set sc = ##class(Ens.Director).StartProduction(tProductionName) ; Quit:$$$ISERR(tSC)
			i 'sc w $System.Status.DisplayError(sc)
		$$$forEnd	
	}
	if ex="auto0" {
		i '$d(@GN@(ns,"Ens")) w !,$$$NotSaveStat
			$$$NspGoto(curNs,ns)
			Set sc = ##class(Ens.Director).SetAutoStart("")
			i 'sc w $System.Status.DisplayError(sc)
			e  w " clean auto start"
			$$$NspReturn(curNs)
	} elseif ex="auto1" {
		i '$d(@GN@(ns,"Ens")) w !,$$$NotSaveStat
		$$$forAll(tProductionName,@GN@(ns,"Ens"))
			continue:'$lg(@GN@(ns,"Ens",tProductionName),4)
			$$$NspGoto(curNs,ns)
			Set sc = ##class(Ens.Director).SetAutoStart(tProductionName)
			i 'sc w $System.Status.DisplayError(sc)
			e  w " set auto start"
			$$$NspReturn(curNs)
		$$$forEnd		
	} elseif ex="status"||(ex="info") {
		i '$d(@GN@(ns,"Ens")) w !,$$$NotSaveStat
		Set sc = ##class(Ens.Director).GetProductionSummary(.pInfo, ns)	if ex'="info" w ! zw pInfo
		Set sc = ##class(Ens.Director).GetProductionSettings("",.tSettings)	if ex'="info" w ! zw tSettings
		$$$forAll(tProductionName,@GN@(ns,"Ens"))
			;continue:'$lg(@GN@(ns,"Ens",tProductionName),4)
			$$$NspGoto(curNs,ns)
			if ex'="info" w !,"Name production :"_tProductionName
			Set sc = ##class(Ens.Director).GetProductionStatus(tProductionName,.Stat)
			s stat=$s(Stat=1:"Running",Stat=2:"Stopped",Stat=3:"Suspended",Stat=4:"Troubled",1:"?")
			if ex'="info" w " Status :"_stat
			i 'sc w $System.Status.DisplayError(sc)
			s out(ns,tProductionName)=stat
			if ex="info" k ou d ..ExtInfo(tProductionName,.ou) m out(ns,tProductionName)=ou
			$$$NspReturn(curNs)
		$$$forEnd		
	}
	$$$forEnd
	if $g(curN)'="" $$$NspReturn(curN)
 	quit $$$OK
]]></Implementation>
</Method>

<Method name="ExtInfo">
<Description>
Extended Product Information
w $System.Status.GetErrorText(##class(apptools.core.Production).ExtInfo("Spgz.SpgzProduction",.o))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pClassName,ou,write=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set tSC = ##Class(Ens.Util.XML.Reader).ObjectFromXData(.tObject,pClassName,"ProductionDefinition","Ens.Config.Production")
	if 'tSC q tSC
	;zw tObject
	s json=$$$AppObJs(tObject)
	;Analysis of products into elements
	set Description={}.$$$jsonFromJSON(json).Description
	set Name={}.$$$jsonFromJSON(json).Name
	write:write !,Name_" "_Description
	s ou(Name)=Description
	;s Items={}.$$$jsonFromJSON(json).Items
	s items=[].$$$jsonFromJSON(json)."Items"
	if items'="" {
		for i=0:1:items.$$$jsonSize()-1 {
			set item = items.$$$jsonGet(i)
			i $isobject(item) {
				s itemIn=item.$$$jsonToJSON()
				s Enabled={}.$$$jsonFromJSON(itemIn).Enabled
				continue:'Enabled
				s NameIten={}.$$$jsonFromJSON(itemIn)."Name"
				write:write !," "_NameIten
				s ClassName={}.$$$jsonFromJSON(itemIn).ClassName
				s ou(Name,NameIten)=$lb(ClassName,{}.$$$jsonFromJSON(itemIn).Category)
				s Settings=[].$$$jsonFromJSON(itemIn).Settings
				
				for ii=0:1:Settings.$$$jsonSize()-1 {
					set setts = Settings.$$$jsonGet(ii)
					i $isobject(setts) {
						s sett=setts.$$$jsonToJSON()
						s Target={}.$$$jsonFromJSON(sett).Target
						s NameSett={}.$$$jsonFromJSON(sett).Name
						s Value={}.$$$jsonFromJSON(sett).Value
						k ip
						if Value["http" {
							s host=$p($p($p(Value,"://",2),"/",1),":",1)
							if host'="" s ip=##class(apptools.core.net).GetIP(host)
						}
						if NameSett="HTTPServer" s:Value'="" ip=##class(apptools.core.net).GetIP(Value)
						write:write !,"  "_NameSett_" "_Value_" "_$g(ip)
						s ou(Name,NameIten,NameSett)=Value
						s:$g(ip)'="" ou(Name,NameIten,NameSett,"ip")=$g(ip)
					}
				}
			}
		}
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="getModelTable">
<Description>
d ##class(apptools.core.Production).getModelTable("User.model.",.result)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>like,all</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set sql = "SELECT cls.Name as ""Class Name"", cls.Description as ""Description"", prop.Name ""Property"",  prop.Type ""Type"",  prop.Description ""Description property"" FROM ""%Dictionary"".ClassDefinition cls  JOIN ""%Dictionary"".PropertyDefinition prop ON cls.Name = prop.parent WHERE cls.Name LIKE '"_like_"%'"
	;Genaration table for HTML
	set result="^||tmpPackgetModelTable"
	set st=##class(apptools.core.sys).SaveSQL(sql,result)
	 	d ..addstr(.all,$$$appTab3("Table name, Description table","Property, Type","Description type"))
	s row="0",last=""
	for { s row=$o(@result@(row)) q:row=""
		s tab=$lg(@result@(row),1)_", "_$lg(@result@(row),2)
		s tabpro=$lg(@result@(row),3)_", "_$lg(@result@(row),4)
		d ..addstr(.all,$$$appTableTrTd3($s(last=tab:"",1:tab),tabpro,$lg(@result@(row),5)))
		s last=tab
	}
	s %DrawArray=1
	d ..addstr(.all,$$$appTableEnd3)
	q $$$OK
]]></Implementation>
</Method>

<Method name="addstr">
<Description>
add string to array</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&all,s]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s all($i(all))=s_$c(13,10)
    q
]]></Implementation>
</Method>

<Method name="GenDoc">
<Description>
Automatic generate documenation
CategotyDoc = Category Elements
filename - report html
namespacelist - if empty then all
title - Discriptions report
d ##class(apptools.core.Production).GenDoc("/home/project/shared/gen-doc.xml")
d ##class(apptools.core.Production).GenDoc("G:/!/gen-doc.xml")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>filename="",namespacelist="",title="Productions ",CategotyItem="",StatusProd=1</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#define appTableAttr "border=1"
	new $namespace
	d ##class(apptools.core.Production).SaveStat(1)
	set:title="" subtitle="Productions documentation"
	if '##class(apptools.core.files).OpenFile(filename) quit:$$$ERROR($$$GeneralError,"Error open file "_filename)
	use filename		
	&html<
	<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<title>Productions</title>
	</head>
	<body><a name='0'>
			<h1>#(title)#</h1>
		>
	s bk=$c(13,10)
	;get information about active productions
	do ##class(apptools.core.Production).EnsAction("info",namespacelist,.proj)
	if $d(proj) {
		 set aNs=""
			 for { s aNs=$o(proj(aNs)) q:aNs=""
			 	d ..addstr(.all,bk_"<H2>Namespace "_aNs_"</H2>"_bk)
			 	d ..addstr(.all,$$$appTable3("Productions Name","Productions Item","Configuration"))
			 	set aNp="",lastprod=""
			 	for { s aNp=$o(proj(aNs,aNp)) q:aNp=""	;Name Production
			 		set aCp=""	
			 		for { s aCp=$o(proj(aNs,aNp,aCp)) q:aCp=""	;Class Production
			 			set aNb=""	
			 			for { s aNb=$o(proj(aNs,aNp,aCp,aNb)) q:aNb=""	;Name Elements
			 				s aClass=$lg(proj(aNs,aNp,aCp,aNb),1) ;Class Elements
			 				s aCategory=$lg(proj(aNs,aNp,aCp,aNb),2) ;Category Elements
						 	i aCategory'="",(" "_aCategory_" ")'[(" "_CategotyItem_" ") continue ;
			 				s aNbp="",listProp="<ul>"
			 				for { s aNbp=$o(proj(aNs,aNp,aCp,aNb,aNbp)) q:aNbp=""	;Name Property
			 					s listProp=listProp_"<li>"_aNbp_" :"_$g(proj(aNs,aNp,aCp,aNb,aNbp))
			 					if $g(proj(aNs,aNp,aCp,aNb,aNbp,"ip"))'="" {
				 					s listProp=listProp_"<ul><li>IP :<font color=red>"_$g(proj(aNs,aNp,aCp,aNb,aNbp,"ip"))_"</font></li></ul>"
			 					}
			 				}
			 				s listProp=listProp_"</ul>"
			 				s valprod=$$NoRepit(aNp,aCp)
			 				d ..addstr(.all,$$$appTableTrTd3($s(lastprod=(valprod):"",1:valprod),$$NoRepit(aNb,aClass)_", "_aCategory,listProp))
			 				s lastprod=valprod
			 			}
			 			
			 		}
			 	}
			 	d ..addstr(.all,$$$appTableEnd3)
			 }
	}
	w "<hr>"	
 	s a=""
 	for { s a=$o(all(a)) q:a=""
 		w $g(all(a))
 	}
 &html<
	</body></html>
	>
	close filename
	write !,"Output documentation in "_filename
	q $$$OK
NoRepit(a,b)
	q a_$s(a=b:"",1:", "_b)
]]></Implementation>
</Method>

<Method name="FindAndDrawAllErr">
<Description><![CDATA[
 d ##class(apptools.core.Production).FindAndDrawAllErr("Select * from Ens_Util.Log where Type='2' and TimeLogged>'2020-09-29 21:00' order by id desc",##class(apptools.core.sys).ListNS(.info,"NotPre,Ens"), .result)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>sql,nspaces,result</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set GN=..#SettingsGN
	if '$Data(@GN) do ##class(apptools.core.Production).SaveStat(1)
	for i=1:1:$l(nspaces,",") { continue:$p(nspaces,",",i)=""||("%All"[$p(nspaces,",",i))
		$$$NspGoto(curNs,$p(nspaces,",",i))
		set NS=$p(nspaces,",",i)
		if '$D(@GN@(NS)) continue ; there is no namespace in the system, skip
		set PN=""
		set p="" for { set p=$o(@GN@(NS,"Ens",p)) quit:p=""
			if $lg($g(@GN@(NS,"Ens",p)),1)[$$$EnsProductStatusRun s PN=p quit
		}
		set onclicknone="$('.taberrors').css('display','none'); "
		set url="<b><a target='ensprod2"_($Namespace)_"' href='/csp/"_$zconvert($Namespace,"L")_"/EnsPortal.ProductionConfig.zen?$NAMESPACE="_$Namespace_"' >"_NS_"</a></b>"
		if PN="" write !,"<li>"_url_" no running products" continue
		if $Namespace'=NS s result(NS,"Err")="<br><font color=red>Go to error "_url_"</font>" w result(NS,"Err") continue
		
		set sql2=$replace(sql,"*","count(*)")
		set gn="tmpErrEns"
		do ##class(apptools.core.sys).SaveSQL(sql2,gn)
		set (ec,result(NS,"Count"))=$lg(@gn@(1),1)
		if ec {
			s onclick=onclicknone_"$('#div"_NS_"').css('display','block'); "
			s ec="<b><font color=red style='cursor:hand' onclick="""_onclick_""">Found "_ec_" errors</font></b>"
		} else { 
			set ec="<b><font color=green style='cursor:hand' onclick="""_onclicknone_"""> No errors found </font></b>"
		}
		write !,"<li>"_url_" "_ec_" <div class='taberrors' id='div"_NS_"' style='display:none'>"
		set exec="##class("_..%ClassName(1)_").AddTraceUrl(.%AppLogInfoVal, %AppLogInfoCol, %AppLogInfoHead, .%AppLogInfoTemp)"
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,$g(Max,10000),$Namespace," Ensemble Errors ",exec)
		write !,"</div>"
		$$$NspReturn(curNs)
	}
]]></Implementation>
</Method>

<Method name="AddTraceUrl">
<Description>
Procedure for ##class(apptools.core.LogInfoPane).DrawSQL 5 Argument</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Val,Col,Head,Temp,Del=0</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set res=Val
	if $g(Head) {
		i $g(Val)="SessionId" s Temp("SessionId",Col)=""
	}
	else {
		if $D(Temp("SessionId",Col)) {
			set res="<a target=Trace"_Val_" title='Go to Visual Trace' href='"_"/csp/"_$Namespace_"/EnsPortal.VisualTrace.zen?SESSIONID="_Val_"' >"_Val_"</a>"
		}
	}
	quit res
]]></Implementation>
</Method>

<Method name="FindAndDrawAllQueue">
<Description>
 do ##class(apptools.core.Production).FindAndDrawAllQueue(##class(apptools.core.sys).ListNS(.info,"NotPre,Ens"))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>nspaces</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	write "<Table>"
	for i=1:1:$l(nspaces,",") { continue:$p(nspaces,",",i)=""||("%All"[$p(nspaces,",",i))
		$$$NspGoto(curNs,$p(nspaces,",",i))
		if $Namespace'=$p(nspaces,",",i) continue
		if $DATA(^Ens.Queue) {
			set serv="",total=0
			set ns=$p(nspaces,",",i)
			for { 	set serv=$order(^Ens.Queue(serv)) quit:serv=""
					set count=$get(^Ens.Queue(serv,0,"count"))
					if count {
						set total=$g(total)+count
					}
				}
			set csp="csp"
			set url="/"_csp_"/"_$zconvert(ns,"L")_"/EnsPortal.Queues.zen?$NAMESPACE="_ns
			write "<tr><td><a target=Que"_ns_" href='"_url_"'>"_ns_"</a></td><td>"_total_"</td></tr>"
		}
		$$$NspReturn(curNs)
	}
	write "</Table>"
]]></Implementation>
</Method>

<Method name="ShowGlobals">
<Description>
do ##class(apptools.core.Production).ShowGlobals("^tmp**",##class(apptools.core.sys).ListNS(.info,"NotPre,Ens"))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>gn,nspaces</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	for i=1:1:$l(nspaces,",") { continue:$p(nspaces,",",i)=""||("%All"[$p(nspaces,",",i))
		$$$NspGoto(curNs,$p(nspaces,",",i))
		if $Namespace'=$p(nspaces,",",i) continue
		set a=$lb(gn,1000,$Namespace,1,"<b>"_$namespace_"</b> globals "_gn,$g(exp),$g(Filtr),$g(ExecuteDraw))
		write "<br><br>"
		set st=##class(apptools.core.LogInfoPane).DrawGN(a)
		$$$NspReturn(curNs)
	}
]]></Implementation>
</Method>

<Method name="GetListErrProducts">
<Description>
Get a list of product errors per day or more for one namespace
d ##class(apptools.core.Production).GetListErrProducts(1,"USER".res)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>day,NS,result</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[

	new $namespace
	set sql="select ConfigName,Text,TimeLogged from Ens_Util.Log where Type='2' and TimeLogged>'"_##class(apptools.core.type).getYYYYMMDD($h-day)_" 21:00' order by id desc"
	set listns= ##class(apptools.core.sys).ListNS(.info,"NotPre,Ens")
	set GN="info" ;##class(apptools.core.Production).#SettingsGN
	if $D(@GN@(NS)) {
		zn NS
		if $Namespace'=NS quit ""
		set PN=""
		set p="" for { s p=$o(@GN@(NS,"Ens",p)) q:p=""
			if $lg($g(@GN@(NS,"Ens",p)),1)[$$$EnsProductStatusRun s PN=p quit
		}
		if PN="" q ""
		set gn="^||tmpErrEnsam" kill @gn
		do ##class(apptools.core.sys).SaveSQL(sql,gn)
		for i=1:1:10 {  
			if $d(@gn@(i)) {
			;k r m r(1)=@gn@(i)	;zw r  
			m result(i)=@gn@(i)
			}
		}
	}
 q $$$OK
]]></Implementation>
</Method>

<Method name="GetStatusProducts">
<Description>
Get the status of products for a day or more
d ##class(apptools.core.Production).GetStatusProducts(0,.res)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>day,result</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set result("server")=$zu(110)
		, result("version")=$zv
		
	if day=0 	quit $$$OK ;
	set sql="select * from Ens_Util.Log where Type='2' and TimeLogged>'"_##class(apptools.core.type).getYYYYMMDD($h-day)_" 21:00' order by id desc"
	set listns= ##class(apptools.core.sys).ListNS(.info,"NotPre,Ens")
	set GN="info" ;##class(apptools.core.Production).#SettingsGN
 	set NS=""
	set sql2=$replace(sql,"*","count(*)")
	set result("sql")=sql2
	set result("listns")=listns
	for { s NS=$o(@GN@(NS)) q:NS=""
		$$$NspGoto(curNs,NS)
		if $Namespace'=NS  continue
		if '$D(@GN@(NS)) continue
		set PN=""
		set p="" for { s p=$o(@GN@(NS,"Ens",p)) q:p=""
			if $lg($g(@GN@(NS,"Ens",p)),1)[$$$EnsProductStatusRun s PN=p quit
		}
		if PN="" continue

		set gn="^||tmpErrEns" kill @gn
		do ##class(apptools.core.sys).SaveSQL(sql2,gn)
		set result(NS,"CountErrors")=$lg(@gn@(1),1)
	}
	quit $$$OK
]]></Implementation>
</Method>

<Method name="GetStatusProductsJson">
<Description>
Get the status of products for a day or more to Json
d ##class(apptools.core.Production).GetStatusProductsJson(1,"system-stat",.res) zw res
d ##class(apptools.core.Production).GetStatusProductsJson(1,"count-errors",.res) zw res
d ##class(apptools.core.Production).GetStatusProductsJson(1,"list-errors-SPGZ",.res) zw res</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>day,mode=0,result</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set result={} 
	set result.server=$zu(110)
	set result.version=$zv		

	if mode="system-stat" {
		quit $$$OK
	}
	set result.ns=[]
	set sql="select * from Ens_Util.Log where Type='2' and TimeLogged>'"_##class(apptools.core.type).getYYYYMMDD($h-day)_" 21:00' order by id desc"
	set listns= ##class(apptools.core.sys).ListNS(.info,"NotPre,Ens")
	set gn="^||tmpErrEns" kill @gn
	if mode="count-errors" {
		set sql2=$replace(sql,"*","count(*)")
	}
	elseif mode["list-errors" {
		set sql2=$replace(sql,"*","ConfigName,Text,TimeLogged ")
		set NSpace=$p(mode,"list-errors-",2)
	}

	set NS=""
	for { s NS=$o(info(NS)) q:NS=""
		$$$NspGoto(curNs,NS)
		if $Namespace'=NS  continue
		if $GET(NSpace)'="",NS'=NSpace continue 
		if '$D(info(NS)) continue
		set PN=""
		set p="" for { s p=$o(info(NS,"Ens",p)) q:p=""
			if $lg($g(info(NS,"Ens",p)),1)[$$$EnsProductStatusRun s PN=p quit
		}
		if PN="" continue

		do ##class(apptools.core.sys).SaveSQL(sql2,gn)
		set prod = {}
		set prod.namespace = $namespace
		set prod.nameproduction = PN
		if mode="count-errors" {
			set prod.counterrors = $lg(@gn@(1),1)
		}
		elseif mode["list-errors" {
			set prod.errors = []
			for i=1:1:10 {  if $d(@gn@(i)) {
				set err = {}
				set err.ConfigName=$lg(@gn@(i),1)
				set err.Text=$lg(@gn@(i),2)
				set err.TimeLogged=$lg(@gn@(i),3)
				do prod.errors.%Push(err)
				}
			}
		}
		
		do result.ns.%Push(prod)
		
	}
]]></Implementation>
</Method>

<Method name="StopProdAndDismount">
<Description>
Stoped production and dismount. Later mounted 
d ##class(apptools.core.Production).StopProdAndDismount("AAA")
w $System.Status.GetErrorText(##class(apptools.core.sys).MountListDB("AAA"))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ns</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	new $namespace
	try {
		set $namespace=ns
		s sc=##class(Ens.Director).StopProduction(..#TIMEOUTSTOP)
		if 'sc {
			s sc2=##class(Ens.Director).StopProduction(..#TIMEOUTSTOP,1) 
			if 'sc2 write $System.Status.DisplayError(sc2) q
			set sc=$$$OK
		}
		set $namespace="%SYS"
		set sc=##class(apptools.core.sys).DismountListDB(ns)
		if 'sc {
			write $System.Status.DisplayError(sc) q
		}
		else {
			write !,"Dismount "_ns
		}
	} catch ex {
	   Set sc = $g(%objlasterror, $$$OK)
	   Set sc = $$$ADDSC(sc, ex.AsStatus())
	   write "Error type   "_ex.Name,!
	   write "Error code   "_ex.Code,!
	   write "Error location "_ex.Location,!
 	}
]]></Implementation>
</Method>

<Method name="GetSettings">
<Description>
GetSettings
write ##class(apptools.core.Production).GetSettings("ProductionName","ItemName","SettName",.val)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[ProductName="",ItemName="",SettingName="",&Value]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[

 #dim p As Ens.Config.Production
 Set p = ##class(Ens.Config.Production).%OpenId(ProductName)
 quit:p="" $$$ERROR($$$GeneralError,"Production not found: "_ProductName)
 #dim item As Ens.Config.Item
 #dim sett As Ens.Config.Setting
 set st=0
 for i=1:1:p.Items.Count() {
	 s item=p.Items.GetAt(i)
	 ;w !,item.Name
	 if item.Name=ItemName 	{
	 	for s=1:1:item.Settings.Count() {
	 		set sett=item.Settings.GetAt(s)
	 		;w !,sett.Name
	 		if sett.Name=SettingName set Value=sett.Value, st=$$$OK quit
	 	}
	 }
 }
 if 'st q $$$ERROR($$$GeneralError,"Settings or ItemName not found")
 quit st
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.UploadCSP">
<CompileAfter>apptools.core.msg</CompileAfter>
<IncludeCode>apptools.core</IncludeCode>
<Super>%CSP.Page</Super>
<TimeChanged>65899,55016.121983</TimeChanged>
<TimeCreated>65607,76511.476206</TimeCreated>

<Parameter name="pathfiles">
<Description>
The path to the directory on the server for storing files</Description>
<Expression>##class(%File).GetDirectory(##class(%File).TempFilename())</Expression>
</Parameter>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set FieldName="loadFile"
    if $g(%loadFileSuccess)'="" {
	    if $lv(%loadFileSuccess) {
	        if $lg(%loadFileSuccess,1) {
		        if $lg(%loadFileSuccess,5)'=1 d WriteError q 1
	    		set orig=$lg(%loadFileSuccess,6)
	    		set orig=$p(orig,$$$slash,*)
	    		set orig=$tr(orig," `()\/*;'"":","_N---")
	    		write "<script>"
	    		write "try{"
	    		write "window.opener.document.getElementById('"_$g(%request.Data("FieldName",1))_"').value='"_$lg(%loadFileSuccess,2)_"*"_orig_"';"
	    		write "}catch(e){}"
	    		write "window.close();"
	    		write "</script>"
	    		quit $$$OK
	        } else {
	            do WriteError
	            quit $$$OK
	        }
	        quit $$$OK
	    }
    }
    &html<<!DOCTYPE HTML>
<html>
<head>
<title>Upload</title>
>
 write ##class(apptools.core.LogInfoPane).GetLink()
 set Upload=$$$aText("Upload","")
 set Cancel=$$$aText("Cancel","")
 set pathcsp=""
  if $d(%request) {
	   ;zw %request TODO
	   ;%request.AppData %request.Application
	   if %request.Application["apptoolsrest" set pathcsp="/csp/spgz/"
	   if %request.Application["/arest/" set pathcsp="/csp/spgz/"
  }
 &html<
    <script>
        $(document).ready(function(){
            $(this).keydown(function(eventObject){
                if (eventObject.which == 27)
                    window.close();
            });
        });
    </script>  
</head>
<body bgcolor="#f0f8ff" >
<form action="#(pathcsp_..%ClassName(1)_".cls")#" enctype="multipart/form-data" method="post">
    <br><center>
     #($$$aText("Select a file",""))#: <input class='ui-button ui-corner-all ui-widget' name='loadFile' id='loadFile' size=30 type='file' accept=".doc,.docx,.odt,.pdf,.xls,.xlsx" >
    <br><br>
    <input class='ui-button ui-corner-all ui-widget' type="submit" value="#(Upload)#"> 
    <input class='ui-button ui-corner-all ui-widget' type="button" value="#(Cancel)#" onclick='window.close();'>
    <input class='ui-button ui-corner-all ui-widget' type="hidden" name=FieldName id=FieldName value='#($g(%request.Data("idreturn",1)))#'>
    <input class='ui-button ui-corner-all ui-widget' type="hidden" name=idOrigNameReturn id=idOrigNameReturn value='#($g(%request.Data("idOrigNameReturn",1)))#'>
    <input class='ui-button ui-corner-all ui-widget' type="hidden" name=ServerDirPath id=ServerDirPath value='#($g(%request.Data("ServerDirPath",1)))#'>
    </center>
</form></body>
</html>
>
   Quit $$$OK
WriteError w "<H3>"_$$$aText("An error has occurred","")_"</h3>"_$System.Status.DisplayError($lg(%loadFileSuccess,5))_"<p><p>"_$$$aText("Try again, otherwise contact your administrator","")
 q
]]></Implementation>
</Method>

<Method name="OnPreHTTP">
<Description>
 [ ServerOnly = 1 ]</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	set ServerDirPath=$zconvert($g(%request.Data("ServerDirPath",1)),"I","URL")
	if ServerDirPath="" set ServerDirPath=..#pathfiles
        s %loadFileSuccess=0
        s FieldName="loadFile"
        i %request.IsDefinedMimeData(FieldName,1) {
            s ContentType=%request.MimeData(FieldName,1).ContentType
            s Content=%request.MimeData(FieldName,1)
        } else {
            s ContentType=%request.ContentType
            s Content=%request.Content
        }
        i $isobject(Content),Content.Size>0 {
	        s fileName=Content.FileName
	        s name=$tr(##class(apptools.core.type).GetDateTime($h),"T: ","_")_"_"_$zcrc($p(fileName,$$$slash,*),7) //TODO tranlit
	        if fileName["." s name=name_"."_$p(fileName,".",*)
	        s %loadFileSuccess=$lb(1,$g(name),Content.Size)
	        s sc=##class(apptools.core.files).Stream2Log(Content, ServerDirPath,$zconvert( name,"O","UTF8"),.path) 
	        if sc s %loadFileSuccess=%loadFileSuccess_$lb($g(path),1,fileName)
	        else  s %loadFileSuccess=%loadFileSuccess_$lb($g(path),sc)
        }
        q 1
    q 1
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.code">
<Description><![CDATA[
Export different types of modules in different subfolders in UDL (plain) format
test.dfi -> /dfi/test.dfi
testpkg.test.cls -> /cls/testpkg/test.cls
Fork from https://github.com/intersystems-ru/cache-udl]]></Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65613,47662.373762</TimeChanged>
<TimeCreated>65607,76499.297641</TimeCreated>

<Method name="exp">
<Description>
d ##class(apptools.core.code).exp("/backup/source/apptools/","apptools.core")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[dir="",mask="",ignoremask="",&list]]></FormalSpec>
<Implementation><![CDATA[
 d ..workdir(dir)
 d ..export(,,,,mask,ignoremask,1,.list)
]]></Implementation>
</Method>

<Method name="imp">
<Description>
import 
d ##class(apptools.core.code).imp("/backup/iris/distr/apptools-all/src/xml/")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>dir="",mask=""</FormalSpec>
<Implementation><![CDATA[
 d ..workdir(dir)
 d ..import(mask)
]]></Implementation>
</Method>

<Method name="workdir">
<Description>
get or set working directory for export/import source
d ##class(apptools.core.code).workdir("/backup/source")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>workdir</FormalSpec>
<Implementation><![CDATA[
	s gln = ..gln() s:$d(workdir) @gln = workdir
	///zu(12) namespace directory by default
	#define nsdir $zu(12,"")
	Q $g(@gln, $$$nsdir)
]]></Implementation>
</Method>

<Method name="export">
<Description>
export all available code
d ##class(apptools.core.code).export(,,,,"apptools.","apptools.M")
d ##class(apptools.core.code).export(,,,,"apptools.","apptools.M",1,"/csp/aaa")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[generated=0,system=0,percent=0,mapped=0,mask="",ignoremask="",ignoredfi=0,&item]]></FormalSpec>
<Implementation><![CDATA[

	#define export(%code, %file) try {s sc = $system.OBJ.ExportUDL(%code, %file,"/diffexport")} catch e {s sc=$$$ERROR($$$GeneralError,"Old version")} ##continue
								 w:sc "Ok" d:'sc $system.OBJ.DisplayError(sc)

	#define isGenerated(%code) ##class(%RoutineMgr).IsGenerated( %code )
	#define isPercented(%code) ("%" = $e(%code))
	#define isMapped(%code) ##class(%RoutineMgr).IsMapped( %code )
	#define log w !, code, " -> ", $piece(filename,..workdir(),2), " "
	
	#define mkdir(%filename) ##continue
			s path = ##class(%File).GetDirectory( %filename ) ##continue
			if '##class(%File).DirectoryExists( path ) { ##continue
				s sc = ##class(%File).CreateDirectoryChain( path ) ##continue
				w !, "mkdir ", path, " ", sc ##continue
			}
						
	w "#; Exporting to ", ..workdir(),!
	#; classes
	s rs = ##class(%ResultSet).%New("%Dictionary.ClassDefinition:Summary")
	if rs.Execute() {

		while rs.%Next(){

			s code = rs.Name _ ".cls", isSystem = rs.System
			;w !,code
			if ( 'system && isSystem ) continue
			if ( 'generated && $$$isGenerated( code ) ) continue
			if ( 'percent && $$$isPercented( code ) ) continue
			if ( 'mapped && $$$isMapped( code ) ) continue
			if mask'="",(("@"_code)'[("@"_mask )) continue
			if ignoremask'="",(("@"_code)[("@"_ignoremask )) continue
			
			s filename = ..filename( code )
			$$$mkdir( filename )
			$$$log
			$$$export( code, filename )
			s item(code)=""
		} s rs=""
	}

	#; routines
	s rs = ##class(%ResultSet).%New("%Routine:RoutineList")
	if rs.Execute() {

    	while rs.%Next() {

	 		s code = rs.Name
	 		if ( 'generated && $$$isGenerated( code ) ) continue
	 		if ( 'percent && $$$isPercented( code ) ) continue
			if ( 'mapped && $$$isMapped( code ) ) continue
			if ( '$find( code, mask ) ) continue
			
			s filename = ..filename( code )
			$$$mkdir( filename )
			$$$log
			$$$export( code, filename )
			s item(code)=""
	    } s rs=""
	}


	#; dfi
	#define export(%code,%file) s sc = ##class(%DeepSee.UserLibrary.Utils).%Export( %code, %file, 0 ) 
	if 'ignoredfi {
		s sql = "Select fullName as Name From %DeepSee_UserLibrary.FolderItem"
	    s rs = ##class(%SQL.Statement).%ExecDirect( .stm, sql )
	    while rs.%Next() {
			s code = rs.Name, filename = ..filename( code_".dfi" )
			if ( '$find( code, mask ) ) continue
			if ($L(code,"$TRASH")>1) continue
			$$$mkdir( filename )
			$$$log
			$$$export(code,filename)
			s item(code)=""
		} s rs=""
	}
	w !!, "#; Exported to ", ..workdir()
    Q $$$OK
]]></Implementation>
</Method>

<Method name="import">
<Description>
import all from workdir
d ##class(apptools.core.code).import()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[filemask="*.xml;*.cls;*.mac;*.int;*.inc;*.dfi",qspec="cku-d",&err="",recurse=1,&loaded="",verbose=1]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#define push(%dir) s dirs( $i( dirs ) ) = %dir
	#define next(%i,%dir) s %i=$o( dirs( "" ), 1, %dir )  k:%i'="" dirs(%i)
	#define isDirectory(%type) ( %type = "D" )
	#define log w !,filename_" " w:sc "Ok" d:'sc $system.OBJ.DisplayError(sc)
	
	s sc = 1, dirs = "", dir = ..workdir() $$$push(dir)
	if verbose w "#; Importing from ", dir,!
	d ..setIgnore(.fm)
	for { $$$next(i,dir) Q:i=""  Q:dir=""

		s rs = ##class(%File).FileSetFunc( dir, filemask, , 1 )

		while rs.%Next() {
			s filename = rs.Name

			if $$$isDirectory(rs.Type) {
				if recurse $$$push(filename)
				continue
			}
			// check file filter
			if ..inFilter(.fm,filename) continue

			s ext = $p( filename, ".", * )

			if $zcvt( ext, "l" ) = "dfi" {
				s sc = ##class(%DeepSee.UserLibrary.Utils).%Import( filename, 1, 0, 0, "", .dsloaded )
			} else {
				// load classes only
				s sc = $system.OBJ.Load( filename, "k-d", .err, .loaded)
			}

			if verbose $$$log
			
	    }
		// compile all the loaded classes to obey dependencies
		s sc=$system.OBJ.CompileList( .loaded, "cukbr-d/multicompile",.err )
		
	}
	
	if verbose {
	
		if $D(err) {
			s i=$Order(err("")) 
			while i'="" {
			w !,err(i)
			s i=$O(err(i))
			}
		}
		
		w !,!,"#; Imported from ", ..workdir()
		}
	Q sc
]]></Implementation>
</Method>

<Method name="inFilter">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&filtermask,filename]]></FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	s result=0
	for 
	{
		if '$d(filtermask($I(i))) quit
		set filter=$piece(filtermask(i),"*")
		if $length(filename,filter)>1 set result=1
	}

	quit result
]]></Implementation>
</Method>

<Method name="setIgnore">
<Description>
get the filtermask for the repository.
looks for .gitignore file and applies all the lines to filters</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&filtermask]]></FormalSpec>
<Implementation><![CDATA[
	
	// working with .gitignore file
	// gitignore consists of masks of filtering files
	s filename=..workdir()_"/.gitignore"
	if '##class(%File).Exists(filename) quit
	s file=##class(%File).%New(filename)
	s sc=file.Open("R")
	if 'sc 
	{
		if verbose d $System.OBJ.DisplayError(sc) return
	}

	While 'file.AtEnd
	{
		s filtermask($I(filtermask))=file.ReadLine()
	}
quit
]]></Implementation>
</Method>

<Method name="gln">
<Description>
gl[obal] n[ame] - storage for settings</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>expression</CodeMode>
<Private>1</Private>
<Implementation><![CDATA["%apptools"
]]></Implementation>
</Method>

<Method name="init">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	#define confile "/cos.json"
	set stream=##class(%Stream.FileCharacter).%New()
	set sc=stream.LinkToFile(..workdir()_$$$confile)
	s conf={}.%FromJSON(stream.Read($$$MaxCacheInt))
	s gln=..gln()
	s @gln@("compileList")=conf.compileList
	s @gln@("projectName")=conf.projectName
	w "compileList="_conf.compileList,!
	w "projectName="_conf.projectName
]]></Implementation>
</Method>

<Method name="release">
<Description>
export release file for list and project settings</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	s gln=..gln()
	s list=$G(@gln@("compileList"))
	if list="" w "Nothing to release. Run init method first" quit

	s release=$G(@gln@("projectName"),"release")
	s release=release_$p($zdt($h,8)," ")_$tr($p($p($zdt($h)," ",2),":",1,2),":")_".xml"
	D $System.OBJ.Export(list,release)
	w "All objects with mask "_list_" has been exported to "_release
]]></Implementation>
</Method>

<Method name="compile">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	s gln=..gln()
	s list=$G(@gln@("compileList"))
	if list="" w "Nothing to compile. Run init method first" quit
	d $System.OBJ.compile(list)
]]></Implementation>
</Method>

<Method name="filename">
<Description><![CDATA[
test.dfi -> /dfi/test.dfi
test.cls -> /cls/test.cls
testpkg.test.cls -> /cls/testpkg/test.cls
etc]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>code</FormalSpec>
<Implementation><![CDATA[
	#define log(%dir,%sc) w !, "mkdir ", %dir, " ", sc

	s wd = ..workdir()

	if '##class(%File).DirectoryExists( wd ) {
		s sc = ##class(%File).CreateDirectoryChain( wd )
		$$$log(wd,sc)
	}

	s ext = $p( code, ".", * ), ext = $zcvt( ext, "l" )
	#; for each type - different directory

	s:ext'="" wd = ##class(%File).NormalizeDirectory( ext, wd )

	#; directory must exist before any call (%File).NormalizeFilename( , wd)
	if '##class(%File).DirectoryExists( wd ) {
		s sc = ##class(%File).CreateDirectoryChain( wd )
		$$$log(wd,sc)
	}

	s filename = ##class(%File).NormalizeFilename( code, wd )
	#; lowercase file extension
	s $p(filename,".",*)=ext
	//B:code="DPRep.Rest.JSON.cls" "L"
	#; for *.cls Package.Subpackage.ClassName.cls -> Folder/Subfolder/ClassName.cls
	if ext ="cls" {
		s dirs = $piece( code, ".",1, *-2 ), dirs = $translate( dirs, ".", "/" )
		s relpath = dirs _ "/" _ $piece( code, ".", *-1, * ) ;
		s filename = ##class(%File).NormalizeFilename( relpath, wd )
	}
	Q filename
]]></Implementation>
</Method>

<Method name="importUpdated">
<Description>
import from workdir all files with ts newer than code ts in db</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[filemask="*.*",qspec="cku-d",&err="",recurse=1,&loaded="",verbose=1]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#define push(%dir) s dirs( $i( dirs ) ) = %dir
	#define next(%i,%dir) s %i=$o( dirs( "" ), 1, %dir )  k:%i'="" dirs(%i)
	#define isDirectory(%type) ( %type = "D" )
	#define log w !, $piece(filename,..workdir(),2)," " w:sc "Ok" d:'sc $system.OBJ.DisplayError( sc )

	s sc = 1, dirs = "", dir = ..workdir() $$$push(dir)
	if verbose w "#; Importing updated from ", dir,!
	d ..setIgnore(.fm)
	for { $$$next(i,dir) Q:i=""  Q:dir=""

		s rs = ##class(%File).FileSetFunc( dir, filemask, , 1 )

		while rs.%Next() {
		   s filename = rs.Name

		   if $$$isDirectory( rs.Type ) {
			 if ( recurse ) $$$push(filename) ;push directory
			 continue
		   }

			// check file filter
			if ..inFilter(.fm,filename) continue

		   s filets = rs.DateModified
		   s codename = ..codename( filename, .ext )
		   s codets = ..codets( codename, ext )
		   
		   #; w !, filename, $c(9), "(", filets, ")"
		   #; w !, codename, $c(9), "(", codets, ")"
		   
		   if ( filets '] codets ) continue
			 
		   if ext = "dfi" {

			   s sc = ##class(%DeepSee.UserLibrary.Utils).%Import( filename, 1, 0, 0, "", .loaded )

		   } else {

			   #; drop existing code before import ( purge DateModified )
			   #; s:codets'="" sc = ##class(%RoutineMgr).Delete( codename )
			   k err s sc = $system.OBJ.Load( filename, qspec, .err, .loaded)

		   }

		   if verbose $$$log
	    }
	}
	w:verbose !,"#; Imported updated from ", ..workdir()
	Q sc
]]></Implementation>
</Method>

<Method name="codename">
<Description>
presumable codename</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[filename,&ext=""]]></FormalSpec>
<Implementation><![CDATA[
	s ext = $p( filename, ".", * ), ext = $zcvt( ext, "l" )
	s path = ##class(%File).NormalizeDirectory( ext, ..workdir() )
	s codename = $p( filename, path, 2 )
	if ext = "dfi" {
		s fullname  = $tr( codename, "\", "/" ) ; return fullname for dfi in $$$IsWINDOWS
		Q $p( fullname, ".", 1, *-1 ) ;remove extension
	}
	if (ext ="cls")!(ext="int")!(ext="inc")!(ext="mac") s codename=$tr(codename,"\/","..")
	Q codename
]]></Implementation>
</Method>

<Method name="codets">
<ClassMethod>1</ClassMethod>
<FormalSpec>codename,ext</FormalSpec>
<Implementation><![CDATA[
	s ts = ""
	if ext'="dfi" {
		s ts = ##class(%RoutineMgr).TS( codename )
	} else {
		s sql="Select timeModified From %DeepSee_UserLibrary.FolderItem Where fullname = ?"
		s rs = ##class(%SQL.Statement).%ExecDirect( , sql, codename )
		if rs.%Next() {
			s utcts = rs.timeModified
			s utch = $zdth( utcts, 3, , 3 ) ;utc internal format
			s loch = $zdth( utch, -3 ) ; utc to local timezone
			s ts = $zdt( loch, 3, ,0 ) ; local timestamp*/
		}
	}
	Q $p( ts, "." ) ;remove ms
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.files">
<Description>
Utilities working with files</Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65943,29001.620792</TimeChanged>
<TimeCreated>65607,76505.230442</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Method name="getSlash">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	q $$$slash
]]></Implementation>
</Method>

<Method name="Stream2String">
<Description>
Stream convert to string
w ##class(apptools.core.files).Stream2String(resp,.str)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>resp:%Stream,StringValue:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set st=$$$OK
	set StringValue=""
	i '$isobject(resp) q $$$ERROR($$$GeneralError,"An empty stream")
	d resp.Rewind() 
	set StringValue=resp.Read($$$MaxStringLength) 
	while '(resp.AtEnd) { 
		s StringValue($i(i))=resp.Read($$$MaxStringLength) 
	}
	q st
]]></Implementation>
</Method>

<Method name="UnzipToDirectory">
<Description>
Unpack the archive to a directory
w ##class(apptools.core.files).UnzipToDirectory("/backup/eaist/imported/3a308a20ff8e271ae3e063231a8df1ad.zip","/backup/eaist/last")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>fileName:%String,*dirName:%String,cmd</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set st = $$$OK
	try {
		set:$g(dirName)="" dirName = ##class(%File).NormalizeDirectory(##class(%File).TempFilename())
		$$$TOE(st, ##class(%File).CreateDirectoryChain(dirName))
		
		set cmd = ..GetUzipCommand(fileName, dirName)
		
		;$$$TRACE(cmd)
		set result = $zf(-1, cmd)
		if (result '= 0) { $$$ThrowStatus($$$ERROR($$$GeneralError, $$$aText("Return code error","")_":" _ result_" cmd="_cmd)) }
	} catch ex {
		set st = ex.AsStatus()
		;$$$TRACE($system.Status.GetErrorText(st))
	}
	quit st
]]></Implementation>
</Method>

<Method name="zipFile">
<Description><![CDATA[
Packaging file in the archive
Directory tempdir need to assign write cacheusr >sudo chmod ugo+w .]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>dir,fileName:%String,newfileName:%String,tempdir:%String=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set st = $$$OK
	if tempdir="" set tempdir=dir
	try {
		if $zversion(1) { ;for Linux
			set cmd = "cd "_dir_"; zip -r "_tempdir_"/"_newfileName_" "_fileName_";"
			if dir'=tempdir s cmd=cmd_" cp -f "_tempdir_"/"_newfileName_" "_newfileName_";" 
		} else {
			;set cmd = "cd "_dir_"; zip -r "_tempdir_"/"_newfileName_" "_fileName_";"
			
		}
		set result = $zf(-1, cmd)
		if (result '= 0) { $$$ThrowStatus($$$ERROR($$$GeneralError, $$$aText("Return code error","")_":" _ result_" cmd="_cmd)) }
	} catch ex {
		set st = ex.AsStatus()
	}
	quit st
]]></Implementation>
</Method>

<Method name="GetList">
<Description>
Get all files in a directory without subdirectories
w ##class(apptools.core.files).GetList("D:\dev\app1\src\","*.xml",.List)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[directory:%String,ext:%String="*.*",&list]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set:ext="*.*" ext=$s($zversion(1)=3:"*",1:"*.*")
	set st = $$$OK
	try {
		set directory = ##class(%File).NormalizeDirectory(directory)
		set rs = ##class(%ResultSet).%New("%File:FileSet")
		s sc=rs.Execute(directory, ext)
		while (rs.Next()) {
			set fName = rs.Get("Name")
			m list(fName)=rs.Data
		}
	} catch ex {
		set st = ex.AsStatus()
	}
	quit st
]]></Implementation>
</Method>

<Method name="RemoveFiles">
<ClassMethod>1</ClassMethod>
<FormalSpec>pFile:%String,pDir:%String=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	// TODO: make error handling removal of
	i pDir'="" do ##class(%File).RemoveDirectoryTree(pDir)
	do ##class(%File).Delete(pFile)
	quit $$$OK
]]></Implementation>
</Method>

<Method name="GetUzipCommand">
<ClassMethod>1</ClassMethod>
<FormalSpec>file,dir</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	if $zversion(1)=3 quit "unzip -o " _ file _ " -d " _ dir
	quit "7z x " _ file _ " -o" _ dir
]]></Implementation>
</Method>

<Method name="Stream2Log">
<Description>
Method unloads the stream aStream into a file folder aLogFolder. 
aLogFolder - directory of discharge /back/temp/
aFileName - name of the unloaded file
File - the full path to the file
w ##class(apptools.core.files).Stream2Log(HttpResponse.Data, TempDir, fileName,.File) s aDATA("pathfileName")=$g(path)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[aStream,aLogFolder,aFileName,&filename]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#dim sc As %Status = $$$OK
	quit:(aLogFolder="") sc
	
	s aLogFolder=##class(%File).NormalizeDirectory(aLogFolder)
	if '##class(%File).DirectoryExists(aLogFolder) {
		quit:'##class(%File).CreateDirectoryChain(aLogFolder) $$$ERROR($$$GeneralError,"Cann't create directory chain: "_aLogFolder)
	}
	// Define a prefix for the file name and the file name
	i (aFileName="") s filename = aLogFolder_"t"_$tr($zts,",.","")_".xml"
	e  s filename = aLogFolder_aFileName
	
	// Execute copy file to stream
	s ext=$p(filename,".",$l(filename,"."))
	
	i aStream.%ClassName(1)="%Stream.FileCharacterGzip" {
		s gzfileName=aStream.Filename
		set f2 = ##class(%Stream.FileBinary).%New()
		set f1 = ##class(%Stream.FileBinaryGzip).%New()
		do f1.LinkToFile(gzfileName)
		do f2.LinkToFile(filename)
		s sc=f2.CopyFromAndSave(f1)
		d aStream.Rewind() 
		quit sc
	}
	i "xml,txt,html,aspx,"[ext {
		s File = ##class(%Stream.FileCharacter).%New()
		s File.TranslateTable="UTF8"
	}
	else {
		 s File = ##class(%Stream.FileBinary).%New()
	}
	
	s File.Filename=filename
	s sc=File.CopyFromAndSave(aStream)

	// Return result
	d aStream.Rewind() quit sc
]]></Implementation>
</Method>

<Method name="ReadFile2Arr">
<Description>
To open a file and write to the array 
w ##class(apptools.core.files).ReadFile2Arr("/backup/temp/snmp/ruRunCmd2018-10-03_14:31:00.txt","RSK",,"%tmp")
w ##class(apptools.core.files).ReadFile2Arr(fn,"RSK","CP1251",gn)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>file,mode="RSK",code="UTF8",gn="tmp"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s io=$i
	Open file:(mode_"\"_code_"\"):1
	if $test {
		s $zt="endoffile"
		for i=1:1 use file read r s @gn@(i)=r
	}
	else {
		q $$$ERROR($$$GeneralError,"No open file "_file)
	}
endoffile u io close file
	q $$$OK
]]></Implementation>
</Method>

<Method name="OpenFile">
<Description>
To open a file for writing 
set fn="/backup/temp/log.txt" if ##class(apptools.core.files).OpenFile(fn) use fn write "test",! close fn</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>file,time=1,mode="WNSK",code="UTF8"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Open file:(mode_"\"_code_"\"):time
	quit $test
]]></Implementation>
</Method>

<Method name="File2Arr">
<Description>
To read a file and write to global 
w ##class(apptools.core.files).File2Arr("/backup/eaist/work/SPGZ.xml_2018-05-07_14.56.26.461","^tmpFile")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>file,Mas,Param="RSU"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set f=##class(%File).%New(file)
 set ok=f.Open(Param)     if 'ok do f.%Close() Q ok
 set len=$zu(140,1,file)
 while 'f.AtEnd {
     set str = f.ReadLine()
     s @Mas@($i(@Mas))=str
  }
 do f.%Close()
 Q len_" byte"
]]></Implementation>
</Method>

<Method name="LoadXML">
<Description>
Loading XML into the feature class 
d ##class(apptools.core.files).LoadXML("d:\!\InfoObject.xml","infoObject","Model.InfoObject") </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>fn,tag,class</FormalSpec>
<Implementation><![CDATA[
	Set tReader = ##class(%XML.Reader).%New()
	s sc=tReader.OpenFile(fn)
	If $$$ISERR(sc) Do $system.OBJ.DisplayError(sc) Quit  
	Do tReader.Correlate(tag,class)
	Set Count=0
	While tReader.Next(.Object, .sc) {
	    Write Object_" imported.",!
	    Set Count=Count+1
	}
	If $$$ISERR(sc) Do $system.OBJ.DisplayError(sc) Quit  
	Write !,Count
	Quit
]]></Implementation>
</Method>

<Method name="getPathcconsole">
<Description>
To the system path Protocol
w ##class(apptools.core.files).getPathcconsole()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&dir,&logname]]></FormalSpec>
<Implementation><![CDATA[
	s slash=$$$slash
	Set path=$p($zu(86),"*",1) ;path cpf file * instance name
	s dir=$p(path,slash,1,$l(path,slash)-1)_slash_"mgr"_slash
	s logname=$s($zv["IRIS":"messages",1:"cconsole")
 quit dir_logname_".log"
]]></Implementation>
</Method>

<Method name="getDate">
<Description>
Search of time of the extension of the database</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Line,yyyy,mm,dd</FormalSpec>
<Implementation><![CDATA[
	Set mm=$p(Line,"/",1)
	Set dd=$p(Line,"/",2)
	Set yyyy="20"_$p($p(Line,"/",3),"-")
	q mm'=""&&(yyyy'="")
]]></Implementation>
</Method>

<Method name="GetContextForAlert">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	quit $lb("Close a transaction that failed to roll back","Shutdown complete","CPUusage Alert: CPUusage","Paging Alert: Physical Memory is","Lock table full","DiskPercentFull","Multiple sensors critically above normal")
]]></Implementation>
</Method>

<Method name="GetContextForAlertExclude">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	quit $lb("ResourceCleanup: Dead job cleanup","JobType=Background","JobType=CSP","SSL/TLS Certificate(s) expiring within")
]]></Implementation>
</Method>

<Method name="Alert">
<Description>
Search important events</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[Line,&bd,hdt]]></FormalSpec>
<Implementation><![CDATA[
	q:'..getDate(Line,.yyyy,.mm) $$$OK
	set context=..GetContextForAlert()
	for i=1:1:$ll(context) {
		if Line[$lg(context,i)	{
			if $i(bd($lg(context,i),yyyy,mm)) set stop=1 quit
		}
	}
	quit:$Get(stop) $$$OK
	set Exclude=..GetContextForAlertExclude()
	if $p(Line," ",3)>2 {
		for i=1:1:$ll(Exclude) {
			if Line[$lg(Exclude,i)	{
				set stop=1 quit
			}
		}
		quit:$Get(stop) $$$OK
		
		set context=$p(Line," ",5,7)
		if $i(bd(context,yyyy,mm))
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="ExpansionDB">
<Description>
Search of time of the extension of the database</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[Line,&bd,hdt]]></FormalSpec>
<Implementation><![CDATA[
	s context = "Expansion completed"
	if Line[context	{
		q:'..getDate(Line,.yyyy,.mm) $$$OK
		Set dbn=$p($p(Line,"database ",2),". Expanded",1)
		Set mb=$p($p(Line,"Expanded by ",2)," MB",1)
		;Set bd("total",yyyy,mm)=$g(bd("total",yyyy,mm))+mb
		;Set bd("total",yyyy)=$g(bd("total",yyyy))+mb
		Set bd(dbn,yyyy,mm)=$g(bd(dbn,yyyy,mm))+mb
		Set bd(dbn,yyyy)=$g(bd(dbn,yyyy))+mb
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="getPeriod">
<Description>
To date range in number of days from the current
w ##class(apptools.core.files).getPeriod(69,.FromDateTime,.ToDateTime,.df,.dt)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>days,FromDateTime,ToDateTime,df,dt</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s FromDateTime="CurrentDay-"_days
	s ToDateTime="CurrentDay"

	if $$InterpretCurrentDay("added?DateFrom="_FromDateTime_"&DateTo="_ToDateTime,.res,.df,.dt) {
		 Set:$g(df)'="" FromDateTime=$p(df,".",2)_"/"_$p(df,".",1)_"/"_$e($p(df,".",3),3,4)_"-00:00:00"
		 Set:$g(dt)'="" ToDateTime=$p(dt,".",2)_"/"_$p(dt,".",1)_"/"_$e($p(dt,".",3),3,4)_"-23:59:59"
	}
	i $g(dt) q df_" "_dt
	q ""
 /// Interpreterpath string with the current date type
 /// Str= DateFrom=(CurrentDay-2)&DateTo=(CurrentDay-1)
 /// The result the computed value of the expression 
InterpretCurrentDay(Str, Result,df,dt) 
	#dim tSC As %Status = 1
	#dim e As %Exception.AbstractException
	
	Set exp=$p(Str,"?",2)
	quit:exp="" "0"
	Set exp="s "_$replace(exp,"CurrentDay",+$h)
	Set exp=$replace(exp,"&DateTo",",%tempTo")
	Set exp=$replace(exp,"DateFrom","%tempFrom")
	try {
		x exp
		Set df=$tr($zd(%tempFrom,4),"/",".")
		Set dt=$tr($zd(%tempTo,4),"/",".")
		Set Result=$p(Str,"?",1)_"?DateFrom="_df_"&DateTo="_dt
		kill %tempFrom,%tempTo
	} Catch e {
		Set tSC=e.AsStatus()
	}
  quit tSC
]]></Implementation>
</Method>

<Method name="FindContextInLog">
<Description>
To execute the method on each line of Protocol</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>days,method,bd</FormalSpec>
<PublicList>tProductionName,inf</PublicList>
<Implementation><![CDATA[
	Set gn=$$$GNmessages
	KILL res
	do ##class(apptools.core.files).getPathcconsole(.dir,.logname) ;w !,dir
	do ##class(apptools.core.files).GetList(dir,logname_"*",.List) ;zw List
	set i="" for { set i=$o(List(i)) q:i="" 
		do ParseFile(gn,i)
	}
	;w !,days
	s period=##class(apptools.core.files).getPeriod(days,.FromDateTime,.ToDateTime,.df,.dt) 
	;w !,df_" "_dt
	
	if FromDateTime="" Set HFromDateTime="1.1"
	else  Set HFromDateTime=$$DataTimeCConsole2H(FromDateTime)
	if ToDateTime="" Set HToDateTime="99999999"
	else  Set HToDateTime=$$DataTimeCConsole2H(ToDateTime)
	
	;w !,HFromDateTime_" "_HToDateTime
	;w !,FromDateTime_" "_ToDateTime
	;set hdt=HFromDateTime
	set from=$p(df,".",3)_$p(df,".",2)_$p(df,".",1)_"000000"
	set to=$p(dt,".",3)_$p(dt,".",2)_$p(dt,".",1)_"235959"
	;w !,from," ",to
	set class=$p($p(method,"(",2),")"),method=$p($p(method,")",2),".",2)
	for i=1:1 {
		 set from=$o(@gn@(from),1,Line) 
		 quit:from=""  
		 quit:from>to
		;w !,$zr,!,Line
		;w !,$na(@gn@(from)),!,@gn@(from)
		// Search context 
		d $classmethod(class,method,Line,.bd,from)
	}
	set bd=period
	quit $$$OK


/// Function parse Protocol of the file on the date required depth
/// To skanirovat cconsole.log the result to put 
ParseFile(gnTemp,InFile)
	if $g(@gnTemp)[InFile,InFile'["messages.log" q 1 ;already archive dismantled
	;w !,InFile
	Set File2 = ##class(%File).%New(InFile)
	Do File2.Open("RSK\UTF8\")
	Do {
		Set Line = File2.ReadLine()
		set H=$$DataTimeCConsole2H($p(Line,":",1,3),.GGGGMMDD)
		
		if H="",$g(zts)'="" {
			if $l($g(@gnTemp@(zts)))>32000 continue
			if @gnTemp@(zts)[Line continue
			set @gnTemp@(zts)=$g(@gnTemp@(zts))_" "_Line ;glue from the previous
			continue
		}
		;s zts=H_","_$p($p(Line,":",4)," ")
		set zts=GGGGMMDD_"."_$p($p(Line,":",4)," ")
		set zts=+zts
		if $g(@gnTemp@(zts))'="",$g(@gnTemp@(zts))'=Line {
			 if $l($g(@gnTemp@(zts)))>32000 continue
			 if @gnTemp@(zts)[Line continue
			 set @gnTemp@(zts)=$g(@gnTemp@(zts))_" "_Line  
			 continue
		}
		;i $i(@gnTemp@(0)) ;i '(@gnTemp@(0)#1000) w "."
		s @gnTemp@(zts)=Line
	} While 'File2.AtEnd
	Do File2.Close()
	set:$g(@gnTemp)'[InFile @gnTemp=$g(@gnTemp)_"*"_InFile ;add the name of zagolovok for exceptions in the following analysis
 quit $g(@gnTemp)

/// Transform the date 09/01/17-10:31:15 in $Horolog.
DataTimeCConsole2H(DT,GGGGMMDD)
		set dc=""
		Set Date1=$p(DT,"-")
		Set Time1=$p(DT,"-",2)
		try {
			set da=$p(Date1,"/",1,2)_"/20"_$p(Date1,"/",3)
			Set dh=$zdh(da,1)
			Set th=$zth(Time1,1)
			Set dc=dh_"."_th
			set GGGGMMDD=$p(da,"/",3)_$p(da,"/",1)_$p(da,"/",2)_$tr(Time1,":")
		} catch {}
 quit $g(dc)


/// Check entry Date1=MM/DD/YY, Time1=HH:MM:SS in the range df,dt
IncludDataTime(DateTime1,df,dt,stop)
	Set z="0"
	try {
		Set dc=$$DataTimeCConsole2H(DateTime1)
		i dc>df,dc<dt s z=1
	} catch {
		Set z=$ze w !,$g(DateTime1)_","_$g(df)_","_$g(dt)_" "_$ze
	}
 quit z
]]></Implementation>
</Method>

<Method name="OneJournalCount">
<Description>
Count one journal as what globals modifierade
k ^tmpJRN d ##class(apptools.core.files).OneJournalCount("/sdb/journals/20181225.003","^tmpJRN")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>journal="",tempGlob=$$$TEMPJRNL</FormalSpec>
<Implementation><![CDATA[
	s TmpGN="^||log" k @TmpGN
	i '$isobject(journal) s journal=##class(%SYS.Journal.File).%OpenId(journal)	q:'$isobject(journal)
	w !,$$$FormatText($$$aText("Processed %1% 2 written in %3",""),journal.Name,$zdt($h,4),tempGlob),! 
	d JournalCount(journal)
	m @tempGlob@($P($zu(86),"*",2))=@TmpGN
    q
JournalCount(journal)
	  #dim record As %SYS.Journal.Record
	  set quit=0
	  i $isobject(journal) {
	    #; the first and last address, to calculate the progress in percent
	    set firstPos=journal.FirstRecord.Address
	    set lastPos=journal.LastRecord.Address
	    set opr=""
	    #; start with the end of the file
	    set record=journal.LastRecord
	    for {
	      if '(record.Address#500000) {
	      	#; the progress display processing
	      	set proc=$j((lastPos-record.Address)/(lastPos-firstPos)*100,5,1)
	      	if proc'=opr set opr=proc write $c(13),?10,proc,"%  "
	      }
	      s TimeStamp=$tr(record.TimeStampGet(),"-")
	      s date=$p(TimeStamp," ")
	      s hour=$p($p(TimeStamp," ",2),":",1)
	      #; Change record data
	      if record.%IsA("%SYS.Journal.SetKillRecord") {
	        ;set gref=record.GlobalReference
	    	s (OV,NV)=""
	    	i record.TypeName="SET" {
	    		s OV=record.OldValue
	    		s NV=record.NewValue
	    	}
	    	elseif record.TypeName="BitSET" {
		    	s NV=1
	    	}
	        d Count(record.TypeName,$l(OV),$l(NV),record.DatabaseName,record.GlobalNode)
	      }
	      #; move to the previous record in the log file
	      set record=record.Prev
	      quit:'$isobject(record)
	    }
	  }
	q  	
Count(TypeOp,OV,NV,base,gref)
	;q:$qs(gref,0)["CacheAuditD"
	;q:$qs(gref,0)["Ens."
	;s base=$qs(gref,-1)
	if $qs(gref,0)["SYS",$ql(gref)>0 {
		s gref=$na(@$qs(gref,0)@($qs(gref,1))) ;$qs(gref,2)))
	}
	elseif $e($qs(gref,0),*)="D"||($e($qs(gref,0),*)="I")||($e($qs(gref,0),*)="S") { //record objects
		s gref=$na(@$qs(gref,0))
	}
	elseif $qs(gref,0)["log"||($qs(gref,0)["tmp") { //protocols
		s gref=$na(@$qs(gref,0))
	}
	else {
		s gref=$na(@$qs(gref,0)) ;the name of the array
	}
	;s Log($lb(base,gref))=$g(Log($lb(base,gref)))+1
	i $i(@TmpGN@(date,hour,base,TypeOp,gref,"Counts"))
	;we assume the number of new would
	s @TmpGN@(date,hour,base,TypeOp,gref,"OldValue")=$g(@TmpGN@(date,hour,base,TypeOp,gref,"OldValue"))+OV
	s @TmpGN@(date,hour,base,TypeOp,gref,"NewValue")=$g(@TmpGN@(date,hour,base,TypeOp,gref,"NewValue"))+NV
 q
]]></Implementation>
</Method>

<Method name="OneDayJournalCount">
<Description>
To count in journal which globals as modifierade for a specific date
 d ##class(apptools.core.files).OneDayJournalCount("/opt/isc/ensemble/mgr/journal/20181225","^tmpJRN")
 d ##class(apptools.core.files).OneDayJournalCount("/sdb/journals/20181225","^tmpJRN")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>fileYYYYMMDD="",tempGlob=$$$TEMPJRNL</FormalSpec>
<Implementation><![CDATA[
 i $g(@tempGlob)'="" w !,$$$aText("About is already underway","")_" "_$g(@tempGlob) q
 s @tempGlob=$zts ;the beginning of the formation

 s slash=$$$slash
 if fileYYYYMMDD="" { 
	w !,$$$aText("We assume for the previous day","")
	s file=##class(%SYS.Journal.System).GetCurrentFile()
	s fileYYYYMMDD=$p(file.Name,slash,1,*-1)_slash_$tr($zd($h-1,3),"-")
 }
 ;date for which we believe
 s date=$p($p(fileYYYYMMDD,slash,$l(fileYYYYMMDD,slash)),".")
 for j=1:1:999 {
	  s suf=$s($l(j)=1:"00",$l(j)=2:"0",1:"")_j
	  s jname=fileYYYYMMDD_"."_suf 
	  w !,jname
	  #dim journ As %SYS.Journal.File = ##class(%SYS.Journal.File).%OpenId(jname)
	  i $isobject(journ) {	  
		 d ..OneJournalCount(journ,tempGlob)
	  }
	  else { QUIT
	  }
 }
 s @tempGlob="" ;flag the end of nascet
 q
]]></Implementation>
</Method>

<Method name="Export2CSV">
<Description>
Export to CSV file
d ##class(apptools.core.files).Export2CSV("/backup/temp/JrnCount*.csv","^tmpJRN2")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>aFileName=$$$EMAILXLSPATH_"JrnCount*.csv",tmpGN=$$$TEMPJRNL,aCharset="CP1251"</FormalSpec>
<Implementation><![CDATA[
	s:aFileName["*" aFileName=$replace(aFileName,"*",$tr($zd($h,3)_$zt($p($h,",",2),-1),":- "))
	#dim FileStream As %FileCharacterStream = ##class(%FileCharacterStream).%New()
	s FileStream.Filename=aFileName
	s:(aCharset'="") FileStream.TranslateTable=aCharset
	d FileStream.WriteLine("Instance;Date;Hour;Drive;Base;TypeOperation;GlobalRef;Counts;ByteOldValue;ByteNewValue")
	s (c4,o4,n4)=0
		s s1="" f { s s1=$o(@tmpGN@(s1)) q:s1=""
			s s2="" f { s s2=$o(@tmpGN@(s1,s2)) q:s2=""      ; Date
				s s3="" f { s s3=$o(@tmpGN@(s1,s2,s3)) q:s3=""	; Hour
					s s4="" f { s s4=$o(@tmpGN@(s1,s2,s3,s4)) q:s4="" ; Base
						s (c4,o4,n4)=0
						s s5="" f { s s5=$o(@tmpGN@(s1,s2,s3,s4,s5)) q:s5="" ; TypeOperation
							s s6="" f { s s6=$o(@tmpGN@(s1,s2,s3,s4,s5,s6)) q:s6="" ; Ref
								continue:s6="^"
								s Count=$g(@tmpGN@(s1,s2,s3,s4,s5,s6,"Counts"))
								s Old=$g(@tmpGN@(s1,s2,s3,s4,s5,s6,"OldValue"))
								s New=$g(@tmpGN@(s1,s2,s3,s4,s5,s6,"NewValue"))
								s gref=s6
								#dim line As %String = $lb(s1,s2,s3,$p($p(s4,":"),"^^",2)_":",s4,s5,s6,Count,Old,New)
								d FileStream.WriteLine($lts(line,";"))
							}
						}
					}
				}
			}
		}
	
	s sc=FileStream.SaveStream()
	WRITE !,$$$aText("Written to the file","")_" "_aFileName,!
	KILL FileStream quit sc
	q
]]></Implementation>
</Method>

<Method name="GetAllDir">
<Description>
Get all files in a directory and subdirectories
d ##class(apptools.core.files).GetAllDir("d:\dev\app1\src\",,.a)
ext = "*.jpg;*.jpeg;*.3gp" </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[dir,ext="",&out]]></FormalSpec>
<Implementation><![CDATA[
	set dir = ##class(%File).NormalizeDirectory(dir)
	set rs = ##class(%ResultSet).%New("%File:FileSet")
	s sc=rs.Execute(dir, ext)
	while (rs.Next()) {
		;w !,rs.Get("Name")
		set out($i(out)) = $lb(rs.Get("Name"),rs.Get("Type"),rs.Get("Size"),rs.Get("ItemName"),rs.Get("DateCreated"),rs.Get("DateModified"))
		i rs.Get("Type")="D" d ##class(apptools.core.files).GetAllDir($lg(out(out),1),ext,.out)
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="TransXLS2CSV">
<Description>
Convert XSL file to CSV format and upload to GD
d ##class(apptools.core.files).TransXLS2CSV</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[fileXSL,FieldNameHead="QUANTITY",&out,&error,tempDir=##class(%File).GetDirectory(##class(%File).TempFilename())]]></FormalSpec>
<Implementation><![CDATA[
		s path=$p(fileXSL,$$$slash,1,*-1)
		if path="" s error="Empty "_path q $$$ERROR($$$GeneralError,error)
		s gn2=..tempGN("Xls2") k @gn2

		;Convert xls to csv in UTF8 format delimited by commas and field values enclosed in double quotes
		s cmd="cd "_path_"; export HOME=$(eval echo ~$(id -u -n)) && unset LD_LIBRARY_PATH && soffice --convert-to csv --infilter=CSV:44,34,76,1 --headless "_fileXSL
		w "<br> "_cmd
		d ##class(apptools.core.sys).RunCmd(cmd,gn2,0,tempDir) h 1
		k @gn2

		s fileCSV=$p(fileXSL,".",1,*-1)_".csv"
		;Load and parse the received CSV
		;w "<br> csv "_fileCSV
		s gn3=..tempGN("Xls3") k @gn3
		s st=##class(apptools.core.files).ReadFile2Arr(fileCSV,"RSK","UTF8",gn3)
		i 'st s error=$System.Status.GetErrorText(st) q st
		i '$d(@gn3) s error="Not file "_fileCSV q $$$ERROR($$$GeneralError,error)
		;zw @gn3
		if FieldNameHead="" m out=@gn3 k @gn3 q $$$OK
		s gn=..tempGN("CsvTable") kill @gn
		s i=""
		f { s i=$o(@gn3@(i),1,s) q:i=""
			s ss=""
			;First go through by double quotes and each even-numbered commas in Char broadcast=1
			f ii=1:1 { q:$p(s,$c(34),ii,ii+1)=""
				s ss=ss_$s('(ii#2):$tr($p(s,$c(34),ii),",",$c(1)),1:$p(s,$c(34),ii))
			}
			i s[FieldNameHead { ;make a hat once
				f ii=1:1 { q:$p(ss,",",ii,ii+1)=""
					s name=$tr($ZStrip($p(ss,",",ii),"<>WP"),$c(1),",") ;reverse stream
					continue:name=""
					s @gn@(0,ii)=$lb(name)
					s @gn@(-1,name)=ii
				}
			} elseif 1 { ;pass on all other rows
				;w "<br>"_ss
				s listval=""
				;We'll use the comma Char=1 return back to commas
				f ii=1:1 { q:$p(ss,",",ii,ii+1)=""
					s val=$tr($ZStrip($p(ss,",",ii),"<>W"),$c(1),",") ;reverse stream
					s listval=listval_$lb(val)
				}
				s row=$g(row)+1
				s @gn@(row)=listval
			}
		}
		if $g(out)="gn" { s out=$na(@gn)}
		elseif $g(out)["^" { m @out=@gn k @gn }
		else {	m out=@gn k @gn
		}
		q $$$OK
]]></Implementation>
</Method>

<Method name="tempGN">
<Description>
To globalnu a reference to a temporary global
w ##class(apptools.core.files).tempGN("GN")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GN,NoKill=0</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	;not to do ^|| and ^mtemp
	s gn=$na(^tmpAppFile(GN,$j)) 
	if 'NoKill KILL @gn	s @gn=$$$AppDT($h)
	q gn
]]></Implementation>
</Method>

<Method name="tempDir">
<Description>
To a temporary directory
w ##class(apptools.core.files).tempDir()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[ q ##class(%File).GetDirectory(##class(%File).TempFilename())
]]></Implementation>
</Method>

<Method name="XlsxTransChoiceLotResult">
<Description>
Generate the XLSX document template transforming field
f - the array of fields to replace
ParamData - the name Value of the parameter
node - the subnode of a temporary global
ParamClass - "Spgz.model.Param"
ParamField - field name ;"OfficeFile"</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>f,node,ParamData,ParamClass,ParamField,debug=0,newfile="",msg=""</FormalSpec>
<Implementation><![CDATA[
	///Forming Applications WG
	s st=##class(apptools.core.Form).GetValueByName(ParamClass,ParamData,ParamField,.Val,1)
	i 'st {
		w $System.Status.GetErrorText(st) q $$$OK
	} else {
		s desc=Val("obj").Description
		s file=$p($g(Val("fileName")),"*",1)
	}
	if $g(file)="" w $$$appError("Empty file "_file) q 1
	
	s gn=..tempGN(node) k @gn
	;d ##class(apptools.core.files).File2Arr(file,gn)
	i debug s msg=msg_"<br>"_gn_" "_file
	;Unzip
	s tempDir=..tempDir()_$j
	d ##class(apptools.core.files).UnzipToDirectory(file,tempDir)
	
	;Read the global source template
	s fileSource=tempDir_"/xl/sharedStrings.xml"
	s st=##class(apptools.core.files).ReadFile2Arr(fileSource,"RSK",,gn) ;read the file into an array

	i 'st s msg=msg_$$$appError($System.Status.GetErrorText(st)) w msg q 1
	i '$d(@gn) w $$$appError($$$aText("No file","")) q 1

	set fn=fileSource ;    $replace(file,"-doc","-order-"_$username_"-") ;_$tr($zts,",.")) 
	if '##class(apptools.core.files).OpenFile(fn) s msg=msg_$$$appError($$$aText("No access rights to write the file","")_" "_fn) w msg q 1
	s curIo=$i
	s i=""
	f { s i=$o(@gn@(i),1,str) q:i=""
		s fkey="" 
		f { s fkey=$o(f(fkey),1,fdata) q:fkey=""
			i str[fkey s str=$replace(str,fkey,fdata)
		}
		s @gn@(i)=str
		use fn 	write @gn@(i),!	use curIo
	}
	close fn
	
	i debug s msg=msg_"<br>fn="_fn_"<br>tempDir="_tempDir
	;Archived again under a new name
	;i ##class(apptools.core.files).zipFile(tempDir,tempDir,newfilename,"/backup/temp/spgz-zip")
	s newfile=..tempDir()_node_"-"_$username_"-"_$zd($h,3)_"-"_$tr($zt($p($h,",",2),1),":")_".xlsx"
	set cmd="cd "_tempDir_"; zip -r "_newfile_" * ; rm -R "_tempDir
	s gn=..tempGN(node_"Xlsx3") k @gn
	i debug s msg=msg_"<br>"_cmd
	d ##class(apptools.core.sys).RunCmd(cmd,gn) h 3
	i debug zw @gn
	;The link is temporary
	if ##class(apptools.core.DownloadCSP).GetFileId(newfile,.url) { 
		s msg=msg_"<li><a title="""_$$$aText("Save this file on your disk","")_""" href='"_url_"'>"_$$$aText("To the formed document file","")_" "_$g(desc)_"</a>"
		w msg
	}
]]></Implementation>
</Method>

<Method name="GetFileIdView">
<Description>
%request.Application_"get-files/"_id</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>FileName,gn="",ContentType=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set st=$$$OK
	if gn="" { //store referals is temporary
		s gn = ##class(apptools.core.DownloadCSP).GetGN()
		set id=$r(+$h)_$zcrc(7,FileName)_$r(+$h)_"."_$p(FileName,".",*)
		set @gn@(id)=FileName
		if ContentType'="" set @gn@(id,"ContentType")=ContentType ;="application/force-download"
	} else {
		set id=$SYSTEM.Encryption.Base64Encode($SYSTEM.Encryption.MD5Hash(FileName))_"."_$p(FileName,".",*)
		if $g(@gn@(id))=""	{
			s @gn@(id)=FileName
			if ContentType'="" set @gn@(id,"ContentType")=ContentType
		}
	}
 		;set @gn@(id,"origname")=origname
 		;set URL=..%ClassName(1)_".cls?"_cgivar_"="_id
 	quit id
]]></Implementation>
</Method>

<Method name="Test">
<Description>
do ##class(apptools.core.files).Test(30,.res)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>days,res</FormalSpec>
<Implementation><![CDATA[
 	;set method="class(apptools.core.files).Alert" 
	set method="class(apptools.core.files).AlertDays" 
	do ##class(apptools.core.files).FindContextInLog(days,method,.res)
]]></Implementation>
</Method>

<Method name="AlertDays">
<Description>
Search important events</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[Line,&bd,dt]]></FormalSpec>
<Implementation><![CDATA[
	q:'..getDate(Line,.yyyy,.mm,.dd) $$$OK
	set context=..GetContextForAlert()
	;w !,dt," ",Line
	
	for i=1:1:$ll(context) {
		if Line[$lg(context,i)	{
			set bd($i(bd))=Line
			set stop=1 quit
		}
	}
	quit:$Get(stop) $$$OK
	
	set Exclude=..GetContextForAlertExclude()
	if $p(Line," ",3)>1 {
		for i=1:1:$ll(Exclude) {
			if Line[$lg(Exclude,i)	{
				set stop=1 quit
			}
		}
	
		quit:$Get(stop) $$$OK
		;set context=$p(Line," ",3)_" "_$p(Line," ",5,7)
		set bd($i(bd))=Line
	}
	q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.filesMimeTypes">
<Description>
Utilities working with files</Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65610,77273.857</TimeChanged>
<TimeCreated>65607,76506.026852</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Method name="GetTypesWildcards">
<Description>
w ##class(apptools.core.filesMimeTypes).GetTypesWildcards()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>type="image"</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set gn="^%apptools.MimeTypes"
	if '$d(@gn) d ..Create(gn)
	set i="",wildcards=""
	for { set i=$o(@gn@("type",type,i)) q:i=""
		set wildcards=wildcards_"*."_i_";"
	}
	q $e(wildcards,1,*-1)
]]></Implementation>
</Method>

<Method name="GetMimeTypes4ext">
<Description>
w ##class(apptools.core.filesMimeTypes).GetMimeTypes4ext()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ext="jpg"</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set gn="^%apptools.MimeTypes" ;k @gn
	if '$d(@gn) d ..Create(gn)
	q:ext="" ""
	q $g(@gn@("ext",ext))
]]></Implementation>
</Method>

<Method name="Create">
<Description>
Create global MimeTypes</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>gn</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s txt=##class(apptools.core.sql).getSQL("apptools.core.filesMimeTypes:MimeTypes",0)
	for i=1:1:$l(txt,$c(13,10)) {
		s str=$tr($zstrip($p(txt,$c(13,10),i),"<>P")," "_$c(9),"**")
		continue:str=""
		continue:$e(str,1)="#"
		s type=$p(str,"*",1)
		continue:type=""
		for ii=2:1:$l(str,"*") {
			if $p(str,"*",ii)'="" {
				set @gn@("ext",$p(str,"*",ii))=type  
				set @gn@("typeext",type)=$p(str,"*",ii)
				set @gn@("type",$p(type,"/"),$p(str,"*",ii))=type
			}
		}
	}
]]></Implementation>
</Method>

<XData name="MimeTypes">
<Description>
MimeTypes from Apache</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
# This file maps Internet media types to unique file extension(s).
# Although created for httpd, this file is used by many software systems
# and has been placed in the public domain for unlimited redisribution.
#
# The table below contains both registered and (common) unregistered types.
# A type that has no unique extension can be ignored -- they are listed
# here to guide configurations toward known types and to make it easier to
# identify "new" types.  File extensions are also commonly used to indicate
# content languages and encodings, so choose them carefully.
#
# Internet media types should be registered as described in RFC 4288.
# The registry is at <http://www.iana.org/assignments/media-types/>.
#
# MIME type (lowercased)			Extensions
# ============================================	==========
# application/1d-interleaved-parityfec
# application/3gpdash-qoe-report+xml
# application/3gpp-ims+xml
# application/a2l
# application/activemessage
# application/alto-costmap+json
# application/alto-costmapfilter+json
# application/alto-directory+json
# application/alto-endpointcost+json
# application/alto-endpointcostparams+json
# application/alto-endpointprop+json
# application/alto-endpointpropparams+json
# application/alto-error+json
# application/alto-networkmap+json
# application/alto-networkmapfilter+json
# application/aml
application/andrew-inset			ez
# application/applefile
application/applixware				aw
# application/atf
# application/atfx
application/atom+xml				atom
application/atomcat+xml				atomcat
# application/atomdeleted+xml
# application/atomicmail
application/atomsvc+xml				atomsvc
# application/atxml
# application/auth-policy+xml
# application/bacnet-xdd+zip
# application/batch-smtp
# application/beep+xml
# application/calendar+json
# application/calendar+xml
# application/call-completion
# application/cals-1840
# application/cbor
# application/ccmp+xml
application/ccxml+xml				ccxml
# application/cdfx+xml
application/cdmi-capability			cdmia
application/cdmi-container			cdmic
application/cdmi-domain				cdmid
application/cdmi-object				cdmio
application/cdmi-queue				cdmiq
# application/cdni
# application/cea
# application/cea-2018+xml
# application/cellml+xml
# application/cfw
# application/cms
# application/cnrp+xml
# application/coap-group+json
# application/commonground
# application/conference-info+xml
# application/cpl+xml
# application/csrattrs
# application/csta+xml
# application/cstadata+xml
# application/csvm+json
application/cu-seeme				cu
# application/cybercash
# application/dash+xml
# application/dashdelta
application/davmount+xml			davmount
# application/dca-rft
# application/dcd
# application/dec-dx
# application/dialog-info+xml
# application/dicom
# application/dii
# application/dit
# application/dns
application/docbook+xml				dbk
# application/dskpp+xml
application/dssc+der				dssc
application/dssc+xml				xdssc
# application/dvcs
application/ecmascript				ecma
# application/edi-consent
# application/edi-x12
# application/edifact
# application/efi
# application/emergencycalldata.comment+xml
# application/emergencycalldata.deviceinfo+xml
# application/emergencycalldata.providerinfo+xml
# application/emergencycalldata.serviceinfo+xml
# application/emergencycalldata.subscriberinfo+xml
application/emma+xml				emma
# application/emotionml+xml
# application/encaprtp
# application/epp+xml
application/epub+zip				epub
# application/eshop
# application/example
application/exi					exi
# application/fastinfoset
# application/fastsoap
# application/fdt+xml
# application/fits
application/font-tdpfr				pfr
# application/framework-attributes+xml
# application/geo+json
application/gml+xml				gml
application/gpx+xml				gpx
application/gxf					gxf
# application/gzip
# application/h224
# application/held+xml
# application/http
application/hyperstudio				stk
# application/ibe-key-request+xml
# application/ibe-pkg-reply+xml
# application/ibe-pp-data
# application/iges
# application/im-iscomposing+xml
# application/index
# application/index.cmd
# application/index.obj
# application/index.response
# application/index.vnd
application/inkml+xml				ink inkml
# application/iotp
application/ipfix				ipfix
# application/ipp
# application/isup
# application/its+xml
application/java-archive			jar
application/java-serialized-object		ser
application/java-vm				class
application/javascript				js
# application/jose
# application/jose+json
# application/jrd+json
application/json				json
# application/json-patch+json
# application/json-seq
application/jsonml+json				jsonml
# application/jwk+json
# application/jwk-set+json
# application/jwt
# application/kpml-request+xml
# application/kpml-response+xml
# application/ld+json
# application/lgr+xml
# application/link-format
# application/load-control+xml
application/lost+xml				lostxml
# application/lostsync+xml
# application/lxf
application/mac-binhex40			hqx
application/mac-compactpro			cpt
# application/macwriteii
application/mads+xml				mads
application/marc				mrc
application/marcxml+xml				mrcx
application/mathematica				ma nb mb
application/mathml+xml				mathml
# application/mathml-content+xml
# application/mathml-presentation+xml
# application/mbms-associated-procedure-description+xml
# application/mbms-deregister+xml
# application/mbms-envelope+xml
# application/mbms-msk+xml
# application/mbms-msk-response+xml
# application/mbms-protection-description+xml
# application/mbms-reception-report+xml
# application/mbms-register+xml
# application/mbms-register-response+xml
# application/mbms-schedule+xml
# application/mbms-user-service-description+xml
application/mbox				mbox
# application/media-policy-dataset+xml
# application/media_control+xml
application/mediaservercontrol+xml		mscml
# application/merge-patch+json
application/metalink+xml			metalink
application/metalink4+xml			meta4
application/mets+xml				mets
# application/mf4
# application/mikey
application/mods+xml				mods
# application/moss-keys
# application/moss-signature
# application/mosskey-data
# application/mosskey-request
application/mp21				m21 mp21
application/mp4					mp4s
# application/mpeg4-generic
# application/mpeg4-iod
# application/mpeg4-iod-xmt
# application/mrb-consumer+xml
# application/mrb-publish+xml
# application/msc-ivr+xml
# application/msc-mixer+xml
application/msword				doc dot
application/mxf					mxf
# application/nasdata
# application/news-checkgroups
# application/news-groupinfo
# application/news-transmission
# application/nlsml+xml
# application/nss
# application/ocsp-request
# application/ocsp-response
application/octet-stream	bin dms lrf mar so dist distz pkg bpk dump elc deploy
application/oda					oda
# application/odx
application/oebps-package+xml			opf
application/ogg					ogx
application/omdoc+xml				omdoc
application/onenote				onetoc onetoc2 onetmp onepkg
application/oxps				oxps
# application/p2p-overlay+xml
# application/parityfec
application/patch-ops-error+xml			xer
application/pdf					pdf
# application/pdx
application/pgp-encrypted			pgp
# application/pgp-keys
application/pgp-signature			asc sig
application/pics-rules				prf
# application/pidf+xml
# application/pidf-diff+xml
application/pkcs10				p10
# application/pkcs12
application/pkcs7-mime				p7m p7c
application/pkcs7-signature			p7s
application/pkcs8				p8
application/pkix-attr-cert			ac
application/pkix-cert				cer
application/pkix-crl				crl
application/pkix-pkipath			pkipath
application/pkixcmp				pki
application/pls+xml				pls
# application/poc-settings+xml
application/postscript				ai eps ps
# application/ppsp-tracker+json
# application/problem+json
# application/problem+xml
# application/provenance+xml
# application/prs.alvestrand.titrax-sheet
application/prs.cww				cww
# application/prs.hpub+zip
# application/prs.nprend
# application/prs.plucker
# application/prs.rdf-xml-crypt
# application/prs.xsf+xml
application/pskc+xml				pskcxml
# application/qsig
# application/raptorfec
# application/rdap+json
application/rdf+xml				rdf
application/reginfo+xml				rif
application/relax-ng-compact-syntax		rnc
# application/remote-printing
# application/reputon+json
application/resource-lists+xml			rl
application/resource-lists-diff+xml		rld
# application/rfc+xml
# application/riscos
# application/rlmi+xml
application/rls-services+xml			rs
application/rpki-ghostbusters			gbr
application/rpki-manifest			mft
application/rpki-roa				roa
# application/rpki-updown
application/rsd+xml				rsd
application/rss+xml				rss
application/rtf					rtf
# application/rtploopback
# application/rtx
# application/samlassertion+xml
# application/samlmetadata+xml
application/sbml+xml				sbml
# application/scaip+xml
# application/scim+json
application/scvp-cv-request			scq
application/scvp-cv-response			scs
application/scvp-vp-request			spq
application/scvp-vp-response			spp
application/sdp					sdp
# application/sep+xml
# application/sep-exi
# application/session-info
# application/set-payment
application/set-payment-initiation		setpay
# application/set-registration
application/set-registration-initiation		setreg
# application/sgml
# application/sgml-open-catalog
application/shf+xml				shf
# application/sieve
# application/simple-filter+xml
# application/simple-message-summary
# application/simplesymbolcontainer
# application/slate
# application/smil
application/smil+xml				smi smil
# application/smpte336m
# application/soap+fastinfoset
# application/soap+xml
application/sparql-query			rq
application/sparql-results+xml			srx
# application/spirits-event+xml
# application/sql
application/srgs				gram
application/srgs+xml				grxml
application/sru+xml				sru
application/ssdl+xml				ssdl
application/ssml+xml				ssml
# application/tamp-apex-update
# application/tamp-apex-update-confirm
# application/tamp-community-update
# application/tamp-community-update-confirm
# application/tamp-error
# application/tamp-sequence-adjust
# application/tamp-sequence-adjust-confirm
# application/tamp-status-query
# application/tamp-status-response
# application/tamp-update
# application/tamp-update-confirm
application/tei+xml				tei teicorpus
application/thraud+xml				tfi
# application/timestamp-query
# application/timestamp-reply
application/timestamped-data			tsd
# application/ttml+xml
# application/tve-trigger
# application/ulpfec
# application/urc-grpsheet+xml
# application/urc-ressheet+xml
# application/urc-targetdesc+xml
# application/urc-uisocketdesc+xml
# application/vcard+json
# application/vcard+xml
# application/vemmi
# application/vividence.scriptfile
# application/vnd.3gpp-prose+xml
# application/vnd.3gpp-prose-pc3ch+xml
# application/vnd.3gpp.access-transfer-events+xml
# application/vnd.3gpp.bsf+xml
# application/vnd.3gpp.mid-call+xml
application/vnd.3gpp.pic-bw-large		plb
application/vnd.3gpp.pic-bw-small		psb
application/vnd.3gpp.pic-bw-var			pvb
# application/vnd.3gpp.sms
# application/vnd.3gpp.sms+xml
# application/vnd.3gpp.srvcc-ext+xml
# application/vnd.3gpp.srvcc-info+xml
# application/vnd.3gpp.state-and-event-info+xml
# application/vnd.3gpp.ussd+xml
# application/vnd.3gpp2.bcmcsinfo+xml
# application/vnd.3gpp2.sms
application/vnd.3gpp2.tcap			tcap
# application/vnd.3lightssoftware.imagescal
application/vnd.3m.post-it-notes		pwn
application/vnd.accpac.simply.aso		aso
application/vnd.accpac.simply.imp		imp
application/vnd.acucobol			acu
application/vnd.acucorp				atc acutc
application/vnd.adobe.air-application-installer-package+zip	air
# application/vnd.adobe.flash.movie
application/vnd.adobe.formscentral.fcdt		fcdt
application/vnd.adobe.fxp			fxp fxpl
# application/vnd.adobe.partial-upload
application/vnd.adobe.xdp+xml			xdp
application/vnd.adobe.xfdf			xfdf
# application/vnd.aether.imp
# application/vnd.ah-barcode
application/vnd.ahead.space			ahead
application/vnd.airzip.filesecure.azf		azf
application/vnd.airzip.filesecure.azs		azs
application/vnd.amazon.ebook			azw
# application/vnd.amazon.mobi8-ebook
application/vnd.americandynamics.acc		acc
application/vnd.amiga.ami			ami
# application/vnd.amundsen.maze+xml
application/vnd.android.package-archive		apk
# application/vnd.anki
application/vnd.anser-web-certificate-issue-initiation	cii
application/vnd.anser-web-funds-transfer-initiation	fti
application/vnd.antix.game-component		atx
# application/vnd.apache.thrift.binary
# application/vnd.apache.thrift.compact
# application/vnd.apache.thrift.json
# application/vnd.api+json
application/vnd.apple.installer+xml		mpkg
application/vnd.apple.mpegurl			m3u8
# application/vnd.arastra.swi
application/vnd.aristanetworks.swi		swi
# application/vnd.artsquare
application/vnd.astraea-software.iota		iota
application/vnd.audiograph			aep
# application/vnd.autopackage
# application/vnd.avistar+xml
# application/vnd.balsamiq.bmml+xml
# application/vnd.balsamiq.bmpr
# application/vnd.bekitzur-stech+json
# application/vnd.biopax.rdf+xml
application/vnd.blueice.multipass		mpm
# application/vnd.bluetooth.ep.oob
# application/vnd.bluetooth.le.oob
application/vnd.bmi				bmi
application/vnd.businessobjects			rep
# application/vnd.cab-jscript
# application/vnd.canon-cpdl
# application/vnd.canon-lips
# application/vnd.cendio.thinlinc.clientconf
# application/vnd.century-systems.tcp_stream
application/vnd.chemdraw+xml			cdxml
# application/vnd.chess-pgn
application/vnd.chipnuts.karaoke-mmd		mmd
application/vnd.cinderella			cdy
# application/vnd.cirpack.isdn-ext
# application/vnd.citationstyles.style+xml
application/vnd.claymore			cla
application/vnd.cloanto.rp9			rp9
application/vnd.clonk.c4group			c4g c4d c4f c4p c4u
application/vnd.cluetrust.cartomobile-config		c11amc
application/vnd.cluetrust.cartomobile-config-pkg	c11amz
# application/vnd.coffeescript
# application/vnd.collection+json
# application/vnd.collection.doc+json
# application/vnd.collection.next+json
# application/vnd.comicbook+zip
# application/vnd.commerce-battelle
application/vnd.commonspace			csp
application/vnd.contact.cmsg			cdbcmsg
# application/vnd.coreos.ignition+json
application/vnd.cosmocaller			cmc
application/vnd.crick.clicker			clkx
application/vnd.crick.clicker.keyboard		clkk
application/vnd.crick.clicker.palette		clkp
application/vnd.crick.clicker.template		clkt
application/vnd.crick.clicker.wordbank		clkw
application/vnd.criticaltools.wbs+xml		wbs
application/vnd.ctc-posml			pml
# application/vnd.ctct.ws+xml
# application/vnd.cups-pdf
# application/vnd.cups-postscript
application/vnd.cups-ppd			ppd
# application/vnd.cups-raster
# application/vnd.cups-raw
# application/vnd.curl
application/vnd.curl.car			car
application/vnd.curl.pcurl			pcurl
# application/vnd.cyan.dean.root+xml
# application/vnd.cybank
application/vnd.dart				dart
application/vnd.data-vision.rdz			rdz
# application/vnd.debian.binary-package
application/vnd.dece.data			uvf uvvf uvd uvvd
application/vnd.dece.ttml+xml			uvt uvvt
application/vnd.dece.unspecified		uvx uvvx
application/vnd.dece.zip			uvz uvvz
application/vnd.denovo.fcselayout-link		fe_launch
# application/vnd.desmume.movie
# application/vnd.dir-bi.plate-dl-nosuffix
# application/vnd.dm.delegation+xml
application/vnd.dna				dna
# application/vnd.document+json
application/vnd.dolby.mlp			mlp
# application/vnd.dolby.mobile.1
# application/vnd.dolby.mobile.2
# application/vnd.doremir.scorecloud-binary-document
application/vnd.dpgraph				dpg
application/vnd.dreamfactory			dfac
# application/vnd.drive+json
application/vnd.ds-keypoint			kpxx
# application/vnd.dtg.local
# application/vnd.dtg.local.flash
# application/vnd.dtg.local.html
application/vnd.dvb.ait				ait
# application/vnd.dvb.dvbj
# application/vnd.dvb.esgcontainer
# application/vnd.dvb.ipdcdftnotifaccess
# application/vnd.dvb.ipdcesgaccess
# application/vnd.dvb.ipdcesgaccess2
# application/vnd.dvb.ipdcesgpdd
# application/vnd.dvb.ipdcroaming
# application/vnd.dvb.iptv.alfec-base
# application/vnd.dvb.iptv.alfec-enhancement
# application/vnd.dvb.notif-aggregate-root+xml
# application/vnd.dvb.notif-container+xml
# application/vnd.dvb.notif-generic+xml
# application/vnd.dvb.notif-ia-msglist+xml
# application/vnd.dvb.notif-ia-registration-request+xml
# application/vnd.dvb.notif-ia-registration-response+xml
# application/vnd.dvb.notif-init+xml
# application/vnd.dvb.pfr
application/vnd.dvb.service			svc
# application/vnd.dxr
application/vnd.dynageo				geo
# application/vnd.dzr
# application/vnd.easykaraoke.cdgdownload
# application/vnd.ecdis-update
application/vnd.ecowin.chart			mag
# application/vnd.ecowin.filerequest
# application/vnd.ecowin.fileupdate
# application/vnd.ecowin.series
# application/vnd.ecowin.seriesrequest
# application/vnd.ecowin.seriesupdate
# application/vnd.emclient.accessrequest+xml
application/vnd.enliven				nml
# application/vnd.enphase.envoy
# application/vnd.eprints.data+xml
application/vnd.epson.esf			esf
application/vnd.epson.msf			msf
application/vnd.epson.quickanime		qam
application/vnd.epson.salt			slt
application/vnd.epson.ssf			ssf
# application/vnd.ericsson.quickcall
application/vnd.eszigno3+xml			es3 et3
# application/vnd.etsi.aoc+xml
# application/vnd.etsi.asic-e+zip
# application/vnd.etsi.asic-s+zip
# application/vnd.etsi.cug+xml
# application/vnd.etsi.iptvcommand+xml
# application/vnd.etsi.iptvdiscovery+xml
# application/vnd.etsi.iptvprofile+xml
# application/vnd.etsi.iptvsad-bc+xml
# application/vnd.etsi.iptvsad-cod+xml
# application/vnd.etsi.iptvsad-npvr+xml
# application/vnd.etsi.iptvservice+xml
# application/vnd.etsi.iptvsync+xml
# application/vnd.etsi.iptvueprofile+xml
# application/vnd.etsi.mcid+xml
# application/vnd.etsi.mheg5
# application/vnd.etsi.overload-control-policy-dataset+xml
# application/vnd.etsi.pstn+xml
# application/vnd.etsi.sci+xml
# application/vnd.etsi.simservs+xml
# application/vnd.etsi.timestamp-token
# application/vnd.etsi.tsl+xml
# application/vnd.etsi.tsl.der
# application/vnd.eudora.data
application/vnd.ezpix-album			ez2
application/vnd.ezpix-package			ez3
# application/vnd.f-secure.mobile
# application/vnd.fastcopy-disk-image
application/vnd.fdf				fdf
application/vnd.fdsn.mseed			mseed
application/vnd.fdsn.seed			seed dataless
# application/vnd.ffsns
# application/vnd.filmit.zfc
# application/vnd.fints
# application/vnd.firemonkeys.cloudcell
application/vnd.flographit			gph
application/vnd.fluxtime.clip			ftc
# application/vnd.font-fontforge-sfd
application/vnd.framemaker			fm frame maker book
application/vnd.frogans.fnc			fnc
application/vnd.frogans.ltf			ltf
application/vnd.fsc.weblaunch			fsc
application/vnd.fujitsu.oasys			oas
application/vnd.fujitsu.oasys2			oa2
application/vnd.fujitsu.oasys3			oa3
application/vnd.fujitsu.oasysgp			fg5
application/vnd.fujitsu.oasysprs		bh2
# application/vnd.fujixerox.art-ex
# application/vnd.fujixerox.art4
application/vnd.fujixerox.ddd			ddd
application/vnd.fujixerox.docuworks		xdw
application/vnd.fujixerox.docuworks.binder	xbd
# application/vnd.fujixerox.docuworks.container
# application/vnd.fujixerox.hbpl
# application/vnd.fut-misnet
application/vnd.fuzzysheet			fzs
application/vnd.genomatix.tuxedo		txd
# application/vnd.geo+json
# application/vnd.geocube+xml
application/vnd.geogebra.file			ggb
application/vnd.geogebra.tool			ggt
application/vnd.geometry-explorer		gex gre
application/vnd.geonext				gxt
application/vnd.geoplan				g2w
application/vnd.geospace			g3w
# application/vnd.gerber
# application/vnd.globalplatform.card-content-mgt
# application/vnd.globalplatform.card-content-mgt-response
application/vnd.gmx				gmx
application/vnd.google-earth.kml+xml		kml
application/vnd.google-earth.kmz		kmz
# application/vnd.gov.sk.e-form+xml
# application/vnd.gov.sk.e-form+zip
# application/vnd.gov.sk.xmldatacontainer+xml
application/vnd.grafeq				gqf gqs
# application/vnd.gridmp
application/vnd.groove-account			gac
application/vnd.groove-help			ghf
application/vnd.groove-identity-message		gim
application/vnd.groove-injector			grv
application/vnd.groove-tool-message		gtm
application/vnd.groove-tool-template		tpl
application/vnd.groove-vcard			vcg
# application/vnd.hal+json
application/vnd.hal+xml				hal
application/vnd.handheld-entertainment+xml	zmm
application/vnd.hbci				hbci
# application/vnd.hcl-bireports
# application/vnd.hdt
# application/vnd.heroku+json
application/vnd.hhe.lesson-player		les
application/vnd.hp-hpgl				hpgl
application/vnd.hp-hpid				hpid
application/vnd.hp-hps				hps
application/vnd.hp-jlyt				jlt
application/vnd.hp-pcl				pcl
application/vnd.hp-pclxl			pclxl
# application/vnd.httphone
application/vnd.hydrostatix.sof-data		sfd-hdstx
# application/vnd.hyperdrive+json
# application/vnd.hzn-3d-crossword
# application/vnd.ibm.afplinedata
# application/vnd.ibm.electronic-media
application/vnd.ibm.minipay			mpy
application/vnd.ibm.modcap			afp listafp list3820
application/vnd.ibm.rights-management		irm
application/vnd.ibm.secure-container		sc
application/vnd.iccprofile			icc icm
# application/vnd.ieee.1905
application/vnd.igloader			igl
application/vnd.immervision-ivp			ivp
application/vnd.immervision-ivu			ivu
# application/vnd.ims.imsccv1p1
# application/vnd.ims.imsccv1p2
# application/vnd.ims.imsccv1p3
# application/vnd.ims.lis.v2.result+json
# application/vnd.ims.lti.v2.toolconsumerprofile+json
# application/vnd.ims.lti.v2.toolproxy+json
# application/vnd.ims.lti.v2.toolproxy.id+json
# application/vnd.ims.lti.v2.toolsettings+json
# application/vnd.ims.lti.v2.toolsettings.simple+json
# application/vnd.informedcontrol.rms+xml
# application/vnd.informix-visionary
# application/vnd.infotech.project
# application/vnd.infotech.project+xml
# application/vnd.innopath.wamp.notification
application/vnd.insors.igm			igm
application/vnd.intercon.formnet		xpw xpx
application/vnd.intergeo			i2g
# application/vnd.intertrust.digibox
# application/vnd.intertrust.nncp
application/vnd.intu.qbo			qbo
application/vnd.intu.qfx			qfx
# application/vnd.iptc.g2.catalogitem+xml
# application/vnd.iptc.g2.conceptitem+xml
# application/vnd.iptc.g2.knowledgeitem+xml
# application/vnd.iptc.g2.newsitem+xml
# application/vnd.iptc.g2.newsmessage+xml
# application/vnd.iptc.g2.packageitem+xml
# application/vnd.iptc.g2.planningitem+xml
application/vnd.ipunplugged.rcprofile		rcprofile
application/vnd.irepository.package+xml		irp
application/vnd.is-xpr				xpr
application/vnd.isac.fcs			fcs
application/vnd.jam				jam
# application/vnd.japannet-directory-service
# application/vnd.japannet-jpnstore-wakeup
# application/vnd.japannet-payment-wakeup
# application/vnd.japannet-registration
# application/vnd.japannet-registration-wakeup
# application/vnd.japannet-setstore-wakeup
# application/vnd.japannet-verification
# application/vnd.japannet-verification-wakeup
application/vnd.jcp.javame.midlet-rms		rms
application/vnd.jisp				jisp
application/vnd.joost.joda-archive		joda
# application/vnd.jsk.isdn-ngn
application/vnd.kahootz				ktz ktr
application/vnd.kde.karbon			karbon
application/vnd.kde.kchart			chrt
application/vnd.kde.kformula			kfo
application/vnd.kde.kivio			flw
application/vnd.kde.kontour			kon
application/vnd.kde.kpresenter			kpr kpt
application/vnd.kde.kspread			ksp
application/vnd.kde.kword			kwd kwt
application/vnd.kenameaapp			htke
application/vnd.kidspiration			kia
application/vnd.kinar				kne knp
application/vnd.koan				skp skd skt skm
application/vnd.kodak-descriptor		sse
application/vnd.las.las+xml			lasxml
# application/vnd.liberty-request+xml
application/vnd.llamagraphics.life-balance.desktop	lbd
application/vnd.llamagraphics.life-balance.exchange+xml	lbe
application/vnd.lotus-1-2-3			123
application/vnd.lotus-approach			apr
application/vnd.lotus-freelance			pre
application/vnd.lotus-notes			nsf
application/vnd.lotus-organizer			org
application/vnd.lotus-screencam			scm
application/vnd.lotus-wordpro			lwp
application/vnd.macports.portpkg		portpkg
# application/vnd.mapbox-vector-tile
# application/vnd.marlin.drm.actiontoken+xml
# application/vnd.marlin.drm.conftoken+xml
# application/vnd.marlin.drm.license+xml
# application/vnd.marlin.drm.mdcf
# application/vnd.mason+json
# application/vnd.maxmind.maxmind-db
application/vnd.mcd				mcd
application/vnd.medcalcdata			mc1
application/vnd.mediastation.cdkey		cdkey
# application/vnd.meridian-slingshot
application/vnd.mfer				mwf
application/vnd.mfmp				mfm
# application/vnd.micro+json
application/vnd.micrografx.flo			flo
application/vnd.micrografx.igx			igx
# application/vnd.microsoft.portable-executable
# application/vnd.miele+json
application/vnd.mif				mif
# application/vnd.minisoft-hp3000-save
# application/vnd.mitsubishi.misty-guard.trustweb
application/vnd.mobius.daf			daf
application/vnd.mobius.dis			dis
application/vnd.mobius.mbk			mbk
application/vnd.mobius.mqy			mqy
application/vnd.mobius.msl			msl
application/vnd.mobius.plc			plc
application/vnd.mobius.txf			txf
application/vnd.mophun.application		mpn
application/vnd.mophun.certificate		mpc
# application/vnd.motorola.flexsuite
# application/vnd.motorola.flexsuite.adsi
# application/vnd.motorola.flexsuite.fis
# application/vnd.motorola.flexsuite.gotap
# application/vnd.motorola.flexsuite.kmr
# application/vnd.motorola.flexsuite.ttc
# application/vnd.motorola.flexsuite.wem
# application/vnd.motorola.iprm
application/vnd.mozilla.xul+xml			xul
# application/vnd.ms-3mfdocument
application/vnd.ms-artgalry			cil
# application/vnd.ms-asf
application/vnd.ms-cab-compressed		cab
# application/vnd.ms-color.iccprofile
application/vnd.ms-excel			xls xlm xla xlc xlt xlw
application/vnd.ms-excel.addin.macroenabled.12		xlam
application/vnd.ms-excel.sheet.binary.macroenabled.12	xlsb
application/vnd.ms-excel.sheet.macroenabled.12		xlsm
application/vnd.ms-excel.template.macroenabled.12	xltm
application/vnd.ms-fontobject			eot
application/vnd.ms-htmlhelp			chm
application/vnd.ms-ims				ims
application/vnd.ms-lrm				lrm
# application/vnd.ms-office.activex+xml
application/vnd.ms-officetheme			thmx
# application/vnd.ms-opentype
# application/vnd.ms-package.obfuscated-opentype
application/vnd.ms-pki.seccat			cat
application/vnd.ms-pki.stl			stl
# application/vnd.ms-playready.initiator+xml
application/vnd.ms-powerpoint			ppt pps pot
application/vnd.ms-powerpoint.addin.macroenabled.12		ppam
application/vnd.ms-powerpoint.presentation.macroenabled.12	pptm
application/vnd.ms-powerpoint.slide.macroenabled.12		sldm
application/vnd.ms-powerpoint.slideshow.macroenabled.12		ppsm
application/vnd.ms-powerpoint.template.macroenabled.12		potm
# application/vnd.ms-printdevicecapabilities+xml
# application/vnd.ms-printing.printticket+xml
# application/vnd.ms-printschematicket+xml
application/vnd.ms-project			mpp mpt
# application/vnd.ms-tnef
# application/vnd.ms-windows.devicepairing
# application/vnd.ms-windows.nwprinting.oob
# application/vnd.ms-windows.printerpairing
# application/vnd.ms-windows.wsd.oob
# application/vnd.ms-wmdrm.lic-chlg-req
# application/vnd.ms-wmdrm.lic-resp
# application/vnd.ms-wmdrm.meter-chlg-req
# application/vnd.ms-wmdrm.meter-resp
application/vnd.ms-word.document.macroenabled.12	docm
application/vnd.ms-word.template.macroenabled.12	dotm
application/vnd.ms-works			wps wks wcm wdb
application/vnd.ms-wpl				wpl
application/vnd.ms-xpsdocument			xps
# application/vnd.msa-disk-image
application/vnd.mseq				mseq
# application/vnd.msign
# application/vnd.multiad.creator
# application/vnd.multiad.creator.cif
# application/vnd.music-niff
application/vnd.musician			mus
application/vnd.muvee.style			msty
application/vnd.mynfc				taglet
# application/vnd.ncd.control
# application/vnd.ncd.reference
# application/vnd.nervana
# application/vnd.netfpx
application/vnd.neurolanguage.nlu		nlu
# application/vnd.nintendo.nitro.rom
# application/vnd.nintendo.snes.rom
application/vnd.nitf				ntf nitf
application/vnd.noblenet-directory		nnd
application/vnd.noblenet-sealer			nns
application/vnd.noblenet-web			nnw
# application/vnd.nokia.catalogs
# application/vnd.nokia.conml+wbxml
# application/vnd.nokia.conml+xml
# application/vnd.nokia.iptv.config+xml
# application/vnd.nokia.isds-radio-presets
# application/vnd.nokia.landmark+wbxml
# application/vnd.nokia.landmark+xml
# application/vnd.nokia.landmarkcollection+xml
# application/vnd.nokia.n-gage.ac+xml
application/vnd.nokia.n-gage.data		ngdat
application/vnd.nokia.n-gage.symbian.install	n-gage
# application/vnd.nokia.ncd
# application/vnd.nokia.pcd+wbxml
# application/vnd.nokia.pcd+xml
application/vnd.nokia.radio-preset		rpst
application/vnd.nokia.radio-presets		rpss
application/vnd.novadigm.edm			edm
application/vnd.novadigm.edx			edx
application/vnd.novadigm.ext			ext
# application/vnd.ntt-local.content-share
# application/vnd.ntt-local.file-transfer
# application/vnd.ntt-local.ogw_remote-access
# application/vnd.ntt-local.sip-ta_remote
# application/vnd.ntt-local.sip-ta_tcp_stream
application/vnd.oasis.opendocument.chart		odc
application/vnd.oasis.opendocument.chart-template	otc
application/vnd.oasis.opendocument.database		odb
application/vnd.oasis.opendocument.formula		odf
application/vnd.oasis.opendocument.formula-template	odft
application/vnd.oasis.opendocument.graphics		odg
application/vnd.oasis.opendocument.graphics-template	otg
application/vnd.oasis.opendocument.image		odi
application/vnd.oasis.opendocument.image-template	oti
application/vnd.oasis.opendocument.presentation		odp
application/vnd.oasis.opendocument.presentation-template	otp
application/vnd.oasis.opendocument.spreadsheet		ods
application/vnd.oasis.opendocument.spreadsheet-template	ots
application/vnd.oasis.opendocument.text			odt
application/vnd.oasis.opendocument.text-master		odm
application/vnd.oasis.opendocument.text-template	ott
application/vnd.oasis.opendocument.text-web		oth
# application/vnd.obn
# application/vnd.oftn.l10n+json
# application/vnd.oipf.contentaccessdownload+xml
# application/vnd.oipf.contentaccessstreaming+xml
# application/vnd.oipf.cspg-hexbinary
# application/vnd.oipf.dae.svg+xml
# application/vnd.oipf.dae.xhtml+xml
# application/vnd.oipf.mippvcontrolmessage+xml
# application/vnd.oipf.pae.gem
# application/vnd.oipf.spdiscovery+xml
# application/vnd.oipf.spdlist+xml
# application/vnd.oipf.ueprofile+xml
# application/vnd.oipf.userprofile+xml
application/vnd.olpc-sugar			xo
# application/vnd.oma-scws-config
# application/vnd.oma-scws-http-request
# application/vnd.oma-scws-http-response
# application/vnd.oma.bcast.associated-procedure-parameter+xml
# application/vnd.oma.bcast.drm-trigger+xml
# application/vnd.oma.bcast.imd+xml
# application/vnd.oma.bcast.ltkm
# application/vnd.oma.bcast.notification+xml
# application/vnd.oma.bcast.provisioningtrigger
# application/vnd.oma.bcast.sgboot
# application/vnd.oma.bcast.sgdd+xml
# application/vnd.oma.bcast.sgdu
# application/vnd.oma.bcast.simple-symbol-container
# application/vnd.oma.bcast.smartcard-trigger+xml
# application/vnd.oma.bcast.sprov+xml
# application/vnd.oma.bcast.stkm
# application/vnd.oma.cab-address-book+xml
# application/vnd.oma.cab-feature-handler+xml
# application/vnd.oma.cab-pcc+xml
# application/vnd.oma.cab-subs-invite+xml
# application/vnd.oma.cab-user-prefs+xml
# application/vnd.oma.dcd
# application/vnd.oma.dcdc
application/vnd.oma.dd2+xml			dd2
# application/vnd.oma.drm.risd+xml
# application/vnd.oma.group-usage-list+xml
# application/vnd.oma.lwm2m+json
# application/vnd.oma.lwm2m+tlv
# application/vnd.oma.pal+xml
# application/vnd.oma.poc.detailed-progress-report+xml
# application/vnd.oma.poc.final-report+xml
# application/vnd.oma.poc.groups+xml
# application/vnd.oma.poc.invocation-descriptor+xml
# application/vnd.oma.poc.optimized-progress-report+xml
# application/vnd.oma.push
# application/vnd.oma.scidm.messages+xml
# application/vnd.oma.xcap-directory+xml
# application/vnd.omads-email+xml
# application/vnd.omads-file+xml
# application/vnd.omads-folder+xml
# application/vnd.omaloc-supl-init
# application/vnd.onepager
# application/vnd.openblox.game+xml
# application/vnd.openblox.game-binary
# application/vnd.openeye.oeb
application/vnd.openofficeorg.extension		oxt
# application/vnd.openxmlformats-officedocument.custom-properties+xml
# application/vnd.openxmlformats-officedocument.customxmlproperties+xml
# application/vnd.openxmlformats-officedocument.drawing+xml
# application/vnd.openxmlformats-officedocument.drawingml.chart+xml
# application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml
# application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml
# application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml
# application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml
# application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml
# application/vnd.openxmlformats-officedocument.extended-properties+xml
# application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml
# application/vnd.openxmlformats-officedocument.presentationml.comments+xml
# application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml
# application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml
# application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml
application/vnd.openxmlformats-officedocument.presentationml.presentation	pptx
# application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml
# application/vnd.openxmlformats-officedocument.presentationml.presprops+xml
application/vnd.openxmlformats-officedocument.presentationml.slide	sldx
# application/vnd.openxmlformats-officedocument.presentationml.slide+xml
# application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml
# application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml
application/vnd.openxmlformats-officedocument.presentationml.slideshow	ppsx
# application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml
# application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml
# application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml
# application/vnd.openxmlformats-officedocument.presentationml.tags+xml
application/vnd.openxmlformats-officedocument.presentationml.template	potx
# application/vnd.openxmlformats-officedocument.presentationml.template.main+xml
# application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml
application/vnd.openxmlformats-officedocument.spreadsheetml.sheet	xlsx
# application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml
application/vnd.openxmlformats-officedocument.spreadsheetml.template	xltx
# application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml
# application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml
# application/vnd.openxmlformats-officedocument.theme+xml
# application/vnd.openxmlformats-officedocument.themeoverride+xml
# application/vnd.openxmlformats-officedocument.vmldrawing
# application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml
application/vnd.openxmlformats-officedocument.wordprocessingml.document	docx
# application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml
# application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml
# application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml
# application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml
# application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml
# application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml
# application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml
# application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml
# application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml
application/vnd.openxmlformats-officedocument.wordprocessingml.template	dotx
# application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml
# application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml
# application/vnd.openxmlformats-package.core-properties+xml
# application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml
# application/vnd.openxmlformats-package.relationships+xml
# application/vnd.oracle.resource+json
# application/vnd.orange.indata
# application/vnd.osa.netdeploy
application/vnd.osgeo.mapguide.package		mgp
# application/vnd.osgi.bundle
application/vnd.osgi.dp				dp
application/vnd.osgi.subsystem			esa
# application/vnd.otps.ct-kip+xml
# application/vnd.oxli.countgraph
# application/vnd.pagerduty+json
application/vnd.palm				pdb pqa oprc
# application/vnd.panoply
# application/vnd.paos.xml
application/vnd.pawaafile			paw
# application/vnd.pcos
application/vnd.pg.format			str
application/vnd.pg.osasli			ei6
# application/vnd.piaccess.application-licence
application/vnd.picsel				efif
application/vnd.pmi.widget			wg
# application/vnd.poc.group-advertisement+xml
application/vnd.pocketlearn			plf
application/vnd.powerbuilder6			pbd
# application/vnd.powerbuilder6-s
# application/vnd.powerbuilder7
# application/vnd.powerbuilder7-s
# application/vnd.powerbuilder75
# application/vnd.powerbuilder75-s
# application/vnd.preminet
application/vnd.previewsystems.box		box
application/vnd.proteus.magazine		mgz
application/vnd.publishare-delta-tree		qps
application/vnd.pvi.ptid1			ptid
# application/vnd.pwg-multiplexed
# application/vnd.pwg-xhtml-print+xml
# application/vnd.qualcomm.brew-app-res
# application/vnd.quarantainenet
application/vnd.quark.quarkxpress		qxd qxt qwd qwt qxl qxb
# application/vnd.quobject-quoxdocument
# application/vnd.radisys.moml+xml
# application/vnd.radisys.msml+xml
# application/vnd.radisys.msml-audit+xml
# application/vnd.radisys.msml-audit-conf+xml
# application/vnd.radisys.msml-audit-conn+xml
# application/vnd.radisys.msml-audit-dialog+xml
# application/vnd.radisys.msml-audit-stream+xml
# application/vnd.radisys.msml-conf+xml
# application/vnd.radisys.msml-dialog+xml
# application/vnd.radisys.msml-dialog-base+xml
# application/vnd.radisys.msml-dialog-fax-detect+xml
# application/vnd.radisys.msml-dialog-fax-sendrecv+xml
# application/vnd.radisys.msml-dialog-group+xml
# application/vnd.radisys.msml-dialog-speech+xml
# application/vnd.radisys.msml-dialog-transform+xml
# application/vnd.rainstor.data
# application/vnd.rapid
# application/vnd.rar
application/vnd.realvnc.bed			bed
application/vnd.recordare.musicxml		mxl
application/vnd.recordare.musicxml+xml		musicxml
# application/vnd.renlearn.rlprint
application/vnd.rig.cryptonote			cryptonote
application/vnd.rim.cod				cod
application/vnd.rn-realmedia			rm
application/vnd.rn-realmedia-vbr		rmvb
application/vnd.route66.link66+xml		link66
# application/vnd.rs-274x
# application/vnd.ruckus.download
# application/vnd.s3sms
application/vnd.sailingtracker.track		st
# application/vnd.sbm.cid
# application/vnd.sbm.mid2
# application/vnd.scribus
# application/vnd.sealed.3df
# application/vnd.sealed.csf
# application/vnd.sealed.doc
# application/vnd.sealed.eml
# application/vnd.sealed.mht
# application/vnd.sealed.net
# application/vnd.sealed.ppt
# application/vnd.sealed.tiff
# application/vnd.sealed.xls
# application/vnd.sealedmedia.softseal.html
# application/vnd.sealedmedia.softseal.pdf
application/vnd.seemail				see
application/vnd.sema				sema
application/vnd.semd				semd
application/vnd.semf				semf
application/vnd.shana.informed.formdata		ifm
application/vnd.shana.informed.formtemplate	itp
application/vnd.shana.informed.interchange	iif
application/vnd.shana.informed.package		ipk
application/vnd.simtech-mindmapper		twd twds
# application/vnd.siren+json
application/vnd.smaf				mmf
# application/vnd.smart.notebook
application/vnd.smart.teacher			teacher
# application/vnd.software602.filler.form+xml
# application/vnd.software602.filler.form-xml-zip
application/vnd.solent.sdkm+xml			sdkm sdkd
application/vnd.spotfire.dxp			dxp
application/vnd.spotfire.sfs			sfs
# application/vnd.sss-cod
# application/vnd.sss-dtf
# application/vnd.sss-ntf
application/vnd.stardivision.calc		sdc
application/vnd.stardivision.draw		sda
application/vnd.stardivision.impress		sdd
application/vnd.stardivision.math		smf
application/vnd.stardivision.writer		sdw vor
application/vnd.stardivision.writer-global	sgl
application/vnd.stepmania.package		smzip
application/vnd.stepmania.stepchart		sm
# application/vnd.street-stream
# application/vnd.sun.wadl+xml
application/vnd.sun.xml.calc			sxc
application/vnd.sun.xml.calc.template		stc
application/vnd.sun.xml.draw			sxd
application/vnd.sun.xml.draw.template		std
application/vnd.sun.xml.impress			sxi
application/vnd.sun.xml.impress.template	sti
application/vnd.sun.xml.math			sxm
application/vnd.sun.xml.writer			sxw
application/vnd.sun.xml.writer.global		sxg
application/vnd.sun.xml.writer.template		stw
application/vnd.sus-calendar			sus susp
application/vnd.svd				svd
# application/vnd.swiftview-ics
application/vnd.symbian.install			sis sisx
application/vnd.syncml+xml			xsm
application/vnd.syncml.dm+wbxml			bdm
application/vnd.syncml.dm+xml			xdm
# application/vnd.syncml.dm.notification
# application/vnd.syncml.dmddf+wbxml
# application/vnd.syncml.dmddf+xml
# application/vnd.syncml.dmtnds+wbxml
# application/vnd.syncml.dmtnds+xml
# application/vnd.syncml.ds.notification
application/vnd.tao.intent-module-archive	tao
application/vnd.tcpdump.pcap			pcap cap dmp
# application/vnd.tmd.mediaflex.api+xml
# application/vnd.tml
application/vnd.tmobile-livetv			tmo
application/vnd.trid.tpt			tpt
application/vnd.triscape.mxs			mxs
application/vnd.trueapp				tra
# application/vnd.truedoc
# application/vnd.ubisoft.webplayer
application/vnd.ufdl				ufd ufdl
application/vnd.uiq.theme			utz
application/vnd.umajin				umj
application/vnd.unity				unityweb
application/vnd.uoml+xml			uoml
# application/vnd.uplanet.alert
# application/vnd.uplanet.alert-wbxml
# application/vnd.uplanet.bearer-choice
# application/vnd.uplanet.bearer-choice-wbxml
# application/vnd.uplanet.cacheop
# application/vnd.uplanet.cacheop-wbxml
# application/vnd.uplanet.channel
# application/vnd.uplanet.channel-wbxml
# application/vnd.uplanet.list
# application/vnd.uplanet.list-wbxml
# application/vnd.uplanet.listcmd
# application/vnd.uplanet.listcmd-wbxml
# application/vnd.uplanet.signal
# application/vnd.uri-map
# application/vnd.valve.source.material
application/vnd.vcx				vcx
# application/vnd.vd-study
# application/vnd.vectorworks
# application/vnd.vel+json
# application/vnd.verimatrix.vcas
# application/vnd.vidsoft.vidconference
application/vnd.visio				vsd vst vss vsw
application/vnd.visionary			vis
# application/vnd.vividence.scriptfile
application/vnd.vsf				vsf
# application/vnd.wap.sic
# application/vnd.wap.slc
application/vnd.wap.wbxml			wbxml
application/vnd.wap.wmlc			wmlc
application/vnd.wap.wmlscriptc			wmlsc
application/vnd.webturbo			wtb
# application/vnd.wfa.p2p
# application/vnd.wfa.wsc
# application/vnd.windows.devicepairing
# application/vnd.wmc
# application/vnd.wmf.bootstrap
# application/vnd.wolfram.mathematica
# application/vnd.wolfram.mathematica.package
application/vnd.wolfram.player			nbp
application/vnd.wordperfect			wpd
application/vnd.wqd				wqd
# application/vnd.wrq-hp3000-labelled
application/vnd.wt.stf				stf
# application/vnd.wv.csp+wbxml
# application/vnd.wv.csp+xml
# application/vnd.wv.ssp+xml
# application/vnd.xacml+json
application/vnd.xara				xar
application/vnd.xfdl				xfdl
# application/vnd.xfdl.webform
# application/vnd.xmi+xml
# application/vnd.xmpie.cpkg
# application/vnd.xmpie.dpkg
# application/vnd.xmpie.plan
# application/vnd.xmpie.ppkg
# application/vnd.xmpie.xlim
application/vnd.yamaha.hv-dic			hvd
application/vnd.yamaha.hv-script		hvs
application/vnd.yamaha.hv-voice			hvp
application/vnd.yamaha.openscoreformat			osf
application/vnd.yamaha.openscoreformat.osfpvg+xml	osfpvg
# application/vnd.yamaha.remote-setup
application/vnd.yamaha.smaf-audio		saf
application/vnd.yamaha.smaf-phrase		spf
# application/vnd.yamaha.through-ngn
# application/vnd.yamaha.tunnel-udpencap
# application/vnd.yaoweme
application/vnd.yellowriver-custom-menu		cmp
application/vnd.zul				zir zirz
application/vnd.zzazz.deck+xml			zaz
application/voicexml+xml			vxml
# application/vq-rtcpxr
# application/watcherinfo+xml
# application/whoispp-query
# application/whoispp-response
application/widget				wgt
application/winhlp				hlp
# application/wita
# application/wordperfect5.1
application/wsdl+xml				wsdl
application/wspolicy+xml			wspolicy
application/x-7z-compressed			7z
application/x-abiword				abw
application/x-ace-compressed			ace
# application/x-amf
application/x-apple-diskimage			dmg
application/x-authorware-bin			aab x32 u32 vox
application/x-authorware-map			aam
application/x-authorware-seg			aas
application/x-bcpio				bcpio
application/x-bittorrent			torrent
application/x-blorb				blb blorb
application/x-bzip				bz
application/x-bzip2				bz2 boz
application/x-cbr				cbr cba cbt cbz cb7
application/x-cdlink				vcd
application/x-cfs-compressed			cfs
application/x-chat				chat
application/x-chess-pgn				pgn
# application/x-compress
application/x-conference			nsc
application/x-cpio				cpio
application/x-csh				csh
application/x-debian-package			deb udeb
application/x-dgc-compressed			dgc
application/x-director			dir dcr dxr cst cct cxt w3d fgd swa
application/x-doom				wad
application/x-dtbncx+xml			ncx
application/x-dtbook+xml			dtb
application/x-dtbresource+xml			res
application/x-dvi				dvi
application/x-envoy				evy
application/x-eva				eva
application/x-font-bdf				bdf
# application/x-font-dos
# application/x-font-framemaker
application/x-font-ghostscript			gsf
# application/x-font-libgrx
application/x-font-linux-psf			psf
application/x-font-pcf				pcf
application/x-font-snf				snf
# application/x-font-speedo
# application/x-font-sunos-news
application/x-font-type1			pfa pfb pfm afm
# application/x-font-vfont
application/x-freearc				arc
application/x-futuresplash			spl
application/x-gca-compressed			gca
application/x-glulx				ulx
application/x-gnumeric				gnumeric
application/x-gramps-xml			gramps
application/x-gtar				gtar
# application/x-gzip
application/x-hdf				hdf
application/x-install-instructions		install
application/x-iso9660-image			iso
application/x-java-jnlp-file			jnlp
application/x-latex				latex
application/x-lzh-compressed			lzh lha
application/x-mie				mie
application/x-mobipocket-ebook			prc mobi
application/x-ms-application			application
application/x-ms-shortcut			lnk
application/x-ms-wmd				wmd
application/x-ms-wmz				wmz
application/x-ms-xbap				xbap
application/x-msaccess				mdb
application/x-msbinder				obd
application/x-mscardfile			crd
application/x-msclip				clp
application/x-msdownload			exe dll com bat msi
application/x-msmediaview			mvb m13 m14
application/x-msmetafile			wmf wmz emf emz
application/x-msmoney				mny
application/x-mspublisher			pub
application/x-msschedule			scd
application/x-msterminal			trm
application/x-mswrite				wri
application/x-netcdf				nc cdf
application/x-nzb				nzb
application/x-pkcs12				p12 pfx
application/x-pkcs7-certificates		p7b spc
application/x-pkcs7-certreqresp			p7r
application/x-rar-compressed			rar
application/x-research-info-systems		ris
application/x-sh				sh
application/x-shar				shar
application/x-shockwave-flash			swf
application/x-silverlight-app			xap
application/x-sql				sql
application/x-stuffit				sit
application/x-stuffitx				sitx
application/x-subrip				srt
application/x-sv4cpio				sv4cpio
application/x-sv4crc				sv4crc
application/x-t3vm-image			t3
application/x-tads				gam
application/x-tar				tar
application/x-tcl				tcl
application/x-tex				tex
application/x-tex-tfm				tfm
application/x-texinfo				texinfo texi
application/x-tgif				obj
application/x-ustar				ustar
application/x-wais-source			src
# application/x-www-form-urlencoded
application/x-x509-ca-cert			der crt
application/x-xfig				fig
application/x-xliff+xml				xlf
application/x-xpinstall				xpi
application/x-xz				xz
application/x-zmachine				z1 z2 z3 z4 z5 z6 z7 z8
# application/x400-bp
# application/xacml+xml
application/xaml+xml				xaml
# application/xcap-att+xml
# application/xcap-caps+xml
application/xcap-diff+xml			xdf
# application/xcap-el+xml
# application/xcap-error+xml
# application/xcap-ns+xml
# application/xcon-conference-info+xml
# application/xcon-conference-info-diff+xml
application/xenc+xml				xenc
application/xhtml+xml				xhtml xht
# application/xhtml-voice+xml
application/xml					xml xsl
application/xml-dtd				dtd
# application/xml-external-parsed-entity
# application/xml-patch+xml
# application/xmpp+xml
application/xop+xml				xop
application/xproc+xml				xpl
application/xslt+xml				xslt
application/xspf+xml				xspf
application/xv+xml				mxml xhvml xvml xvm
application/yang				yang
application/yin+xml				yin
application/zip					zip
# application/zlib
# audio/1d-interleaved-parityfec
# audio/32kadpcm
# audio/3gpp
# audio/3gpp2
# audio/ac3
audio/adpcm					adp
# audio/amr
# audio/amr-wb
# audio/amr-wb+
# audio/aptx
# audio/asc
# audio/atrac-advanced-lossless
# audio/atrac-x
# audio/atrac3
audio/basic					au snd
# audio/bv16
# audio/bv32
# audio/clearmode
# audio/cn
# audio/dat12
# audio/dls
# audio/dsr-es201108
# audio/dsr-es202050
# audio/dsr-es202211
# audio/dsr-es202212
# audio/dv
# audio/dvi4
# audio/eac3
# audio/encaprtp
# audio/evrc
# audio/evrc-qcp
# audio/evrc0
# audio/evrc1
# audio/evrcb
# audio/evrcb0
# audio/evrcb1
# audio/evrcnw
# audio/evrcnw0
# audio/evrcnw1
# audio/evrcwb
# audio/evrcwb0
# audio/evrcwb1
# audio/evs
# audio/example
# audio/fwdred
# audio/g711-0
# audio/g719
# audio/g722
# audio/g7221
# audio/g723
# audio/g726-16
# audio/g726-24
# audio/g726-32
# audio/g726-40
# audio/g728
# audio/g729
# audio/g7291
# audio/g729d
# audio/g729e
# audio/gsm
# audio/gsm-efr
# audio/gsm-hr-08
# audio/ilbc
# audio/ip-mr_v2.5
# audio/isac
# audio/l16
# audio/l20
# audio/l24
# audio/l8
# audio/lpc
audio/midi					mid midi kar rmi
# audio/mobile-xmf
audio/mp4					m4a mp4a
# audio/mp4a-latm
# audio/mpa
# audio/mpa-robust
audio/mpeg					mpga mp2 mp2a mp3 m2a m3a
# audio/mpeg4-generic
# audio/musepack
audio/ogg					oga ogg spx
# audio/opus
# audio/parityfec
# audio/pcma
# audio/pcma-wb
# audio/pcmu
# audio/pcmu-wb
# audio/prs.sid
# audio/qcelp
# audio/raptorfec
# audio/red
# audio/rtp-enc-aescm128
# audio/rtp-midi
# audio/rtploopback
# audio/rtx
audio/s3m					s3m
audio/silk					sil
# audio/smv
# audio/smv-qcp
# audio/smv0
# audio/sp-midi
# audio/speex
# audio/t140c
# audio/t38
# audio/telephone-event
# audio/tone
# audio/uemclip
# audio/ulpfec
# audio/vdvi
# audio/vmr-wb
# audio/vnd.3gpp.iufp
# audio/vnd.4sb
# audio/vnd.audiokoz
# audio/vnd.celp
# audio/vnd.cisco.nse
# audio/vnd.cmles.radio-events
# audio/vnd.cns.anp1
# audio/vnd.cns.inf1
audio/vnd.dece.audio				uva uvva
audio/vnd.digital-winds				eol
# audio/vnd.dlna.adts
# audio/vnd.dolby.heaac.1
# audio/vnd.dolby.heaac.2
# audio/vnd.dolby.mlp
# audio/vnd.dolby.mps
# audio/vnd.dolby.pl2
# audio/vnd.dolby.pl2x
# audio/vnd.dolby.pl2z
# audio/vnd.dolby.pulse.1
audio/vnd.dra					dra
audio/vnd.dts					dts
audio/vnd.dts.hd				dtshd
# audio/vnd.dvb.file
# audio/vnd.everad.plj
# audio/vnd.hns.audio
audio/vnd.lucent.voice				lvp
audio/vnd.ms-playready.media.pya		pya
# audio/vnd.nokia.mobile-xmf
# audio/vnd.nortel.vbk
audio/vnd.nuera.ecelp4800			ecelp4800
audio/vnd.nuera.ecelp7470			ecelp7470
audio/vnd.nuera.ecelp9600			ecelp9600
# audio/vnd.octel.sbc
# audio/vnd.qcelp
# audio/vnd.rhetorex.32kadpcm
audio/vnd.rip					rip
# audio/vnd.sealedmedia.softseal.mpeg
# audio/vnd.vmx.cvsd
# audio/vorbis
# audio/vorbis-config
audio/webm					weba
audio/x-aac					aac
audio/x-aiff					aif aiff aifc
audio/x-caf					caf
audio/x-flac					flac
audio/x-matroska				mka
audio/x-mpegurl					m3u
audio/x-ms-wax					wax
audio/x-ms-wma					wma
audio/x-pn-realaudio				ram ra
audio/x-pn-realaudio-plugin			rmp
# audio/x-tta
audio/x-wav					wav
audio/xm					xm
chemical/x-cdx					cdx
chemical/x-cif					cif
chemical/x-cmdf					cmdf
chemical/x-cml					cml
chemical/x-csml					csml
# chemical/x-pdb
chemical/x-xyz					xyz
font/collection					ttc
font/otf					otf
# font/sfnt
font/ttf					ttf
font/woff					woff
font/woff2					woff2
image/bmp					bmp
image/cgm					cgm
# image/dicom-rle
# image/emf
# image/example
# image/fits
image/g3fax					g3
image/gif					gif
image/ief					ief
# image/jls
# image/jp2
image/jpeg					jpeg jpg jpe
# image/jpm
# image/jpx
image/ktx					ktx
# image/naplps
image/png					png
image/prs.btif					btif
# image/prs.pti
# image/pwg-raster
image/sgi					sgi
image/svg+xml					svg svgz
# image/t38
image/tiff					tiff tif
# image/tiff-fx
image/vnd.adobe.photoshop			psd
# image/vnd.airzip.accelerator.azv
# image/vnd.cns.inf2
image/vnd.dece.graphic				uvi uvvi uvg uvvg
image/vnd.djvu					djvu djv
image/vnd.dvb.subtitle				sub
image/vnd.dwg					dwg
image/vnd.dxf					dxf
image/vnd.fastbidsheet				fbs
image/vnd.fpx					fpx
image/vnd.fst					fst
image/vnd.fujixerox.edmics-mmr			mmr
image/vnd.fujixerox.edmics-rlc			rlc
# image/vnd.globalgraphics.pgb
# image/vnd.microsoft.icon
# image/vnd.mix
# image/vnd.mozilla.apng
image/vnd.ms-modi				mdi
image/vnd.ms-photo				wdp
image/vnd.net-fpx				npx
# image/vnd.radiance
# image/vnd.sealed.png
# image/vnd.sealedmedia.softseal.gif
# image/vnd.sealedmedia.softseal.jpg
# image/vnd.svf
# image/vnd.tencent.tap
# image/vnd.valve.source.texture
image/vnd.wap.wbmp				wbmp
image/vnd.xiff					xif
# image/vnd.zbrush.pcx
image/webp					webp
# image/wmf
image/x-3ds					3ds
image/x-cmu-raster				ras
image/x-cmx					cmx
image/x-freehand				fh fhc fh4 fh5 fh7
image/x-icon					ico
image/x-mrsid-image				sid
image/x-pcx					pcx
image/x-pict					pic pct
image/x-portable-anymap				pnm
image/x-portable-bitmap				pbm
image/x-portable-graymap			pgm
image/x-portable-pixmap				ppm
image/x-rgb					rgb
image/x-tga					tga
image/x-xbitmap					xbm
image/x-xpixmap					xpm
image/x-xwindowdump				xwd
# message/cpim
# message/delivery-status
# message/disposition-notification
# message/example
# message/external-body
# message/feedback-report
# message/global
# message/global-delivery-status
# message/global-disposition-notification
# message/global-headers
# message/http
# message/imdn+xml
# message/news
# message/partial
message/rfc822					eml mime
# message/s-http
# message/sip
# message/sipfrag
# message/tracking-status
# message/vnd.si.simp
# message/vnd.wfa.wsc
# model/example
# model/gltf+json
model/iges					igs iges
model/mesh					msh mesh silo
model/vnd.collada+xml				dae
model/vnd.dwf					dwf
# model/vnd.flatland.3dml
model/vnd.gdl					gdl
# model/vnd.gs-gdl
# model/vnd.gs.gdl
model/vnd.gtw					gtw
# model/vnd.moml+xml
model/vnd.mts					mts
# model/vnd.opengex
# model/vnd.parasolid.transmit.binary
# model/vnd.parasolid.transmit.text
# model/vnd.rosette.annotated-data-model
# model/vnd.valve.source.compiled-map
model/vnd.vtu					vtu
model/vrml					wrl vrml
model/x3d+binary				x3db x3dbz
# model/x3d+fastinfoset
model/x3d+vrml					x3dv x3dvz
model/x3d+xml					x3d x3dz
# model/x3d-vrml
# multipart/alternative
# multipart/appledouble
# multipart/byteranges
# multipart/digest
# multipart/encrypted
# multipart/example
# multipart/form-data
# multipart/header-set
# multipart/mixed
# multipart/parallel
# multipart/related
# multipart/report
# multipart/signed
# multipart/voice-message
# multipart/x-mixed-replace
# text/1d-interleaved-parityfec
text/cache-manifest				appcache
text/calendar					ics ifb
text/css					css
text/csv					csv
# text/csv-schema
# text/directory
# text/dns
# text/ecmascript
# text/encaprtp
# text/enriched
# text/example
# text/fwdred
# text/grammar-ref-list
text/html					html htm
# text/javascript
# text/jcr-cnd
# text/markdown
# text/mizar
text/n3						n3
# text/parameters
# text/parityfec
text/plain					txt text conf def list log in
# text/provenance-notation
# text/prs.fallenstein.rst
text/prs.lines.tag				dsc
# text/prs.prop.logic
# text/raptorfec
# text/red
# text/rfc822-headers
text/richtext					rtx
# text/rtf
# text/rtp-enc-aescm128
# text/rtploopback
# text/rtx
text/sgml					sgml sgm
# text/t140
text/tab-separated-values			tsv
text/troff					t tr roff man me ms
text/turtle					ttl
# text/ulpfec
text/uri-list					uri uris urls
text/vcard					vcard
# text/vnd.a
# text/vnd.abc
text/vnd.curl					curl
text/vnd.curl.dcurl				dcurl
text/vnd.curl.mcurl				mcurl
text/vnd.curl.scurl				scurl
# text/vnd.debian.copyright
# text/vnd.dmclientscript
text/vnd.dvb.subtitle				sub
# text/vnd.esmertec.theme-descriptor
text/vnd.fly					fly
text/vnd.fmi.flexstor				flx
text/vnd.graphviz				gv
text/vnd.in3d.3dml				3dml
text/vnd.in3d.spot				spot
# text/vnd.iptc.newsml
# text/vnd.iptc.nitf
# text/vnd.latex-z
# text/vnd.motorola.reflex
# text/vnd.ms-mediapackage
# text/vnd.net2phone.commcenter.command
# text/vnd.radisys.msml-basic-layout
# text/vnd.si.uricatalogue
text/vnd.sun.j2me.app-descriptor		jad
# text/vnd.trolltech.linguist
# text/vnd.wap.si
# text/vnd.wap.sl
text/vnd.wap.wml				wml
text/vnd.wap.wmlscript				wmls
text/x-asm					s asm
text/x-c					c cc cxx cpp h hh dic
text/x-fortran					f for f77 f90
text/x-java-source				java
text/x-nfo					nfo
text/x-opml					opml
text/x-pascal					p pas
text/x-setext					etx
text/x-sfv					sfv
text/x-uuencode					uu
text/x-vcalendar				vcs
text/x-vcard					vcf
# text/xml
# text/xml-external-parsed-entity
# video/1d-interleaved-parityfec
video/3gpp					3gp
# video/3gpp-tt
video/3gpp2					3g2
# video/bmpeg
# video/bt656
# video/celb
# video/dv
# video/encaprtp
# video/example
video/h261					h261
video/h263					h263
# video/h263-1998
# video/h263-2000
video/h264					h264
# video/h264-rcdo
# video/h264-svc
# video/h265
# video/iso.segment
video/jpeg					jpgv
# video/jpeg2000
video/jpm					jpm jpgm
video/mj2					mj2 mjp2
# video/mp1s
# video/mp2p
# video/mp2t
video/mp4					mp4 mp4v mpg4
# video/mp4v-es
video/mpeg					mpeg mpg mpe m1v m2v
# video/mpeg4-generic
# video/mpv
# video/nv
video/ogg					ogv
# video/parityfec
# video/pointer
video/quicktime					qt mov
# video/raptorfec
# video/raw
# video/rtp-enc-aescm128
# video/rtploopback
# video/rtx
# video/smpte292m
# video/ulpfec
# video/vc1
# video/vnd.cctv
video/vnd.dece.hd				uvh uvvh
video/vnd.dece.mobile				uvm uvvm
# video/vnd.dece.mp4
video/vnd.dece.pd				uvp uvvp
video/vnd.dece.sd				uvs uvvs
video/vnd.dece.video				uvv uvvv
# video/vnd.directv.mpeg
# video/vnd.directv.mpeg-tts
# video/vnd.dlna.mpeg-tts
video/vnd.dvb.file				dvb
video/vnd.fvt					fvt
# video/vnd.hns.video
# video/vnd.iptvforum.1dparityfec-1010
# video/vnd.iptvforum.1dparityfec-2005
# video/vnd.iptvforum.2dparityfec-1010
# video/vnd.iptvforum.2dparityfec-2005
# video/vnd.iptvforum.ttsavc
# video/vnd.iptvforum.ttsmpeg2
# video/vnd.motorola.video
# video/vnd.motorola.videop
video/vnd.mpegurl				mxu m4u
video/vnd.ms-playready.media.pyv		pyv
# video/vnd.nokia.interleaved-multimedia
# video/vnd.nokia.videovoip
# video/vnd.objectvideo
# video/vnd.radgamettools.bink
# video/vnd.radgamettools.smacker
# video/vnd.sealed.mpeg1
# video/vnd.sealed.mpeg4
# video/vnd.sealed.swf
# video/vnd.sealedmedia.softseal.mov
video/vnd.uvvu.mp4				uvu uvvu
video/vnd.vivo					viv
# video/vp8
video/webm					webm
video/x-f4v					f4v
video/x-fli					fli
video/x-flv					flv
video/x-m4v					m4v
video/x-matroska				mkv mk3d mks
video/x-mng					mng
video/x-ms-asf					asf asx
video/x-ms-vob					vob
video/x-ms-wm					wm
video/x-ms-wmv					wmv
video/x-ms-wmx					wmx
video/x-ms-wvx					wvx
video/x-msvideo					avi
video/x-sgi-movie				movie
video/x-smv					smv
x-conference/x-cooltalk				ice
]]></Data>
</XData>
</Class>


<Class name="apptools.core.msg">
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65647,40346.301313</TimeChanged>
<TimeCreated>65607,76510.645284</TimeCreated>

<Method name="AddLangMsg">
<Description>
Add two languages to global translation
Samples ##Expression(##class(apptools.core.sys).AddLangMsg(%en,%ru))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>en,other</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s otherLang="ru"
	;s @$$$GNLang@($$$GNLangDOMAIN) = otherLang
	s @$$$GNLang@($$$GNLangDOMAIN,"en",$zcrc(en,7)) = en
	s:other'="" @$$$GNLang@($$$GNLangDOMAIN,otherLang,$zcrc(en,7)) = other
	q "$s("_$zcrc(en,7)_":$g("_$$$GNLang_"("""_$$$GNLangDOMAIN_""",$get("_$$$GNEnsConf_"(""Language""),$mvv(58)),"_$zcrc(en,7)_"),"""_en_"""),1:"""_other_""")"
]]></Implementation>
</Method>

<Method name="man">
<Description>
Get description of parameters, propertis or methodes
write ##class(apptools.core.msg).man("apptools.Tabs.security).LockDown")
do ##class(apptools.core.msg).man("apptools.core.Log",.doc) zw doc ;# get full class description </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[ClassNameItem,&d]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set cn=$p(ClassNameItem,")")
	q:cn="" ""
	set item=$p(ClassNameItem,").",2)
	do ##class(apptools.core.LogInfoPane).GetClassDef(cn,"",.d,0)
	if item="" q $g(d("ClassName",cn))
	for it="Methods","Properties","Parameters"	if $g(d(it,item,"Description"))'="" s ret=$g(d(it,item,"Description"))
	q $g(ret)
]]></Implementation>
</Method>

<Method name="ZPMColorScheme">
<Description>
write ##class(apptools.core.msg).ZPMColorScheme()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	try {
		set scheme=##class(%ZPM.PackageManager.Client.Settings).GetValue("ColorScheme")
	} 
	catch e {
		set scheme=0
	}
	quit scheme
]]></Implementation>
</Method>

<Method name="EscColor">
<Description>
Output color escape sequence
do ##class(apptools.core.msg).EscColor()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>mode=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	if mode="" { //write all colors
		write ..EscColor(0)
		//brightness
		for b=1,2 {
			for f=30:1:37 {  //font
				for i=40:1:47 {  //background
					s code=b_";"_f_";"_i
					s txt=" write $Char(27)_""["_code_"m Any text""_$c(27)_""[0m"""
					w !,$$$escSeq(code,txt)
				}
			}
		}
	
	} elseif mode=0 { //cleaning
		q $c(27)_"[0m"
	} else {
		q $c(27)_"["_mode_"m"
	}
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.net">
<Description>
Network Utility %Net.HttpRequest, %Net.SMTP, %Net.FTP</Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65904,47131.774221</TimeChanged>
<TimeCreated>65607,76510.74453</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Method name="SendFilesToEmail">
<Description>
Zip files and Send to email
w ##class(apptools.core.net).SendFilesToEmail()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>subj,text,files,zip=1,email=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;send files to email
	s f="" for { s f=$o(files(f)) q:f=""
		s path=$p(f,$$$slash,1,*-1)
		s file=$p(f,$$$slash,*)
		if zip {
			s sc=##class(apptools.core.files).zipFile(path,file,file_".zip",path)
			if sc {s file=file_".zip" 
			}
			i 'sc s $$$AppL("MSW","SendFilesToEmail-ErrZip")=$System.Status.GetErrorText(sc) 
		}
		s filez($i(fil),"path")=path_$$$slash
		s filez(fil)=file
	}	
	s sc=##class(apptools.core.LogInfo).SendEmail(email, subj, text, .filez)
	i 'sc s $$$AppL("MSW","SendFilesToEmail-ErrSend")=$System.Status.GetErrorText(sc) 
	q sc
]]></Implementation>
</Method>

<Method name="SendMail">
<Description>
To send email
subscrible - a comma separated list whom to send the letter
subj - subject
text - the text of the letter
attach - an array of files the link
samples write ##class(apptools.core.net).SendMail(server, port, ssl, UseSTARTTLS, timezone, username, psw, from, subscrible, subj, text, attach)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>server,port,ssl,UseSTARTTLS,timezone,username,psw,from,subscrible,subj,text,attach</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 #dim smtp As %Net.SMTP
 #; Define SMTP server for sending
 set smtp=##class(%Net.SMTP).%New()
 set smtp.smtpserver=server
 set:port smtp.port=port
 set:ssl||(port=465) smtp.SSLConfiguration=..CheckSSLCertificate("SSL4SMTP")
 set:UseSTARTTLS smtp.UseSTARTTLS=1
 set smtp.timezone=timezone
 if username'="" {
	set auth=##class(%Net.Authenticator).%New()
	set auth.UserName=username
	set auth.Password=psw
	set smtp.authenticator=auth
 }
 set smtp.timezone=$g(timezone,"0300")  ;Timezone by Grinwitch  +3 russia
 set mail=##class(%Net.MailMessage).%New() 
 set mail.From=$G(from)        ##; From 
 ##; List of emails to send this mail
 for i=1:1 {
	 q:$p(subscrible,",",i,i+1)=""  
	 set to=$p(subscrible,",",i) 
	 if to'="" do mail.To.Insert(to)
 }
 set mail.Subject=$s($g(subj)="":$g(Subj),1:$g(subj))     ; Subject - the subject
 set mail.Charset="windows-1251"
 set mail.IsHTML=$s(text["<html":1,1:0)
 set mail.IsMultiPart=1
 set mail.MultiPartType="related" 
 do mail.TextData.Write(text)
 set sc=$$$OK
 ; If a single file is transmitted in text format $lb
 if $g(attach)'="" {
	 set attach(1)=$lg(attach,2)
	 set attach(1,"path")=$lg(attach,1)
	 set:$lg(attach,3)'="" attach(1,"content-type")=$lg(attach,3) ;image/jpeg
 }
 ; A lot of files
 if $d(attach)>1 {
	set rec="" 
	for { s rec=$o(attach(rec),1,file) quit:rec=""
	 set sc=mail.AttachFile($g(attach(rec,"path")),file) ;  C:\!\","utl.zip")
	 if $$$ISERR(sc) q
	 set part=mail.Parts.GetAt(rec)
	 do part.Headers.SetAt(file,"Content-ID")
	 do part.Headers.SetAt($g(attach(rec,"content-type")),"Content-Type")
	}
 }
 if $$$ISERR(sc) quit sc ;##class(%Library.Status).LogicalToOdbc(sc)
 set sc=smtp.Send(mail) 
 if $$$ISERR(sc) quit sc ;##class(%Library.Status).LogicalToOdbc(sc)
 quit $$$OK
]]></Implementation>
</Method>

<Method name="LoadFileHttp">
<Description>
Download the file and put on the server by adding the name of the mark date and time</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>aURL="",aDATA,TempDir="",fileName</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s st=##class(apptools.core.net).GetHttp(aURL,.aDATA)
	i 'st q st
	i $g(aDATA("status"))'=200 q $$$ERROR($$$GeneralError,"Status HTTP "_$g(aDATA("status")))
	s sc=1
	i TempDir'="" s sc=##class(apptools.core.files).Stream2Log(aDATA("content"), TempDir, fileName,.path) s aDATA("pathfileName")=$g(path)
	q sc
]]></Implementation>
</Method>

<Method name="GetResult">
<Description>
if ##class(apptools.core.net).GetResult("http://localhost/apptoolsrest/productslist/-","user","pass",.json) do json.%ToJSON()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[url:%String,user="",pass="",&result:%ZEN.proxyObject]]></FormalSpec>
<Implementation><![CDATA[
	$$$TOE(sc, ..GetHttp(url, .aData,,,user,pass))  
	set stream =  aData("content")
	quit ##class(Ens.Util.JSON).JSONStreamToObject(stream,.result)
]]></Implementation>
</Method>

<Method name="GetHttp">
<Description>
To receive from the data server at the URL
If TempDir is specified, then the file will be written there 
w ##class(apptools.core.net).GetHttp("https://codeload.github.com/SergeyMi37/cache-iris-app-tools/zip/master",.out2,"D:\temp\")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>aURL="",aDATA,TempDir="",tmpGN="",user="",pass=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set part1=$p(aURL,"/",3),part2=$p(aURL,"/",4,$l(aURL,"/")),params=$p(aURL,"?",2)
	#; Server
	set server=$p(part1,":",1) quit:(server="") $$$ERROR($$$GeneralError,"0:"_$$$aText("no server",""))
	#; Port
	set port=$p(part1,":",2)
	#; Address
	set location=$p(part2,"?",1) quit:(location="") $$$ERROR($$$GeneralError,"0:"_$$$aText("missing address","")_" - "_location)
	#; Create HTTP request to download the file
	set HttpRequest=##class(%Net.HttpRequest).%New()
	set HttpRequest.Server=server
	if $f($zcvt(aURL,"L"),"https://") {
		set:(port="") port=443
		set HttpRequest.Https=1
		;set HttpRequest.FollowRedirect = 1
		set HttpRequest.SSLConfiguration=..CheckSSLCertificate("DefaultSSL")
	
	#; Request HTTP
	} else {
		s:(port="") port=80
	}
	;w !,server,!,location,!,port,!,params
	set HttpRequest.Port=port

	if user'="" {
		set HttpRequest.Username=user
		set HttpRequest.Password=pass
	}

	#; Fill in the parameters
	for i=1:1:$l(params,"&") { s pair=$p(params,"&",i),name=$p(pair,"=",1),value=$p(pair,"=",2)
		continue:(name="")	
		;Conversion, to prevent double conversion
		s value=$zcvt(value,"I","URL") 
		d HttpRequest.SetParam(name,value)
	} ; /for i
	
	#; Execute the query
	Try { d HttpRequest.Get(location) } Catch Error { s err=Error.AsSystemError() }
	quit:($g(err)'="") $$$ERROR($$$GeneralError,err)
	#; The processed response is received
	set HttpResponse=HttpRequest.HttpResponse 
	quit:('$isobject(HttpResponse)) $$$ERROR($$$GeneralError,$$$aText("the server does not return a response",""))
	quit:(HttpResponse.StatusCode'=200) $$$ERROR($$$GeneralError,HttpResponse.ReasonPhrase)
	s aDATA("status")=HttpResponse.StatusCode
	#; Parse the response from the server, keeping the structure of the aDATA
	set aDATA("contentType")=HttpResponse.ContentType
	#; The name of the file received via the "content-disposition" as "attachment;filename="name.ext";"
	s fileName=HttpResponse.GetHeader("content-disposition")
	s aDATA("content-disposition")=fileName
	if ($l(fileName,"*=utf-8''")>1) {
		s fileName=$p(fileName,"*=utf-8''",2)
		s fileName=##CLASS(%CSP.Page).UnescapeURL(fileName)
		s fileName=$zcvt(fileName,"I","UTF8")
	} else { s fileName=$p(fileName,"filename=",2),fileName=$tr($p(fileName,";",1),"""'","") }
	
	#; If the file name is not specified, use as the name of the piece of the link
	s:(fileName="") fileName=$p(location,"/",$l(location,"/"))
	s aDATA("content")=HttpResponse.Data
	s aDATA("fileName")=$zcvt(fileName,"I","URL")
	i tmpGN'="" M @tmpGN=aDATA
	s sc=1
	i TempDir'="" s sc=##class(apptools.core.files).Stream2Log(HttpResponse.Data, TempDir, fileName,.path) s aDATA("pathfileName")=$g(path)
	quit sc
]]></Implementation>
</Method>

<Method name="CheckSSLCertificate">
<Description>
The method checks for the existence of the configured SSL configuration
and creates an empty configuration with that name if this yet
to connect to a https server, that's enough</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>name</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  NEW $NAMESPACE
  SET $NAMESPACE = "%SYS"
  
  IF '##class(Security.SSLConfigs).Exists(name) {
    DO ##class(Security.SSLConfigs).Create(name)
  }
  QUIT name
]]></Implementation>
</Method>

<Method name="PostHttp">
<Description>
To response to Http Post request</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[ServerPort,method,user,pass,&body,&out]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    set ht = ##class(%Net.HttpRequest).%New()
	set ht.Server = $p(ServerPort,":")
	if user'="" {
		set ht.Username=user
		set ht.Password=pass
	}
	s ht.ContentType="text/html;  charset=UTF-8"
	;s ht.ContentType="application/json; charset=UTF-8"
	set port=$p(ServerPort,":",2)
	i $p(ServerPort,":",2)'="" set ht.Port = port
	
	if port=443 {
		set ht.Https=1
		;set ht.Port = 443
		set ht.SSLConfiguration=..CheckSSLCertificate("DefaultSSL")
	}
	
	Do ht.EntityBody.Write($g(body))
	if $d(body)>1 s i="" f  s i=$o(body(i)) q:i=""  Do ht.EntityBody.Write(body(i))
	
	s st=ht.Post(method)
	if 'st w !,$System.Status.GetErrorText(st)  q ""

	;Do ht.HttpResponse.OutputToDevice()
	S out=ht.HttpResponse.StatusLine
	;s ^z1=ht.HttpResponse.ContentLength
    set i="" for  S i=ht.HttpResponse.GetNextHeader(i) Q:i=""  S out("Header",i)=ht.HttpResponse.GetHeader(i)
    if ht.HttpResponse.Data.Size>0 {
	    set sc=##class(apptools.core.files).Stream2String(ht.HttpResponse.Data,.json)
	    m out("Data")=json
	}
 	do ht.%Close()
 	q $g(out)
]]></Implementation>
</Method>

<Method name="RunPage">
<Description>
d ##class(apptools.core.net).RunPage()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Url:%String="http://intersystems.ru"</FormalSpec>
<Implementation><![CDATA[
    #Include %occOptions
    Set Browser = $s($$$isWINDOWS:"start", $$$isUNIX:"x-www-browser", 1:"x-www-browser")
    Set Command = Browser _ " " _ Url
    Do $ZF(-1, Command)
]]></Implementation>
</Method>

<Method name="ImportCSPFromGitHub">
<Description>
Import CSP-file from GitHub repository for 7z utility 
s repo="cache-iris-app-tools" d ##class(apptools.core.net).ImportCSPFromGitHub("https://codeload.github.com/SergeyMi37/"_repo_"/zip/master",repo,"d:\!\csptest")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>url,repo,target</FormalSpec>
<Implementation><![CDATA[
	s tempdir=$zu(12)_"Temp"_$$$slash_$p(##class(%File).TempFilename("zip"),$$$slash,*)
	w !,tempdir
	s st=##class(%File).CreateDirectory(tempdir)
	i 'st q st
 	s st=##class(apptools.core.net).GetHttp(url,.out,tempdir)
	s unzip=$zu(12)_"Temp"_$$$slash_$p(##class(%File).TempFilename("unzip"),$$$slash,*)
	s st=##class(%File).CreateDirectory(unzip)
	i 'st q st
	d ##class(apptools.core.files).UnzipToDirectory(tempdir_$$$slash_repo_"-master.zip",unzip)
	s source=unzip_$$$slash_repo_"-master"_$$$slash_"src"_$$$slash_"csp"
	w !,source_" copy to "_target,!
	s st=##class(%File).CopyDir(source,target,1,1,1)
	i 'st w !,st
	s source=unzip_$$$slash_repo_"-master"_$$$slash_"src"_$$$slash_"glb"_$$$slash_"appcachemsg.xml"
	do $system.OBJ.Load(source,"ck")
	d ##class(%File).RemoveDirectoryTree(tempdir)
	d ##class(%File).RemoveDirectoryTree(unzip)
	q $$$OK
]]></Implementation>
</Method>

<Method name="GetMailPOP3">
<Description>
 d ##class(apptools.core.net).GetMailPOP3()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>MDEAM,BSmName,BSmPass,MASS,dir</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 ;MDEAM - MAIL SERVER NAME OR ITS IP
 ;,BSmName - USER NAME = "NAME_user@"_MDEAM
 ;,BSmPass - USER PASSWORD
 ;,MASS - THE ARRAY FROM WHICH TO CREATE THE PROGRAM, WHICH WILL BE BASED ON A LIST OF EMAILS
 ;dir - the PATH TO the DIRECTORY WHERE you DOWNLOADED the attached FILES
 ;new mailserver,status,from,to,date,subject,messagesize,m,hdrs,key,mailMsg,lined
 ;N mssg
 set mailserver=##class(%Net.POP3).%New()
 I $D(dir) set mailserver.AttachDir=dir
 set mailserver.Debug=0
 set mailserver.port=25
 set mailserver.StoreAttachToFile=1
 set status=mailserver.Connect(MDEAM,BSmName,BSmPass)
 if ('status) w !,$System.Status.GetErrorText(status) g clo
 f mssg=1:1 d  if ('status) Q
 .set status=mailserver.FetchMessage(mssg,.from,.to,.date,.subject,.messagesize,.hdrs,.mailMsg,0)
 .if ('status) Q
 .S MASS(mssg,"subject")=subject
 .S MASS(mssg,"date")=date
 .S MASS(mssg,"from")=from
 .S MASS(mssg,"messagesize")=messagesize
 .S MASS(mssg,"to")=to
 .K MAS
 .d Dump(mailMsg,.MAS)
 .M MASS(mssg,"z")=MAS
 .s status=mailMsg.%Close()
clo s status=mailserver.%Close()
	i 'status w !,$System.Status.GetErrorText(status)
 q $G(mssg)-1
 
Dump(msg,MASS) 
 ;new i,index,value
 if msg.IsMultiPart do  quit
 . for i=1:1:msg.Parts.Count() do Dump(msg.Parts.GetAt(i),.MASS)
 s index=""  f  s value=msg.Headers.GetNext(.index) q:index=""  S MASS(msg,"head",index)=value
 if msg.IsBinary do
 . S MASS(msg,"msg")="binary"
 . S MASS(msg,"msgFN")=msg.FileName
 . S MASS(msg,"msgGA")=msg.GetAttribute("content-disposition","filename")
 else  do
 . ;w !,"Dumping text msg Filename="_msg.FileName_" filename="_msg.GetAttribute("content-disposition","filename"),!
 . S MASS(msg,"msg")="text"
 . S MASS(msg,"msgFN")=msg.FileName
 . S MASS(msg,"msgGA")=msg.GetAttribute("content-disposition","filename")
 . set stream=msg.TextData
 . do stream.Rewind()
 . k len,line
 . for l=1:1 set len=32763,line=stream.Read(.len) do  quit:stream.AtEnd
 ..S MASS(msg,"msg",l)=line         ;write line
 quit
]]></Implementation>
</Method>

<Method name="KILLMAIL">
<ClassMethod>1</ClassMethod>
<FormalSpec>MDEAM,BSmName,BSmPass,MSGK,Kill</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 S OK=1,Kill=0
 set mailserver=##class(%Net.POP3).%New()
 set mailserver.port=$G(^%BScSMTP(MDEAM,"POP"),"110")
 set mailserver.Debug=0
 set mailserver.StoreAttachToFile=1
 set status=mailserver.Connect(MDEAM,BSmName,BSmPass)
 if ('status) S OK=status g Kclo
 S I="" F  S I=$O(MSGK(I)) Q:I=""  set OK=mailserver.DeleteMessage(I) S:OK Kill=Kill+1 I 'OK Q
 s status=mailserver.QuitAndCommit()
Kclo s status=mailserver.%Close()
 q $G(OK)
]]></Implementation>
</Method>

<Method name="GetJsonURL">
<Description>
write $System.Status.GetErrorText(##class(apptools.core.net).GetJsonURL("https://pm.community.intersystems.com/",.o)) </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[url:%String,&object]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	New $Namespace
	#dim re As %Net.HttpRequest
	
 	Set req=##class(%Net.HttpRequest).%New()
	
	if $zconvert(url,"L")["https:" {
	 	Set SSLConfig = "ZPM"
	 	Zn "%SYS"
	 	Do:'##class(Security.SSLConfigs).Exists(SSLConfig) ##class(Security.SSLConfigs).Create(SSLConfig)
	 	Set req.Https=1
		Set req.SSLConfiguration=SSLConfig
	}
	set server=$p(url,"/",3)
	if server[":" {
		Set req.Port=$p(server,":",2)
		set server=$p(server,":")
	}
	Set req.Server=server
	Set req.Location = $p(url,"/",4,*)
	;Do req.SetHeader("Accept","application/vnd.github.v3+json")

	Set st = req.Get()
	Return:$$$ISERR(st) st
	Return:(req.HttpResponse.StatusCode = 404) $$$ERROR($$$GeneralError,"Repository doesn't exist OR you don't have access")
	Return:((req.HttpResponse.StatusCode = 403) && (req.HttpResponse.GetHeader("X-RATELIMIT-REMAINING")=0)) $$$ERROR($$$GeneralError,"API rate limit exceeded. Try logging in.")
 	Return:(req.HttpResponse.StatusCode '= 200) $$$ERROR($$$GeneralError,"Received " _ req.HttpResponse.StatusCode _ " status, expected 200")

 	#dim object As %ZEN.proxyObject
	Set st = ##class(%ZEN.Auxiliary.jsonProvider).%ConvertJSONToObject(req.HttpResponse.Data,,.object,1)
	Return:$$$ISERR(st) st

 	Return $$$OK
]]></Implementation>
</Method>

<Method name="GetListIP">
<Description>
To obtain the server's IP address
w ##class(apptools.core.net).GetIP()
$G(%request.CgiEnvs("REMOTE_ADDR")) - agrees client</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 set lsIface=##class(%SYSTEM.INetInfo).GetListOfConfiguredInterfaces()
 for iface=1:1:$ll(lsIface) { 
   s IPv4=$lg($lg(lsIface,iface),2)
   if $l(IPv4,":")>2 {set IPv4=$lg($lg(lsIface,iface),3) if $l(IPv4,":")>2 {set IPv4=""}}
   write IPv4,!
 }
]]></Implementation>
</Method>

<Method name="GetIP">
<Description>
Get IP address
w ##class(apptools.core.net).GetIP("google.com")
w $P($ZU(54,13,$zu(54,0)),",",1)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>host=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	if host="" set host=$zu(54,0) ;current host
	q $P($ZU(54,13,host),",",1)
]]></Implementation>
</Method>

<Method name="GetIPext">
<Description>
Get IP address external
do ##class(apptools.core.net).GetIPext(,.ip) zw ip</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[url={"https://pr-cy.ru/browser-details/"},&ip]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	If url="" Quit $$$ERROR($$$GeneralError,"Invalid - URL - not supplied")
	set st=$$$OK 
	set st=##class(apptools.core.net).GetHttp(url,.out)
	if st {
		do ##class(apptools.core.files).Stream2String(out("content"),.str)
		;s out("stream")=str
		set ip=$p($p($p(str,"<input type=""text"" name=""host"" ",2),"value=""",2),$c(34),1)
	}
    quit st
]]></Implementation>
</Method>

<Method name="GetURI">
<Description>
Get current URI
write ##class(apptools.core.net).GetURI(.prop)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Properties</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	New $Namespace
	set $Namespace="%SYS"
	set Status=##Class(Config.Startup).Get(.Properties)
	if Status s ServerPort="http://"_$zu(110)_":"_$g(Properties("WebServerPort"),57772)
	quit $G(ServerPort)
]]></Implementation>
</Method>

<Method name="loadzpm">
<Description>
/* Install ZPM, ZAPM */ set $namespace="%SYS", name="DefaultSSL" do:'##class(Security.SSLConfigs).Exists(name) ##class(Security.SSLConfigs).Create(name) set url="https://pm.community.intersystems.com/packages/zpm/latest/installer" Do ##class(%Net.URLParser).Parse(url,.comp) set ht = ##class(%Net.HttpRequest).%New(), ht.Server = comp("host"), ht.Port = 443, ht.Https=1, ht.SSLConfiguration=name, st=ht.Get(comp("path")) quit:'st $System.Status.GetErrorText(st) set xml=##class(%File).TempFilename("xml"), tFile = ##class(%Stream.FileBinary).%New(), tFile.Filename = xml do tFile.CopyFromAndSave(ht.HttpResponse.Data) do ht.%Close(), $system.OBJ.Load(xml,"ck") do ##class(%File).Delete(xml) zpm "install zapm"
w ##class(apptools.core.net).loadzpm()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
  SET $NAMESPACE="%SYS"
  set name="DefaultSSL" DO:'##class(Security.SSLConfigs).Exists(name) ##class(Security.SSLConfigs).Create(name)
  set url="https://pm.community.intersystems.com/packages/zpm/latest/installer" write !,url
  Do ##class(%Net.URLParser).Parse(url,.comp)
  set ht = ##class(%Net.HttpRequest).%New()
  set ht.Server = comp("host")
  set ht.Port = 443
  set ht.Https=1
  set ht.SSLConfiguration=name
  set st=ht.Get(comp("path"))
  quit:'st $System.Status.GetErrorText(st) 
  set xml=##class(%File).TempFilename("xml")
  Set tFileBinStream = ##class(%Stream.FileBinary).%New()
  Set tFileBinStream.Filename = xml
  do tFileBinStream.CopyFromAndSave(ht.HttpResponse.Data)      
  do ht.%Close()
  do $system.OBJ.Load(xml,"ck")
  do ##class(%File).Delete(xml)
  quit 1
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.rest">
<Description>
// The REST interface: class that routes HTTP requests</Description>
<IncludeCode>apptools.core</IncludeCode>
<Super>%CSP.REST</Super>
<TimeChanged>65962,35137.979494</TimeChanged>
<TimeCreated>65607,76511.09225</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="CONTENTTYPE">
<Default>application/json</Default>
</Parameter>

<Parameter name="CHARSET">
<Default>UTF-8</Default>
</Parameter>

<Parameter name="ISCPREFIX">
<Default>isc_cache</Default>
</Parameter>

<XData name="UrlMap">
<XMLNamespace>http://www.intersystems.com/urlmap</XMLNamespace>
<Data><![CDATA[
<Routes>
<Route Url="/a/:text" Method="GET" Call="apptools.lte.adminStatic:GetMain"/>
<Route Url="/ad/:text" Method="GET" Call="apptools.MVK.adminStatic:GetMvkApp"/>

<Route Url="/get-html/:text" Method="GET" Call="Index"/>
<Route Url="/post-json" Method="POST" Call="jsonrpc"/>
<Route Url="/get-files/:text" Method="GET" Call="Files"/>

<Route Url="/testpost" Method="POST" Call="Test"/>
<Route Url="/testget/:text" Method="GET" Call="Test"/>  
<Route Url="/finduser/:text" Method="GET" Call="FindUser"/>

<Route Url="/auth" Method="GET" Call="Auth"/>
<Route Url="/css/index.css" Method="GET" Call="GetCss"/>
<Route Url="/css/themes/:theme" Method="GET" Call="GetTheme"/>
<Route Url="/js/index.js" Method="GET" Call="GetJs"/>

<Route Url="/db" Method="GET" Call="getDBsize"/>
<Route Url="/dirsize/:path" Method="GET" Call="getDirSize"/>

<Route Url="/products/:mode" Method="GET" Call="getProductions"/>
<Route Url="/productslist/:ns" Method="GET" Call="getListErrProducts"/>
<Route Url="/alerts/:count" Method="GET" Call="GetAlerts"/>

<Route Url="/proj/:proj/:metrics/:mode" Method="GET" Call="apptools.MVK.Metrics:getProj"/>
</Routes>
]]></Data>
</XData>

<UDLText name="T">
<Content><![CDATA[
/*
/// sample servise JSON-RPC 2.0 https://www.jsonrpc.org/specification

{"jsonrpc": "2.0", "result": {"likes": 123}, "id": 1}
If error:
{"jsonrpc": "2.0", "error": {"code": 666, "message": "Post not found"}, "id": "1"}
Request:
[
  {"jsonrpc":"2.0","method":"server.shutdown","params":{"server":"42"},"id":1},
  {"jsonrpc":"2.0","method":"server.remove","params":{"server":"24"},"id":2}
]
Response:
[
  {"jsonrpc":"2.0","result":{"status":"down"},"id":1}
  {"jsonrpc":"2.0","error":{"code":1234,"message":"Server not found"},"id": 2}
]
*/
]]></Content>
</UDLText>

<Method name="jsonrpc">
<Description>
post http://server:57772/rest/jsonrpc
{"jsonrpc":"2.0","method":"GetInfo","params":{"code":"5007092465"},"id":123}</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ns="",class="",meth=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set sc = $$$OK
	try {
	 	;merge $$$AppL("MML","%request.Data")=%request.Data
		;set $$$AppL("MML","%request.AppData")=%request.AppData
		;set $$$AppL("MML","req")=$$$AppObJs(%request)
		;if %request.Get("Username")'="",'..Authorize(%request.Get("Username"),%request.Get("Password")) {
		; 	;set %response.Status = "401 Unauthorized" quit
		; 	d ..jsonrpcError(401,"Unauthorized "_%request.Content) 
		;}
		if $isobject(%request.Content) { //POST
			d %request.Content.Rewind() 
			set json=%request.Content.Read($$$MaxStringLength) 
			set json = $ZCVT(json,"I","UTF8") 
			;s $$$AppL("MML","jsonrpc-json")=json
	 		if ($g(json)["{") {
	 			set method={}.$$$jsonFromJSON(json).method
	 			set params={}.$$$jsonFromJSON(json).params
	 			set jsonrpc={}.$$$jsonFromJSON(json).jsonrpc
	 			set id={}.$$$jsonFromJSON(json).id
	 			if jsonrpc'="2.0" w ..jsonrpcError(2,"Version not supported "_jsonrpc) q
	 			s appPar=""
	 			if method[":" { 
	 				if $p(method,":",1)'="" s ns=$p(method,":",1)
					if $p(method,":",2)'="" s class=$p(method,":",2)
					if $p(method,":",3)'="" s meth=$p(method,":",3)
					if $p(method,":",4)'="" s appPar=$p(method,":",4,*)
				}
				if ns'="" zn ns
				if $e(class,1)="^" {
					do @(meth_class_"(.par,.json)") ;??? xec public 
				} else {
					if appPar["~" {
						do ##class(apptools.core.type).ParseURL(appPar,.appPar,"~")  ;parse in array
					}
					elseif appPar["&" {
						d ##class(apptools.core.type).ParseURL(appPar,.appPar,"&")
					}
				   ;set %response.CharSet = "utf-8"
    			;	set %response.ContentType = "text/html"
    				;s appPar("params")=params
    				if $isobject(params) {
	    				d ##class(apptools.core.Action).GetElemParseForm(params.form,.appPar,"z",0)
	    				s appPar("params")=params.%ToJSON()
    				}
    				do $classmethod(class,meth,.appPar) 
					quit
					/*
					if $isobject(params.form) {
	    				d ##class(apptools.core.Action).GetElemParseForm(params.form,.appPar,"z",0)
	    				do $classmethod(class,meth,.appPar) 
    				}
    				elseif $isobject(params) {
	    				do $classmethod(class,meth,.params) 
    				}
	    			else {
		    			;d ##class(apptools.core.Action).GetElemParseForm(params.form,.appPar,"z",0)
      					do $classmethod(class,meth,.appPar) 
	    			}
					quit */
				}
				;w "{""text"":""Hello world"",""inn"":"""_params.inn_"""}" q
				;w $ZCVT(str,"O","UTF8") 
				;w resjson
	 			
	 		}
		} else {
			;s $$$AppL("MML","%request")=$$$AppObJs(%request)
			;m $$$AppL("MML","%request.Data")=%request.Data
			;m $$$AppL("MML","%request.Content")=%request.Content
			;set $$$AppL("MML","%request.AppData")=%request.AppData
			 d ..jsonrpcError(3,"Bad request "_%request.Content)
			 q
		}
	} catch ex {
		set sc = ex.AsStatus()
		;s $$$AppL("MML","jsonrpc-err")=$System.Status.GetErrorText(sc)
		d ..jsonrpcError(4,"exception: "_$zconvert($System.Status.GetErrorText(sc),"O","HTML"))
	}
	return $$$OK
]]></Implementation>
</Method>

<Method name="Authorize">
<ClassMethod>1</ClassMethod>
<FormalSpec>user,password</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	q $SYSTEM.Security.Login(user, password)
]]></Implementation>
</Method>

<Method name="jsonrpcError">
<ClassMethod>1</ClassMethod>
<FormalSpec>code,message</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;w "{""jsonrpc"":""2.0"",""error"":{""code"":"""_code_""",""message"":"""_message_"""}}"
	Set json = $$$NewDynObj
 	s json.jsonrpc="2.0"
	s json.code=code
	s json.message=message
	$$$DynObjToJSON(json)
	q $$$OK
]]></Implementation>
</Method>

<Method name="Files">
<Description>
Method writes files.
/apptoolsrest/get-files/fileId</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>fileId</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 s file=##class(apptools.core.DownloadCSP).GetfileName(fileId,,,.ContentType)
 ;get date modification	file
 set dh=$zu(140,2,file)
 if dh<0 set dh=$now(0)
 set date=$zd(dh, 11) _ ", "_ $zdt(dh, 2,1) _ " GMT"
 
 ;do %response.SetHeader("Last-Modified", date)
 if (%request.GetCgiEnv("HTTP_IF_MODIFIED_SINCE")=date) {
	        set %response.Status = "304 Not Modified"
	    } 
 else {
	set %response.CharSet="raw"
	;d %response.SetHeader("Expires", "0")
	;d %response.SetHeader("Accept-Ranges","bytes")

	if $g(ContentType)'="" {
		s mimetype=ContentType
	} else {
		set ext=$p(file,".",*)
		set mimetype=##class(apptools.core.filesMimeTypes).GetMimeTypes4ext(ext)
	}
	set %response.ContentType=mimetype
	
	set stream=##class(%FileBinaryStream).%New()
	set stream.Filename=file
	set size=stream.Size
	do %response.SetHeader("Content-Length",size)

	if ContentType["application/force-download" {
		set name=$p(file,$$$slash,*)
		set name=$ZCVT($ZCVT(name,"O","UTF8"),"O","URL")
		d %response.SetHeader("Content-Disposition","attachment;filename="_name)
	}

	while 'stream.AtEnd {
		set line=stream.Read()
		write line
	}
 }
  return $$$OK
]]></Implementation>
</Method>

<Method name="Test">
<ClassMethod>1</ClassMethod>
<FormalSpec>parameter</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set %response.CharSet = "utf-8"
    set %response.ContentType = "text/html"
	&html<<h1>Status: OK!</h1><pre>>
	zw %request
	zw %response
	&html<</pre>>
	quit $$$OK
]]></Implementation>
</Method>

<Method name="FindUser">
<Description>
Search users by context
http://localhost:57772/apptoolsrest/finduser/super</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>text=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 i $l(text)<3 d ..jsonrpcError(5,$$$aText("Search string must be at least 3 characters","")) q $$$OK
 zn "%SYS"
 s sql="select Name,FullName,Comment,EmailAddress,Enabled,CreateDateTime,LastModifiedDateTime from Security.Users where UPPER(FullName) [ '"_$zconvert(text,"U")_"'"
	#if $$$comClassDefined("%ZEN.Auxiliary.jsonSQLProvider")
		set Provider = ##class(%ZEN.Auxiliary.jsonSQLProvider).%New()
		set Provider.sql = sql
		Set Provider.%Format = $$$formatJSONSQL
		Set Provider.maxRows = 10000
		set st = Provider.%DrawJSON()
	#else
		set st = $$$ERROR($$$GeneralError,"Class %ZEN.Auxiliary.jsonSQLProvider does not exist")
	#endif
	return st
]]></Implementation>
</Method>

<Method name="WriteStatic">
<Description>
Calls StaticContent.Write method or sends not modified header. Type have to be "css" or "js"
d ##class(apptools.core.rest).WriteStatic("html",,,,,text)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>type:%String,ContentType:%String="",xDataClass="apptools.core.rest",ClassCSPPage="",IsCached=0,Content=""</FormalSpec>
<Implementation><![CDATA[
    #define CompileTime ##Expression("""" _ $zd($h, 11) _ ", "_ $zdt($NOW(0), 2,1) _ " GMT""")
    set %response.CharSet = "utf-8"
    set %response.ContentType = $case(type,
        "css": "text/css",
        "js": "text/javascript",
        "html": "text/html",
        : $case(ContentType="", 1:"text/plain", :ContentType)
    )
    do %response.SetHeader("Last-Modified", $$$CompileTime)
    try{
		;if %request.Get("Username")'="",'..Authorize(%request.Get("Username"),%request.Get("Password")) {
		; 	set %response.Status = "401 Unauthorized" quit
		;}
	    if IsCached,(%request.GetCgiEnv("HTTP_IF_MODIFIED_SINCE")=$$$CompileTime) {
	        set %response.Status = "304 Not Modified"
	    } 
	    elseif Content'="" {
		    write Content
	    }
	    elseif ClassCSPPage'="" {
		    s param=$p(ClassCSPPage,"?",2,*)
		    s ClassCSPPage=$p(ClassCSPPage,"?")
		    s:ClassCSPPage[".cls" ClassCSPPage=$p(ClassCSPPage,".cls",1)
		    ;set $$$AppL("MMM","WriteStatic")=$lb(type,ClassCSPPage) ;$$$AppObJs(id)
		    ;set $$$AppL("MMM","%request")=$$$AppObJs(%request)
		    s method="OnPage"
		    s:ClassCSPPage[":" method=$p(ClassCSPPage,":",2,*),ClassCSPPage=$p(ClassCSPPage,":",1)
		    do:method["OnPage" $classmethod(ClassCSPPage,method,param)
	    }
	    else {
	        do ..WriteStaticContent(xDataClass,type)
	    }
    }
    catch e { 
    	write $ze
    	set %response.Status = "501 Not Implemented" ;"405 Method Not Allowed" ;"400 Bad Request"
    }
]]></Implementation>
</Method>

<Method name="GetCss">
<Description>
Method writes application CSS.</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>class</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    do ..WriteStatic("css")
    return $$$OK
]]></Implementation>
</Method>

<Method name="GetTheme">
<Description>
Method writes application theme.</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Theme:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    do ..WriteStatic("Theme"_$REPLACE(Theme, ".css", ""),"text/css")
    return $$$OK
]]></Implementation>
</Method>

<Method name="GetJs">
<Description>
Method writes application JavaScript.</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    do ..WriteStatic("js")
    return $$$OK
]]></Implementation>
</Method>

<Method name="Index">
<Description>
Method writes application HTML.</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>class</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    do ..WriteStatic("html","","",class)
    return $$$OK
]]></Implementation>
</Method>

<Method name="WriteStaticContent">
<Description>
Write the contents of xData tag</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Class:%String,Const:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set obj = ##class(%Dictionary.CompiledXData).%OpenId(Class_"||"_Const)
    return:(obj = "") $$$OK
    set xdata = obj.Data
    set status = ##class(%XML.TextReader).ParseStream(xdata, .textreader)
    while textreader.Read() { if (textreader.NodeType="chars") {
        write textreader.Value
    } }
    return $$$OK
]]></Implementation>
</Method>

<Method name="getStatic">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[name:%String,&Description]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set class = $case($l(name, ":"), 2:$p(name, ":"), :$classname())
	set queryName = $p(name, ":", *)
	set Description=""
	set str = ""	
	if ##class(%Dictionary.XDataDefinition).IDKEYExists(class, queryName) {
		set stream = ##class(%Stream.TmpCharacter).%New()
		for i=1:1:$$$comMemberKeyGet(class,$$$cCLASSxdata,queryName,$$$cXDATAdata) {
			do stream.WriteLine($$$comMemberArrayGet(class,$$$cCLASSxdata,queryName,$$$cXDATAdata,i))
		}
		set str = stream.Read($$$MaxLocalLength)
		set Description=$$$comMemberKeyGet(class,$$$cCLASSxdata,queryName,$$$cXDATAdescription)
		
	}
	return str
]]></Implementation>
</Method>

<Method name="getDirSize">
<Description>
To sorted sizes subdirs for Linux
kill res set res="" write ##class(apptools.core.rest).getDirSize("/opt2/isc/iris/mgr/",.res,0)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[path="",&res,minsize=10]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set gn = "^||tmpfile"
	do ##class(apptools.core.files).getPathcconsole(.dir,.logname)
	if $g(path)="" set path=dir ;location of default database
	if $zv'["Linux" quit $$$OK  ;for other OS not implemented
	set st=$$$OK
	set curNs=$zu(5)
	zn "%sys"
	set prefix = ..#ISCPREFIX_"_dirsize"
	set tempfile=$SYSTEM.Util.InstallDirectory()_"mgr/Temp/dirsize.log"
	kill @gn set nl = $c(10)
	try {
		;du -sm /opt2/isc/iris/mgr/*| sort -nr
		set cmd="du -sm "_path_"*| sort -nr >"_tempfile
		set result = $zf(-1, cmd)
		if (result '= 0) { 
			w !,$System.Status.GetErrorText(result)
			$$$ThrowStatus($$$ERROR($$$GeneralError, "Error:" _ result_", "_cmd)) 
		}
		else {
			set size=##class(apptools.core.files).File2Arr(tempfile,gn,"RSK\UTF8\")
			for i=1:1 { q:'$d(@gn@(i))   ;pass the loop through the entire report
				continue:$p(@gn@(i),$c(9))'>minsize ;eliminate small and empty directories
				set str=$g(@gn@(i))
				if $d(res) s res(i)=$P(str,$c(9),2)_" "_$P(str,$c(9),1)
				else  w prefix_"_"_$P(str,$c(9),2)_" "_$P(str,$c(9),1)_nl
			}
		}
	} catch ex {
		set st = ex.AsStatus()
		;$$$TRACE($system.Status.GetErrorText(st))
	}
	do ##class(%File).Delete(tempfile)
	zn curNs
	quit st
]]></Implementation>
</Method>

<Method name="getDBsize">
<Description>
The size of the database in Gigabytes
do ##class(apptools.core.rest).getDBsize("dbsize",.list) write list</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>prefix=..#ISCPREFIX_"_dbsize",dbname,int=1,all=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set nl = $c(10)
	new $namespace
	set $namespace="%sys"
	set gn="^||db"
	set st=##class(apptools.core.sys).SaveQuery("SYS.Database:FreeSpace",gn)
	set r=$q(@gn@("")) ;to the first link
	set r=$na(@gn@($qs(r,1),$qs(r,2))) ;take the first 2 of the index in the link
	s listDb=##class(apptools.core.sys).ListDB(.info,"NotPre,NotTemp")
	for i=1:1 { q:'$d(@r@(i))   ;pass the loop through the entire report
		continue:$g(@r@(i,1))=""
		;by default, we give all sizes to Gigabytes

		set dir=$g(@r@(i,2))
		set name=$g(@r@(i,1))
		if 'all,(","_listDb_",")'[(","_name_",") continue
		if 'all,(dir)[("secondary/")||((dir)[("temp/")) continue
		
		set size=$$ToGB($g(@r@(i,4)))
		set free=$$ToGB($g(@r@(i,8)))
		set dbname(dir)=size
		set dbname(dir,"name")=name
		set dbname(dir,"free")=free
		write:'int prefix_"_"_name_" "_size_nl
		write:'int prefix_"_"_name_"_DiskFreeSpace "_(+free)_nl
	}
	set dbname=free
	write nl
	quit $$$OK
ToGB(size) 
		if size["MB" {s size=$j(size/(1024),"",3) ;if in MB, then divide
		}
		elseif size["TB" {s size=size*1024  ;if TB then multiply
		}
		else {
			set size=+size  ;if GB then translate into the number
		}
	quit size
]]></Implementation>
</Method>

<Method name="getListErrProducts">
<Description>
http://localhost:57772/apptoolsrest/productslist/-SPGZ</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>nspace=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;d ##class(apptools.core.Production).GetListErrProducts(1,nspace)
	do ##class(apptools.core.Production).GetStatusProductsJson(1,"list-errors"_nspace,.res)
	do res.%ToJSON()
	q $$$OK
]]></Implementation>
</Method>

<Method name="getProductions">
<Description>
http://localhost:57772/apptoolsrest/products/0</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>day="1"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if 'day {
		do ##class(apptools.core.Production).GetStatusProductsJson(0,"system-stat",.res) 
		do res.%ToJSON()
	}
	else {
		do ##class(apptools.core.Production).GetStatusProductsJson(day,"count-errors",.res)
		 do res.%ToJSON()
	}
	;d ##class(apptools.core.Production).GetStatusProducts(day,.errors)
	;s ns=""
	;for { s ns=$o(errors(ns)) q:ns=""
	;	s co=+$g(errors(ns,"CountErrors"))
	;	w $s(co:"/",1:"\")_"server_"_$zu(110)_"_"_ns_" Errors: "_co_$$$NL
	;}
	q $$$OK
]]></Implementation>
</Method>

<Method name="GetAlertsSys">
<Description>
do ##class(%SYS.System).WriteToConsoleLog("InterSystems Interoperability Test",,3)
do ##class(apptools.core.rest).GetAlertsSys(,.json)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[count=10,&sys]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(%SYSTEM.Monitor).GetAlerts(,.str,.last)
	set sys = {}
	set sys.host = $ZU(110)
	set sys.instance = $P($ZU(86),"*",2)
	set sys.version = $zv
	set sys.alerts = []
	
	set i=""
	for ii=1:1 { set i=$Order(str(i),-1,val) quit:i=""
		if ii>count quit
		set alert={}
		set alert.type=$P(val," ",3)
		set alert.text=val
		do sys.alerts.%Push(alert)
	}
	do sys.%ToJSON()
 quit $$$OK
]]></Implementation>
</Method>

<Method name="GetAlerts">
<Description>
do ##class(apptools.core.rest).GetAlerts(,.json)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[days=1,&sys]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 	;set method="class(apptools.core.files).Alert" 
	set method="class(apptools.core.files).AlertDays" 
	do ##class(apptools.core.files).FindContextInLog(days,method,.str)
	set sys = {}
	set sys.host = $ZU(110)
	set sys.instance = $P($ZU(86),"*",2)
	set sys.version = $zv
	set sys.period = $G(str)
	set sys.alerts = []
	set i=""
	for ii=1:1 { set i=$Order(str(i),-1,val) quit:i=""
		;if ii>count quit
		set alert={}
		set alert.type=$P(val," ",3)
		set alert.text=val
		do sys.alerts.%Push(alert)
	}
	do sys.%ToJSON()
	 quit $$$OK
]]></Implementation>
</Method>

<XData name="Themecache">
<Data><![CDATA[
<data>
<![CDATA[<!-- @include client/css/themes/cache.css -->]]]]><![CDATA[>
</data>
]]></Data>
</XData>

<XData name="html">
<Data><![CDATA[
<data>
<![CDATA[
<!-- @include client/index.html -->]]]]><![CDATA[>
</data>
]]></Data>
</XData>

<XData name="css">
<Data><![CDATA[
<data>
<![CDATA[<!-- @include client/css/index.css -->]]]]><![CDATA[>
</data>
]]></Data>
</XData>

<XData name="js">
<Data><![CDATA[
<data>
<![CDATA[<!-- @include client/js/index.js -->]]]]><![CDATA[>
</data>
]]></Data>
</XData>
</Class>


<Class name="apptools.core.sql">
<Description>
Query and SQL statements</Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65713,47388.040224</TimeChanged>
<TimeCreated>65607,76511.179169</TimeCreated>

<Method name="getSQL">
<Description>
s sql=##class(apptools.core.sql).getSQL("apptools.core.sql:TestXData",0,.desc) w !,sql,!!,desc
s sql=##class(apptools.core.sql).getSQL("TestQuery",0,.desc) w !,sql,!!,desc</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[name:%String,removeNL=$$$NO,&Description,today=1]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	#dim sc As %Status = $$$OK
	
	set class = $case($l(name, ":"), 2:$p(name, ":"), :$classname())
	set queryName = $p(name, ":", *)
	set Description=""
		
	if ##class(%Dictionary.QueryDefinition).IDKEYExists(class, queryName) {
		set query = ##class(%Dictionary.QueryDefinition).IDKEYOpen(class, queryName,,.sc)
		throw:$$$ISERR(sc) ##class(%Exception.StatusException).CreateFromStatus(sc)
		set sql = query.SqlQuery
		set Description=query.Description
	} elseif ##class(%Dictionary.XDataDefinition).IDKEYExists(class, queryName) {
		set stream = ##class(%Stream.TmpCharacter).%New()
		for i=1:1:$$$comMemberKeyGet(class,$$$cCLASSxdata,queryName,$$$cXDATAdata) {
			do stream.WriteLine($$$comMemberArrayGet(class,$$$cCLASSxdata,queryName,$$$cXDATAdata,i))
		}
		set sql = stream.Read($$$MaxLocalLength)
		set Description=$$$comMemberKeyGet(class,$$$cCLASSxdata,queryName,$$$cXDATAdescription)
		
	} else {
		throw ##class(%Exception.StatusException).CreateFromStatus($$$ERROR($$$GeneralError, $$$FormatText($$$aText("Class %1 does not have a Query or XData element named %2",""), class, queryName)))
	}
	
	set:(removeNL = $$$YES) sql = $replace(sql, $$$NL, " ")
	return sql_$s(today:" -- Today "_$zd($h,3)_" "_$g(ssm),1:"")
]]></Implementation>
</Method>

<Query name="TestQuery">
<Description>
test query
stored in query</Description>
<Type>%Query</Type>
<SqlQuery>SELECT top 10 * from
  apptools_core.Log</SqlQuery>
</Query>

<XData name="TestXData">
<Description>
test query
stored in xdata</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
SELECT
  c.contractNumber,
  TO_DATE(d."date", 'YYYY-MM-DD'),
  d.year,
  d.month,
  d.amount,
FROM mvk_model_payment.PayDoc d
  JOIN mvk_model_payment.PayDocSession s ON s.ID = d.session
  JOIN mvk_model_contract.Contract c ON d.contract = c.ID
WHERE s.ID = ?
ORDER BY c.contractNumber
]]></Data>
</XData>

<Method name="getViewOrQuerySQL">
<ClassMethod>1</ClassMethod>
<FormalSpec>viewOrQueryName:%String,*sql:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#dim sc As %Status = $$$OK
	set sql = ""
	
	if (viewOrQueryName [ ".")
	{
		set sql = "select * from " _ viewOrQueryName _ " where 1=1 "
	}
	else
	{
		try
		{
			set sql = ..getSQL(viewOrQueryName)
		}
		catch ex
		{
			set sql = ""
			set sc = $$$ADDSC($$$ERROR($$$GeneralError, "Error " _ viewOrQueryName), ex.AsStatus())
		}
	}
	
	quit sc
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.sys">
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65965,59621.589885</TimeChanged>
<TimeCreated>65607,76511.284467</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Method name="logout">
<Description>
Sign Out
d ##Expression(##class(apptools.core.sys).logout()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    #dim %session As %CSP.Session
    set st = %session.Logout(1)
    set %session.EndSession = 1
    return st
]]></Implementation>
</Method>

<Method name="GetSysUserProp">
<Description>
Get system user properties
do ##class(apptools.core.sys).GetSysUserProp($username,.Prop)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Name,Prop</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	$$$NspGoto(curNs,"%SYS")
	set Status=##Class(Security.Users).Get(Name,.Prop)
	$$$NspReturn(curNs)
	quit Status
]]></Implementation>
</Method>

<Method name="IsPreparedDB">
<Description>
Check whether the database is prepared
w ##class(apptools.core.sys).IsPreparedDB("ENSDEMO")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>name</FormalSpec>
<Implementation><![CDATA[
	i (",ENSDEMO,ENSEMBLE,ENSEMBLEENSTEMP,ENSEMBLESECONDARY,ENSLIB,CACHESYS,CACHELIB,CACHETEMP,CACHE,CACHEAUDIT,DOCBOOK,USER,SAMPLES,IRISSYS,IRISLIB,IRISTEMP,IRISLOCALDATA,IRISAUDIT")[(","_$zconvert(name,"U")_",") q 1
	Q 0
]]></Implementation>
</Method>

<Method name="getEnsProd">
<Description>
Get a list of products in namespace
w ##class(apptools.core.sys).getEnsProd("ENSDEMO",.info)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>name,info</FormalSpec>
<Implementation><![CDATA[
	s sc=$$$OK
	try {
		$$$NspGoto(curNs,name) KILL info
		DO ##CLASS(Ens.Director).GetProductionSummary(.info,name)
	}
	catch e { s sc=$$$ERROR($$$GeneralError,$ze)}
	$$$NspReturn(curNs)
	Q sc
]]></Implementation>
</Method>

<Method name="IsPreparedNS">
<Description>
Check whether the namespace is prepared
w ##class(apptools.core.sys).IsPreparedNS("%SYS")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>name</FormalSpec>
<Implementation><![CDATA[
	i (",%SYS,%ALL,DOCBOOK,ENSDEMO,ENSEMBLE,SAMPLES,")[(","_$zconvert(name,"U")_",") q 1
	Q 0
]]></Implementation>
</Method>

<Method name="getCSPapps">
<Description>
//get csp apps 
w ##class(apptools.core.sys).getCSPapps("/apptools","Path")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>csppapp,prop</FormalSpec>
<Implementation><![CDATA[
		
 $$$NspGoto(curNs,"%SYS")
	s result=##CLASS(%ResultSet).%New("%DynamicQuery:SQL")
	s tSC=result.Prepare("select * FROM Security.Applications where Name=?")
	s:tSC tSC=result.Execute(csppapp)
	i '$$$ISOK(tSC) {
		 QUIT tSC
	}
	else {
		while result.Next() {
			set res=result.Data(prop)
		}
	}
	d result.Close()
	$$$NspReturn(curNs)	
	Q $g(res)
]]></Implementation>
</Method>

<Method name="CreateResourse">
<Description>
d ##class(apptools.core.sys).CreateResourse(.res,"NotPre")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>res,type=""</FormalSpec>
<Implementation><![CDATA[
	$$$NspGoto(curNs,"%SYS")
	d ..ListDB(.info,type)
	s r=""
	for { s r=$o(info(r)) q:r=""
		s ResourceName="%DB_"_r
    	if (##class(Security.Resources).Exists(ResourceName) = 0) {
        	set st = ##class(Security.Resources).Create(ResourceName,
            "Grants access to DB "_r_".", "")
            s res(ResourceName)=st
    	}
	}
	$$$NspReturn(curNs)	
 q $$$OK
]]></Implementation>
</Method>

<Method name="ListDB">
<Description>
Get a list of database names separated by commas
w ##class(apptools.core.sys).ListDB(.info,"NotPre")
Flag = "NotPre" - exclude prepared
Flag = "NotTemp" - exclude tempory</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>info,Flag=""</FormalSpec>
<Implementation><![CDATA[
	$$$NspGoto(curNs,"%SYS")
	s list=""
	s rss=##class(%ResultSet).%New("Config.Databases:List")
	d rss.Execute()
	while rss.Next(.sc) { 
		s name=rss.Data("Name")
		if Flag["NotPre" continue:##class(apptools.core.sys).IsPreparedDB(name)
		if Flag["NotTemp" continue:(name_",")["SECONDARY,"||((name_",")["TEMP,")
		s list=list_","_name 
		m info(name)=rss.Data
	}
	
	d rss.Close()
	$$$NspReturn(curNs)	
	Q $g(list)
]]></Implementation>
</Method>

<Method name="ListNS">
<Description>
Get a list of domain namespaces separated by commas
write ##class(apptools.core.sys).ListNS(.info,"NotPre,Ens")
Flag = "Ens" - only where the ensemble is installed
Flag = "NotPre" - exclude prepared</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>info,Flag=""</FormalSpec>
<Implementation><![CDATA[
	s disp=""
	$$$NspGoto(curNs,"%SYS")	
	set tRS = ##class(%ResultSet).%New("Config.Namespaces:List")
	if '$isobject(tRS) q ""
	set tSC = tRS.Execute()
	While tRS.Next() {	
		s name=tRS.GetData(1) KILL ens
		if Flag["NotPre" continue:##class(apptools.core.sys).IsPreparedNS(name)
		if Flag["Ens",##class(apptools.core.sys).getEnsProd(name,.ens) k info("Ens") m info(name,"Ens")=ens
		s disp=disp_","_name
		m info(name)=tRS.Data
	}
	d tRS.Close()
	$$$NspReturn(curNs)	
	Q $g(disp)
]]></Implementation>
</Method>

<Method name="RunCmd">
<Description><![CDATA[
Function to call the OS command in the result output
%SYS>d ##class(apptools.core.sys).RunCmd("sudo du -sm /opt/isc/ensemble/mgr/*| sort -nr",$na(^%apptools.Cmd("mgr",$zd($h,3))),1,"/backup/temp/snmp/")]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>cmdOs="free",gn="^TaskGN",AddDateTime=0,dir=##class(%File).GetDirectory(##class(%File).TempFilename())</FormalSpec>
<Implementation><![CDATA[
	s gnTask=gn
	set filename=dir_"RunCmd.log"
	if AddDateTime set datetime=$tr($$$AppDT($h)," ","_") set gnTask=$na(@gn@(datetime)),filename=dir_"RunCmd"_datetime_".log"
	;$zf(-100,"/SHELL", "(ps -Af | grep username)" ,"")
	if cmdOs'="",$zf(-1,cmdOs_" > "_filename)
	if ##class(apptools.core.files).ReadFile2Arr(filename,"RSK",,"^||tmpFile") MERGE @gnTask=^||tmpFile
	q $$$OK
]]></Implementation>
</Method>

<Method name="RunTask">
<Description><![CDATA[
Function to call from a regular task
%SYS>d ##class(apptools.core.sys).RunTask("snmpwalk -v 1 server.ru -c public 1.3.6.1.4.1.16563.1.1.1.1.10","^%apptools.TaskLic","%SYSTEM.License:Counts","/backup/temp/snmp/")]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>cmdOs="free",gn="^TaskGN",query="%SYSTEM.License:Counts",dir=##class(%File).GetDirectory(##class(%File).TempFilename())</FormalSpec>
<Implementation><![CDATA[
	set datetime=$tr($$$AppDT($h)," ","_")
	set gnTask=$na(@gn@(datetime))
	set filename=dir_"RunTask"_datetime_".txt"
	if cmdOs'="",$zf(-1,cmdOs_" > "_filename)
	if query'="" d ##class(apptools.core.sys).SaveQuery(query,gn,datetime)
	q $$$OK
]]></Implementation>
</Method>

<Method name="getSQLConnection">
<Description>
  w ##class(apptools.core.sys).getSQLConnection(.list)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&List:%String=""]]></FormalSpec>
<Implementation><![CDATA[
	set res=""
	$$$NspGoto(curNs,"%SYS")	
	Set result=##CLASS(%ResultSet).%New("%DynamicQuery:SQL")
	Set tSC=result.Prepare("select Connection_Name,isJDBC,DSN from %Library.sys_SQLConnection") ; where isJDBC=1")
	Set:tSC tSC=result.Execute()
	
	if '(tSC) {
		s text=$$$aText("Application Setup Error","")_" :"_$SYSTEM.Status.GetErrorText(tSC)  w !,text QUIT $$Error^%apiOBJ(text)
	}
	else {
		while result.Next() {
			if result.Data("Connection_Name")'="" {
				set List(result.Data("Connection_Name"))=$s('result.Data("isJDBC"):result.Data("DSN"),1:"")
				set res=res_result.Data("Connection_Name")_","
			}
		}
	}
	$$$NspReturn(curNs)	
	Q $g(res)
]]></Implementation>
</Method>

<Method name="GetValueGN">
<Description>
Get the value of a field by its name from GN or a list of values
Format $listbuild
w a=##class(apptools.core.sys).GetValueGN(gn,2,"QUANTITY,PRIMARY_UNIT_OF_MEASURE")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>gn,row,NameFields</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	i NameFields'["," q $lb(..GetValue(gn,row,NameFields))
	set ret=""
	for i=1:1:$l(NameFields,",") { continue:$p(NameFields,",",i)=""
		set ret=ret_$lb(..GetValue(gn,row,$p(NameFields,",",i)))
	}
	q ret
]]></Implementation>
</Method>

<Method name="GetValue">
<Description>
Get one field value by its name from GN
w a=##class(apptools.core.sys).GetValue(gn,2,"QUANTITY")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>gn,row,NameField</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 i $g(@gn@(-1,NameField))="" q "" ;undefined field: "_NameField
 i '$d(@gn@(row)) q "undefined row: "_row
 q $lg(@gn@(row),@gn@(-1,NameField))
]]></Implementation>
</Method>

<Method name="SaveQuery">
<Description><![CDATA[
Procedure for calling from a regular job and storing reports in the global
%SYS>d ##class(apptools.core.sys).SaveQuery("SYS.Database:FreeSpace")
%SYS>d ##class(apptools.core.sys).SaveQuery("%SYSTEM.License:Counts")]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>query="%SYSTEM.License:Counts",gn="^%apptools.Task",datetime=""</FormalSpec>
<Implementation><![CDATA[
	set:datetime="" datetime=$$$AppDT($h)
	set gnTask=$na(@gn@(query,datetime))
	Set rset=##class(%Library.ResultSet).%New($p(query," ",1))
	If rset="" s @gnTask@("Create Query failed")= $System.Status.DisplayError(%objlasterror) q %objlasterror
	if $p(query," ",3)'=""	{Set status=rset.Execute($p(query," ",2),$p(query," ",3))}
	elseif $p(query," ",2)'=""	{Set status=rset.Execute($p(query," ",2))}
	else { Set status=rset.Execute()}
	If $$$ISERR(status) s @gnTask@("Execute Query failed:")= $System.Status.DisplayError(status) q status
	Set colcnt=rset.GetColumnCount()
	For i=1:1:colcnt s @gnTask@(0,i)=rset.GetColumnName(i)
	while rset.Next() {	if $I(row)
	   For i=1:1:colcnt s @gnTask@(row,i)=rset.GetData(i)
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="SaveSQL">
<Description><![CDATA[
/*! \brief Procedure query executing and storing reports in the global
<br>\ingroup query
<br>\param ext=1 add saving column and row positions
<br>\return count rows
<br>\example d ##class(apptools.core.sys).SaveSQL("select * from Ens.MessageHeader where id=1461","^logMSW2") */]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SQL,gn="^mtempSQLGN",ext=0</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s st=$$$OK,hr=$h,ts=$$$AppDT(hr)
	s myQuery = ##CLASS(%ResultSet).%New("%DynamicQuery:SQL")
	s st=myQuery.Prepare(SQL)
	i 'st q st
	s st=myQuery.Execute()
	i 'st q st
	s (count)=0
	k @gn
	s ColCount=myQuery.GetColumnCount()
	F i=1:1:ColCount {	s @gn@(0)=$g(@gn@(0))_$lb(myQuery.GetColumnName(i))	
		s @gn@(-1,$ZStrip(myQuery.GetColumnName(i),"<>WCP"))=i //Name = Number
	}
	while (myQuery.Next())	{
		s count=count+1
		if ext s @gn@(-2,$ZStrip(myQuery.Get("Name"),"<>WCP"))=count  ; w "<li>"_myQuery.Get("Name")_" "_count_" "_$zr
		f ii=1:1:ColCount {
			s @gn@(count)=$g(@gn@(count))_$lb(myQuery.GetData(ii))
			}
	}
	s @gn@(-3,"sql")=$lb(SQL)
	s @gn@(-3,"timestamp")=$lb(ts,$$$AppDT($h),##class(apptools.core.type).GetCountSec($h)-##class(apptools.core.type).GetCountSec(hr))
	q count
]]></Implementation>
</Method>

<Method name="ClassExist">
<Description>
Is there such a class
w ##class(apptools.core.sys).ClassExist("Spgz.model.spgz")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>class</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	q:class="" ""
	try {
		s st=$d($$$comClassRaw(class))
	} catch e { s st=$ze }
  q $g(st)
]]></Implementation>
</Method>

<Method name="GlobalList">
<Description>
Global list
d ##class(apptools.core.sys).GlobalList("SAMPLES",.L)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[ns,&list,SystemGlobals=0,Mapped=1]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
/// Returns a list of the Globals in a Cache NameSpace (used for GUI display)<br>
/// <br>
/// <b>Parameters:</b> <br>
/// NameSpace - a Cache namespace. Default is current namespace. <br>
/// Mask - a mask, or comma-separated list of masks, to select globals. Default is "*" for all.<br>
/// SystemGlobals - boolean flag to include system globals in the results. Default is "0".<br>
/// UnavailableDatabases - a returned local array of any databases not currently accessible, i.e. array(name)=status.<br>
/// Index - Internal use only.<br>
/// IgnoreHasData - For faster list of Globals set this to 1 and the HasData column will always be FALSE.<br>
/// Mapped - Return all mapped global nodes when set to 1, the default value of this parameter is 1.
/// <br>
/// Valid masks are as follows:
/// <br>
/// ABC* - All strings starting with ABC<br>
/// A:D - All strings between A and D<br>
/// A:D,Y* - All strings between A and D, and all strings starting with Y<br>
/// A:D,'C* - All strings between A and D, except those starting with C
/// Query NameSpaceList(  NameSpace As %String,  Mask As %String,  SystemGlobals As %Boolean,  ByRef UnavailableDatabases As %String,  Index As %Integer,  IgnoreHasData As %Boolean = 0,  Mapped As %Boolean = 1) As %Query(ROWSPEC = "Name:%String,Location:%String,ResourceName:%String,Permission:%String,Empty:%String,Keep:%String,Collation:%String,PointerBlock:%String,GrowthBlock:%String,HasData:%Boolean,Journal:%String,LockLocation:%String,HasSubscripts:%Boolean") [ SqlProc ]
 set s = ##class(%SQL.Statement).%New()
 do s.%PrepareClassQuery("%SYS.GlobalQuery", "NameSpaceList")
 set r = s.%Execute(ns, "*",SystemGlobals,,,,Mapped)
 ;set $namespace = ns
 while r.%Next() { 
	;w !,r.%Get("Name")
	s list(r.%Get("Name"))=""
 }
]]></Implementation>
</Method>

<Method name="GlobalSize">
<Description>
Global list
d ##class(apptools.core.sys).GlobalList("SAMPLES",.L)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[dir,&list,SystemGlobals=0,FastFlag=1]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
/// Size(Directory As %String, System As %String = "", Mask As %String, SystemGlobals As %Boolean, Index As %Integer, FastFlag As %Boolean)
/// Selects Name As %String, Allocated MB As %Float, Used MB As %Float
 set s = ##class(%SQL.Statement).%New()
 do s.%PrepareClassQuery("%SYS.GlobalQuery", "Size")
 set r = s.%Execute(dir,,"*",SystemGlobals,,FastFlag )
 ;set $namespace = ns
 while r.%Next() { 
	;w !,r.%Get("Name")
	s list(r.%Get("Name"))=""
 }
]]></Implementation>
</Method>

<Method name="GetObj">
<Description>
s a=##class(apptools.core.sys).GetObj("select top 1 * from model.SP where deletedDate is null order by importDate desc") zw a</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Query</FormalSpec>
<Implementation><![CDATA[
	#dim rs As %ResultSet.SQL = ##class(%ResultSet.SQL).%Prepare(Query)
	if 'rs.%Next() q $$$NULLOREF
	q rs
]]></Implementation>
</Method>

<Method name="SqlToDSN">
<Description>
Get a DSN request
w $System.Status.GetErrorText(##class(apptools.core.sys).SqlToDSN("SELECT * FROM xxmv.xx_t359_pzn","OEBS-Daily","^tmMSWq"))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>sql,DSN,result,top=100000</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#dim %JDBCGateway As %Net.Remote.Java.JDBCGateway
	s hr=$h,ts=$$$AppDT(hr)
	kill %objlasterror
	set conn = $system.SQLGateway.GetJDBCConnection(DSN)
	if (conn = "") {
		   	Set sc = $g(%objlasterror, $$$OK)
   			Set sc = $$$ADDSC(sc, $$$ERROR($$$GeneralError, "Cannot get connection for " _ DSN))
			quit sc
	}
	set st = %JDBCGateway.prepareStatement(conn, sql)
	 if %JDBCGateway.wasError()		{
			set sc = $$$ERROR($$$GeneralError, %JDBCGateway.getErrorText())
			quit sc
		}
	set %JDBCGateway.StatementCache(conn) = st
	set query = %JDBCGateway.execQuery(st)
	
	if (query = -1)	{
		;w %JDBCGateway.getErrorText() q 0
		set sc = $$$ERROR($$$GeneralError, %JDBCGateway.getErrorText())
		do %JDBCGateway.removeStatement(conn)
		;if $isObject($g(%JDBCGateway)) do %JDBCGateway.closeAll()
		quit sc
	}
	i $g(result)'="" s gn=result k @gn
	e  s gn="result" 
	
	set columns = %JDBCGateway.getColumnCount(st)
	
	;set pos = 0
	for i=1:1:columns 
	{
	  set name = $ZStrip(%JDBCGateway.getColumnName(st,i),"<>WCP")
	  set size = %JDBCGateway.getColumnDisplaySize(st,i)
	  set Type= %JDBCGateway.getColumnType(st,i)
	  set TypeName= %JDBCGateway.getColumnTypeName(st,i)
	  s @gn@(0,i)=$lb(name,size,Type,TypeName)
	  set @gn@(-1,name)=i //	  ;s @gn@(-1)=$g(@gn@(-1))_$lb($lb(size,Type,TypeName))
	  ;set pos(i) = pos
	  ;set pos = pos + size + 1
	  ;w name,!
	}

	set cnt = 1
	while %JDBCGateway.next(st)
	{
		;write !
		for i=1:1:columns {
			;write "!",%JDBCGateway.getString(st, i) 
			s @gn@(cnt)=$g(@gn@(cnt))_$lb(%JDBCGateway.getString(st, i))
		}
		set cnt = cnt + 1
		q:cnt>top
	}
	;w !,cnt,!
	;if $isObject($g(%JDBCGateway)) do %JDBCGateway.closeAll()
	do %JDBCGateway.removeStatement(conn)
	s @gn=cnt-1
	s @gn@(-3,"sql")=$lb(sql,DSN,top)
	s @gn@(-3,"timestamp")=$lb(ts,$$$AppDT($h),##class(apptools.core.type).GetCountSec($h)-##class(apptools.core.type).GetCountSec(hr))
	quit $$$OK
]]></Implementation>
</Method>

<Method name="SaveGateway">
<Description>
s a=##class(apptools.core.sys).SaveGateway("select * from Sample.Person","Ensemble Samples","_system","") zw a
TODO save to gn</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>sql,pDSN,usr,pwd,result,top=100000</FormalSpec>
<Implementation><![CDATA[
 #include %occInclude
 	s hr=$h,ts=$$$AppDT(hr)
 	//Create new Gateway connection object
 	set gc=##class(%SQLGatewayConnection).%New()
 	If gc=$$$NULLOREF quit $$$ERROR($$$GeneralError,"Cannot create %SQLGatewayConnection.")
 		  
 	//Make connection to target DSN
 	set sc=gc.Connect(pDSN,usr,pwd,0) 
 	If $$$ISERR(sc) quit sc
 	if gc.ConnectionHandle="" quit $$$ERROR($$$GeneralError,"Connection failed")
 		  
 	set sc=gc.AllocateStatement(.hstmt) 
 	if $$$ISERR(sc) quit sc
		  
 	//Prepare statement for execution
 	set sc=gc.Prepare(hstmt,sql) 
 	if $$$ISERR(sc) quit sc
 	//Execute statement
 	set sc=gc.Execute(hstmt)
 	if $$$ISERR(sc) quit sc
 	//Get list of columns returned by query
 	set sc=gc.DescribeColumns(hstmt, .columnlist) 
 	if $$$ISERR(sc) quit sc
 	
 	if $g(result)'="" s gn=result k @gn
	else  s gn="result" 
 	//display column headers delimited by ":"
 	set numcols=$listlength(columnlist)-1  //get number of columns
 	for colnum=2:1:numcols+1 {
 		    ;Write $listget($listget(columnlist,colnum),1),":"
 		    set name=$listget($listget(columnlist,colnum),1)
 		    set @gn@(0,colnum-1)=$lb(name)
	  		set @gn@(-1,name)=colnum-1 
 	  		}
 	;write !
 	 
 	//Return first 200 rows	  
 	set sc=gc.Fetch(hstmt)
 	if $$$ISERR(sc) quit sc
 	set rownum=1
 	while((gc.sqlcode'=100) && (rownum<=top)) {
 	      	for ii=1:1:numcols {
 		      	set sc=gc.GetData(hstmt, ii, 1, .val)
 		      	;w " "_val
 		      	set @gn@(rownum)=$g(@gn@(rownum))_$lb(val)
 		      	if $$$ISERR(sc) break
 	      	}
 	      	set rownum=rownum+1
 	 		;write !
 	 		set sc=gc.Fetch(hstmt)
 			if $$$ISERR(sc) break
 
 	  		}
 	    
 	  //Close cursor and then disconnect
 	set sc=gc.CloseCursor(hstmt)
 	if $$$ISERR(sc) quit sc
 	set sc=gc.Disconnect()
	set @gn=rownum-1
	set @gn@(-3,"sql")=$lb(sql,pDSN,top,usr,pwd)
	set @gn@(-3,"timestamp")=$lb(ts,$$$AppDT($h),##class(apptools.core.type).GetCountSec($h)-##class(apptools.core.type).GetCountSec(hr))
 	Quit sc
]]></Implementation>
</Method>

<Method name="GetFullName">
<Description>
Sample  write ##class(apptools.core.sys).GetFullName("superuser")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>login</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  new $namespace
  set $namespace="%SYS"
  try {
	if ##class(Security.Users).Exists(login,.User,.Status) {
			if $isobject(User) {
				s fullName=User.FullName 
			}
		}
  } catch e {}
  quit $GET(fullName)
]]></Implementation>
</Method>

<Method name="GetRoles">
<Description>
Sample  w ##class(apptools.core.sys).GetRoles(mask,.roles)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[mask="",&list]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  NEW $NAMESPACE
  SET $NAMESPACE = "%SYS"
  set mask=$zconvert(mask,"L")
  set sql="select NameLowerCase,Description,Name FROM Security.Roles"
  if mask["," { set mask=$replace($ZStrip(mask,"<>W"),",","','")
  	set sql=sql_" where ID in ('"_mask_"')"
  } 
  elseif mask'="" {
	  set sql=sql_" where NameLowerCase like '%"_mask_"%'"
  }
	set result=##CLASS(%ResultSet).%New("%DynamicQuery:SQL")
	set tSC=result.Prepare(sql)
	set:tSC tSC=result.Execute()
	if '$$$ISOK(tSC) {
	 	QUIT tSC
	}
	else {
		while result.Next() {
			set list(result.Data("NameLowerCase"))=$lb(result.Data("Name"),result.Data("Description"))
		}
	}
	quit $$$OK
]]></Implementation>
</Method>

<Method name="GetUsers">
<Description>
Get system users
kill users set ext(1)=" or FullName like '%Manager%'" w ##class(apptools.core.sys).GetUsers("super",.users,.sql,.ext) w !,sql,! zw users 
kill users w ##class(apptools.core.sys).GetUsers("sup%,adm%",.users,.sql) w !,sql,! zw users 
kill users w ##class(apptools.core.sys).GetUsers("sup%,admin",.users,.sql) w !,sql,! zw users </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[mask="",&list,&sql,&ext]]></FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
  NEW $NAMESPACE
  SET $NAMESPACE = "%SYS"
  set mask=$zconvert(mask,"L")
  set sql="select NameLowerCase,FullName,Comment,Roles,EmailAddress,Enabled FROM Security.Users where (1=1)"
  if mask[",",mask'["%" { set mask=$replace($ZStrip(mask,"<>W"),",","','")
  	set sql=sql_" and NameLowerCase in ('"_mask_"')"
  } 
  elseif mask["%" {
	  set sql=sql_" and ( "
	  for i=1:1:$l(mask,",") {
		if $p(mask,",",i)="" continue
		if i>1 set sql=sql_" or "
	  	if $p(mask,",",i)["%" set sql=sql_" NameLowerCase like '"_$p(mask,",",i)_"'"
	  	else  set sql=sql_" NameLowerCase = '"_$p(mask,",",i)_"'"
	  }
	  set sql=sql_" ) "
  }
  elseif mask'="" {
	  set sql=sql_" and NameLowerCase like '%"_mask_"%'"
  }
  if $DATA(ext) {
	  set i=""
	  for { set i=$order(ext(i),1,data) quit:i=""
	  	set sql=sql_" "_data
	  }
  }
	set result=##CLASS(%ResultSet).%New("%DynamicQuery:SQL")
	set tSC=result.Prepare(sql)
	set:tSC tSC=result.Execute()
	if '$$$ISOK(tSC) {
	 	QUIT tSC
	}
	else {
		while result.Next() {
			set list(result.Data("NameLowerCase"))=$lb(result.Data("FullName"),result.Data("Comment"),result.Data("Roles"),result.Data("EmailAddress"),result.Data("Enabled"))
		}
	}
	quit $$$OK
]]></Implementation>
</Method>

<Method name="Export">
<Description>
Delete and Export the table in oeBS when the match is in Description
Sample d ##class(apptools.core.sys).Export("OEBS",.msg,"Mvk.model.Characteristic")
s class="Spgz.model.PP.Files" d ##class(apptools.core.sys).Export("OEBS",.msg,class,1,"select * from "_##class(apptools.core.type).GetTableName(class)_" where FileID='127'")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>jdbc="OEBS",msg,class,NoDel=0,sql="",write=0</FormalSpec>
<Implementation><![CDATA[
	#define addQuote(%s) $replace(%s,"'","''")
	d ##class(apptools.core.LogInfoPane).GetClassDef(class,"",.out,0)
	;zw out
	q:'$d(out) 1
	s gn="^||tmpExp"_$p(class,".",*)  ;^||
	kill @gn	
	s:sql="" sql="select * from "_##class(apptools.core.type).GetTableName(class)
	s st=##class(apptools.core.sys).SaveSQL(sql,gn)
	i 'st q st
	s rowcount=$o(@gn@(""),-1) 
	w:write !,$$$FormatText($$$aText("On request %1 found %2 records",""),sql,rowcount)_" "_gn_" "_$System.Status.GetErrorText(st)
	i 'rowcount w:write !,$$$aText("there is nothing to export","") q 1

	s tab=$g(out("Parameters","OEBSTAB","Default"))
	w:write !,tab
	if 'NoDel { ;do not delete the table
		s del="delete "_tab
		s gnDel="^||tmpExpDel"
		s st=##class(apptools.core.sys).SqlToDSN(del,jdbc,gnDel)
		;i 'st s err=$System.Status.GetErrorText(st) q st
		kill @gnDel
	}
	i write { ;check the types in oeBS
		s sqltest="select * from "_tab_" where 1=0"
		s gnD="^||tmpExpD"
		s st=##class(apptools.core.sys).SqlToDSN(sqltest,jdbc,gnD)
		zw @gnD
	}
	s f="" ;Create an array of unequivocal conformity between oeBS and instrumentation fields
	f ff=1:1 { s f=$o(out("Properties",f)) q:f=""
		i $e(out("Properties",f,"Description"))="=" {
			w:write !,ff_". "_$$$aText("field","")_" ",f
			s desc=$p(out("Properties",f,"Description"),";",1)
			w:write " "_$$$aText("review","")_" ",desc
			s oefield=$p($p(desc,"=",2)," ")
			s oetype=$ZStrip($p(desc," ",2,*),"<>WCP")
			
			if " "[oefield {	s oefield=f	}
			if oetype="" {	s oetype="NUMBER"	}
			if $zconvert(oefield,"L")["date" {	s oetype="DATE"	}
			
			i write {w " -> "_oefield_" "_oetype_" "
			 s num=$g(@gnD@(-1,$zconvert(oefield,"U")))
			 if 'num {w $$$aText("not found","")_" "_$zconvert(oefield,"U")}
			 else { s typ=$lg(@gnD@(0,num),4) w typ
			 	i oetype'[typ w $$$aText("not the same","")
			 }
			}
			s array(f)=oefield
			s array(f,"type")=oetype
		}
	}
	i '$d(array) w !,$$$aText("Not configured-to-one correspondence","") q 1
	s f="" ;A new pass through the array, sorting may differ
	s pattIns="insert into "_tab_"("
	f { s f=$o(array(f)) q:f=""
		s pattIns=pattIns_array(f)_$s($o(array(f))="":"",1:",")_" "
	}	
	s pattIns=pattIns_") values "
	;w !,pattIns 
	s ins="",coun=0,gnIns="^||tmpExpIns"
	s chank=2000 ;1000 batch of transmission records
	m fields=@gn@(-1)
	for row=1:1:rowcount { 
		s coun=coun+1
		
		s f="" ;Get the values to be written
		s values="("
		f { s f=$o(array(f)) q:f=""
			 s val=$$$addQuote($lg(@gn@(row),fields(f))) 
			 if array(f,"type")["DATE" {
				 s val="TO_DATE('"_val_"','YYYY-MM-DD HH24:MI:SS')"
			 } else {
				 s val="'"_val_"'"
			 }
			s values=values_val_$s($o(array(f))="":"",1:",")_" "
		}	
		s ins=ins_pattIns_values_");"		
		;w:row=1 !,ins ;q:row=1
		i '(coun#chank) {
			w:write !,ins
			s st=##class(apptools.core.sys).SqlToDSN("BEGIN "_ins_" COMMIT; END;",jdbc,gnIns)
			s ins=""
		}
	}
	;q 1
	i ins'="" w:write !,ins s st=##class(apptools.core.sys).SqlToDSN("BEGIN "_ins_" COMMIT; END;",jdbc,gnIns)
	s st=##class(apptools.core.sys).SqlToDSN("select count(*) from "_tab,jdbc,gnIns)
	i $d(%objlasterror) w:write !,$System.Status.GetErrorText(%objlasterror)
	s inscount=$lg($g(@gnIns@(1)),1) ;from the first record to take the first field
	s msg=$$$FormatText($$$aText("Unloaded %1 from %2",""),inscount,rowcount)
	k @gnIns,@gn
	w:write !,msg
	q $$$OK
]]></Implementation>
</Method>

<Method name="DismountListDB">
<Description>
zn "app" w $System.Status.GetErrorText(##class(apptools.core.sys).DismountListDB("DOJO"))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Database,write=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s st=##class(apptools.core.sys).DismountDB(Database)
	if st {
		s st1=##class(apptools.core.sys).DismountDB(Database_"ENSTEMP")
		if 'st1 q st1
		s st2=##class(apptools.core.sys).DismountDB(Database_"SECONDARY")
		if st2 q st2
	} else { q st }
	q $$$OK
]]></Implementation>
</Method>

<Method name="DismountDB">
<Description>
w $System.Status.GetErrorText(##class(apptools.core.sys).DismountDB("ASURPROD"))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Database</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $namespace
	zn "%sys"
	s st=$$$OK
	If ##Class(Config.Databases).Get(Database,.Properties) {
		Set Directory = $G(Properties("Directory"))
  		Set st = ##class(SYS.Database).DismountDatabase(Directory)
	}
	q st
]]></Implementation>
</Method>

<Method name="MountDB">
<Description>
zn "app" w ##class(apptools.core.sys).MountDB("DOJO")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Database</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $namespace
	zn "%sys"
	If ##Class(Config.Databases).Get(Database,.Properties) {
		Set Directory = $G(Properties("Directory"))
  		q ##class(SYS.Database).MountDatabase(Directory)
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="MountListDB">
<Description>
zn "app" w $System.Status.GetErrorText(##class(apptools.core.sys).MountListDB("DOJO"))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Database</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s st=##class(apptools.core.sys).MountDB(Database)
	if st {
		s st1=##class(apptools.core.sys).MountDB(Database_"ENSTEMP")
		if 'st1 q st1
		s st2=##class(apptools.core.sys).MountDB(Database_"SECONDARY")
		if st2 q st2
	} else { q st }
	q $$$OK
]]></Implementation>
</Method>

<Method name="GetDirDB">
<Description>
write $System.Status.GetErrorText(##class(apptools.core.sys).GetDirDB("APPTOOLS",.d,.dir,0))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[nspace,&db,&dirlist,IRIS=1]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $namespace
	zn "%sys"
	set Status=##Class(Config.Namespaces).Get(nspace,.p)
	Q:'Status Status
	set db="",dirlist=""
	for { set db=$o(p(db)) q:db=""
		if 'IRIS,p(db)["IRIS" continue
		set db(p(db))=""
	}
	s st=$$$OK
	for { set db=$o(db(db)) quit:db=""
		If ##Class(Config.Databases).Get(db,.Properties) {
  			Set Directory = $G(Properties("Directory"))
  			set dirlist=dirlist_$lb(Directory)
  			set db(db)=Directory
		} Else {
			set err="Database " _ db _ " does not exist" 
			Set st = $$$ERROR($$$GeneralError,err)
			q
		}
	}
	quit st
]]></Implementation>
</Method>

<Method name="Integrity">
<Description>
write $System.Status.GetErrorText(##class(apptools.core.sys).Integrity("APPTOOLS,APP,USER"))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>nspace,dir="/backup/iris-backup/integrity/",adddir=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	new $namespace
	zn "%sys"
	$$$TOE(st, ##class(%File).CreateDirectoryChain(dir))
	set result=""
	for i=1:1:$L(nspace,",") {
		s ns=$P(nspace,",",i)
		continue:ns=""
		s st=##class(apptools.core.sys).GetDirDB(ns,.d,,0)
	}
	set d=""
	for { set d=$o(d(d)) q:d=""
		set result=result_$lb($g(d(d)))
	}
	if adddir'="" set result=result_adddir
	set filename=dir_$zd($h,3)_"-"_nspace_".log"
	write !,filename zw result
	
	quit $$Silent^Integrity(filename,result,0)
]]></Implementation>
</Method>
</Class>


<Class name="apptools.core.type">
<Description>
Utility types</Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65871,33598.386736</TimeChanged>
<TimeCreated>65607,76511.38127</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Method name="Date3">
<Description>
To return the date in the format 3 
apptools.core.type_Date3(DateFrom)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>h:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<SqlProc>1</SqlProc>
<Implementation><![CDATA[	return $zd(h,3)
]]></Implementation>
</Method>

<Method name="GetYYYYMM">
<Description>
To count the number of seconds to YYYY-MM-DD HH:MM:SS or the $HOROLOG
w ##class(apptools.core.type).GetYYYYMM("2018-07-06 08:14:47",-1)
w ##class(apptools.core.type).GetYYYYMM($h,-1)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>h,plusMM=0</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	i h["-" s h=..GetHorYYYYMMDD(h)
	s MM=$p($zd(+h,3),"-",2)+plusMM,YYYY=$p($zd(+h,3),"-",1)
	i MM<1 s MM=12+MM,YYYY=YYYY-1 ;running for less than 12 plusMM
	i MM>12 s MM=MM-12,YYYY=YYYY+1
	i $l(MM)=1 s MM="0"_MM
	q YYYY_"-"_MM
]]></Implementation>
</Method>

<Method name="GetCountSec">
<Description>
To count the number of seconds to YYYY-MM-DD HH:MM:SS or the $HOROLOG
w ##class(apptools.core.type).GetCountSec("2018-07-06 08:14:47")
w ##class(apptools.core.type).GetCountSec($h)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>h</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	i h["-" s h=..GetHorYYYYMMDD(h)
	i h'["," q ""
	q $p(h,",",1)*86400+$p(h,",",2)
]]></Implementation>
</Method>

<Method name="GetTextMonth">
<Description>
w ##class(apptools.core.type).GetTextMonth("05")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>mm</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	q $s(+mm="1":$$$aText("January",""),+mm="2":$$$aText("February",""),+mm="3":$$$aText("March",""),+mm="4":$$$aText("April",""),+mm="5":$$$aText("may",""),+mm="6":$$$aText("June",""),+mm="7":$$$aText("July",""),+mm="8":$$$aText("August",""),+mm="9":$$$aText("September",""),+mm="10":$$$aText("October",""),+mm="11":$$$aText("November",""),1:$$$aText("December",""))
]]></Implementation>
</Method>

<Method name="GetMonth">
<Description>
To month
w ##class(apptools.core.type).GetMonth($h)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>h</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	q $p($zd(h,3),"-",2)
]]></Implementation>
</Method>

<Method name="GetHorYYYYMMDD">
<Description>
Translate YYYY-MM-DD HH:MM:SS in $HOROLOG
w ##class(apptools.core.type).GetHorYYYYMMDD("2018-07-06 08:14:47")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>dt</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	try{ 
		s d=$zdh($p(dt," "),3)
		s c=$zth($p(dt," ",2),1)
		s res=d_","_c
	}
	catch e { s res="" }
	q $g(res)
]]></Implementation>
</Method>

<Method name="GetValidZD">
<Description>
To check the validity and display the date
w ##class(apptools.core.type).GetValidZD(+$h)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>hr</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	try{ s res=$tr($zd(hr,4),"/",".") }
	catch e { s res="" }
	q res
]]></Implementation>
</Method>

<Method name="GetYear">
<Description>
To year format 2018
w ##class(apptools.core.type).GetYear($h)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>h</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	q $p($zd(h,3),"-",1)
]]></Implementation>
</Method>

<Method name="GetDateTime">
<Description>
To get a date in the format 2018-04-03T16:40:30
w ##class(apptools.core.type).GetDateTime($h)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>h,delim="T"</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	q $zd(h,3)_delim_##class(apptools.core.type).GetValidZT(h)
]]></Implementation>
</Method>

<Method name="GetValidZT">
<Description>
To check the validity and display the time
w ##class(apptools.core.type).GetValidZT($h)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>hr</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	try{ s res=$zt(+$p(hr,",",2),1) }
	catch e { s res="" }
	q res
]]></Implementation>
</Method>

<Method name="getDDMMYY">
<Description>
Translate the date to the format DD.MM.YY
w ##class(apptools.core.type).getDDMMYY("2016-05-05")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pStringDate:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	try {
		i pStringDate?1n.n s pStringDate=$zd(pStringDate,3)
		i pStringDate["." s date=pStringDate s:$p(date,".",3)?4n date=$p(date,".",1,2)_"."_$e($p(date,".",3),3,4)
		i pStringDate["-" s date=$p(pStringDate,"-",3)_"."_$p(pStringDate,"-",2)_"."_$e($p(pStringDate,"-",1),3,4)
		i pStringDate["/" s date=$p(pStringDate,"/",2)_"."_$p(pStringDate,"/",1)_"."_$e($p(pStringDate,"/",3),3,4)
	} catch e {}
	q $g(date)
]]></Implementation>
</Method>

<Method name="getDDMMYYYY">
<Description>
Translate the date to the format DD.MM.YYYY
w ##class(apptools.core.type).getDDMMYYYY("2016-05-05")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pStringDate:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	try {
		i pStringDate?1n.n s pStringDate=$zd(pStringDate,3)
		i pStringDate["." s date=pStringDate
		i pStringDate["-" s date=$p(pStringDate,"-",3)_"."_$p(pStringDate,"-",2)_"."_$p(pStringDate,"-",1)
		i pStringDate["/" s date=$p(pStringDate,"/",2)_"."_$p(pStringDate,"/",1)_"."_$p(pStringDate,"/",3)
	} catch e {}
	q $g(date)
]]></Implementation>
</Method>

<Method name="GetInpretDate">
<Description>
Translate the date to the format YYYY-MM-DD FORMAT=3 passing a formula of the type "CurrentDay+1"
w ##class(apptools.core.type).GetInpretDate("CurrentDay+1","12:00")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pStringDate:%String,time=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	try {
		i pStringDate["CurrentDay" s pStringDate=$replace(pStringDate,"CurrentDay","$h")
		i pStringDate["$h"||(pStringDate["$H") {
			s %Date=""
			x "s %Date="_pStringDate
			s pStringDate=%Date
		}
		i pStringDate?1n.n s date=$zd(pStringDate,3) q
		i pStringDate["." s date=$p(pStringDate,".",3)_"-"_$p(pStringDate,".",2)_"-"_$p(pStringDate,".",1)
		i pStringDate["-" s date=pStringDate q
		i pStringDate["/" s date=..AddZerro($p(pStringDate,"/",3))_"-"_..AddZerro($p(pStringDate,"/",1))_"-"_..AddZerro($p(pStringDate,"/",2))
	} catch e {}
	q $g(date)_$s($g(date)'=""&&(time'=""):" "_time,1:"")
]]></Implementation>
</Method>

<Method name="getYYYYMMDD">
<Description>
Translate the date to the format YYYY-MM-DD FORMAT=3
w ##class(apptools.core.type).getYYYYMMDD(+$h)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pStringDate:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	try {
		i pStringDate?1n.n s date=$zd(pStringDate,3) q
		i pStringDate["." s date=$p(pStringDate,".",3)_"-"_$p(pStringDate,".",2)_"-"_$p(pStringDate,".",1)
		i pStringDate["-" s date=pStringDate q
		i pStringDate["/" s date=..AddZerro($p(pStringDate,"/",3))_"-"_..AddZerro($p(pStringDate,"/",1))_"-"_..AddZerro($p(pStringDate,"/",2))
	} catch e {}
	q $g(date)
]]></Implementation>
</Method>

<Method name="AddZerro">
<ClassMethod>1</ClassMethod>
<FormalSpec>m:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	if $l(m)=1 q "0"_m
	q m
]]></Implementation>
</Method>

<Method name="InterpretCurrentDay">
<Description><![CDATA[
Interpreterpath string with the current date type
Str= DateFrom=(CurrentDay-2)&DateTo=(CurrentDay-1)
The result of the computed expression value "added?DateFrom=06.06.2018&DateTo=07.06.2018"
w ##class(apptools.core.type).InterpretCurrentDay("added?DateFrom=(CurrentDay-2)&DateTo=(CurrentDay-1)",.res)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Str:%String,Result:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#dim tSC As %Status = $$$OK
	#dim e As %Exception.AbstractException
	
	s exp=$p(Str,"?",2)
	q:exp="" "0"
	s exp="s "_$replace(exp,"CurrentDay",+$h)
	s exp=$replace(exp,"&DateTo",",%tempTo")
	s exp=$replace(exp,"DateFrom","%tempFrom")
	try {
		x exp
		s Result=$p(Str,"?",1)_"?DateFrom="_$tr($zd(%tempFrom,4),"/",".")_"&DateTo="_$tr($zd(%tempTo,4),"/",".")
		k %tempFrom,%tempTo
	} Catch e {
		Set tSC=e.AsStatus()
	}
	q tSC
]]></Implementation>
</Method>

<Method name="ParseURL">
<Description><![CDATA[
Parse a string of CGI variable 
w ##class(apptools.core.type).ParseURL("aaa=111&bbb=222")]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[str:%String,&out,del="&"]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	f i=1:1:$l(str,del) {
		continue:$p(str,del,i)=""
		continue:$p($p(str,del,i),"=")=""
		s out($p($p(str,del,i),"="))=$p($p(str,del,i),"=",2)
	}
]]></Implementation>
</Method>

<Method name="UploadFilesJS">
<Description>
Output the js code to select a file in a new window and download it to the server
##class(apptools.core.type).UploadFilesJS(%id)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>id,%id</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s onclick="win=window.open('apptools.core.UploadCSP.cls?idreturn="_id_"&ServerDirPath="_$zconvert($g(%id("filesStore")),"O","URL")_"', 'winupload', 'location=no,left=200,top=300,width=800,height=300,scrollbars=no,status=no,toolbar=no,menubar=no');"
	q $$$appButton("appButtonUpload"_id,"onclick="""_$g(onclick)_"""",$$$aText("Download file",""))
]]></Implementation>
</Method>

<Method name="GetTableName">
<Description>
To obtain the table name from the Class
w ##class(apptools.core.type).GetTableName("apptools.sss.user")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>SelectClass</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set (tab,table)=$p(SelectClass,".",*)
	//If the table name is the key words, frame it in quotation marks
	set:$SYSTEM.SQL.IsReservedWord(table) table = """"_table_""""
	set tab=$tr($p(SelectClass,"."_tab,1),".","_")_"."_table
	q tab
]]></Implementation>
</Method>

<Method name="GetValidNumeric">
<Description>
The number to the normal mind
w ##class(apptools.core.type).GetValidNumeric("14,650.00")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>price</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	i price[","&&(price[".") s price=$tr(price,",")
	i price["," s price=$tr(price,",",".")
	q $tr(price," "_$c(160)) ;remove the spaces
]]></Implementation>
</Method>
</Class>


<Class name="apptools.lte.adminStatic">
<Description>
https://adminlte.io</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>apptools.lte.adminTabs</Super>
<TimeChanged>65855,32810.102631</TimeChanged>
<TimeCreated>64127,58953.319558</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Method name="GetMain">
<Description><![CDATA[
http://localhost:52773/apptoolsrest/a/permiss&autoload=snapshot
http://localhost:52773/apptoolsrest/a/infochest
http://localhost:52773/apptoolsrest/a/smarthome&autoload=snapshot&namespace=USER]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>parameter,class=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set app=$p(parameter,"&")
	if (app["apptools.core.UploadCSP") quit ..GetAppCSP(app)
	if (app["apptools.core.DownloadCSP") quit ..DownLoadFile(app)
	
	set:class="" class="apptools.lte."_app
	set par("input-class=")=class
	;if '##class(apptools.core.sys).ClassExist(class) set class="apptools.lte.page404"
	set cgivar="&"_$p(parameter,"&",2,*)
	set ns=##class(apptools.core.Action).GetParam(,"namespace",cgivar)
	if ns'="" set $namespace=ns
	set par("input-cgivar")=cgivar
    set par("=path=")="/apptools/"
    set par("=Message-default=")=""
	set h=##class(apptools.core.rest).getStatic("apptools.lte.adminStatic:html")
    set st=$classmethod(class,"MainParameter",.h,.par) 

	d ##class(apptools.core.rest).WriteStatic("html",,,,,h)
	q $$$OK
]]></Implementation>
</Method>

<Method name="DownLoadFile">
<ClassMethod>1</ClassMethod>
<FormalSpec>app</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do $classmethod("apptools.core.DownloadCSP","OnPreHTTP",app)
	do $classmethod("apptools.core.DownloadCSP","OnPage",app)
	q $$$OK
]]></Implementation>
</Method>

<Method name="GetAppCSP">
<ClassMethod>1</ClassMethod>
<FormalSpec>app</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	d ##class(apptools.core.rest).WriteStatic("html",,,$p(app,".",1,*-1))
	q $$$OK
]]></Implementation>
</Method>

<XData name="AddStyle">
<Description>
s h=##class(apptools.core.rest).getStatic("apptools.lte.adminStatic:AddStyle") w !,h,!</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
<style type="text/css">
 
 	/* https://habr.com/ru/post/453744/
table {
  overflow: hidden;
}

tr:hover {
  background-color: #ffa;
}

td, th {
  position: relative;
}
td:hover::after,
th:hover::after {
  content: "";
  position: absolute;
  background-color: #ffa;
  left: 0;
  top: -5000px;
  height: 10000px;
  width: 100%;
  z-index: -1;
}
*/

 
 /*
	div {
  max-width: 400px;
  max-height: 150px;
  overflow: scroll;
}
*/

/* Use position: sticky to have it stick to the edge
 * and top, right, or left to choose which edge to stick to: */

thead th {
  position: -webkit-sticky; /* for Safari */
  position: sticky;
  top: 0;
}

tbody th {
  position: -webkit-sticky; /* for Safari */
  position: sticky;
  left: 0;
}

/* To have the header in the first column stick to the left: */

thead th:first-child {
  left: 0;
  z-index: 1;
}


/* Just to display it nicely: */

thead th {
  background: #E7EBF9;
  color: blue;

}

tbody th {
  background: #E7EBF9;
  color: blue;

}

table {
  border-radius: 10px; 
  border: 1px solid #72a7cf
}

td,
th {
  padding: 0.5em;
}

.bigbox { 
height: 20px; width: 20px 
}
 
</style>
]]></Data>
</XData>

<XData name="AddJS">
<Description>
s h=##class(apptools.core.rest).getStatic("apptools.lte.adminStatic:AddJS") w !,h,!</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
<script language='javascript'>
$('#tWHAT').keydown(function (e) {
  	if (e.ctrlKey && e.keyCode == 13) {
    // Ctrl-Enter pressed
    document.getElementById('WHAT').value=document.getElementById('tWHAT').value;
    document.forms['loginfo'].submit();
   }
});
// 
function ActionJs(FormId,ResultId,appClass,appMethod,appPar,appNsp){
	var $data =[];
	//;var appNspace ='#(ns)#';
	//;if (!appNsp) {appNsp =appNspace;}
	//var classname ='#(class)#';
	//if (!appClass) var appClass =classname;
	if (FormId) {
		$data = $('#'+FormId).serializeArray(); 
		//alert(FormId);
	}
	//Add to array
	$data.push({name:"appClass",value:appClass});
	$data.push({name:"appMethod",value:appMethod});
	$data.push({name:"appNsp",value:appNsp});
	$data.push({name:"appPar",value:appPar});
	$.ajax({
	  url: 'apptools.core.Action.cls',
	  type: 'post',
	  data: $data,
	  crossDomain: true,
	  success: function(result) {
	  if (ResultId) {$('#'+ResultId).html(result);}
	  }
	});
}
// Collect data from the form, serialize, send to the server, execute and paste the result into the container
// FormId - source form identifier <form id='FormInpur'>...</form>
// ResultId -  identifier of the target container <div id='ResultDiv'>...</div>
// appAct -  parameters for executing code on the server
//     namespace:classname:methodname:par1=val1&par2=val2...&parX-valX
function AppAct(FormId,ResultId,appAct){
	var $data =[]; //json array initialization
	$data.push({name:"params",value:{}});
	if (FormId) { //if the form id is specified, then we collect all input elements from it
		// elements must have an id attribute matching the name.
		// For example <input type='text' id='elem2' name='elem2'>
		$data = $('#'+FormId).serializeArray();
	}
	$data.push({name:"appAct",value:appAct}); //add execution parameters that will be parsed in apptools.core.Action.cls
	//if (jsonExt) {
	//  if there is additional json, then add it
	//	$data.push({"jsonExt":jsonExt});
	//	}
	//var url1='apptools.core.Action.cls';	if (url2) { url1=url2;}
	//execute an asynchronous request to the apptools.core.Action.cls
	$.ajax({  
	  url: 'apptools.core.Action.cls',
	  type: 'post',
	  data: $data,
	  success: function(result) {  // if successful
	  	// if the resulting container is specified, put everything sent from the server into it
	  	if (ResultId) {$('#'+ResultId).html(result);}
	  }
	});
}
// Collect data from the form, serialize, send to the server, execute and paste the result into the container
// FormId - source form identifier <form id='FormInpur'>...</form>
// ResultId -  identifier of the target container <div id='ResultDiv'>...</div>
// appAct -  parameters for executing code on the server
//     namespace:classname:methodname:par1=val1&par2=val2...&parX-valX
//     namespace:routine:label:par1=val1&par2=val2...&parX-valX
function AppRpc(FormId,ResultId,appAct,url,json){
	var data ={"jsonrpc":"2.0",params:{}};
	
	if (FormId) {
		data.params.formId=FormId;
		data.params.form=JSON.stringify($('#'+FormId).serializeArray());
	}
	if (json) {
		data.params.json = json;
	}

	data.method=appAct;
	$.ajax({
	  url: url,
	  type: 'post',
	  contentType:'application/json; charset=UTF-8',
	  dataType:'html', 
	  crossDomain: true,
	  data: JSON.stringify(data),
	  success: function(result) {
	  if (ResultId) {
		  $('#'+ResultId).html(result);
	  }
	  else {
		  return result;
	  	}
	  }
	});
}

// The function of opening the dialog box
function WinOpen(ns,classname,met,el,title,rest) {
	
	var titlename="Method "+met+" parameter "+decodeURIComponent(el);
	if (title) {titlename=title;}

	//$("#dialogContent").load("apptools.core.Action.cls","appClass="+classname+"&appMethod="+met+"&appNsp="+ns+"&appPar="+el);
	
	if (rest) {AppRpc('anyForm','dialogContent',ns+':'+classname+':'+met+':'+decodeURIComponent(el),rest);}
	else { ActionJs('anyForm',"dialogContent",classname,met,el,ns);}
	$( "#dialog" ).dialog({
		modal: true, 
        title: titlename, 
        autoOpen: true, 
        width:window.innerWidth-200, 
        height:window.innerHeight-300,
		position: { my: 'top', at: 'top+150' },
		buttons: [
		{
			text: "Cancel",
			click: function() {
				$( this ).dialog( "close" );
			}
		}
		]
		});
	try { event.preventDefault();
	} catch (e){};
}
</script>
]]></Data>
</XData>

<XData name="html">
<Description>
s h=##class(apptools.core.rest).getStatic("apptools.Uikit.AdminLTE:html") w !,h,!</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>=titleAppToolsadmin=</title>

  <!-- Google Font: Source Sans Pro -->
  <!--<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">-->
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="=path=adminlte/plugins/fontawesome-free/css/all.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="=path=adminlte/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="=path=adminlte/dist/css/adminlte.min.css">
  <link rel="stylesheet" href="=path=jqueryui/jquery-ui.css">
  <!--=LinkIcon=-->
  <!--=Links=-->
</head>
<body class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
<div class="wrapper">

  <!-- Preloader -->
  <div class="preloader flex-column justify-content-center align-items-center">
    <img class="animation__wobble" src="=path=adminlte/dist/img/ApptoolsLogo.png" alt="ApptoolLogo" height="60" width="60">
  </div>

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-dark">
    <!-- Left navbar links -->
	
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <!--<li class="nav-item d-none d-sm-inline-block">
        <a href="#" onclick="document.location.reload();" class="nav-link">Home</a>
      </li>-->
    </ul>

    <!-- Right navbar links -->
	<ul class="navbar-nav ml-auto">
      <!-- =Navbar Search= -->
      <li class="nav-item">
        <div class="navbar-search-block">
         
            <div class="input-group input-group-sm">
              <input class="form-control" placeholder="Search" id="MainSearch" aria-label="Search" >
              <div class="input-group-append">
                <button class="btn btn-navbar" type="button" id="MainSearchRun" onclick="AppRpc('','MainHidden','%SYS:apptools.lte.adminTabs:ShowTab:&appPar=Search&Searchstr='+$('#MainSearch').val(),'/apptoolsrest/post-json');" >
                  <i class="fas fa-search"></i>
                </button>
                <button class="btn btn-navbar" type="button" data-widget="navbar-search" onclick="$('#MainSearch').val('');">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
         
        </div>
      </li>

      <!-- Notifications Dropdown Menu -->
	  <!-- =Item Dropdown Menu= -->

      <li class="nav-item">
        <a class="nav-link" data-widget="fullscreen" href="#" role="button">
          <i class="fas fa-expand-arrows-alt"></i>
        </a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="#" onclick="document.location.reload();" class="brand-link">
      <img src="=Logo-image=" alt="ApptoolsLogo" class="brand-image img-circle elevation-3" style="opacity: .8">
      <span class="brand-text font-weight-light">=Brand-Text=</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      
	  <!-- Sidebar user panel (optional) -->
	  <!--
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <img src="dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
        </div>
        <div class="info">
          <a href="#" class="d-block">Alexander Pierce</a>
        </div>
      </div>
		-->

      <!-- SidebarSearch Form -->
	  <div class="form-inline">
        <div class="input-group" data-widget="sidebar-search">
          <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
          <div class="input-group-append">
            <button class="btn btn-sidebar">
              <i class="fas fa-search fa-fw"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <!-- =Sidebar Menu= -->
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <!-- Info boxes -->
       <div class="row">
       
       <!-- Uikit Tab start -->
	    <div class="uk-width-1-1 uk-margin-left uk-margin-right " style='overflow: auto;' id="mainApp" >
			<ul id='tabMenu' class="uk-tab uk-tab-grid uk-tab-top" data-uk-tab="{connect:'#tabList', animation: 'fade'}">
				<li id='t1' class="uk-active"><a href="#"><font color=Lightsteelblue>=Tab=</font></a></li>
			</ul>
			<ul id="tabList" class="uk-switcher uk-margin uk-tab-content">
				<li id='ta1' >
			 	<div class="uk-alert-warning" uk-alert>
					<p>=Message-default=</p>
			 	</div>
				</li>
			</ul>
		</div>
		<!-- Uikit Tab start -->
	
   
      </div>
       <!-- /.row -->
		</div><!--/. container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <strong>Applications Tools for Admin.</strong>
   
    <div class="float-right d-none d-sm-inline-block">
      <!--<b>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a> All rights reserved. Version</b> 3.1.0-rc-->
    </div>
  </footer>
</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->
<!-- jQuery -->
<script src="=path=adminlte/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="=path=adminlte/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- overlayScrollbars -->
<script src="=path=adminlte/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
<!-- AdminLTE App -->
<script src="=path=adminlte/dist/js/adminlte.js"></script>

<!-- PAGE PLUGINS -->
<!-- jQuery Mapael -->
<script src="=path=adminlte/plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
<script src="=path=adminlte/plugins/raphael/raphael.min.js"></script>
<script src="=path=adminlte/plugins/jquery-mapael/jquery.mapael.min.js"></script>
<script src="=path=adminlte/plugins/jquery-mapael/maps/usa_states.min.js"></script>
<!-- jQuery UI -->
<script src="=path=jqueryui/jquery-ui.js"></script>
<script src="=path=jqueryui/jquery.blockui.js"></script>
<!-- ChartJS -->
<script src="=path=adminlte/plugins/chart.js/Chart.min.js"></script>

<!-- AdminLTE for demo purposes -->
<!--<script src="dist/js/demo.js"></script>-->
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<!--<script src="dist/js/pages/dashboard2.js"></script>-->
 <div id='MainHidden' style='display:none;'></div>
 <div id="dialog" title="Dialog Title">
	<div id=dialogContent></div>
 </div>
<!--=JS-Autoload=-->
<script language='javascript'>
$('#MainSearch').keydown(function (e) {
  	if (e.keyCode == 13) {
    // e.ctrlKey ...  Ctrl-Enter pressed
   	$('#MainSearchRun').click();
   }
});
</script>

</body>
</html>
]]></Data>
</XData>
</Class>


<Class name="apptools.lte.adminTabs">
<Description>
The template GUI of the application selector and tabs on the basis jQueryUi, Uikit</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>%CSP.Page</Super>
<TimeChanged>65967,34789.044928</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
The application title</Description>
<Default>AdminTabsApplication</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files and id sessions</Description>
<Default>^%apptools.ui</Default>
</Parameter>

<Parameter name="PreLoad">
<Description>
For Redirect </Description>
</Parameter>

<Parameter name="ToAdmin">
<Default><![CDATA[You need to contact <a target=_new href='https://github.com/SergeyMi37'> technical support.</a>]]></Default>
</Parameter>

<Parameter name="AppRoles">
</Parameter>

<Method name="IsPermiss">
<Description>
is there a right to work with this form</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>role=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $roles["%All" quit $$$OK
	set st=""
	for i=1:1:$L(role,",") { continue:$P(role,",",i)=""
		if (","_$roles_",")[(","_$P(role,",",i)_",") set st=$$$OK quit
	}
	if 'st quit $$$ERROR($$$GeneralError,"Protect")
	quit st
]]></Implementation>
</Method>

<Method name="CheckPermiss">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&par]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 do ..GetAllApps(.opt)
 if '..IsPermiss(..#AppRoles) {
	set par("=Message-default=")="You are missing access rights. "_..#ToAdmin
 	set par("=Tab=")="Error"
 }
 elseif '$d(opt) {
	set par("=Message-default=")="You don't have a single menu item. "_..#ToAdmin
 	set par("=Tab=")="Message"
 }
 else {
	set par("=Message-default=")=" "
 	set par("=Tab=")=" "
 }
 quit $$$OK
]]></Implementation>
</Method>

<Method name="CheckRoleMenu">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&opt]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	quit:$roles["%All" $$$OK
	set i="" for { set i=$Order(opt(i)) quit:i=""
		kill found
		if $GET(opt(i,"Roles"))'="" {
			set roles=$GET(opt(i,"Roles"))
			set found=..CheckRole(roles)
		}
		else { set found=1
		}
		if '$GET(found) KILL opt(i)
	}
	quit $$$OK
]]></Implementation>
</Method>

<Method name="CheckRole">
<ClassMethod>1</ClassMethod>
<FormalSpec>roles</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	for r=1:1:$l(roles,",") { continue:$p(roles,",",r)=""
		if (","_$roles_",")[(","_$p(roles,",",r)_",") set found=1 quit
	}
	quit +$GET(found)
]]></Implementation>
</Method>

<Method name="GetAppIcon">
<Description>
Icon from png</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>path="",ext="",base64=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	if path'="" {
		quit "<link rel=""icon"" href="""_path_"."_ext_""" type=""image/x-"_ext_"""/><link rel=""shortcut icon"" href="""_path_"."_ext_""" type=""image/x-"_ext_"""/>"
	}
	elseif base64'="" {
		quit "<link rel=""icon"" type=""image/x-"_ext_""" href="""_base64_"""/>"		
	}
	else {
		;hammer gray
	   quit "<link rel=""icon"" type=""image/x-icon"" href="""_##class(apptools.core.rest).getStatic("apptools.Tabs.PanelUikit:IconTools")_"""/>"		
		; raisen
		;quit "<link rel=""icon"" type=""image/x-icon"" href=""data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8AJCQk/yQkJP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/0ZGRv8XFxf/////AP///wD///8A////AP///////////////+7u7v9OTk7/sbGx/11dXf9KSkr///////////+lpaX/4eHh/////wD///8A////AAAAAP8AAAD///////////+8vLz///////X19f/t7e3/gICA/5eXl////////////wAAAP8AAAD/////AKysrP8AAAD/AAAA/wAAAP+enp7/////////////////////////////////5OTk/wAAAP8AAAD/AAAA/6ysrP////8A////AP///wCurq6PlJSUzP///wD///8A////AP///wD///8A////AJSUlMyQkJDY////AP///wD///8A////AP///wD///8AAAAA/wAAAP////8A////AP///wD///8A////AP///wAAAAD/AAAA/////wD///8A////AP///wD///8AAAAA/wAAAP8AAAD/////AP///wD///8A////AP///wD///8AAAAA/wAAAP8AAAD/////AP///wD///8ACwsL/wAAAP8AAAD/lJSU2AAAAP8AAAD/cnJy/1hYWP8AAAD/AAAA/2FhYdgHBwf/AAAA/wAAAP////8A////AP///wD///8A////AP///wAAAAD/s7Oz/wAAAP8AAAD/x8fH/wAAAP////8A////AP///wD///8A////AP///wD///8A////AP///wAAAAD/AAAA/////wAAAAD/AAAA/////wAAAAD/AAAA/////wD///8A////AP///wD///8A////AP///wD///8AAAAA/wAAAP+qqqqlAAAA/wAAAP9lZWXjAAAA/wAAAP////8A////AP///wD///8A////AP///wD///8A////ALa2tv////8A9vb2UQAAAP8AAAD/////Uf///wDAwMD/////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wBcXFz/AAAA/////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AADAAwAAwAMAAIABAAAAAAAA5+cAAOfnAADH4wAAgAEAAPgfAADyTwAA8A8AAPZvAAD+fwAA//8AAA==""/>"
	}
]]></Implementation>
</Method>

<Method name="RepaceParameter">
<Description>
Replace parameters</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&h,&par]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set url=par("input-cgivar")
 set path=par("=path=")
 set p=""
 for { set p=$Order(par(p)) quit:p=""
 	set h=$replace(h,p,par(p))
 }
 ;links 
 set linkjqueyuikit= ##class(apptools.core.LogInfoPane).GetLink()
 set linkjqueyuikit2= ##class(apptools.core.LogInfoPane).AddJsScripts() 
 set js= ..GetStringJs($namespace,..%ClassName(1),0)
 set h=$replace(h,"<!--=Links=-->",
 				linkjqueyuikit_$$$NL_
 				linkjqueyuikit2_$$$NL_
 				js_$$$NL
 	)
 set menu=..DrawMenu() ;sidebar
 set h=$replace(h,"<!-- =Sidebar Menu= -->",menu)
 set menuTop=..DrawMenuTop() ;top think
 set h=$replace(h,"<!-- =Item Dropdown Menu= -->",menuTop)
 if url["autoload=" set autoload=$p($p($p(url,"autoload=",2),"-"),"&")
 set js= ..GetStringJs($namespace,..%ClassName(1),1,$G(autoload))
  set h=$replace(h,"<!--=JS-Autoload=-->",js)
 quit $$$OK
]]></Implementation>
</Method>

<Method name="GetStringJs">
<ClassMethod>1</ClassMethod>
<FormalSpec>ns,cls,postload=0,autoload=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 set js=""
 if postload {
  set js=js_$$$NL_"<script language='javascript'>"_$$$NL
  set js=js_$$$NL_##class(apptools.core.Action).WriteActJs(%request,"","account_status",..%ClassName(1),"DrawStatus","")_$$$NL
 	set enter=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar=Search&Searchstr='+document.getElementById('searchstr').value")_$$$NL
 	set js=js_$$$NL_"$('#searchstr').keydown(function (e) { if (e.keyCode == 13) { "_enter_" }});"_$$$NL
  	if autoload="" {
	 	do ..GetAllApps(.opt) 
	 	set i="" 
	 	for { set i=$o(opt(i)) q:i=""
	 		if $GET(opt(i,"Active")) set js=js_$$$NL_"$('#Menu"_opt(i,"id")_"').trigger('click');"_$$$NL
	 	}
 	} else {
	 	set js=js_$$$NL_"$('#Menu"_autoload_"').trigger('click');"_$$$NL
 	}
 	set js=js_$$$NL
  set js=js_$$$NL_"</script>"_$$$NL
 }
 else {
 	set js=js_$$$NL_##class(apptools.core.rest).getStatic("apptools.lte.adminStatic:AddJS")_$$$NL
 	set js=js_$$$NL_##class(apptools.core.rest).getStatic("apptools.lte.adminStatic:AddStyle")_$$$NL
 }
 quit js
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what are the available modes</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;----- Setup the search in the top menu
	s key="Search"
	s opt(key)="Search"
	s opt(key,"id")="Search-"
	s opt(key,"TabName")="Search"_"-"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSearch"
	s opt(key,"TabMenu","Close")=1
	s opt(key,"TabMenu","Mode")=0 ;1 - for each new search bar to make new tab, 0-tab is always the same
]]></Implementation>
</Method>

<Method name="DrawMenuTop">
<Description>
the rendering top menu </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	do ..GetAllApps(.opt) 
	do ..GetAllMenu(.opt,.menu,1)
	set m="",ret=""
	for { set m=$o(menu(m)) quit:m=""
		set i=""
		  set iditem="id_top_item"_m
		  if m=99 set iditem="account_status" //account - with submenu
		 s ret=ret_"<li class=""nav-item dropdown"">"_
        	"<a class=""nav-link"" data-toggle=""dropdown"" href=""#"">"_
          	 "<span id="""_iditem_""">"_$lg(menu(m),2)_"</span>"_
        	"</a>"_
        	"<div class=""dropdown-menu dropdown-menu-lg dropdown-menu-right"">"
			for { set i=$o(menu(m,i)) quit:i=""
				set ns=$GET(opt(i,"Namespace"))
				set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar="_i,ns)
				set ret=ret_
			     "<div class=""dropdown-divider""></div>"_
          		"<a href=""#"" class=""dropdown-item"" id='Menu"_$g(opt(i,"id"))_"' onclick="""_onclick_""">"_
           		 "<i class=""fas fa-file333 mr-2""></i>"_
            	 "<span class=""float-right text-muted text-sm"">"_$g(opt(i))_"</span>"_
          		"</a>"
			}
 			s ret=ret_ 
    	    	"</div>"_
	      	"</li>"
		}
	
  quit ret
]]></Implementation>
</Method>

<Method name="DrawMenu">
<Description>
render side menu </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	do ..GetAllApps(.opt) 
	do ..GetAllMenu(.opt,.menu)
	set m="",ret=""
	for { set m=$o(menu(m)) quit:m=""
		set i=""
		set icon=$select($lg(menu(m),4)'="":$lg(menu(m),4),1:"fa-copy")
		set active=$s($lg(menu(m),3):"menu-open",1:"")
		set ret=ret_
		"<li class=""nav-item "_active_""">"_
            "<a href=""#"" class=""nav-link"" >"_
              //"<i class=""nav-icon fas fa-chart-pie""></i>"_
              "<i class=""nav-icon fas "_icon_"""></i>"_
              "<p>"_$lg(menu(m),2)_
                "<i class=""right fas fa-angle-left""></i>"_
              "</p>"_
            "</a>"

		for { set i=$o(menu(m,i)) quit:i=""
			set ns=$GET(opt(i,"Namespace"))
	   		set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar="_i,ns)
			set iconInem=$select($g(opt(i,"aw-icon"))'="":$g(opt(i,"aw-icon")),1:"fa-ellipsis-h")
		 	set ret=ret_	
			"<ul class=""nav nav-treeview"">"_
              "<li class=""nav-item"">"_
                "<a id='Menu"_$g(opt(i,"id"))_"' href=""#"" onclick="""_onclick_""" class=""nav-link""  title="""_$g(opt(i))_""">"_
                "<i class=""nav-icon fas "_iconInem_"""></i>"_
                			
                  "<p>"_$g(opt(i))_"</p>"_
                "</a>"_
              "</li>"_
            "</ul>"
			;set ret=ret_
			;	"<li><a id='Menu"_$g(opt(i,"id"))_
			;	"' href='#' onclick="""_onclick_""">"_
			;	$g(opt(i))_
			;	"</a></li>"
		}
		;s ret=ret_"</ul></li>"
	}
	set ret=ret_"</li>"
  quit ret
]]></Implementation>
</Method>

<Method name="GetSupportInfo">
<Description>
To obtain information on the support</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set msg=$$$aText("Software complex to debug. Try to log in later, or contact tech support:","")
	quit msg_"Support info mailto: sergey.mikhaylenko@gmail.com"
]]></Implementation>
</Method>

<Method name="IsDebugMode">
<Description>
To add to the form js code if development mode</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>mode=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if mode,'%request.Get("debug") { 
	$$$jsstart
	  write $$$blockui(..GetSupportInfo())
	$$$jsstop
  quit $$$OK
 }
	quit 0
]]></Implementation>
</Method>

<Method name="DrawStatus">
<Description>
rendering status of the user</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set fio=##class(apptools.core.sys).GetFullName($username)
 set:fio="" fio=$$$aText("The user","")
 write "<span class='tip' title='"_fio_"-"_$j_"-"_$zu(5)_"'>"_$username_" - "_fio_"</span>"
 quit $$$OK
]]></Implementation>
</Method>

<Method name="GetAllMenu">
<Description>
To menu</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt,menu,top=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set i="" for { s i=$o(opt(i)) q:i=""
	if 'top,$d(opt(i,"Menu")) { 
		set m=$lg(opt(i,"Menu"),1)
		set:'$d(menu(m)) menu(m)=opt(i,"Menu")
		set menu(m,i)=""
	}
	if top,$d(opt(i,"MenuTop")) { 
		set m=$lg(opt(i,"MenuTop"),1)
		set:'$d(menu(m)) menu(m)=opt(i,"MenuTop")
		set menu(m,i)=""
	} else {
		;s:'$d(menu(99)) menu(99)=$lb(0,"---",0)
		;s menu(99,i)=""
	}
  }
]]></Implementation>
</Method>

<Method name="ShowTabSearch">
<Description>
drawing Tabs search
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 ;do ..GetAllApps(.opt) 
 ;if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 ;set NSpace=$zu(5)
 write $$$aText("Context","")_" :"_$g(key)
 ;set pref=$g(opt(key,"id"))
]]></Implementation>
</Method>

<Method name="ShowTab">
<Description>
the render Tab on the menu
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	zw Par
	if $g(Par("appPar"))'="" set Par=Par("appPar")
	zw Par
	do ..GetAllApps(.opt) 
	do ..ShowTabApps(.Par,.opt)
]]></Implementation>
</Method>

<Method name="ShowTabApps">
<Description>
the render Tab on the menu
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par,opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if Par="Search" {
		set Searchstr=$g(Par("%request.Data","Searchstr"),$GET(Par("Searchstr")))
		if Searchstr="" q $$$OK
		;s tr=$tr(##class(apptools.MSW.type).Transliteration(Searchstr)," `()\/*;'"":%","_N---")
		;s tr=$tr($zts,".,") 
		set tr=$e($tr(Searchstr," `()\/*;'"":%?$@&.,",""),1,10)_$i(@..#GNStore@("jobs",$j))
		set key=tr ;Searchstr
		MERGE opt(key)=opt(Par)
		set opt(key)=$GET(opt(key))_tr ;Searchstr
		if $g(opt(Par,"TabMenu","Mode"))=1 { ;mode add a new tab 
			set opt(key,"id")=opt(key,"id")_tr
		} else { ;mode add a new replace the old 
			set tabId="tab-"_opt(Par,"id")
			set tabIdMenu="tabMenu-"_opt(Par,"id")
			$$$jsstart
		  	 write "$('#"_tabId_"').remove();"
		  	 write "$('#"_tabIdMenu_"').remove();"
		  	$$$jsstop
		}
		s opt(key,"CGIvar")="&Searchstr="_Searchstr ;$zconvert(Searchstr,"O","URI")
		s opt(key,"TabName")=opt(key,"TabName")_tr 
		s Par=key

	}
	set tabId="tab-"_opt(Par,"id")
	set tabIdMenu="tabMenu-"_opt(Par,"id")
	if $g(opt(Par,"TabMenu","Close"))'="0" s IconMenu="<span class=""uk-margin-small-left uk-icon uk-close"" uk-icon=""close"" onclick=""$(\'#"_tabIdMenu_",#"_tabId_"\').remove();""></span>"
 	if $DATA(opt(Par,"TabMenu","Close"))>9 { //there are more points
 		;TODO
 	}
 	$$$jsstart
 	 if $g(opt(Par,"MethodUrlNewWin"))'="" {
	 	 if $g(opt(Par,"Disable")) { w "alert('"_$$$aText("Mode debugging","")_"');"}
	 	 else {write "window.open('"_$g(opt(Par,"MethodUrlNewWin"))_"','_blank');"
	 	 }
 	}
	else {
 	 write "if (!$('li').is('#"_tabId_"')) { $('.uk-active').removeClass('uk-active');"_$c(13,10)
 		write " $('#tabList').append('<li id="_tabId_"></li>');"_$c(13,10)
 		write " $('#tabMenu').append('<li id="_tabIdMenu_"><a><font color=Lightsteelblue>"_$g(opt(Par,"TabName"))_"</font>"_$g(IconMenu)_"</a></li>');"_$c(13,10)
 		write " $('#t1,#ta1').hide();"_$c(13,10) //" $('#t1').prop('disabled',true);"
 		set ns=$GET(opt(Par,"Namespace"))
 		if $GET(opt(Par,"Disable")) {
	 		;write "$('#"_tabId_"').load('apptools.core.Action.cls','appClass="_..%ClassName(1)_"&appMethod=ShowTabAbout&appNsp="_$zu(5)_"&appPar="_Par_"');"
	 		write ##class(apptools.core.Action).WriteActJs(%request,"",tabId,..%ClassName(1),"ShowTabAbout","&appPar="_Par_$g(opt(Par,"CGIvar")),ns)
 		}
 		elseif $g(opt(Par,"MethodUrl"))'="" {
	 		write "$('#"_tabId_"').load('"_$g(opt(Par,"MethodUrl"))_"');"
 		}
 		else {
	 		;write "$('#"_tabId_"').load('apptools.core.Action.cls','appClass="_$g(opt(Par,"ClassName"))_"&appMethod="_$g(opt(Par,"Method"))_"&appNsp="_$zu(5)_"&appPar="_Par_"');"
	 		write ##class(apptools.core.Action).WriteActJs(%request,"",tabId,$g(opt(Par,"ClassName")),$g(opt(Par,"Method")),"&appPar="_Par_$g(opt(Par,"CGIvar")),ns)
 		}
 	 write "};"
 	 write " UIkit.tab('#tabMenu').show($('#"_tabIdMenu_"'));"
	}
	$$$jsstop
]]></Implementation>
</Method>

<Method name="Logout">
<Description>
Return in a single string</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(Par("appPar"))'="" set Par=Par("appPar")
 do ##class(apptools.core.sys).logout()
 do ..GetAllApps(.opt) 
 $$$jsstart
 set i=""
 for { set i=$o(opt(i)) q:i=""
 	continue:i=Par
 	set tabId="tab-"_opt(i,"id")
	set tabIdMenu="tabMenu-"_opt(i,"id")
 	write "$('#"_tabIdMenu_",#"_tabId_"').remove();"
 }
 $$$jsstop
 set onclick = "top.document.location.reload();"
 &html<
 <br>
 <div class="uk-align-center uk-width-1-1 uk-margin-left uk-margin-right ">
	<div class="uk-alert-warning" uk-alert>
	<p>#($$$aText("The output of System produced",""))#</p>
	</div>
	<center>
		<button class="uk-button uk-button-primary uk-margin-small-right" type="button" onclick="#(onclick)#" >
		<span class="uk-margin-small-left uk-icon" uk-icon="sign-in">
		</span>#($$$aText("Login",""))#</button>
	</center>
</div>
>
 	quit $$$OK
]]></Implementation>
</Method>

<Method name="ButtonAgain">
<Description>
The output of the First button</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>divId="",key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	//set onclick="$('#"_divId_"MainContent"_"').empty();"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainHeader",..%ClassName(1),divId_"FirstHead","&key="_key_"&divId="_divId)
	set onclick="$('#"_divId_"MainContent"_"').empty();"_
		$$$onclick(divId_"MainForm",divId_"MainHeader",$namespace,..%ClassName(1),divId_"FirstHead","&key="_key_"&divId="_divId)
	quit $$$appButton("appButtonExit","onclick="""_$g(onclick)_"""",$$$aText("Again",""))
]]></Implementation>
</Method>

<Method name="ShowTabAbout">
<Description>
the render Tab On the program"
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $g(key("appPar"))'="" set key=key("appPar")
	do ..GetAllApps(.opt) 
	if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
	set divId=$g(opt(key,"id"))
	write ..#ToAdmin
	write "<br>Parameter key: "_key_"<br>Sample create custom tab"
	write $$$appText(divId_"nametab","","tabname")_" "
	set onclick=##class(apptools.core.Action).WriteActJs(%request,"","MainHidden",..%ClassName(1),"ShowTab","&appPar=Search&Searchstr='+$('#"_divId_"nametab"_"').val()")
	set %ui=1
	write $$$appButton(divId_"appButtonAbout","onclick="""_$tr(onclick,"*",1)_"""",""_$$$aText("Make tab",""))
]]></Implementation>
</Method>

<Method name="ShowInIFrame">
<Description>
rendering the Tab previously submitted
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(key("appPar"))'="" set key=key("appPar")
 do ..GetAllApps(.opt) 
 if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 set NSpace=$zu(5)
 set pref=$g(opt(key,"id"))
 set mhead=pref_"MainHeader"
 set mcont=pref_"MainContent"
 ;  <iframe id="#(mcont)#" width="100%" height="100%" style='overflow: auto;' src='#($g(opt(key,"InFrameUrl")))#' ></iframe>
 &html<
<form id="#(pref_"MainForm")#">
<div class="uk-grid">
    <iframe id="#(mcont)#" width="1500" height="1000" style='overflow: auto;' src='#($g(opt(key,"InFrameUrl")))#' ></iframe>
    </div>
</div>
</form>
>
 quit $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabSample">
<Description>
rendering the Tab previously submitted
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(key("appPar"))'="" set key=key("appPar")
 do ..GetAllApps(.opt) 
 if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 set NSpace=$zu(5)
 set pref=$g(opt(key,"id"))
 set mhead=pref_"MainHeader"
 set mcont=pref_"MainContent"
 &html<
<form id="#(pref_"MainForm")#">
<div class="uk-grid">
    <div class="uk-width-1-1 "id="#(mhead)#" ></div>
    <div style='overflow: auto;' class="uk-width-1-1 uk-margin-top uk-margin-left" id="#(mcont)#"></div>
</div>
</form>
>
 ;d ##class(apptools.core.LogInfoPane).AddJS(NSpace,..%ClassName(1))
 
 $$$jsstart
  	; to calculate the height of the container as a result of wijetunge victory container-Taba height of the container header
    write ##class(apptools.core.Action).WriteActJs(%request,pref_"MainForm",mhead,..%ClassName(1),pref_"FirstHead","&divId="_pref_"&key="_key)_$$$NL
  	write $$$blockui($$$aText("Loading...",""))_$$$NL
  	;write "$('#"_mcont_"').height($(window).height()-($('#"_mhead_"').height()+$('#t1').height()+300)); //^^^height"_$$$NL
  	;write "console.log('^^^height');"_$$$NL
 $$$jsstop
 
 quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxDrawJson">
<Description>
Lighbox Draw JSON
List - files array 
subdir - application static</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>List,subdir="",appdynamic,gn=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set i=""
 for { set i=$o(List(i)) q:i=""
 	if $lv($g(List(i))),$lg($g(List(i)),2)="F" {
		 	set fullpath=$lg($g(List(i)),1)
		 	set ItemName=$lg($g(List(i)),4)
 	} else {
 		set ItemName=$g(List(i,"ItemName"))
 		set fullpath=$g(List(i,"Name"))
 	}
 	set ext=$p(ItemName,".",*)
 	set mimetype=##class(apptools.core.filesMimeTypes).GetMimeTypes4ext(ext)
 	set type=$s(mimetype[("video"):"video",(mimetype)[("image"):"image",1:"iframe")
 	if subdir'="" {
 		write "{source: '"_subdir_ItemName_"', caption: '"_ItemName_"', type: '"_type_"'}",$c(13,10)
 	} else {
	 	set fileId=##class(apptools.core.files).GetFileIdView(fullpath,gn) 
		write "{source: '"_appdynamic_fileId_"', caption: '"_ItemName_"', type: '"_type_"'}",$c(13,10)
 	}
	write:$o(List(i))'="" ","
 }
]]></Implementation>
</Method>

<Method name="EnCode">
<Description>
Encode string to URL</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>s</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set:$zversion(1)'=3 s=$zconvert(s,"O","URL")
	quit s
]]></Implementation>
</Method>

<Method name="DeCode">
<Description>
Decode string from URL</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>s</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set:$zversion(1)'=3 s=$zconvert(s,"I","URL")
	quit s
]]></Implementation>
</Method>

<Method name="DrawTableUi">
<Description>
Draw Tables UiKit</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[mode="beg",divId="tab2",attr="",&Enum]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if mode="beg" {
	&html<
 <div #(attr)# id="#(divId)#" >
    <table class="uk-table uk-table-hover uk-table-middle uk-table-divider">
        <thead>
           <tr>
          >
          set i=""  for {  s i=$o(Enum(i)) quit:i=""
            write " <th "_$GET(Enum(i,"attr"))_" >"_$g(Enum(i))_"</th>"
          }
               /* <th class="uk-table-shrink">Preserve</th>
                <th class="uk-table-expand">Expand + Link</th>
                <th class="uk-width-small">Truncate</th>
                <th class="uk-table-shrink uk-text-nowrap">Shrink + Nowrap</th> */
    &html<
            </tr>
        </thead>
        <tbody>
        >
	}
    elseif mode="tr" {
			write "<tr>"
            set i=""  for {  set i=$o(Enum(i)) quit:i=""
				write "<td "_$GET(Enum(i,"attr"))_"><font color=Lightblue>"_$GET(Enum(i))_"</font></td>"
               
               /* <td><input class="uk-checkbox" type="checkbox"></td>
               <td><img class="uk-preserve-width uk-border-circle" src="image/msw.jpg" width="40" alt=""></td>
                <td class="uk-table-link">
                    <a class="uk-link-reset" href="">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</a>
                </td>
                <td class="uk-text-truncate">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</td>
                <td class="uk-text-nowrap">Lorem ipsum dolor</td>*/
            } 			
            w "</tr>"
	}
	elseif mode="end" {
		&html<
		   </tbody>
 	 	 </table>
 		</div>
    	>
	} else {
	}
]]></Implementation>
</Method>

<Method name="GetElemProp">
<Description>
Get property element object
do ##class(apptools.lte.adminTabs).GetElemProp("","test",.gn,"pref",,.tag)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[obj="",propName,&gn,PrefixIdDIV="",Mode="",&tags="",&Par=""]]></FormalSpec>
<Implementation><![CDATA[
	set sysType=$g(gn("Properties",propName,"Type"))
	
	if sysType["%Stream." quit $$$OK ;TODO exception
	set Name=$g(gn("Properties",propName,"Name"))

	if Name="" quit $$$ERROR($$$GeneralError,"No Exsist Property "_propName) 
	
	set Required=$g(gn("Properties",propName,"Required"))
	set ReadOnly=$g(gn("Properties",propName,"ReadOnly"))
	set Parameters=$g(gn("Properties",propName,"Parameters"))
	
	set Value=$G(Par("ValueElement"))
	if $iso(obj) set Value=$property(obj,Name)
	
	set redstar="" if Required s redstar="<font color=red title='"_$$$aText("Required field","")_"'>*</font>"
	
	do ##class(apptools.core.Form).GetJsonProp(obj, propName, .gn, .pr)
	if $GET(Par("attr"))'="" set pr("attr")=Par("attr") 
	if 'ReadOnly set ReadOnly=$g(pr("readOnly"))
	if 'Mode set ReadOnly=1
	
	set label=pr("description")_redstar
	if Mode["ShowFieldName" set label=label_"<br>("_propName_")"
	if $g(pr("inputpattern"))="hidden" set label=""
	set tags=tags_"<td style='text-align: right;' title='"_$g(pr("title"))_"' ><label>"_label_"</label></td>"
	set tags=tags_"<td style='text-align: left;' title='"_$g(pr("title"))_"' >"
	s pr("attr")=$g(pr("attr"))_" "_$s(Required:"Required",1:"")_" "_$s(ReadOnly:"disabled",1:"")
	
	s %id=$g(PrefixIdDIV)_Name
	s %val=$g(Value)
	s pr("WebComp-size")=" size=50 " if pr("attr")["size" set pr("WebComp-size")=""
	
	if sysType="%Boolean",pr("inputtype")'="checkbox" {
		d ..SelectFieldYesNo(%id,%val,.tag)
		set tags=tags_tag
	}
	elseif sysType="%Date" {
	 	set tags=tags_$$$appText(%id," size=10 "_pr("attr"),%val)
	}
	else {  //%String
		if $g(pr("inputpattern"))="textarea" {
			if pr("attr")'["cols" s pr("attr")=pr("attr")_" cols=77 "
			if pr("attr")'["rows" s pr("attr")=pr("attr")_" rows=3 "
			set tags=tags_$$$appTextarea(%id,pr("attr"),%val)
		}
		elseif $g(pr("inputpattern"))="hidden" {
			set tags=tags_"<input type='hidden' id='"_%id_"' name='"_%id_"' "_$g(pr("attr"))_" value='"_%val_"'>"
		}
		elseif $g(pr("inputpattern"))="autocomplete" {
			set met=$g(pr("autocompleteMethod"))
			if met'=""  xecute "do "_met
			set tags=tags_$$$appAutocomplete(%id," "_pr("attr"),%val)
		}
		elseif $g(pr("inputpattern"))="files" {
			set tags=tags_##class(apptools.core.Form).WebCompShowFiles(obj,.pr,Mode,%id,%val)
		}
		elseif $g(pr("inputpattern"))="select" {
			set met=$g(pr("selectMethod"))
			if met'="" {
				;;w met
				if (met["{") { //a list of json
					;TODO
				}
				else { //a list of functions
					xecute "do "_met
				}
			}
			;w $$$appInputHidden(.%id," "_attr,%val)
		}
		elseif $g(pr("inputpattern"))="selectize" {
			s met=$g(pr("selectMethod"))
			set tags=tags_"<input type='text' id='"_%id_"' name='"_%id_"' class='input-tags demo-default ui-corner-all ui-widget ui-widget-content' value='"_%val_"'>"
			if met'="" {
				xecute "do "_met
			}
		}
		elseif pr("inputtype")="checkbox" {
			set tags=tags_##class(apptools.core.Form).WebCompShowCheckbox(,.pr,Mode,%id,%val)
		}
		elseif pr("inputtype")'="" {
			set tags=tags_$$$appInput(%id," type='"_pr("inputtype")_"' "_pr("WebComp-size")_pr("attr"),%val)
		}
		elseif Parameters["{" {
			if {}.$$$jsonFromJSON(Parameters).VALUELIST'="" {
			  set vl={}.$$$jsonFromJSON(Parameters).VALUELIST
			  set dl={}.$$$jsonFromJSON(Parameters).DISPLAYLIST
			  ;	s ^tmpMSW(1,$i(^tmpMSW),"Parameters")=$lb(propName,vl,dl)
			  set:dl="" dl=vl
			  do ..SelectField($lfs(vl),,$lfs(dl),.gn2,,%id,%val,600,.tag)
			  set tags=tags_tag
			} else {
				set tags=tags_$$$appText(%id,pr("WebComp-size")_pr("attr"),%val)
			}
		}
		else { set tags=tags_$$$appText(%id,pr("WebComp-size")_pr("attr"),%val)
		}
	}
	set tags=tags_"</td>"
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="SelectFieldYesNo">
<Description>
The output type field select Yes or no 
do ##class(apptools.lte.adminTabs).SelectFieldYesNo("test","0",.tag)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[idSelect="selectmenu",dfltKey="",&tags]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ..SelectField($lb(0,1),,$lb($$$aText("No",""),$$$aText("Yes","")),.gn,,idSelect,dfltKey,100,.tags)
	q $$$OK
]]></Implementation>
</Method>

<Method name="SelectField">
<Description>
The output fields of type select
do ##class(apptools.lte.adminTabs).SelectField($lb("",0,1),"alert(1);",$lb("","No","Yes"),.gn,,"test","0",50,.tag) </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[KeyList="",ONCHANGE="",ValueList="",gnRet,order=1,idSelect="selectmenu",dfltKey="",width=500,&tags]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	kill gnRet
	set selectNS="<SELECT id='"_idSelect_"' name='"_idSelect_"' "_$s(ONCHANGE'="":"ONCHANGE='"_ONCHANGE_"'",1:"")_">",
		tags=""
	set gnRet($i(gnRet))=selectNS
	for i=1:1:$ll(KeyList) { 
		set selected=""
		if dfltKey'="",dfltKey=$lg(KeyList,i) s selected="selected"
		set select=" <OPTION "_$g(selected)_" VALUE="""_$lg(KeyList,i)_""">"_$lg(ValueList,i)_"</OPTION>"
  		set gnRet($i(gnRet))=select
	}
	set gnRet($i(gnRet))="</SELECT>"
	for i=1:1 {q:'$DATA(gnRet(i))  set tags=tags_gnRet(i)}
	set tags=tags_"<script language='javascript'>"
		set tags=tags_"$( '#"_idSelect_"' ).selectmenu({ change: function( event, data ) { "_ONCHANGE_" }, width:"_width_" }).selectmenu('menuWidget');" ;;.selectmenu('refresh') .addClass('overflow');"
		set tags=tags_"$( '#"_idSelect_"-menu' ).css( 'max-height','500px');"
	set tags=tags_"<script language='javascript'>"
	q $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.lte.adminsample">
<Description>
http://hp-msw:52773/apptoolsrest/a/adminsample</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>apptools.lte.adminTabs</Super>
<TimeChanged>65868,34946.104385</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
Application title</Description>
<Default>Admin Sample</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files</Description>
<Default>^apptools.Permissions</Default>
</Parameter>

<Parameter name="AppRoles">
<Default>ui_Permissions</Default>
</Parameter>

<Method name="Init">
<Description>
do ##class(apptools.lte.adminsample).Init()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set ServerPort=##class(apptools.core.net).GetURI(.prop)
	write !,"Open in browser "
    do ##class(apptools.core.Installer).AddAndWriteFavorite(##class(apptools.core.Installer).#AppName_" SampleAdminPanel","/"_##class(apptools.core.Installer).#AppCSP_"rest/a/adminsample",ServerPort)
    do ##class(apptools.core.Installer).AddAndWriteFavorite(##class(apptools.core.Installer).#AppName_" SampleMatrixPermiss","/"_##class(apptools.core.Installer).#AppCSP_"rest/a/permiss",ServerPort)
]]></Implementation>
</Method>

<Method name="MainParameter">
<Description>
Replace parameters</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&h,&par]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set path=par("=path=")
 set par("=Brand-Text=")="Admin Sample Panel"
 set par("=path=")=path
 set par("=Brand-Text=")="AppTools-admin"
 set par("=Logo-image=")=path_"adminlte/dist/img/ApptoolsLogo.png"
 set par("=titleAppToolsadmin=")=..#HeaderText
 set par("<!--=LinkIcon=-->")=..GetAppIcon(path_"adminlte/dist/img/ApptoolsLogo","png")
 
 quit ..RepaceParameter(.h, .par)
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what are the available modes</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;make them zavisimye from the area
	;------------ sidebar
	set key="menu-first"
	set opt(key)="Find users" ;The name of the menu
	set opt(key,"id")="Find" ;use methods: FindFirstHead FindResult
	set opt(key,"TabName")="finding users" ;the name of the tab
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"Method")="ShowTabSample"
	set opt(key,"Disable")=0 ;developed
	set opt(key,"TabMenu","Close")=0 ;the tab cannot be deleted
	set opt(key,"Menu")=$lb(1,"Mode",1,"fa-cog") ;$lg(,3)=1 - open menu level 1
	set opt(key,"Active")=1 ;active menu item
	set opt(key,"aw-icon")="fa-list-alt" ;fa-table"

	set key="menu-first2"
	set opt(key)="Sample gallery" ;The name of the menu
	set opt(key,"id")="Lighbox" ;use methods: LighboxFirstHead LighboxResult
	set opt(key,"TabName")="Gallery" ;the name of the tab
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"Method")="ShowTabSample"
	set opt(key,"Disable")=0 ;developed
	set opt(key,"Menu")=$lb(1,"Mode",1) ;$lg(,3)=1 - open menu level 1
	
	set key="menu-second"
	set opt(key)="Help"
	set opt(key,"id")="Help"
	set opt(key,"TabName")="Help"
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"MethodUrl")="http://ShowTabAbout.cls"
	set opt(key,"Disable")=1 ;developed
	set opt(key,"Menu")=$lb(2,"About the program",0)

	set key="menu-second2"
	set opt(key)="Menu 3"
	set opt(key,"id")="About"
	set opt(key,"TabName")="Menu 3"
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"Method")="ShowTabAbout"
	set opt(key,"Disable")=1 ;developed
	set opt(key,"Menu")=$lb(2,"About the program")

	set key="menu-second3"
	set opt(key)="Support"
	set opt(key,"id")="Support"
	set opt(key,"TabName")="Support"
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"MethodUrlNewWin")="http://ShowTabAbout.cls"
	set opt(key,"Disable")=1 ;developed
	set opt(key,"Menu")=$lb(2,"About the program")
	
	;------------ one-level upper menu 
	set key="menu-topLern"
	set opt(key)="Menu 2"
	set opt(key,"id")="Menu2"
	set opt(key,"TabName")="Menu 2"
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"Method")="ShowTabAbout"
	set opt(key,"MenuTop")=$lb(1,"Menu 2") ;has no sub-items

	set key="menu-topOpt"
	set opt(key)="Option"
	set opt(key,"id")="Option"
	set opt(key,"TabName")="Option"
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"Method")="ShowTabAbout"
	set opt(key,"MenuTop")=$lb(2,"Option") ;has no sub-items

	;------------ top menu the top-accoun
	set key="menu-top-accoun"
	set opt(key)=$$$aText("Profile","")
	set opt(key,"id")="AccountProf"
	set opt(key,"TabName")=$$$aText("Profile","")
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"Method")="ShowTabAbout"
	set opt(key,"MenuTop")=$lb(99,"Account") ;only 99-account has sub-items

	set key="menu-top-account3"
	set opt(key)=$$$aText("Exit","")
	set opt(key,"id")="AccountExit"
	set opt(key,"TabName")=$$$aText("Exit","")
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"Method")="Logout"
	set opt(key,"MenuTop")=$lb(99,"Account") ;only 99-account has sub-items
	
	;----- Setup the search in the top menu
	set key="Search"
	set opt(key)=$$$aText("Search","")
	set opt(key,"id")="Search-"
	set opt(key,"TabName")=$$$aText("Search","")_"-"
	set opt(key,"ClassName")=..%ClassName(1)
	set opt(key,"Method")="ShowTabSearch"
	set opt(key,"TabMenu","Close")=1
	set opt(key,"TabMenu","Mode")=0 ;1 - for each new search bar to make new tab, 0-tab is always the same
	
	quit $$$OK
]]></Implementation>
</Method>

<Method name="FindFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","~key="_key_"~divId="_divId_"~mode=*")
	;ActionJs('"_divId_"MainForm','"_divId_"MainContent','','"_divId_"Result','key="_key_"~divId="_divId_"~mode=*');"
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
		Context name users
			</td>
			<td>
				#($$$appText(divId_"textName","title='context in Name'","s"))#
			</td>		
			<td>
				#($$$appText(divId_"textDesc","title='context in FullName'","m"))#
			</td>
			<td>
			</td>
			<td>
		
			</td>
			<td>

			</td>
		</tr>
		<tr>
			<td>
			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""","Find USERS"))#
			</td>
			<td>
			</td>
			<td>
			</td>
			<td>
			
			</td>
			<td>

			</td>
		</tr>
		</table>
	>
 $$$jsstart
 	//for all identifiers starting with "_divId_"text by pressing Enter, click on the button (ending with $("[id$='txtTitle']"))
 	write "$('[id^="""_divId_"text""]').keydown(function (e) { if (e.keyCode == 13) { $('#"_divId_"appButtonResult1').click(); }});"_$c(13,10)
 $$$jsstop
	
	quit $$$OK
]]></Implementation>
</Method>

<Method name="FindResult">
<Description>
Search result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	set Name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"textName")	
	set Desc=$g(Par("%request.Data",divId_"textDesc"))
	set st=$$$OK
	if mode=1 {
		write ..ButtonAgain(divId,key)
		if Name="" w $$$appError($$$aText("Context is empty","")) quit $$$OK
		zn "%sys"
		set sql="select ID,name,EmailAddress,fullName from Security.Users where Enabled [ '1' "
		if Name'="" s sql=sql_" and (name like '%"_Name_"%') "
		if Desc'="" s sql=sql_" and (fullName like '%"_Desc_"%') "
		set msg="Query: "_sql

		set exec="##class(apptools.core.LogInfo).MarkRed(%AppLogInfoVal,"""_$GET(Name)_","_$GET(Desc)_""")"
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,100000,$zu(5),msg,exec)
		if 'st  w $$$appError($System.Status.GetErrorText(st))
		quit $$$OK

	} 
	write "<br>"
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","~key="_key_"~divId="_divId_"~mode=*")
	Set path=$p($p($zu(86),"*",1),$$$slash,1,*-1)
	Set path1=path_$tr("\csp\broker\images\","\",$$$slash)
	Set path2=path_$tr("\docs\","\",$$$slash)
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
				#($$$appText(divId_"path1","size=50 title='path to images'",path1))#
			</td>
			<td>
				#($$$appText(divId_"path2","size=50 title='path to images docs'",path2))#
			</td>
		</tr>
		<tr>
			<td>
			#($$$appButton(divId_"appButtonResult1"," onclick="""_$tr(onclick,"*",1)_"""","Generate gallery via App /csp/broker"))#			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult2"," onclick="""_$tr(onclick,"*",2)_"""","Generate gallery dinamic rest"))#			
			</td>
		</tr>
		</table>
	>
 $$$jsstart
 	;for all identifiers starting with "_divId_"text by pressing Enter, click on the button (ending with $("[id$='txtTitle']"))
 	write "$('[id^="""_divId_"path""]').keydown(function (e) { if (e.keyCode == 13) { $('#"_divId_"appButtonResult2').click(); }});"_$c(13,10)
 $$$jsstop
	
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LighboxResult">
<Description>
Its result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	set path1=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"path1")	
	set path2=$g(Par("%request.Data",divId_"path2"))
	set st=$$$OK
	set wc=##class(apptools.core.filesMimeTypes).GetTypesWildcards("image")_##class(apptools.core.filesMimeTypes).GetTypesWildcards("video")
	if mode=1 {
	 do ##class(apptools.core.files).GetList(path1,wc,.List)
	 set cspappstatic="/csp/broker/images/"
	 ;zw List
	 $$$jsstart
 		write "UIkit.lightboxPanel({"
   		write "items: [ "
		  do ..LighboxDrawJson(.List,cspappstatic)
  		write " ] }).show();"
	 $$$jsstop
	} 
	elseIF mode=2 {
	;	w path2
	 do ##class(apptools.core.files).GetList(path2,wc,.List)
	 ;zw List
	 set appdinamic=%request.Application_"get-files/"
	 $$$jsstart
 		write "UIkit.lightboxPanel({"
   		write "items: [ "
		  do ..LighboxDrawJson(.List,,appdinamic,..#GNStore)
  		write " ] }).show();"
	 $$$jsstop
	}
	write "<br>"
	quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.lte.dev">
<Description>
http://hp-msw:52773/apptoolsrest/a/dev</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>apptools.lte.adminStatic</Super>
<TimeChanged>65822,56034.010793</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
Application title</Description>
<Default>Development</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files</Description>
<Default>^apptools.Dev</Default>
</Parameter>

<Parameter name="AppRoles">
<Default>%All</Default>
</Parameter>

<Method name="Init">
<Description>
do ##class(apptools.lte.dev).Init()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set ServerPort=##class(apptools.core.net).GetURI(.prop)
	write !,"Open in browser "
    do ##class(apptools.core.Installer).AddAndWriteFavorite(##class(apptools.core.Installer).#AppName_" Dev","/"_##class(apptools.core.Installer).#AppCSP_"rest/a/dev",ServerPort)
]]></Implementation>
</Method>

<Method name="MainParameter">
<Description>
Replace parameters</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&h,&par]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set path=par("=path=")
 set par("=Brand-Text=")=..#HeaderText
 set par("=path=")=path
 set par("=Brand-Text=")=..#HeaderText
 set par("=Logo-image=")=path_"adminlte/dist/img/ApptoolsLogo.png"
 set par("=titleAppToolsadmin=")=..#HeaderText
 set par("<!--=LinkIcon=-->")=..GetAppIcon(path_"adminlte/dist/img/ApptoolsLogo","png")
 do ..CheckPermiss(.par)
 quit ..RepaceParameter(.h, .par)
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what are the available modes</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 

	;make sidebar
	quit $$$OK
]]></Implementation>
</Method>

<Method name="FindFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","~key="_key_"~divId="_divId_"~mode=*")
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
				Context name users
			</td>
			<td>
				#($$$appText(divId_"textName","title='context in Name'","s"))#
			</td>		
			<td>
				#($$$appText(divId_"textDesc","title='context in FullName'","m"))#
			</td>
		</tr>
		<tr>
			<td>
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""","Find USERS"))#
			</td>
			<td>
			</td>
		</tr>
		</table>
	>
 $$$jsstart
 	write "$('[id^="""_divId_"text""]').keydown(function (e) { if (e.keyCode == 13) { $('#"_divId_"appButtonResult1').click(); }});"_$c(13,10)
 $$$jsstop
	
	quit $$$OK
]]></Implementation>
</Method>

<Method name="FindResult">
<Description>
Search result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	set Name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"textName")	
	set Desc=$g(Par("%request.Data",divId_"textDesc"))
	set st=$$$OK
	if mode=1 {
		write ..ButtonAgain(divId,key)
		if Name="" w $$$appError($$$aText("Context is empty","")) quit $$$OK
		zn "%sys"
		set sql="select ID,name,EmailAddress,fullName from Security.Users where Enabled [ '1' "
		if Name'="" s sql=sql_" and (name like '%"_Name_"%') "
		if Desc'="" s sql=sql_" and (fullName like '%"_Desc_"%') "
		set msg="Query: "_sql
		set exec="##class(apptools.core.LogInfo).MarkRed(%AppLogInfoVal,"""_$GET(Name)_","_$GET(Desc)_""")"
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,100000,$zu(5),msg,exec)
		if 'st  w $$$appError($System.Status.GetErrorText(st))
		quit $$$OK
	} 
	write "<br>"
	quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.lte.infochest">
<Description>
http://hp-msw:52773/apptoolsrest/a/infochest</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>apptools.lte.adminTabs</Super>
<TimeChanged>65822,30346.110422</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
Application title</Description>
<Default>Info Chest</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files</Description>
<Default>^apptools.infochest</Default>
</Parameter>

<Parameter name="AppRoles">
</Parameter>

<Method name="Init">
<Description>
do ##class(apptools.lte.adminsample).Init()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set ServerPort=##class(apptools.core.net).GetURI(.prop)
	write !,"Open in browser "
    do ##class(apptools.core.Installer).AddAndWriteFavorite(##class(apptools.core.Installer).#AppName_" SampleAdminPanel","/"_##class(apptools.core.Installer).#AppCSP_"rest/a/infochest",ServerPort)
]]></Implementation>
</Method>

<Method name="MainParameter">
<Description>
Replace parameters</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&h,&par]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set base64=##class(apptools.core.rest).getStatic(..%ClassName(1)_":image")
 set par("=Brand-Text=")="Info Chest"
 set par("=titleAppToolsadmin=")=..#HeaderText
 set par("=Logo-image=")=base64
 set par("<!--=LinkIcon=-->")=..GetAppIcon(,"png",base64)
 quit ..RepaceParameter(.h, .par)
 quit $$$OK
]]></Implementation>
</Method>

<Method name="GetAppRootdir">
<Description>
write ##class(apptools.lte.infochest).GetAppRootdir()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set rootdir="d:\files\"
	if $zversion(1)=3 s rootdir="/home/project/shared/photo/"
	if $data(@..#GNStore@("rootdir"),data) {
		set rootdir=data
	}
	else {
		set rootdir= ##class(%File).GetDirectory($zu(86))_"/mgr/.modules/"_$namespace_"/apptools-admin/1.1.5/web/files/"
	}
	quit ##class(%File).GetDirectory(rootdir)
]]></Implementation>
</Method>

<Method name="SetAppRootdir">
<Description>
do ##class(apptools.lte.infochest).SetAppRootdir("d:\!\")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>path</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set @..#GNStore@("rootdir")=path
	quit $$$OK
]]></Implementation>
</Method>

<Method name="GetAllApps">
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if ..IsPermiss(..#AppRoles) {
	;------------ side menu
	s LeftMenuName="Treasure hest" i $i(LeftMenuNumer)
	s rootdir=..GetAppRootdir()

	s key="camera"
	s List(key,"ItemName")="Photo & Video"
	s key="audio"
	s List(key,"ItemName")="Music"
	s key="books"
	s List(key,"ItemName")="Books"
 	
 	s i="" for { s i=$o(List(i)) q:i=""  
 	s ItemName=$g(List(i,"ItemName"))
 	i $i(count)
 	s key="find-"_i
	s opt(key)=ItemName 
	s opt(key,"id")="GDiv"_i
	s opt(key,"TabName")=ItemName_"-"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabS"
	s opt(key,"TabMenu","Close")=1
	s opt(key,"Menu")=$lb(LeftMenuNumer,LeftMenuName,1)
	s:count=1 opt(key,"Active")=1
	s opt(key,"Dir")=rootdir_i
 }
 if ..IsPermiss("%All") {	
 	i $i(LeftMenuNumer)
	s key="menu-topOpt"
	s opt(key)="Parameter"
	s opt(key,"id")="Option"
	s opt(key,"TabMenu","Close")=1
	s opt(key,"TabName")="Parameter"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Menu")=$lb(LeftMenuNumer,"Option") ;has no sub-items
 }
	;------------ top-accoun
	s LeftMenuName="Account",LeftMenuNumer=99

	s key="menu-top-account3"
	s opt(key)="Exit"
	s opt(key,"id")="AccountExit"
	s opt(key,"TabName")="Exit" 
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="Logout"
	s opt(key,"MenuTop")=$lb(LeftMenuNumer,LeftMenuName)
	
	s key="Search"
	s opt(key)=""
	s opt(key,"id")="Search-"
	s opt(key,"TabName")="Search-"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSearch"
	s opt(key,"TabMenu","Close")=1
	s opt(key,"TabMenu","Mode")=0
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabSearch">
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 ;do ..GetAllApps(.opt) 
 ;if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
 ;set NSpace=$zu(5)
 w $$$aText("Context","")_" :"_$g(key)
 q $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabS">
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 if $g(Par("appPar"))'="" set key=Par("appPar")
 do ..GetAllApps(.opt) 
 set divId=$g(opt(key,"id"))
 set mcont=divId_"MainContent"
 set mhead=divId_"MainHeader"
 if $g(Par("dir"))'="" set opt(key,"Dir")=..DeCode(Par("dir"))
 &html<
<form id="#(divId_"MainForm")#">
<div class="uk-grid">
    <div class="uk-width-1-1 "id="#(mhead)#" >
    >   
 ;Folders icon
 set srcFolder="data:image/gif;base64,R0lGODlhEAAOALMAAOazToeHh0tLS/7LZv/0jvb29t/f3//Ub//ge8WSLf/rhf/3kdbW1mxsbP//mf///yH5BAAAAAAALAAAAAAQAA4AAARe8L1Ekyky67QZ1hLnjM5UUde0ECwLJoExKcppV0aCcGCmTIHEIUEqjgaORCMxIC6e0CcguWw6aFjsVMkkIr7g77ZKPJjPZqIyd7sJAgVGoEGv2xsBxqNgYPj/gAwXEQA7"
 set dir=$g(opt(key,"Dir"),"!")

 do ..GetSortedList(key,dir,.List,.sort)

 if '$d(List) { write "No files and directories "_dir
	 quit $$$OK }
 ;If there are no directories, then we will immediately show the files
 if '$d(sort("n","D")) {
	 do ..FilesShow(.Par,dir,.sort)
	 quit $$$OK
 }
 
 set on=$$$blockui("...")_";"_##class(apptools.core.Action).WriteActJs(%request,"",mcont,..%ClassName(1),"NexLevelTree","&key="_key_"&divId="_divId_"&count=*&dir=***")

 set IdTab=$tr($p($zts,",",2),".")
 set fields(1)="<img class='uk-preserve-width uk-border-circle' src='"_$g(sort("icon"))_"' width='40' alt=''>" ;,fields(1,"attr")="class='uk-table-shrink'"
 set fields(2)="Name",fields(2,"attr")="class='uk-table-expand'"
 do ..DrawTableUi("beg","Table"_IdTab,"style='overflow: auto;'",.fields)
 
 ;If there are files then show them
 if $d(sort("n","F")) {
	s on2=$replace(on,"***",..EnCode(dir))
 	s on2=$replace(on2,"*",(IdTab))
 	if key["camera" { s on2=$replace(on2,"NexLevelTree","FilesShow") ;we will replace it with the show program
 	} else { s on2=$replace(on2,"NexLevelTree","NextLevelInDir")
 	}
 	s row(2)=$G(sort("n"))_"  '"_$p(dir,$$$slash,*)_"' - "_$G(sort("n","F"))
 	s row(2,"attr")="class='uk-table-expand' onclick="""_on2_""""
 	s row(1)="<img class='uk-preserve-width uk-border-circle' src='"_$g(sort("icon"))_"' width='40' alt=''>"
 	d ..DrawTableUi("tr",,,.row)
 }
 s i=""
  for { s i=$o(List(i)) q:i=""  
 	s ItemName=$g(List(i,"ItemName"))
 	continue:$g(List(i,"Type"))="F"
 	k sort2
	d ..GetSortedList(key,dir_$$$slash_ItemName,,.sort2)
	;w "<li>"_ItemName_" "_key zw sort2
	i '$d(sort2("n","F"))&&('$d(sort2("n","D"))) continue
	s on2=on
	i '$d(sort2("n","D")) {
 		s:key["camera" on2=$replace(on2,"NexLevelTree","FilesShow") ;we will replace it with the show program
	}
 	i $i(count)
  	s on2=$replace(on2,"***",..EnCode(dir_$$$slash_ItemName))
 	s on2=$replace(on2,"*",(IdTab+count))
 	s row(2)=ItemName_" - "_$tr($G(sort2("n","F")),"'")
 	s row(2,"attr")="class='uk-table-expand' onclick="""_on2_""""
 	s row(1)="<img class='uk-preserve-width uk-border-circle' src='"_srcFolder_"' width='40' alt=''>"
 	d ..DrawTableUi("tr",,,.row)
 }
 d ..DrawTableUi("end")
 &html<
  </div>
  <div id="#(mcont)#"></div>
 </div>
</form>
>
 quit $$$OK
]]></Implementation>
</Method>

<Method name="NextLevelInDir">
<Description>
Show files in the root of the directory</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s Par("InDir")=1
	d ..NexLevelTree(.Par)
]]></Implementation>
</Method>

<Method name="NexLevelTree">
<Description>
Create a tab with the next level</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set dir=..DeCode(Par("dir"))
	set count=$g(Par("count"))
 	do ..GetAllApps(.opt)
 	if '$d(opt(key)) {
	 	i key["audio" s key="find-audio"
	 	i key["camera" s key="find-camera"
	 	i key["books" s key="find-books"
	 	s count=count+10  ;
 	}
 	s key2=key_count
 	m opt(key2)=opt(key)
 	s opt(key2,"id")=$s(divId'="":divId,1:opt(key,"id"))_count
 	if $g(Par("InDir")) {
	 	s addtab="--"
	 	s opt(key2,"Method")="FilesShow"
 	}
	s opt(key2,"TabName")=opt(key,"TabName")_$p($p(dir,$$$slash,*),".")_$g(addtab)
	
 	s opt(key2,"Dir")=dir
 	s opt(key2,"CGIvar")="&dir="_..EnCode(dir)
 	s Par=key2
 	;w dir
    d ..ShowTabApps(.Par,.opt)
    q $$$OK
]]></Implementation>
</Method>

<Method name="GetSortedList">
<Description>
Get a sorted list of files and directories</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key,dir,List,sort</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set wildcard=$s($zversion(1)=3:"*",1:"*.*")
    d ##class(apptools.core.files).GetList(dir,wildcard,.List)
	if key["audio" {
		s wc=##class(apptools.core.filesMimeTypes).GetTypesWildcards("audio")
		s sort("n")="Listen"
		;Gramophone icon (G)
		s sort("icon")="data:image/ico;base64,AAABAAEAICAQAAAAAADoAgAAFgAAACgAAAAgAAAAQAAAAAEABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAACAAAAAgIAAgAAAAIAAgACAgAAAwMDAAICAgAAAAP8AAP8AAAD//wD/AAAA/wD/AP//AAD///8AEREREREREREREAAAAAAAABk5OTk5OTk5MREAAAARERETk5OTk5OTk5EREQAAERERGTk5OTk5OTkxEREQABEREROTk5OTk5OTkRG7sAAAAAAZOTk5OTk5OTERERAAAAAAEREREREREREREREQAPAAAAF3d3d3dwd3d3EREADwCAAAEXd3dwAAd3d3cRAAALAAAAAQERAAAAEREREQAICwgAAAC/AAAAAAAA//AAcIuwAAD7sAAAAAAAAA/wB3C7sAAPu7AAAAAAAADw8HeAu7DAC/sAAAAAAAAA8Ad3CLu4gA+7AAAAAAAAAAB3ewi7uwAL+wAAAA8AAAAHd7cIu7sAALuwAAAAd4B3e3t7C7u7AAD7u3u7e3t3t7e3twu7vwAAALu7v7+/v39/f38Lu7uAAAAA+7u7u7u7u7u7C7u7gAAAAAAPv797u7u7uw+7uwAAAAAAAAALu7u7u7sLu7sAAAAAAAAAAAD7+/v7C7u7AAAAAAAAAAAIAA+/vwu7uwAAAAAAAAAAAAAA+/sIu7sAAAAAAAAAAAAAAA+/CLu4gAAAAAAAAAAAAAAA+3C7sAAAAAAAAAAAAAAAAA+wu7AAAAAAAAAAAAAAAAAA8IuwAAAAAAAAAAAAAAAAAAcLCAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAACAAAAB//AAAPwAAAAwAAAAFAAAAAfwAAAf8AAAHfAAABw8AAAcPwAAGB4AHjAcCB8gGBw+gAg//oAIP/8ACD8AAAwAAAAMAAAADAAAAA+AAAAP4AAAD/wAAA//wAAP//AAD///AA///4AP///AH///4B////Af///4H////D////4w=="
	}
	elseif key["camera" {
		s wc=##class(apptools.core.filesMimeTypes).GetTypesWildcards("image")_";"_##class(apptools.core.filesMimeTypes).GetTypesWildcards("video")
		s sort("n")="Watch"
		;Camera icon
		s sort("icon")="data:image/gif;base64,R0lGODlhEAAQAKIAAAAAAHt7AL29vXt7e/8AAP///wAAAAAAACH5BAkIAAEALAAAAAAQABAAAANJGBrT7iuOQmsRI6ppqSiZ1FFACYijB4RMqjbY01DwWn4CIGDroJcBk27nu/w2uyTPltsQdr/i7RQUCivNBSeV3biMEqW4W7VaEwA7"
	} else {
		s wc="*.fb2;*.zip;*.doc*"
		s sort("n")="To read"
		;Reader icon
		s sort("icon")="data:image/ico;base64,AAABAAIAICAQAAAAAADoAgAAJgAAABAQEAAAAAAAKAEAAA4DAAAoAAAAIAAAAEAAAAABAAQAAAAAAIACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAgAAAAICAAIAAAACAAIAAgIAAAICAgADAwMAAAAD/AAD/AAAA//8A/wAAAP8A/wD//wAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACIAAAAAAAAAAAAAAAAAACQd4gAAAAAAAAAAAAAAAAJkHd3iAAAAAAAAAAAAAAAmZgAd3eIAAAAAAAAAAAACZmAmQB3d4gAAAAAAAAAAJmYCZmZAHd3AAAAAAAAAAmZgJmZmZkAdwAAAAAAAACZmAmZmZmZmQAAAAAAAAAJmYCZmZmZmZmZAAAAAAAAmZgJmZmZmZmZmQAAAAAAAJmAmZmZmZmZmZAAAAAAAACYCZmZmZmZmZkAAAAAAAAAgJmZmZmZmZmQAAAAAAAAAACZmZmZmZmZAAAAAAAAAAAAAJmZmZmZkAAAAAAAAAAAAAAAmZmZmQAAAAAAAAAAAAAAAACZmZAAAAAAAAAAAAAAAAAAAJkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////////////////////////////////x////4H///8Af//+AB///AAH//gAAf/wAAP/4AAD/8AAA/+AAAH/AAAD/wAAB/8AAA//AAAf/4AAP//gAH//+AD///4B////g////+f///////////////////////////8oAAAAEAAAACAAAAABAAQAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAgAAAAICAAIAAAACAAIAAgIAAAICAgADAwMAAAAD/AAD/AAAA//8A/wAAAP8A/wD//wAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkHAAAAAAAAmAeIAAAAAAmAAHeAAAAAmAmZAHAAAAmAmZmZAAAACAmZmZkAAAAAmZmZkAAAAAAJmZkAAAAAAAAJkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAD//wAA/48AAP8DAAD+AAAA/AEAAPgBAADwAAAA8AEAAPADAAD4BwAA/g8AAP+fAAD//wAA//8AAA=="
	}
    s i="" 	s sort("d")=wc
	 for { s i=$o(List(i)) q:i=""  
 		s ItemName=$g(List(i,"ItemName"))
 		s DateModified=$tr($g(List(i,"DateModified")),"- :")
 		s type=$g(List(i,"Type"))
	 	if type="F" {
		 	s ext=$p(ItemName,".",*)
		 	continue:wc'[("*."_ext)
	 	}
	 	s sort("d",type,DateModified,$i(sort(type,DateModified)))=$lb(i,ItemName) ;sort by date
	 	s sort("n",type,ItemName)=$lb(i) ;sort by name
	 	i $i(sort("n",type))
	 }
	 q $$$OK
]]></Implementation>
</Method>

<Method name="FilesShow">
<Description>
Show pictures</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par="",dir="",sort</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	s key=$g(Par)
	set divId=$g(Par("divId"))
	s:key="" key=$g(Par("appPar"))
	s:key="" key=$g(Par("key"))
	s:dir="" dir=..DeCode($g(Par("dir")))
	set dynamic=%request.Application_"get-files/" ;dynamic path
	if '$d(sort) {
		d ..GetSortedList(Par, dir, .List, .sort)
	}
	s IdTab=$tr($p($zts,",",2),".")
	
	if key["-audio" { ;Show playlist
	 ;Header
	 set fields(1)="<img class='uk-preserve-width uk-border-circle' src='"_$g(sort("icon"))_"' width='40' alt=''>"
 	 set fields(2)=$p(dir,$$$slash,*),fields(2,"attr")="class='uk-table-expand'"
 	 do ..DrawTableUi("beg","TableAudio"_IdTab,"style='overflow: auto;'",.fields)
	 set i="" for num=1:1 { s i=$o(sort("n","F",i)) q:i=""
	  	s row(2)=$p($p($lg(sort("n","F",i),1),$$$slash,*),".",1,*-1)
 		s row(2,"attr")="class='uk-table-expand' "
 		set fileId=##class(apptools.core.files).GetFileIdView($lg(sort("n","F",i),1)) 
 		s nextrack="Track"_IdTab_"-"_$S($o(sort("n","F",i))="":1,1:num+1)
 		s row(1)="<audio id='Track"_IdTab_"-"_num_"'  src="""_dynamic_fileId_""" onended=""document.getElementById('"_nextrack_"').play();"" controls preload=""metadata""></audio>"
 		d ..DrawTableUi("tr",,,.row)
 		}
 	d ..DrawTableUi("end")
	$$$jsstart
	w "$('audio').on(""play"", function (me) {"_$C(13,10)
    w " $('audio').each(function (i,e) {"_$C(13,10)
    w "  if (e !== me.currentTarget) {"_$C(13,10)
    w "   this.pause(); "_$C(13,10)
	w "      }"_$C(13,10)
    w " });"_$C(13,10)
    w "});"_$C(13,10)
	 $$$jsstop
	q $$$OK
	} 
	elseif key["-books" { ;Show books
	 ;Header
	 set fields(1)="<img class='uk-preserve-width uk-border-circle' src='"_$g(sort("icon"))_"' width='40' alt=''>"
 	 set fields(2)=$p(dir,$$$slash,*),fields(2,"attr")="class='uk-table-expand'"
 	 do ..DrawTableUi("beg","TableBooks"_IdTab,"style='overflow: auto;'",.fields)
	 set i="" for { s i=$o(sort("n","F",i)) q:i=""
	  	s row(2)=$p($p($lg(sort("n","F",i),1),$$$slash,*),".",1,*-1)
 		s row(2,"attr")="class='uk-table-expand' "
 		set fileId=##class(apptools.core.files).GetFileIdView($lg(sort("n","F",i),1),,"application/force-download") 
 		s row(1)="<a href="""_dynamic_fileId_""">Download</a>"
 		d ..DrawTableUi("tr",,,.row)
 		}
 	d ..DrawTableUi("end")
	}
	else {
		;Show pictures sorted by modification date
		k List
		s i="" for { s i=$o(sort("d","F",i)) q:i=""
			s ii="" for { s ii=$o(sort("d","F",i,ii)) q:ii=""
				s List($i(List),"ItemName")=$lg(sort("d","F",i,ii),2)
				s List(List,"Name")=$lg(sort("d","F",i,ii),1)
			}
		}
		;zw List
		 $$$jsstart
	 	 write "UIkit.lightboxPanel({"
	   		write "items: [ "
			  do ..LighboxDrawJson(.List,,dynamic)
	  		write " ] }).show();"
		$$$jsstop
	}
	quit $$$OK
]]></Implementation>
</Method>

<Method name="OptionFirstHead">
<Description>
download template forms search</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	s path= ##class(apptools.lte.infochest).GetAppRootdir()
	set onclick=$$$blockui("Load...")_";"_##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","~key="_key_"~divId="_divId_"~mode=*")
		&html<
		<table width="90%" style="border-radius: 10px; border: 1px solid #72a7cf" cellpadding="2" cellspacing="0" class="DetailTable" bgcolor="#c4d6d6" >
		<tr>
			<td>
		Path to files
			</td>
			<td>
				#($$$appText(divId_"Path_to_files","title='path to files' size=80 ",path))#
			</td>		
		</tr>
		<tr>
			<td>
			
			</td>
			<td>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""","Save"))#
			</td>
		</tr>
		</table>
	>
	quit $$$OK
]]></Implementation>
</Method>

<Method name="OptionResult">
<Description>
Search result</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	set Name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"Path_to_files")	
	set st=$$$OK
	if mode=1 {
		write ..ButtonAgain(divId,key)
		if Name="" w $$$appError($$$aText("Context is empty","")) quit $$$OK
		do ##class(apptools.lte.infochest).SetAppRootdir(Name)
		write $$$appMsg(Name_" saved")
	} 
	write "<br>"
	quit $$$OK
]]></Implementation>
</Method>

<XData name="image">
<Description>
set base64 = ##class(apptools.core.rest).getStatic("apptools.lte.infochest:image") w !,base64,!</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
data:image/x-png;base64,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
]]></Data>
</XData>
</Class>


<Class name="apptools.lte.page404">
<Description>
404 not found</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>apptools.lte.adminTabs</Super>
<TimeChanged>65822,30217.549705</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
Application title</Description>
<Default>404 Page not found</Default>
</Parameter>

<Method name="MainParameter">
<Description>
Replace parameters</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&h,&par]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set path=par("=path=")
 set par("=Brand-Text=")="404 Page not found"
 set par("=Logo-image=")=path_"adminlte/dist/img/ApptoolsLogo.png"
 set par("=titleAppToolsadmin=")=..#HeaderText
 set par("<!--=LinkIcon=-->")=..GetAppIcon(path_"adminlte/dist/img/ApptoolsLogo","png")
 set par("=Message-default=")="Error 404: class "_$GET(par("input-class="))_" not found "
 set par("=Tab=")="Error"
 quit ..RepaceParameter(.h, .par)
 quit $$$OK
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what modes are available</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[ 	quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.lte.permiss">
<Description>
http://hp-msw:52773/apptoolsrest/a/permiss</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>apptools.lte.adminTabs</Super>
<TimeChanged>65868,34963.084065</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
Application title</Description>
<Default>Permissions</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files</Description>
<Default>^apptools.Permissions</Default>
</Parameter>

<Parameter name="AppRoles">
<Default>ui_Permissions</Default>
</Parameter>

<Method name="MainParameter">
<Description>
Replace parameters</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&h,&par]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set path=par("=path=")
 set par("=Brand-Text=")="Admin v.1"
 set par("=Logo-image=")=path_"adminlte/dist/img/ApptoolsLogo.png"
 set par("=titleAppToolsadmin=")=..#HeaderText
 set par("<!--=LinkIcon=-->")=..GetAppIcon(path_"adminlte/dist/img/ApptoolsLogo","png")
 quit ..RepaceParameter(.h,.par)
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what modes are available</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;side menu
	set sideMenuName="Permission",
		sideMenuNumer=1,
		sideMenuOpen=1,        //3 =1 open menu
		sideMenuIcon="fa-cog"  //4  icon   https://fontawesome.com/icons?d=gallery&p=2&m=free
		set sideMenu=$lb(sideMenuNumer,sideMenuName,sideMenuOpen,sideMenuIcon) 
			set key="MenuMatrix"
			set opt(key,"Menu")=sideMenu
			set opt(key)=$$$aText("The matrix","") ;The name of the menu
			set opt(key,"id")="Matrix"
			set opt(key,"TabName")=$$$aText("The matrix","") ;the name of the tab
			set opt(key,"ClassName")=..%ClassName(1)
			set opt(key,"Role")="%All"
			set opt(key,"Namespace")="%SYS"
			set opt(key,"Method")="ShowTabSample"
			set opt(key,"TabMenu","Close")=0 ;the tab cannot be deleted
			set opt(key,"Active")=1 ;active menu item
			set opt(key,"aw-icon")="fa-list-alt" ;fa-table"   https://fontawesome.com/icons?d=gallery&p=2&m=free

	;top menu
	set topMenuName="Account",
		topMenuNumer=99
	set key="menu-top-account3"
		set opt(key,"MenuTop")=$lb(topMenuNumer,topMenuName) ; 99-account has nested items
		set opt(key)="Exit"
		set opt(key,"id")="AccountExit"
		set opt(key,"TabName")="Logoit" 
		set opt(key,"ClassName")=..%ClassName(1)
		set opt(key,"Method")="Logout"
	
	do ..CheckRoleMenu(.opt)
	quit $$$OK
]]></Implementation>
</Method>

<Method name="MatrixFirstHead">
<Description>
download form template search users and roles</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set %ui=1
	//##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	set onclick=$$$blockui("Load...")_
		$$$onclick(divId_"MainForm",divId_"MainContent",$namespace,..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	&html<
		<table>
		<tr>
			<td>
 			Login <br>#($$$appText(divId_"name","title='"_$$$aText("Names separated by a comma or by context","")_"'","ms"))#
			</td>
			<td>
			Roles <br>#($$$appText(divId_"roles","title='"_$$$aText("Roles separated by a comma or by context","")_"'","d"))#
			</td>
			<td> <br>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""",""_$$$aText("User roles","")))#
			</td>
		</tr>
		</table>
	>
	$$$SetHeightContent(divId,250)
	q $$$OK
]]></Implementation>
</Method>

<Method name="MatrixResult">
<Description>
Search result </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set %ui=1
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	set name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"name")	
	set roles=$g(Par("%request.Data",divId_"roles"))
	write ..ButtonAgain(divId,key)
	do ##class(apptools.Tabs.security).UiMatrixPermission(name,roles,divId,key,"apptools.Tabs.security","UiSavePermiss")
	quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.lte.permiss2">
<Description>
http://hp-msw:52773/apptoolsrest/a/permiss2</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>apptools.lte.adminTabs</Super>
<TimeChanged>65868,34974.237726</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
Application title</Description>
<Default>Permissions</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files</Description>
<Default>^apptools.Permissions</Default>
</Parameter>

<Parameter name="AppRoles">
<Default>ui_Permissions</Default>
</Parameter>

<Method name="MainParameter">
<Description>
Replace parameters</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&h,&par]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set path=par("=path=")
 set par("=Brand-Text=")="Admin v.2"
 set par("=Logo-image=")=path_"adminlte/dist/img/ApptoolsLogo.png"
 set par("=titleAppToolsadmin=")=..#HeaderText
 set par("<!--=LinkIcon=-->")=..GetAppIcon(path_"adminlte/dist/img/ApptoolsLogo","png")
 quit ..RepaceParameter(.h,.par)
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what modes are available</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;side menu
	set sideMenuName="Permission",
		sideMenuNumer=1,
		sideMenuOpen=1,        //3 =1 open menu
		sideMenuIcon="fa-cog"  //4  icon   https://fontawesome.com/icons?d=gallery&p=2&m=free
		set sideMenu=$lb(sideMenuNumer,sideMenuName,sideMenuOpen,sideMenuIcon) 
			set key="MenuMatrix"
			set opt(key,"Menu")=sideMenu
			set opt(key)=$$$aText("The matrix","") ;The name of the menu
			set opt(key,"id")="Matrix"
			set opt(key,"TabName")=$$$aText("The matrix","") ;the name of the tab
			set opt(key,"ClassName")=..%ClassName(1)
			set opt(key,"Role")="%All"
			set opt(key,"Namespace")="%SYS"
			set opt(key,"Method")="ShowTabSample"
			set opt(key,"TabMenu","Close")=0 ;the tab cannot be deleted
			set opt(key,"Active")=1 ;active menu item
			set opt(key,"aw-icon")="fa-list-alt" ;fa-table"   https://fontawesome.com/icons?d=gallery&p=2&m=free

			set key="User-Copy"
			set opt(key,"Menu")=sideMenu
			set opt(key)=$$$aText("UserCopy","") ;The name of the menu
			set opt(key,"id")="UserCopy"
			set opt(key,"TabName")=$$$aText("UserCopy","") ;the name of the tab
			set opt(key,"ClassName")=..%ClassName(1)
			set opt(key,"Role")="%All"
			set opt(key,"Namespace")="%SYS"
			set opt(key,"Method")="ShowTabSample"
			set opt(key,"TabMenu","Close")=1
			set opt(key,"aw-icon")="fa-table"   ;https://fontawesome.com/icons?d=gallery&p=2&m=free

	;top menu
		s LeftMenuName="Support",LeftMenuNumer=1
		s key="menu-top-support"
		s opt(key)="support"
		s opt(key,"id")="Support"
		s opt(key,"TabName")="Support" 
		s opt(key,"ClassName")=..%ClassName(1)
		s opt(key,"Method")="ShowTabSupport"
		s opt(key,"TabMenu","Close")=1
		s opt(key,"MenuTop")=$lb(LeftMenuNumer,LeftMenuName)
	
	set topMenuName="Account",
		topMenuNumer=99
		set key="menu-top-accoun2"
		set opt(key)="Account: "_$username
		set opt(key,"id")="AccountProf"
		set opt(key,"TabName")="Profile "_$username 
		set opt(key,"ClassName")=..%ClassName(1)
		set opt(key,"Method")="ShowInIFrame" 
		set opt(key,"InFrameUrl")="http://"_$zu(110)_":52773/csp/sys/sec/%25CSP.UI.Portal.User.zen?PID="_$username
		set opt(key,"TabMenu","Close")=1
		set opt(key,"MenuTop")=$lb(topMenuNumer,topMenuName)
	set key="menu-top-account3"
		set opt(key,"MenuTop")=$lb(topMenuNumer,topMenuName) ; 99-account has nested items
		set opt(key)="Exit"
		set opt(key,"id")="AccountExit"
		set opt(key,"TabName")="Logoit" 
		set opt(key,"ClassName")=..%ClassName(1)
		set opt(key,"Method")="Logout"
	
	do ..CheckRoleMenu(.opt)
	quit $$$OK
]]></Implementation>
</Method>

<Method name="ShowTabSupport">
<Description>
the render Tab On the program"
Par - code menu item from the GetAllApps ..</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>key=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if $g(key("appPar"))'="" set key=key("appPar")
	do ..GetAllApps(.opt) 
	if $g(opt(key,"Disable")) write ..GetSupportInfo() quit $$$OK
	set divId=$g(opt(key,"id"))
	write ..#ToAdmin
	quit $$$OK
]]></Implementation>
</Method>

<Method name="MatrixFirstHead">
<Description>
download form template search users and roles</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set %ui=1
	//##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	set onclick=$$$blockui("Load...")_
		$$$onclick(divId_"MainForm",divId_"MainContent",$namespace,..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	&html<
		<table>
		<tr>
			<td>
 			Login <br>#($$$appText(divId_"name","title='"_$$$aText("Names separated by a comma or by context","")_"'","ms"))#
			</td>
			<td>
			Roles <br>#($$$appText(divId_"roles","title='"_$$$aText("Roles separated by a comma or by context","")_"'","d"))#
			</td>
			<td> <br>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""",""_$$$aText("User roles","")))#
			</td>
		</tr>
		</table>
	>
	$$$SetHeightContent(divId,250)
	q $$$OK
]]></Implementation>
</Method>

<Method name="MatrixResult">
<Description>
Search result </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set %ui=1
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	set name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"name")	
	set roles=$g(Par("%request.Data",divId_"roles"))
	write ..ButtonAgain(divId,key)
	do ##class(apptools.Tabs.security).UiMatrixPermission(name,roles,divId,key,"apptools.Tabs.security","UiSavePermiss")
	quit $$$OK
]]></Implementation>
</Method>

<Method name="UserCopyFirstHead">
<Description>
--------- User copy form</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set %ui=1
	//##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	set onclick=$$$blockui("Load...")_
		$$$onclick(divId_"MainForm",divId_"MainContent",$namespace,..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	&html<
		<table>
		<tr>
			<td>
 			Login <br>#($$$appText(divId_"name","title='"_$$$aText("Names separated by a comma or by context","")_"'","s"))#
			</td>
			<td>
			Unclude Fullname, Comment or Roles <br>#($$$appText(divId_"desc","title='"_$$$aText("Description","")_"'","s"))#
			</td>
			<td> <br>
			#($$$appButton(divId_"appButtonFind","onclick="""_$replace(onclick,"*","find")_"""",""_$$$aText("Find Users","")))#
			</td>

			<td>
 			Copy from <br>#($$$appText(divId_"copyfrom","title='"_$$$aText("Username copy from","")_"'",""))#
			</td>
			<td>
			Copy to <br>#($$$appText(divId_"copyto","title='"_$$$aText("Username copy to","")_"'",""))#
			</td>
			<td> <br>
			#($$$appButton(divId_"appButtonCopy","onclick="""_$replace(onclick,"*","copy")_"""",""_$$$aText("Copy Users","")))#
			</td>
		</tr>
		</table>
	>
	$$$SetHeightContent(divId,250)
	q $$$OK
]]></Implementation>
</Method>

<Method name="UserCopyResult">
<Description>
Search result </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set %ui=1
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	if mode="find" {
		;Geting elements from form and prepare array Par
		set name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"name")	
		set desc=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"desc")	
		write ..ButtonAgain(divId,key)
		set where="name['"_name_"'"
		if name="" set where="1=1"
		set wheredesc="1=1"
		if desc'="" set wheredesc="( Comment['"_desc_"' or FullName [ '"_desc_"' or Roles [ '"_desc_"' )"
		set sql="select name, comment, FullName, Superuser,Enabled, Roles, ExpirationDate,CreateDateTime,CreateUsername,LastModifiedDateTime,LastModifiedInfo,LastModifiedUsername, EmailAddress from Security.Users where "_where_" and "_wheredesc
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,100000,$namespace,$g(msg),$g(exec),,1)
	}
	if mode="copy" {
		;Geting elements from form and prepare array Par
		set copyfrom=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"copyfrom")	
		set copyto=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"copyto")	
		if copyfrom=""||(copyto="") write $$$appError("Username is empty") quit $$$OK
		set st=##class(Security.Users).Copy(copyfrom,copyto)
		if 'st write $$$appError($System.Status.GetErrorText(st)) quit $$$OK
		write $$$appMsg("Copied successfully") quit $$$OK
	}
	quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.lte.permiss3">
<Description>
http://hp-msw:52773/apptoolsrest/a/permiss2</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>apptools.lte.adminTabs</Super>
<TimeChanged>65868,35009.393923</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
Application title</Description>
<Default>Permissions</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files</Description>
<Default>^apptools.Permissions</Default>
</Parameter>

<Parameter name="AppRoles">
<Default>ui_Permissions</Default>
</Parameter>

<Method name="MainParameter">
<Description>
Replace parameters</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&h,&par]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set path=par("=path=")
 set par("=Brand-Text=")="Admin v.3"
 set par("=Logo-image=")=path_"adminlte/dist/img/ApptoolsLogo.png"
 set par("=titleAppToolsadmin=")=..#HeaderText
 set par("<!--=LinkIcon=-->")=..GetAppIcon(path_"adminlte/dist/img/ApptoolsLogo","png")
 quit ..RepaceParameter(.h,.par)
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what modes are available</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	;side menu
	set sideMenuName="Permission",
		sideMenuNumer=1,
		sideMenuOpen=1,        //3 =1 open menu
		sideMenuIcon="fa-cog"  //4  icon   https://fontawesome.com/icons?d=gallery&p=2&m=free
		set sideMenu=$lb(sideMenuNumer,sideMenuName,sideMenuOpen,sideMenuIcon) 
			set key="MenuMatrix"
			set opt(key,"Menu")=sideMenu
			set opt(key)=$$$aText("The matrix","") ;The name of the menu
			set opt(key,"id")="Matrix"
			set opt(key,"TabName")=$$$aText("The matrix","") ;the name of the tab
			set opt(key,"ClassName")=..%ClassName(1)
			set opt(key,"Role")="%All"
			set opt(key,"Namespace")="%SYS"
			set opt(key,"Method")="ShowTabSample"
			set opt(key,"TabMenu","Close")=0 ;the tab cannot be deleted
			set opt(key,"Active")=1 ;active menu item
			set opt(key,"aw-icon")="fa-list-alt" ;fa-table"   https://fontawesome.com/icons?d=gallery&p=2&m=free

			set key="User-Copy"
			set opt(key,"Menu")=sideMenu
			set opt(key)=$$$aText("UserCopy","") ;The name of the menu
			set opt(key,"id")="UserCopy"
			set opt(key,"TabName")=$$$aText("UserCopy","") ;the name of the tab
			set opt(key,"ClassName")=..%ClassName(1)
			set opt(key,"Role")="%All"
			set opt(key,"Namespace")="%SYS"
			set opt(key,"Method")="ShowTabSample"
			set opt(key,"aw-icon")="fa-table"   ;https://fontawesome.com/icons?d=gallery&p=2&m=free

	;top menu
		s LeftMenuName="Support",LeftMenuNumer=1
		s key="menu-top-support"
		s opt(key)="support"
		s opt(key,"id")="Support"
		s opt(key,"TabName")="Support" 
		s opt(key,"ClassName")=..%ClassName(1)
		s opt(key,"Method")="ShowTabAbout"
		s opt(key,"TabMenu","Close")=1
		s opt(key,"MenuTop")=$lb(LeftMenuNumer,LeftMenuName)
	
	set topMenuName="Account",
		topMenuNumer=99
		set key="menu-top-accoun2"
		set opt(key)="Account: "_$username
		set opt(key,"id")="AccountProf"
		set opt(key,"TabName")="Profile "_$username 
		set opt(key,"ClassName")=..%ClassName(1)
		set opt(key,"Method")="ShowInIFrame" 
		set opt(key,"InFrameUrl")="http://"_$zu(110)_":52773/csp/sys/sec/%25CSP.UI.Portal.User.zen?PID="_$username
		set opt(key,"MenuTop")=$lb(topMenuNumer,topMenuName)
	set key="menu-top-account3"
		set opt(key,"MenuTop")=$lb(topMenuNumer,topMenuName) ; 99-account has nested items
		set opt(key)="Exit"
		set opt(key,"id")="AccountExit"
		set opt(key,"TabName")="Logoit" 
		set opt(key,"ClassName")=..%ClassName(1)
		set opt(key,"Method")="Logout"
	
	;----- Setup the search in the top menu
	s key="Search"
	s opt(key)="Search"
	s opt(key,"id")="Search-"
	s opt(key,"TabName")="Search"_"-"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSearch"
	s opt(key,"TabMenu","Mode")=0 ;1 - for each new search bar to make new tab, 0-tab is always the same
	
	do ..CheckRoleMenu(.opt)
	quit $$$OK
]]></Implementation>
</Method>

<Method name="MatrixFirstHead">
<Description>
download form template search users and roles</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set %ui=1
	//##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	set onclick=$$$blockui("Load...")_
		$$$onclick(divId_"MainForm",divId_"MainContent",$namespace,..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	&html<
		<table>
		<tr>
			<td>
 			Login <br>#($$$appText(divId_"name","title='"_$$$aText("Names separated by a comma or by context","")_"'","ms"))#
			</td>
			<td>
			Roles <br>#($$$appText(divId_"roles","title='"_$$$aText("Roles separated by a comma or by context","")_"'","d"))#
			</td>
			<td> <br>
			#($$$appButton(divId_"appButtonResult1","onclick="""_$tr(onclick,"*",1)_"""",""_$$$aText("User roles","")))#
			</td>
		</tr>
		</table>
	>
	$$$SetHeightContent(divId,250)
	q $$$OK
]]></Implementation>
</Method>

<Method name="MatrixResult">
<Description>
Search result </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set %ui=1
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	;Geting elements from form and prepare array Par
	set name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"name")	
	set roles=$g(Par("%request.Data",divId_"roles"))
	write ..ButtonAgain(divId,key)
	do ##class(apptools.Tabs.security).UiMatrixPermission(name,roles,divId,key,"apptools.Tabs.security","UiSavePermiss")
	quit $$$OK
]]></Implementation>
</Method>

<Method name="UserCopyFirstHead">
<Description>
--------- User copy form</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set %ui=1
	//##class(apptools.core.Action).WriteActJs(%request,divId_"MainForm",divId_"MainContent",..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	set onclick=$$$blockui("Load...")_
		$$$onclick(divId_"MainForm",divId_"MainContent",$namespace,..%ClassName(1),divId_"Result","&key="_key_"&divId="_divId_"&mode=*")
	&html<
		<table>
		<tr>
			<td>
 			Login <br>#($$$appText(divId_"name","title='"_$$$aText("Names separated by a comma or by context","")_"'","s"))#
			</td>
			<td>
			Unclude Fullname, Comment or Roles <br>#($$$appText(divId_"desc","title='"_$$$aText("Description","")_"'","s"))#
			</td>
			<td> <br>
			#($$$appButton(divId_"appButtonFind","onclick="""_$replace(onclick,"*","find")_"""",""_$$$aText("Find Users","")))#
			</td>

			<td>
 			Copy from <br>#($$$appText(divId_"copyfrom","title='"_$$$aText("Username copy from","")_"'",""))#
			</td>
			<td>
			Copy to <br>#($$$appText(divId_"copyto","title='"_$$$aText("Username copy to","")_"'",""))#
			</td>
			<td> <br>
			#($$$appButton(divId_"appButtonCopy","onclick="""_$replace(onclick,"*","copy")_"""",""_$$$aText("Copy Users","")))#
			</td>
		</tr>
		</table>
	>
	$$$SetHeightContent(divId,250)
	q $$$OK
]]></Implementation>
</Method>

<Method name="UserCopyResult">
<Description>
Search result </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Par=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set %ui=1
	do ##class(apptools.core.Form).BlockUI(0)
	set key=Par("key")
	set divId=Par("divId")
	set mode=Par("mode")
	if mode="find" {
		;Geting elements from form and prepare array Par
		set name=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"name")	
		set desc=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"desc")	
		write ..ButtonAgain(divId,key)
		set where="name['"_name_"'"
		if name="" set where="1=1"
		set wheredesc="1=1"
		if desc'="" set wheredesc="( Comment['"_desc_"' or FullName [ '"_desc_"' or Roles [ '"_desc_"' )"
		set sql="select name, comment, FullName, Superuser,Enabled, Roles, ExpirationDate,CreateDateTime,CreateUsername,LastModifiedDateTime,LastModifiedInfo,LastModifiedUsername, EmailAddress from Security.Users where "_where_" and "_wheredesc
		set st=##class(apptools.core.LogInfoPane).DrawSQL(sql,100000,$namespace,$g(msg),$g(exec),,1)
	}
	if mode="copy" {
		;Geting elements from form and prepare array Par
		set copyfrom=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"copyfrom")	
		set copyto=##class(apptools.core.Action).GetElemForm(%request,.Par,divId_"copyto")	
		if copyfrom=""||(copyto="") write $$$appError("Username is empty") quit $$$OK
		set st=##class(Security.Users).Copy(copyfrom,copyto)
		if 'st write $$$appError($System.Status.GetErrorText(st)) quit $$$OK
		write $$$appMsg("Copied successfully") quit $$$OK
	}
	quit $$$OK
]]></Implementation>
</Method>
</Class>


<Class name="apptools.lte.smarthome">
<Description>
http://hp-msw:52773/apptoolsrest/a/smarthome</Description>
<ClassType/>
<IncludeCode>apptools.core</IncludeCode>
<ProcedureBlock>1</ProcedureBlock>
<Super>apptools.lte.adminTabs</Super>
<TimeChanged>65868,35030.799266</TimeChanged>
<TimeCreated>65065,36454.902831</TimeCreated>
<DependsOn>apptools.core.msg</DependsOn>

<Parameter name="HeaderText">
<Description>
Application title</Description>
<Default>Home, smart home</Default>
</Parameter>

<Parameter name="GNStore">
<Description>
Global Name Store Referens files</Description>
<Default>^appmsw.smarthome.ui</Default>
</Parameter>

<Parameter name="AppRoles">
<Default>%All</Default>
</Parameter>

<Method name="Init">
<Description>
do ##class(apptools.lte.adminsample).Init()</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set ServerPort=##class(apptools.core.net).GetURI(.prop)
	write !,"Open in browser "
    do ##class(apptools.core.Installer).AddAndWriteFavorite(##class(apptools.core.Installer).#AppName_" SampleAdminPanel","/"_##class(apptools.core.Installer).#AppCSP_"rest/a/smarthome",ServerPort)
]]></Implementation>
</Method>

<Method name="MainParameter">
<Description>
Replace parameters</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&h,&par]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 set path=par("=path=")
 set base64=##class(apptools.core.rest).getStatic(..%ClassName(1)_":image")
 set par("=path=")=path
 set par("=Brand-Text=")="Smart Home"
 set par("=Logo-image=")=base64
 set par("=titleAppToolsadmin=")=..#HeaderText
 set par("<!--=LinkIcon=-->")=..GetAppIcon(,"png",base64)
 quit ..RepaceParameter(.h, .par)
 quit $$$OK
]]></Implementation>
</Method>

<Method name="GetAllApps">
<Description>
what modes are available</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>opt</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if ..IsPermiss("%All") {	
	;make them zavisimye from the area
	;------------ sidebar
	s key="menu-first"
	set Level1=$lb(1,"Home",1) ;$lg(,3)=1 - open menu level 1
	s opt(key)="Sensor values" ;The name of the menu
	s opt(key,"id")="Find" ;use methods: FindFirstHead FindResult
	s opt(key,"TabName")="Sensors" ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"Menu")=Level1
	s opt(key,"Active")=1 ;active menu item

	s key="menu-first2"
	s opt(key)="Snapshots" ;Pictures from cameras
	s opt(key,"id")="Lighbox" ;use methods: LighboxFirstHead LighboxResult
	s opt(key,"TabName")="Snapshots" ;the name of the tab
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSample"
	s opt(key,"Disable")=0 ;developed
	s opt(key,"Menu")=Level1

	;----------
	s key="menu-second"
	set Level2=$lb(2,"Tablo",0)
	s opt(key)="Tenis"
	s opt(key,"id")="Tenis"
	s opt(key,"TabName")="Ping pong scores"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"MethodUrl")="http://ShowTabAbout.cls"
	s opt(key,"Disable")=1 ;developed
	s opt(key,"Menu")=Level2

	s key="menu-second2"
	s opt(key)="About"
	s opt(key,"id")="About"
	s opt(key,"TabName")="About"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"Disable")=1 ;developed
	s opt(key,"Menu")=Level2

	
	;------------ one-level upper menu 
		s key="menu-topOpt"
	s opt(key)="Option"
	s opt(key,"id")="Option"
	s opt(key,"TabName")="Option"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"TabMenu","Close")=1
	s opt(key,"MenuTop")=$lb(2,"Option") ;has no sub-items

	;------------ top menu the top-accoun
	s key="menu-top-accoun"
	set Level99=$lb(99,"Account") ;only 99-account has sub-items
	s opt(key)="Profile"
	s opt(key,"id")="AccountProf"
	s opt(key,"TabName")="Profile"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabAbout"
	s opt(key,"TabMenu","Close")=1
	s opt(key,"MenuTop")=Level99

	s key="menu-top-account3"
	s opt(key)="Exit"
	s opt(key,"id")="AccountExit"
	s opt(key,"TabName")="Exit"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="Logout"
	s opt(key,"TabMenu","Close")=1
	s opt(key,"MenuTop")=Level99
	
	;----- Setup the search in the top menu
	s key="Search"
	s opt(key)="Search"
	s opt(key,"id")="Search-"
	s opt(key,"TabName")="Search"_"-"
	s opt(key,"ClassName")=..%ClassName(1)
	s opt(key,"Method")="ShowTabSearch"
	s opt(key,"TabMenu","Close")=1
	s opt(key,"TabMenu","Mode")=0 ;1 - for each new search bar to make new tab, 0-tab is always the same
	
	}
	q $$$OK
]]></Implementation>
</Method>

<XData name="image">
<Description>
set base64 = ##class(apptools.core.rest).getStatic("apptools.lte.smarthome:image") w !,base64,!</Description>
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
data:image/x-png;base64,
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
nk71qAAAAABJRU5ErkJggg==
]]></Data>
</XData>
</Class>


<Class name="apptools.python.xlsx">
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65968,77555.431457</TimeChanged>
<TimeCreated>65923,76431.799769265</TimeCreated>

<Method name="sql2xlsx">
<Description>
do ##class(apptools.python.xlsx).sql2xlsx("select * from apptools_core.Log order by id desc","n,,,,,n,,,,d","/tmp/sample-py.xlsx")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>sql,format="",file:%String="d:\_proj\python\sample-py-*.xlsx",title=""</FormalSpec>
<Implementation><![CDATA[
	set st=$$$OK
	set myQuery = ##CLASS(%ResultSet).%New("%DynamicQuery:SQL")
	set st=myQuery.Prepare(sql)
	if 'st q st
	set st=myQuery.Execute()
	if 'st q st
	
	;prepare XLSX
	set file=$Replace(file,"*",$Tr($zts,".,"))
	try {
        set openpyxl = ##class(%SYS.Python).Import("openpyxl") 
    } catch err {
        set sc = ##class(%SYS.Python).Install("openpyxl")
        set openpyxl = ##class(%SYS.Python).Import("openpyxl") 
    }
	set wb = openpyxl.Workbook()
	#; grab the active worksheet
	set ws = wb.active
	set ws.title = "Report"
	set pybuiltins = $system.Python.Import("builtins")
	set pycols = pybuiltins.list()
	do pycols.append(" ")
	do ws.append(pycols)
	set ws."__getitem__"("A2").value=title

	set pycols = pybuiltins.list()
	set (count)=0
	set ColCount=myQuery.GetColumnCount()
	for i=1:1:ColCount {	
		do pycols.append(myQuery.GetColumnName(i))
		set col=$C(i+64)
		if i<27 set ws."column_dimensions"."__getitem__"(col).width = "20"
	}
	do ws.append(pycols)

	while (myQuery.Next())	{
		set count=count+1
		set pyrows = pybuiltins.list()
		for ii=1:1:ColCount {
			set val=myQuery.GetData(ii)
			if $P(format,",",ii)="d" { //date
				set dt = ##class(%SYS.Python).Import("datetime")
				set val=dt.datetime(+$p(val,"-",1), +$p(val,"-",2), +$p($p(val,"-",3)," "),+$p($p(val,":",1)," ",2),+$p($p(val,":",2)," ",2),+$p($p(val,":",3)," ",2))
			}
			if $P(format,",",ii)="n" { //number
				set val=+val
			}
			do pyrows.append(val)
		}
		do ws.append(pyrows)
	}
   ;}
	write !,"Save into "_file_" rows: "_count
	do wb.save(file)
	q $GET(count)
]]></Implementation>
</Method>

<Method name="rest">
<Description>
do ##class(apptools.python.xlsx).rest(.par)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>par</FormalSpec>
<Implementation><![CDATA[
	Set json = $$$NewDynObj
 	set json.jsonrpc="2.0"
	set json.code=1
	;set json.params=par
	set json.message="OK"
	set json.ns=$namespace
	if $GET(par("params"))'="" {
		set params={}.%FromJSON(par("params"))
		set gn=params.gn
		if gn'="" {
			if 1 {
				job ##class(apptools.python.xlsx).globals2xlsx(gn)::1 
				if $t set json.result="Task runed. "_gn
				else  set json.result="Task not runed. "_gn
			}
			else {
				set st=##class(apptools.python.xlsx).globals2xlsx(gn)
				set json.result="Runed "_gn
			}
		}
	}
	else {
		set json.result="Job not started."
	}
	$$$DynObjToJSON(json)
	q $$$OK
]]></Implementation>
</Method>

<Method name="globals2xlsx">
<Description>
do ##class(apptools.python.xlsx).globals2xlsx("^tmpQuery","/backup/temp/giszkh-*.xlsx")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>gn</FormalSpec>
<Implementation><![CDATA[
	set patternxlsx=$lg(@gn,9)
	set paternfile=$lg(@gn,1) //;set pattern="/backup/temp/reports/gis-*.xlsx"
	set transname=$lg(@gn,10)
	set q=""
	for { set q=$o(@gn@(q)) q:q=""
		set GN=$na(@gn@(q))
		if '$d(@GN@(-3,"par"),data) set stat="Is not report "_GN continue
		set format=$lg(data,2)
		set name=$lg(data,1)
		set rows=$lg(data,4)
		set file=$replace(paternfile,"*",transname_"-"_$zd($h,3)_"_"_$zt($p($h,",",2),1))
		set file=$tr(file,":")
		set st=##class(apptools.python.xlsx).gn2xlsx(GN,format,file,name,patternxlsx)
		set stat="rows="_rows_" -> "_st
		set @GN@(-3,"par")=@GN@(-3,"par")_$lb(file)
	}
	quit $G(stat)
]]></Implementation>
</Method>

<Method name="gn2xlsx">
<ClassMethod>1</ClassMethod>
<FormalSpec>gn,format="",file:%String,title="",patternxlsx=""</FormalSpec>
<Implementation><![CDATA[
	set st=$$$OK

	if '$d(@gn@(1)) q $$$ERROR($$$GeneralError,"Is empty glovals data")

	try {
        set openpyxl = ##class(%SYS.Python).Import("openpyxl") 
    } catch err {
        set sc = ##class(%SYS.Python).Install("openpyxl")
        set openpyxl = ##class(%SYS.Python).Import("openpyxl")
    }

	if patternxlsx'="" {
		try {
			set wb = openpyxl."load_workbook"(patternxlsx)
		} catch err {
			set wb = openpyxl.Workbook()
		}
	}
	else {		
		set wb = openpyxl.Workbook()
	}
	;set sheetname="Report"
	set sheetname=$qs(gn,1)
	
	#; grab the active worksheet
	set ws = wb.active
	set ws.title = sheetname_$g(a)
	set pybuiltins = $system.Python.Import("builtins")
	set pycols = pybuiltins.list()
	;do pycols.append(" ")
	;do ws.append(pycols)
	set ws."__getitem__"("A1").value=title

	set pycols = pybuiltins.list()
	set (count)=0
	set ColCount=$ll(@gn@(0))
	for i=1:1:ColCount {	
		do pycols.append($lg(@gn@(0),i))
		set col=$C(i+64)
		if i<27 {
			set width=$s($P(format,",",i)="d":17,$P(format,",",i)="n":10,1:30)
			set ws."column_dimensions"."__getitem__"(col).width = width
		}
	}
	do ws.append(pycols)

	for row=1:1 {
		quit:'$d(@gn@(row),data)
		set count=count+1
		set pyrows = pybuiltins.list()
		for ii=1:1:ColCount {
			set val=$lg(data,ii)
			if $P(format,",",ii)="d",val'="" { //date
				set dt = ##class(%SYS.Python).Import("datetime")
				set val=dt.datetime(+$p(val,"-",1), +$p(val,"-",2), +$p($p(val,"-",3)," "),+$p($p(val,":",1)," ",2),+$p($p(val,":",2)," ",2),+$p($p(val,":",3)," ",2))
			}
			if $P(format,",",ii)="n" { //number
				set val=+val
			}
			do pyrows.append(val)
		}
		do ws.append(pyrows)
	}
   ;}
	write !,"Save into "_file_" rows: "_count
	do wb.save(file)
	q $GET(count)
]]></Implementation>
</Method>
</Class>


<Class name="apptools.util.XLSX">
<Description>
Report generation in a given directory upon request with a given field format</Description>
<IncludeCode>apptools.core,%occODBC</IncludeCode>
<TimeChanged>65839,58764.427203</TimeChanged>
<TimeCreated>64273,2606.599454</TimeCreated>

<Method name="Report2xlsx">
<Description>
Report generation in a given directory upon request with a given field format
set sc = ##class(apptools.util.XLSX).Report2xlsx("/backup/temp/reports","select top 10 id,ClassName  FROM apptools.core.Log order by id desc","AppLogReport",",N")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>directory:%String,sql="",filename="",format="",args...</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	q:sql="" $$$OK
	try {
		set directory = ##class(%File).NormalizeDirectory(directory)
		#dim sc As %Status = $$$OK

		if ('##class(%File).DirectoryExists(directory)) {
			do ##class(%File).CreateDirectoryChain(directory)
		}
		if ##class(%Dictionary.CompiledClass).%ExistsId("isc.SetEnv") {
			set env = "EXCELMEMSIZE"
			set sc = ##class(isc.SetEnv).Setup()
			quit:$$$ISERR(sc) 
			set sc = ##class(isc.SetEnv).SetEnvVar(env, "7048m")
			quit:$$$ISERR(sc) 
			set val = $system.Util.GetEnviron(env)
		}
		
		i filename="" s filename=query_"-"_$system.Util.CreateGUID()
		set file = filename_".xlsx"
		;set $$$AppL("MSW",$username_" Generated step 1")=directory_file
		w !,"Generated in "_directory_file
		set sc = ..generateFileFromSQL(directory_file, sql,format,args...)
		if $$$ISERR(sc) w !,$System.Status.GetErrorText(sc) quit 
		;set $$$AppL("MSW",$username_" Compliet step 2")=directory_file
		w !,"Compliet "_directory_file
		;set ..reportStream.Filename = directory _ file 
		;set sc = ..%Save()
	} Catch ex {
	   Set sc = $g(%objlasterror, $$$OK)
	   Set sc = $$$ADDSC(sc, ex.AsStatus())
	   ;set $$$AppL("MSW",$username_" Error")=$lb(ex.Name,ex.Code,ex.Location)
	   w "Error type   "_ex.Name,!
	   w "Error code   "_ex.Code,!
	   w "Error location "_ex.Location,!
 }
	quit sc
]]></Implementation>
</Method>

<Method name="generateFileFromSQL">
<Description>
Outputs Excel-compliant table from sql into file. args are sql arguments
Does not support
w ##class(mvk.util.XLSX).generateFileFromSQL(,"SELECT * FROM Sample.Person")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>file:%String=##class(%File).TempFilename("xlsx"),sql:%String,format="",args...</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#dim sc As %Status = $$$OK
	
	set xmlfile = ##class(%File).TempFilename("xml")
	set sc = ..generateXMLFromSQL(xmlfile, sql,format, args...)
	quit:$$$ISERR(sc) sc
	
	set sc = ..generateXLSXfromXML(xmlfile, file)
	
	do:$$$ISOK(sc) ##class(%File).Delete(xmlfile)

	
	quit sc
]]></Implementation>
</Method>

<Method name="generateXMLFromSQL">
<Description>
Outputs XML to be fed into %SYS.ZENReportExcelExporter Excel-compliant stream from sql into file. args are sql arguments</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>xmlfile:%String,sql:%String,format="",args...</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#dim sc As %Status = $$$OK
	set st = ##class(%SQL.Statement).%New()
	set sc = st.%Prepare(sql)
	quit:$$$ISERR(sc) sc
	#dim result As %SQL.StatementResult
	set result = st.%Execute(args...)
	set stream = ##class(%Stream.FileCharacter).%New()
	set sc=stream.LinkToFile(xmlfile)
	quit:$$$ISERR(sc) sc
	set header = ##class(%Dictionary.XDataDefinition).IDKEYOpen($classname(), "header").Data.Read(10000)
	do stream.Write(header)
	;set $$$AppL("MSW",$username_"header")=header
	#dim metadata As SQL.StatementMetadata
	set metadata = result.%GetMetadata()
	set columnCount = metadata.columns.Count()
	for i=1:1:columnCount {
		#dim column As %SQL.StatementColumn
		set column = metadata.columns.GetAt(i)
		;!!!
		set class(i) = "<item excelName="""_ column.colName _ """"
		if $p(format,",",i)'="" {
			s type=$e($zconvert($p(format,",",i),"L"),1)
			set type="isExcel"_$s(type="n":"Number",type="d":"Date",type="t":"Time",1:"")_"=""1"" "
			set class(i) = class(i) _ " "_type
		}
		elseif column.IsNumeric() {
			set class(i) = class(i) _ " isExcelNumber=""1"""
		} elseif ..isDate(column.ODBCType) {
			set class(i) = class(i) _ " isExcelDate=""1"""
		} elseif ..isTime(column.ODBCType)  {
			set class(i) = class(i) _ " isExcelTime=""1"""	
		}
		set class(i) = class(i) _ ">"
	}
	while result.%Next() {
		do stream.WriteLine("<Row>")
		for i=1:1:columnCount {
			set data = result.%GetData(i)
			set:$lv(data) data = $lts(data)
			set data=$zstrip(data,"*C")
			do stream.WriteLine(class(i) _ $zcvt(data, "O", "XML") _ "</item>")
			if $i(row)
		}
		do stream.WriteLine("</Row>")
	}
	do stream.WriteLine("</sheet></MyReport>")
	set sc=stream.%Save()
	return sc
]]></Implementation>
</Method>

<Method name="generateXLSXfromXML">
<ClassMethod>1</ClassMethod>
<FormalSpec>xmlfile:%String,file:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set exportType = "xlsx"
	set outputdir = ##class(%File).GetDirectory(file)
	set outputfile = file
	set isMultiSheet = $$$YES
	set aggregateTag = ""
	set reportName = "Report"
	set logfile = ##class(%File).TempFilename("log")
	set suppresExcelHeaders = $$$NO
	set ExcelMode = "element"
	set DisplayLog= $$$NO
	
	set sc = ##class(%SYS.ZENReportExcelExporter).CommonExport(exportType, xmlfile, outputdir, outputfile, isMultiSheet, aggregateTag, reportName, logfile, suppresExcelHeaders, ExcelMode, DisplayLog)
	
	do:$$$ISOK(sc) ##class(%File).Delete(logfile)	
	
	return sc
]]></Implementation>
</Method>

<Method name="isDate">
<ClassMethod>1</ClassMethod>
<FormalSpec>odbcType:%Integer</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	return:odbcType=$$$ODBCTYPEtimestamp $$$YES
	return:odbcType=$$$ODBCTYPEdate $$$YES
	return $$$NO
]]></Implementation>
</Method>

<Method name="isTime">
<ClassMethod>1</ClassMethod>
<FormalSpec>odbcType:%Integer</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	return:odbcType=$$$ODBCTYPEtime $$$YES
	return $$$NO
]]></Implementation>
</Method>

<XData name="header">
<MimeType>application/yaml</MimeType>
<Data><![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
 <MyReport xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:zr="http://www.intersystems.com/zenreports" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:svg="http://www.w3.org/2000/svg">
 <sheet excelSheetName="Report">
]]></Data>
</XData>
</Class>


<Class name="apptools.util.gotoiris">
<Description>
Adaption to IRIS</Description>
<Abstract>1</Abstract>
<IncludeCode>apptools.core</IncludeCode>
<TimeChanged>65685,38918.718132</TimeChanged>
<TimeCreated>65118,33195.953362</TimeCreated>

<Method name="compile">
<Description>
d ##class(apptools.util.gotoiris).CompNS(ns)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>Class:%String="",package:%String=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 q $$$OK
 s ^%qCacheObjectSys("strictchecking")=0
 k er d $system.OBJ.CompileAll("cfk-u-d",.er) zw er
 ;CompileAllNamespaces
 ;d $system.OBJ.CompileAllNamespaces()
 ;d $system.OBJ.CompilePackage(package,"cdfk-u")
 
 ;w $$defdir^%SYS.GLO($namespace) ;w $zu(12,"")

 ;zn "%SYS"
 ;d ##class(Config.CPF).PendingRestart(.r)
 ;d ##class(Config.CPF).Validate()
 ;d ##class(Config.CPF).Activate()
 ;zw ^SYS("CONFIG") ;Config.CPF
 ;^%SYS
 ;zw ^SYS("Security") - all users, privileges, roles, resources and applications
]]></Implementation>
</Method>

<Method name="RenameDB4IRIS">
<Description>
When going from Ensemble to IRIS
zn "app" w !,$System.Status.GetErrorText(##class(apptools.core.sys).DismountListDB("AAA"))
d ##class(apptools.util.gotoiris).RenameDB4IRIS("/opt2/isc/iris/mgr/AAA/")
zn "app" w !,$System.Status.GetErrorText(##class(apptools.core.sys).MountListDB("AAA"))</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>dir</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(apptools.core.files).GetAllDir(dir,,.L)
	set i=""
	for  { set i=$o(L(i)) quit:i=""
		set file=$lg(L(i),1)
		w !,file
		if $p(file,$$$slash,*)="CACHE.DAT" {
			s newfile=$replace(file,"CACHE","IRIS")
			If ##class(%File).Rename(file,newfile) w !,"renamed ",newfile
		}
		elseif $p(file,$$$slash,*)="cache.lck" {
			If ##class(%File).Delete(file) w !,"removed "_file
		}
	}
]]></Implementation>
</Method>

<Method name="CompNS">
<Description>
Recompilation to IRIS namespace
d ##class(apptools.util.gotoiris).CompNS("AAA")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ns</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	zn ns
	d ##class(%EnsembleMgr).EnableNamespace(ns,1)
	w !,"Compilation started, please wait..."
	k err d $system.OBJ.CompileAll("cfk-u-d",.err) zw err
	q $$$OK
]]></Implementation>
</Method>

<Method name="RecovNS">
<Description>
IRIS area processing package after copying the database from Ensemble
d ##class(apptools.util.gotoiris).RecovNS("AAA")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ns</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set st=##class(apptools.core.sys).DismountListDB(ns)
	if st {
		d ##class(apptools.util.gotoiris).RenameDB4IRIS("/opt/isc/iris/mgr/"_ns_"/")
		set st=##class(apptools.core.sys).MountListDB(ns)
		if st {
			d ##class(apptools.util.gotoiris).CompNS(ns)
		} else {
			w !,$System.Status.GetErrorText(st)
		}
	} else {
		w !,$System.Status.GetErrorText(st)
	}
]]></Implementation>
</Method>
</Class>


<Class name="apptools.util.json">
<IncludeCode>%ZEN.Utils</IncludeCode>
<ProcedureBlock>0</ProcedureBlock>
<TimeChanged>65719,99.877075181</TimeChanged>
<TimeCreated>64766,31033.601325</TimeCreated>

<Method name="Test">
<Description>
set sc=##class(apptools.util.json).Test(.obj)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&out,aa]]></FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set o = ##class(%ZEN.proxyObject).%New()
	set a("name")=$zv
	 set a("zvname")=$zu(110)
	 for i=1:1:5 set a("zvname",i)=i_"sss"
	 d o.%CopyFromArray(.a)
	 s aa=##class(apptools.core.Log).WriteJSONFromObject(o)
	 q 1
	 s st=o.%SerializeObject(.out)
	 zw out
	q $$$OK
]]></Implementation>
</Method>

<Method name="Export">
<Description>
set sc=##class(apptools.util.json).Export($na(^SAMPLE.PersonD),.json) do json.%ToJSON()</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>GlobalRoot:%String,*JSON:%DynamicObject</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if '$d(@GlobalRoot) quit $System.Status.Error(5001, "Nothing to export; "_GlobalRoot_" <undefined>")
	set root=$p(GlobalRoot,")",1,$l(GlobalRoot,")")-1),node=GlobalRoot s:root="" root=GlobalRoot
	set JSON=##class(%DynamicObject).%New()
	set JSON.globalName=$p(GlobalRoot,"(",1)
	set JSON.nodes=##class(%DynamicArray).%New()
	while $e(node,1,$l(root))=root {
		if $d(@node)#10 do ..addNode(node,.JSON)
		set node=$q(@node)
	}
	quit 1
]]></Implementation>
</Method>

<Method name="addNode">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[node:%String,&JSON:%DynamicObject]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set nodeJSON=##class(%DynamicObject).%New()
	set data=@node,nodeJSON.data=##class(%CSP.Page).EscapeHTML(data)
	set subscripts=$p(node,"(",2,999),subscripts=$p(subscripts,")",1,$l(subscripts,")")-1)
	if ""'=subscripts {
		set nodeJSON.subscripts=##class(%DynamicArray).%New()
		set cp=1
		for {
			q:cp>$l(subscripts,",")
			set subscript=$p(subscripts,",",cp)
			f  {
				q:$l(subscript,"""")#2
				set cp=cp+1,subscript=subscript_","_$p(subscripts,",",cp)
			}
			set subArray=$i(subArray),subArray(subArray)=subscript
			set cp=cp+1
		}
		for i=1:1:subArray do nodeJSON.subscripts.%Push(##class(%CSP.Page).EscapeHTML(subArray(i)))
	}	
	do JSON.nodes.%Push(nodeJSON)
]]></Implementation>
</Method>

<Method name="GlobalToJSON">
<Description><![CDATA[
d ##class(apptools.util.json).GlobalToJSON("^tmp")

Write out the contents of the named global or % array <var>pGlobalName</var> in JSON format.
Subscripts become JSON property names and $List values become JSON arrays.<br/>
<var>pFormat</var> is a flags string that controls output formatting options.<br/>
The following character option codes are supported:<br/>
1-9 : indent with this number of spaces (4 is the default with the 'i' format specifier)<br/>
b - line break before opening { of objects<br/>
i - indent with 4 spaces unless 't' or 1-9<br/>
n - newline (lf)<br/>
s - use strict JSON output - <strong>NOTE:</strong> special care should be taken when sending data to a browser, as using this flag 
may expose you to cross site scripting (XSS) vulnerabilities if the data is sent inside <code>&lt;script&gt;</code> tags. Zen uses
this technique extensively, so this flag should <strong>NOT</strong> be specified for jsonProviders in Zen pages.<br/>
t - indent with tab character<br/>
u - output pre-converted to UTF-8 instead of in native internal format<br/>
w - Windows-style cr/lf newline<br/>
<var>pNodeName</var> is the name of a special JSON property used to hold the top-level value of a global node.]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pGlobalName="",pFormat:%String="tw",pNodeName:%String="^_",pLevel:%Integer=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Quit:$IsObject(pGlobalName) ##class(%ZEN.Auxiliary.jsonProvider).%ObjectToJSON(pGlobalName,,,pFormat) // switch around; call global export from inside jsonProvider.%ObjectToJSON
	Quit:$Case($E(pGlobalName),"^":0,"%":0,:1) $$$ERROR($$$GeneralError,"Array name must start with % or ^.  Found '"_pGlobalName_"'")
	Set tSC = $$$OK
	Set tLF=$S(pFormat["w":$C(13,10), pFormat["n":$C(10), 1:"")
	If pFormat'=$TR(pFormat,"it123456789") { Set tN=+$ZStrip(pFormat,"<E'N"), $P(tTab,$S(pFormat["t":$C(9),1:" "),1+$S(tN:tN,pFormat["t":1,1:4))="" }
	Else { Set tTab="" }
	Set tIncludeWhitespace = (tLF_tTab'="")
	If pFormat["o" || 'pLevel {
		Set tPropCount = ""
		If (tIncludeWhitespace && pLevel) Set tIndent="", $P(tIndent,tTab,pLevel+1)="" Write $S(pFormat["b":tLF_tIndent,1:" ")
		Write "{"
	} Else {
		Set tPropCount = 0
	}
	Try {
		Set d = $D(@pGlobalName,tVal)
		If d#2 {
			// process node top value
			If d>1||'pLevel {
				Do nextProp
				Write $$$ZENJSONPROP(pNodeName,pFormat)_":" ; note: erroneously escapes $C(11) as \v
			}
			Do ..writeScalar(tVal,pFormat,pLevel)
		}
		If d>1||'pLevel {
			// process node child values
			Set k="" For { Set k=$O(@pGlobalName@(k))  Quit:""=k
				If k=pNodeName Set tSC=$$$ERROR($$$GeneralError,"Array subscript name collision with top node name '"_pNodeName_"'")  Quit
				Do nextProp
				Write $$$ZENJSONPROP(k,pFormat)_":"
				Set tSC=..GlobalToJSON($Name(@pGlobalName@(k)),pFormat,pNodeName,pLevel+1)  Quit:$$$ISERR(tSC)
			}
			If tPropCount'=0 {
				#; either we wrote at least one property or we wrote an empty '{' due to "o" mode or level zero
				If tIncludeWhitespace Set tIndent="", $P(tIndent,tTab,pLevel+1)="" Write tLF_tIndent
				Write "}"
			}
		}
	}
	Catch ex {
		Set tSC = ex.AsStatus()
		Write "null"
	}
	Quit tSC
nextProp
	If tPropCount=0 {
		If (tIncludeWhitespace && pLevel) Set tIndent="", $P(tIndent,tTab,pLevel+1)="" Write $S(pFormat["b":tLF_tIndent,1:" ")
		Write "{"
	} ElseIf tPropCount {
		Write ","
	} ; else tPropCount="" means we already did the starting '{' due to "o" mode
	Set tPropCount = tPropCount + 1
	If tIncludeWhitespace Set tIndent="", $P(tIndent,tTab,pLevel+2)="" Write tLF_tIndent
	Quit
]]></Implementation>
</Method>

<Method name="writeScalar">
<Internal>1</Internal>
<ClassMethod>1</ClassMethod>
<FormalSpec>pVal:%String,pFormat:%String,pLevel:%Integer,pForceStr:%Boolean=0</FormalSpec>
<Implementation><![CDATA[
	If ""=pVal||'$ListValid(pVal) {
		Write $S('pForceStr&&$$$ZENJSISNUM(pVal):$$$ZENJSNUM(pVal), 1:$$$ZENJSONSTR(pVal,pFormat)) ; note: erroneously escapes $C(11) as \v
	} Else {
		Write "["
		For i=1:1:$LL(pVal) {
			Write:i>1 ","
			If $LD(pVal,i) {
				Set tItem = $LI(pVal,i)
				Do ..writeScalar(tItem,pFormat,.pLevel,$ListValid(tItem)||$Case($E($LB($LI(pVal,i)),2), $C(1):1, $C(2):1, :0))
			} Else {
				Write "null"
			}
		}
		Write "]"
	}
]]></Implementation>
</Method>

<Method name="GlobalsToJSONStream">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&pArrOfGlobalNames:%String,pStream:%Stream.Object,pFormat:%String="tw",pNodeName:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set tSC = $$$OK
	Do pStream.Write("{"_$C(13,10))
	Set k="" For i=1:1 { Set k=$O(pArrOfGlobalNames(k))  Quit:""=k
		Do:i>1 pStream.Write(","_$C(13,10))
		Do pStream.Write($$$ZENJSONPROP("^"_$E(k,1,*-4),pFormat)_":")
		Set tSC = ..GlobalToJSONStream("^"_$E(k,1,*-4),pStream,pFormat)  Quit:$$$ISERR(tSC)
	}
	Do pStream.Write($C(13,10)_"}")
	Quit tSC
]]></Implementation>
</Method>

<Method name="GlobalToJSONStream">
<Description>
remove; not needed if global support is integrated in jsonProvider</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pObject:%String,pStream:%Stream.Object,pFormat:%String,pNodeName:%String</FormalSpec>
<ProcedureBlock>0</ProcedureBlock>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	New %ISCJSONStream, tSC, ex, tInitIO, tRedirected, tWasRedirected, tOldMnemonic
	Set tSC = $$$OK
	Set tRedirected = 0
	Try {
		Set tWasRedirected = 0
		Set tOldMnemonic = ""

		Set:'$IsObject($G(pStream)) pStream=##class(%Stream.TmpBinary).%New()

		Set tInitIO = $IO
		Set tWasRedirected = ##class(%Library.Device).ReDirectIO()
		Set tOldMnemonic = ##class(%Library.Device).GetMnemonicRoutine()
		Set %ISCJSONStream = pStream
		Use tInitIO::("^"_$ZNAME)
		Set tRedirected = 1
		Do ##class(%Library.Device).ReDirectIO(1)

		Set tSC = ..GlobalToJSON(.pObject,.pFormat,.pNodeName)
	}
	Catch ex {
		Set tSC = ex.AsStatus()
	}
	If tRedirected && ##class(%Library.Device).ReDirectIO(0) {
		Use tInitIO
	}
	If ($get(tOldMnemonic) '= "") {
		Set tOldMnemonic = "^"_tOldMnemonic
		Use tInitIO::(tOldMnemonic)
	}
	If $get(tWasRedirected) {
		Do ##class(%Library.Device).ReDirectIO(1)
	}
	Quit tSC
]]></Implementation>
</Method>

<Method name="redirects">
<Internal>1</Internal>
<ClassMethod>1</ClassMethod>
<Private>1</Private>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
	Quit
#; Public entry points for redirection - any changes made here should
#; also be reflected in redirects() in the jsonSQLProvider class
wstr(s) Do %ISCJSONStream.Write(s) Quit
wchr(a) Do %ISCJSONStream.Write($char(a)) Quit
wnl Do %ISCJSONStream.Write($char(13,10)) Quit
wff Do %ISCJSONStream.Write($char(13,10,13,10)) Quit
wtab(n) New chars Set $piece(chars," ",n+1)="" Do %ISCJSONStream.Write(chars) Quit
rstr(len,time) Quit ""
rchr(time) Quit ""
]]></Implementation>
</Method>

<Method name="SaveTrakLayout">
<ClassMethod>1</ClassMethod>
<FormalSpec>pFile:%String="",pFormat:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#dim tSC As %Status
	#dim tIO As %String
	Set tSC=$$$OK,$ZT="Trap",tIO=$IO
	Do {
		// Pick a default filename
		Set:pFile="" pFile=$system.Util.InstallDirectory()_"distlib/trak/misc/HSDBLayout.json"

		// Now, build a list of globals to export
		Write "Collecting globals, please be patient ...",!
		Do ..findLayoutGlobals(.tGlobals)

		Write "Exporting to ",pFile,!
		Set tFileStream = ##class(%IO.FileStream).%New()
		Do tFileStream.Open(pFile,"NEW",,,.tSC)  Quit:$$$ISERR(tSC)
		Set tFileStream.CharEncoding = "UTF8"
		Set tSC = ..GlobalsToJSONStream(.tGlobals, tFileStream, .pFormat) Quit:$$$ISERR(tSC)
		Do tFileStream.Close()
	} While (0)
Exit
	Do:$$$ISERR(tSC) $system.OBJ.DisplayError(tSC)
	Quit tSC
Trap
	Set $ZT="",tSC=$$$ERROR($$$CacheError,$ZE)
	Goto Exit
]]></Implementation>
</Method>

<Method name="findLayoutGlobals">
<Internal>1</Internal>
<ClassMethod>1</ClassMethod>
<FormalSpec>alist</FormalSpec>
<Implementation><![CDATA[
	Do findGlobals("^epr*",				.alist)
	Do findGlobals("^oo*",				.alist)
	Do findGlobals("^websys.Dict*",		.alist)
	Do findGlobals("^websys.Pref*",		.alist) 
	Do findGlobals("^websys.Stan*",		.alist)
	Do findGlobals("^websys.Trans*",	.alist)
	Do findGlobals("^websys.Work*",		.alist)

	// Remove exceptions
	Kill alist("epr.CTChartItemTypeD.gbl")
	Kill alist("epr.CTChartItemTypeI.gbl")

	#; Include Layout Verison
	Set alist("HS.Layout.gbl")=""
	Quit

findGlobals(spec,list)
	If $E(spec,$L(spec))="*" {
		// Wildcards
		Set (spec,glo) = $E(spec,1,$L(spec)-1)
		For {
			If $D(@spec) {
				Set list($E(spec,2,$L(spec))_".gbl")=""
			}
			Set spec = $O(^$global(spec))
			Quit:spec=""
			Quit:$E(spec,1,$L(glo))'=glo
		}
	} Else {
		// Specific global
		Set:$D(@spec) list($E(spec,2,$L(spec))_".gbl")=""
	}
	Quit
]]></Implementation>
</Method>

<Method name="ParseJSONToGlobal">
<Description><![CDATA[
Parse the input string <var>pJSON</var> containing JSON notation
and store it in a named global or % array <var>pGlobalName</var>.<br/>
<var>pJSON</var> could also be a character stream.<br/>
JSON objects nested within JSON arrays cannot be imported because JSON arrays are imported as $List values. A $List value can contain other $List elements but not object references or COS arrays.<br/>
<var>pNodeName</var> is the name of a special JSON property used to hold the top-level value of a global node.
<var>pCharsProcessed</var> and <var>pLevel</var> are used internally and do not have to be supplied.
Note that this method assumes well-formed JSON content; it does not perform complete error checking.]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pJSON:%String,pGlobalName:%String,pNodeName:%String="^_",*pCharsProcessed:%Integer,pLevel:%Integer=1,pFirstChar:%String=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
#define WHITESPACE(%c) (((%c)=" ")||((%c)=$C(10))||((%c)=$C(13))||((%c)=$C(9)))
#define MATCHHEXCHARS(%hex,%n) (%hex ? %n(1N,1(1"A",1"B",1"C",1"D",1"E",1"F",1"a",1"b",1"c",1"d",1"e",1"f")))

	Set tSC = $$$OK
	Try {
		Set pCharsProcessed = 0
		Set p = 1
		Set tToken = ""
		Set tProperty = ""
		Set tValue = ""
		Set tState = 0
		Set tIsString = 0
		Set tPropQuoted = 0
		Set tQuote = ""
		Set tUnicodeHex = ""
		Set tHex = ""
		Set tArrayList ="" // used to accumulate $List arrays for storage into the global
		Set list = "" // passed ByRef in place of global name when we need to get back a child $List array
		Set tIO=$S('$IsObject(pJSON):"",1:+pJSON.%Extends("%IO.I.Stream"))
		
		While $$$ISOK(tSC) {
			// test end condition; get next character
			If $L(tIO) {
				If (pFirstChar'="") {
					Set ch = pFirstChar, pFirstChar = ""
				} Else {
					Quit:pJSON.AtEnd
					Set ch = $S(tIO:pJSON.Read(1,,.tSC), 1:pJSON.Read(1,.tSC))  Quit:$$$ISERR(tSC)
				}
			} Else {
				Quit:p>$L(pJSON)
				Set ch = $E(pJSON,p)
			}
			Set p = p + 1
			Set pCharsProcessed = pCharsProcessed + 1

			If (tState = 0) {
				If ch = "{" {
					// start of object
					Kill @pGlobalName ; invalid list
					Set tState = 1
				} ElseIf ch = "[" {
					Set tToken = ""
					Set tIsString = 0
					Set tState = 5
				} ElseIf '$$$WHITESPACE(ch) {
					Set tSC = $$$ERROR($$$GeneralError,"Expected { or [ at start of JSON text.")
					Quit
				}
			}
			ElseIf (tState = 1) {
				If ch = "}" {
					// end of object
					Quit
				} ElseIf ch = """" && 'tPropQuoted {
					Set tPropQuoted = 1
					Set tToken = ""
					Set tState = 2
				} ElseIf ch'="" && '$$$WHITESPACE(ch) {
					// start of property name
					Set tToken = ch
					Set tState = 2
				}
			}
			ElseIf (tState = 2) {
				// property name
				If ch = "\" {
					Set tState = "2a"
				} ElseIf tPropQuoted {
					If ch = """" {
						Set tPropQuoted = 0
					} Else {
						Set tToken = tToken _ ch
					}
				} Else {
					If ch = ":" {
						Set tProperty = tToken, tToken = ""
 //#define ZENJSONUNESCAPE(%str,%format)		$S(%format["s":$ZCVT(%str,"I",$$$ZENJSONTABLE(%format)),1:$ZCVT(%str,"I",$$$ZENJSTABLE(%format)))
						// Set tProperty = ..%UnescapeJSONString(tToken) ; unescaping done in states 2abc
						Set tState = 3
						Set tIsString = 0
					} ElseIf '$$$WHITESPACE(ch) {
						Set tToken = tToken _ ch
					}
				}
			}
			// NOTE: States 2a, 2b and 2c are defined as the last few states as we expect escaped property names to be very rare
			ElseIf (tState = 3) || (tState = 5) {
				// property or array value
				If ch = "," || (ch = "}") || (ch = "]") {
					// end of value
					Set tValue = $S(tIsString:tToken, 1:$Case(tToken,"null":"","true":1,"false":0,"":"",:+tToken))
					If tState = 3 {
						If tProperty=pNodeName { Set @pGlobalName = tValue }
						Else { Set:(tToken'="null"||tIsString)&&$L(tProperty) @pGlobalName@(tProperty) = tValue }
						Set tState = 1
						Quit:ch="}" // end of object
					} Else {
						Set:$L(tToken)||tIsString tArrayList = tArrayList _ $S(tToken="null"&&'tIsString:$LB(), 1:$LB(tValue))
						If ch = "]" {
							If ""=pGlobalName { Set pGlobalName = tArrayList }
							Else { Set @pGlobalName = tArrayList }
							Quit // end of array
						}
					}
					Set tToken = "", tProperty = "", tValue = "", tIsString = 0
				} ElseIf ch = "{" || (ch = "[") {
					// start of object- or list- valued property
					If $IsObject(pJSON) { Set tSubJSON = pJSON, tPoke = ch } // simulate stream unwind
					Else { Set tSubJSON = $E(pJSON,p-1,*), tPoke = "" }
					If tState = 3 {
						Set tSC = ..ParseJSONToGlobal(tSubJSON,$S(tProperty=pNodeName:pGlobalName, 1:$Name(@pGlobalName@(tProperty))),pNodeName,.tChars,pLevel+1,tPoke)  Quit:$$$ISERR(tSC)
					} Else {
						If ch = "{" Set tSC=$$$ERROR($$$GeneralError,"JSON object within JSON Array not supported for import into Global at '"_pGlobalName_"'")  Quit
						Set tSC = ..ParseJSONToGlobal(tSubJSON,.list,"",.tChars,pLevel+1,tPoke)  Quit:$$$ISERR(tSC)
						Set tArrayList = tArrayList _ $LB(list), list=""
					}
					Set tProperty = ""
					Set p = p + tChars - 1
					Set pCharsProcessed = pCharsProcessed + tChars - 1
				} ElseIf ch = """" || (ch = "'") {
					// start of string
					Set tToken = ""
					Set tIsString = 1
					Set tQuote = ch
					Set tState = 4
				} ElseIf '$$$WHITESPACE(ch) {
					// must be a numeric value, or true,false,or null
					Set tToken = tToken _ ch
				}
			}
			ElseIf (tState = 4) {
				// string literal
				If ch = "\" {
					// escape?
					Set tState = "4a"
				} ElseIf ch = tQuote {
					// end of quoted string
					Set tState = $S(""=tProperty:5, 1:3)
				} Else {
					Set tToken = tToken _ ch
				}
			}
			// NOTE: States 4a, 4b and 4c precede states 2a, 2b and 2c as we expect literal strings to need escaping more often than property names
			ElseIf (tState = "4a") {
				// \ in string
				If ch = "u" {
					Set tUnicodeHex = ""
					Set tState = "4b"
				} ElseIf ch = "x" {
					// add special case support for \xNN escape sequences that are valid in Javascript
					Set tHex = ""
					Set tState = "4c"
				} Else {
					// Support escape sequences defined in RFC 4627, as well as \' and also \v because ^NLS "JS" mode does it on output
					Set tToken = tToken _ $Case(ch, "\": "\", "'": "'", """": """", "/": "/", "b": $char(8), "f": $char(12), "n": $char(10), "r": $char(13), "t": $char(9), "v": $char(11), : "\" _ ch)
					Set tState = 4
				}
			}
			ElseIf (tState = "4b") {
				// in \uXXXX escape sequence
				Set tUnicodeHex = tUnicodeHex _ ch
				If $length(tUnicodeHex) = 4 {
					// Check that we do actually have a Hex value
					If $$$MATCHHEXCHARS(tUnicodeHex,4) {
						Set tUnicodeDecimal = $zhex(tUnicodeHex)
						Set tToken = tToken _ $char(tUnicodeDecimal)
					} Else {
						Set tToken = tToken _ "\u" _ tUnicodeHex
					}
					Set tState = 4
				}
			}
			ElseIf (tState = "4c") {
				// in \xNN escape sequence
				Set tHex = tHex _ ch
				If $length(tHex) = 2 {
					// Check that we do actually have a Hex value
					If $$$MATCHHEXCHARS(tHex,2) {
						Set tCodeDecimal = $zhex(tHex)
						Set tToken = tToken _ $char(tCodeDecimal)
					} Else { // Not a hex escape
						Set tToken = tToken _ "\x" _ tHex
					}
					Set tState = 4
				}
			}
			ElseIf (tState = "2a") {
				// \ in property name
				If ch = "u" {
					Set tUnicodeHex = ""
					Set tState = "2b"
				} ElseIf ch = "x" {
					// add special case support for \xNN escape sequences that are valid in Javascript
					Set tHex = ""
					Set tState = "2c"
				} Else {
					// Support escape sequences defined in RFC 4627, as well as \' and also \v because ^NLS "JS" mode does it on output
					Set tToken = tToken _ $Case(ch, "\": "\", "'": "'", """": """", "/": "/", "b": $char(8), "f": $char(12), "n": $char(10), "r": $char(13), "t": $char(9), "v": $char(11), : "\" _ ch)
					Set tState = 2
				}
			}
			ElseIf (tState = "2b") {
				// in \uXXXX escape sequence
				Set tUnicodeHex = tUnicodeHex _ ch
				If $length(tUnicodeHex) = 4 {
					#; Check that we do actually have a Hex value
					If $$$MATCHHEXCHARS(tUnicodeHex,4) {
						Set tUnicodeDecimal = $zhex(tUnicodeHex)
						Set tToken = tToken _ $char(tUnicodeDecimal)
					} Else {
						Set tToken = tToken _ "\u" _ tUnicodeHex
					}
					Set tState = 2
				}
			} ElseIf (tState = "2c") {
				// in \xNN escape sequence
				Set tHex = tHex _ ch
				If $length(tHex) = 2 {
					#; Check that we do actually have a Hex value
					If $$$MATCHHEXCHARS(tHex,2) {
						Set tCodeDecimal = $zhex(tHex)
						Set tToken = tToken _ $char(tCodeDecimal)
					} Else { // Not a hex escape
						Set tToken = tToken _ "\x" _ tHex
					}
					Set tState = 2
				}
			}
		}
	}
	Catch ex {
		Set tSC = ex.AsStatus()
	}
	Quit tSC
]]></Implementation>
</Method>

<Method name="ParseJSONToGlobals">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[pJSON:%String,&pArrOfGlobalNames:%String,pNodeName:%String="^_",*pCharsProcessed:%Integer,pLevel:%Integer=1,pFirstChar:%String=""]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set tRaw = '$D(pArrOfGlobalNames)
	Set tSC = $$$OK, p=1, pCharsProcessed=0, tIO=$S('$IsObject(pJSON):"",1:+pJSON.%Extends("%IO.I.Stream"))
	While $$$ISOK(tSC) {
		// test end condition; get next character
		If $L(tIO) {
			Quit:pJSON.AtEnd
			Set ch = $S(tIO:pJSON.Read(1,,.tSC), 1:pJSON.Read(1,.tSC))  Quit:$$$ISERR(tSC)
		} Else {
			If (p > $L(pJSON)) Quit
			Set ch = $E(pJSON,p)
		}
		Set p = p + 1
		Set pCharsProcessed = pCharsProcessed + 1
		
		If ch = "}" {
			Quit:$D(tGlobalName)
			Set tSC = $$$ERROR($$$GeneralError,"Found unexpected }")  Quit
		}
		If ch = "{" || (ch = ",") {
			Set tGlobalName = ""
			While $$$ISOK(tSC) {
				// test end condition; get next character of Global name
				If $L(tIO) {
					Quit:pJSON.AtEnd
					Set tGlobalName = tGlobalName _ $S(tIO:pJSON.Read(1,,.tSC), 1:pJSON.Read(1,.tSC))  Quit:$$$ISERR(tSC)
				} Else {
					If (p > $L(pJSON)) Quit
					Set tGlobalName = tGlobalName _ $E(pJSON,p)
				}
				Set p = p + 1
				Set pCharsProcessed = pCharsProcessed + 1
				Quit:":"=$E(tGlobalName,*)
			}
			Set tGlobalName=$ZStrip($E(tGlobalName,1,*-1),"<>WC")
			Set:$Case($E(tGlobalName),"""":1,"'":1,:0) tGlobalName=$E(tGlobalName,2,*-1)
			If tRaw {
				Set pArrOfGlobalNames($I(pArrOfGlobalNames))=tGlobalName
				Set tSC = ..ParseJSONToGlobal(pJSON,tGlobalName,pNodeName,.tChars,1,"")
				Set pArrOfGlobalNames(pArrOfGlobalNames,"c") = tChars
			} Else {
				Set tMappedName = $G(pArrOfGlobalNames(tGlobalName),"<empty>")
				If $Case($E(tMappedName),"^":0,"%":0,:1) {
					Set tSC = $$$ADDSC(tSC,$$$ERROR($$$GeneralError,"Array name must start with % or ^.  Found '"_tMappedName_"' mapped from '"_tGlobalName_"'"))
					Set tMappedName = "^CacheTmp.JSONJunk"  // import but ignore
				}
				Set:$L(tMappedName)>32 $E(tMappedName,20,20+($L(tMappedName)-32)) = ""
				Set tSC = ..ParseJSONToGlobal(pJSON,tMappedName,pNodeName,.tChars,1,"")
				Set pArrOfGlobalNames(tGlobalName,"c") = tChars
				Set pArrOfGlobalNames(tGlobalName,"m") = tMappedName
				Set:tMappedName="^CacheTmp.JSONJunk" pArrOfGlobalNames(tGlobalName,"x") = 1
			}
			Set p = p + tChars
			Set pCharsProcessed = pCharsProcessed + tChars
		}
	}
	Quit tSC
]]></Implementation>
</Method>

<Method name="LoadTrakLayout">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[pFile:%String="",&pGlobals]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	// Now, build a list of globals to export
	//Set pGlobals("^HS.Layout")="^TLayout"
	If $D(pGlobals)<=1 {
		Write "Collecting globals, please be patient ...",!
		Kill pGlobals
		Do ..findLayoutGlobals(.pGlobals)
		Set k="" For { Set k=$O(pGlobals(k))  Quit:""=k
			Set test("^"_$E(k,1,*-4))="^T."_$E(k,1,*-4)
		}
	} Else {
		Merge test = pGlobals
	}
	Set tStream = ##class(%IO.FileStream).%New(pFile), tStream.CharEncoding = "UTF8", tStream.BuildCharPosMap = 0
	Set tSC = ..ParseJSONToGlobals(tStream,.test)
	
	Set k="" For { Set k=$O(test(k))  Quit:""=k
		If '$G(test(k,"x")) {
			Set diff = $$compareArrays^EnsUtil(k,test(k,"m"))
			If ""'=diff Set tSC = $$$ADDSC(tSC,$$$ERROR($$$GeneralError,"Imported global differs from original global at '"_k_"'")), test(k,"e") = tSC
		}
	}
	Kill pGlobals  Merge pGlobals=test
	Quit tSC
]]></Implementation>
</Method>

<Method name="ZPretty">
<Description><![CDATA[
s j={"Name":"Li,Robert K.","SSN":"672-92-9664","DOB":"1975-01-12","Home":{"Street":"986 Washington Blvd","City":"Boston","State":"PA","Zip":"95802"},"Office":{"Street":"6012 First Place","City":"Reston","State":"MT","Zip":"77739"},"Spouse":{"Name":"Avery,Zelda H.","SSN":"323-13-7437","DOB":"1943-03-27","Home":{"Street":"196 Main Drive","City":"Youngstown","State":"WY","Zip":"53229"},"Office":{"Street":"4056 Franklin Court","City":"Bensonhurst","State":"IA","Zip":"27688"},"FavoriteColors":["Black"],"Age":77},"Age":45,"Title":"Associate Marketing Manager","Salary":10421}
write ##class(apptools.util.json).ZPretty(j)
ZPretty ; make JSON readable
#; input= JSON string | stream | %DynamicAbstractObject
#; indent filler  ; "" => no indent         
#define fill "  "
#; New line code   ; "" => no Lines
#define crlf $c(13,10)]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>input,fil="  ",nl={$c(13,10)}</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 q $$Do(input,fil,nl)
Do(input,fil,nl) public {
    set sc=1,res="",indt=""
    I $iso(input),input.%IsA("%Library.DynamicAbstractObject") S obj=input
    E  S obj=##class(%Library.DynamicAbstractObject).%FromJSON(input)
    S stc=0,ito=obj.%GetIterator(),sep=""
        ,jtyp=$s(obj.%IsA("%Library.DynamicObject"):"object",1:"array")
        ,ist(stc)=ito, cst(stc)=obj, tst(stc)=jtyp
    I $i(stc)
    S res=res_$s(jtyp="object":"{",1:"["), indt=indt_fil
    F { S isito=ito.%IsA("%Iterator.Object")
        I ito.%GetNext(.key,.val) {
	        S jtyp=$CASE(obj.%GetTypeCodeOf(key),0:"null"
	                        ,1:"boolean",2:"boolean",3:"number",4:"number"
	                        ,6:"array",7:"object",8:"string",9:"number"
	                        ,10:"illegalvalue"
	                        ,11:"number",12:"oref",13:"unassigned"
	                        ,14:"number",15:"number",16:"string"
	                        ,18:"number",19:"number",20:"string"
	                        ,31:"unassigned",:"UNKNOWN")
            S res=res_sep_nl_indt, sep="," }
		Else {
            S indt=$e(indt,1,*-$l(nl)), res=res_nl_indt, res=res_$s(isito:"}",1:"]")
            Q:'$i(stc,-1)
            S ito=ist(stc), obj=cst(stc), jtyp=tst(stc), sep=","
            Continue }
        I isito S res=res_""""_key_""":"
        I (jtyp="object") || (jtyp="array") {
            S ist(stc)=ito, cst(stc)=obj, tst(stc)=jtyp, sep=""
            I $i(stc)
            S ito=val.%GetIterator(),obj=val, indt=indt_fil
            	,res=res_$s(jtyp="object":"{",1:"[")
        } ElseIf jtyp="string" { S res=res_""""_$zcvt(val,"O","JSON")_""""
        } ElseIf jtyp="boolean" { S res=res_$s(val:"true",1:"false")
        } ElseIf jtyp="null" { S res=res_"null"
        } Else { I $e(val)="." S val="0"_val
            I $e(val,1,2)="-." S val="-0."_$e(val,3,*)
            S res=res_val } }
    Q res 
    }
]]></Implementation>
</Method>
</Class>
</Export>
